<!doctype html>

<!--[if lt IE 7 ]> <html class="ie ie6 no-js" lang="ca"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie ie7 no-js" lang="ca"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie ie8 no-js" lang="ca"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie ie9 no-js" lang="ca"> <![endif]-->
<!--[if gt IE 9]><!--><html class="no-js" lang="ca"><!--<![endif]-->
<!-- the "no-js" class is for Modernizr. -->

<head id="www-sitename-com" data-template-set="html5-reset">

	<meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html">
        
	<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>Serveis de Xarxa i Internet</title>
	
<!-- <meta name="title" content=""> --> 
	<meta name="description" content="">
	<!-- Google will often use this as its description of your page/site. Make it good. -->
	
	<meta name="google-site-verification" content="">
	<!-- Speaking of Google, don't forget to set your site up: http://google.com/webmasters -->
	
	<meta name="author" content="Institut Obert de Catalunya">
	<meta name="Copyright" content="Copyright Institut Obert de Catalunya 2011. All Rights Reserved.">

	<!-- Dublin Core Metadata : http://dublincore.org/ -->
	<meta name="DC.title" content="Serveis de Xarxa i Internet">
	<meta name="DC.subject" content="Informàtica i comunicacions">
	<meta name="DC.creator" content="Institut Obert de Catalunya">
	
	<!--  Mobile Viewport Fix
	j.mp/mobileviewport & davidbcalhoun.com/2010/viewport-metatag 
	device-width : Occupy full width of the screen in its current orientation
	initial-scale = 1.0 retains dimensions instead of zooming out if page height > device height
	maximum-scale = 1.0 retains dimensions instead of zooming in if page width < device width
	-->
	<!-- Uncomment to use � use thoughtfully!
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	-->

	<link rel="shortcut icon" href="../../../img/favicon.ico">
	<!-- This is the traditional favicon.
		 - size: 16x16 or 32x32
		 - transparency is OK
		 - see wikipedia for info on browser support: http://mky.be/favicon/ -->
		 
	<link rel="apple-touch-icon" href="../../../img/apple-touch-icon.png">
	<!-- The is the icon for iOS's Web Clip.
		 - size: 57x57 for older iPhones, 72x72 for iPads, 114x114 for iPhone4's retina display (IMHO, just go ahead and use the biggest one)
		 - To prevent iOS from applying its styles to the icon name it thusly: apple-touch-icon-precomposed.png
		 - Transparency is not recommended (iOS will put a black BG behind the icon) -->
	
	<!-- CSS: screen, mobile & print are all in the same file -->
	<link rel="stylesheet" href="../../../_/css/style.css">

	<!-- CSS: jQuery UI -->
	<link rel="stylesheet" href="../../../_/css/jquery-ui.css">
	
	<!-- all our JS is at the bottom of the page, except for Modernizr. -->
	<script src="../../../_/js/modernizr-1.7.min.js"></script>
	<script src="../../../_/js/Hyphenator.js" type="text/javascript"></script>
	<script type="text/javascript">
	   Hyphenator.config({
		minwordlength : 4
	   });
	   Hyphenator.run();
	</script>
    <script src="../../../_/js/build.js" type="text/javascript"></script>
</head>

<body class="style-newspaper">

<div class="wrapper"><!-- not needed? up to you: http://camendesign.com/code/developpeurs_sans_frontieres -->

	<header id="header">
		<div class="head"><a href="http://ioc.gencat.cat"><img src="../../../img/logo.png" alt="Institut Obert de Catalunya"/></a><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/es/deed.ca"><img src="../../../img/license.png" alt="Llic&egrave;ncia" class="license"/></a></div>
		<div class="headdocument"><a href="../../../index.html">Serveis de Xarxa i Internet</a></div>
        <div id="search" class="search" name="search">
         <form id="frmsearch" action="../../../search.html" method="get">
          <input type="text" name="q"/>
        </form>
        </div>
	</header>
   <div id="upbutton" class="upbutton" style="display:none;"><img src="../../../img/uparrow.png" alt="Pujar a l'inici de p&agrave;gina"/></div>
   <aside id="aside">
    <div id="menu">
      <ul>
       <li name="toc"><div><img src="../../../img/toc.png" alt="&Iacute;ndex"/></div></li>
       <li name="settings"><div><img src="../../../img/settings.png" alt="Configuraci&oacute;"/></div></li>
       <li name="printer"><div><img src="../../../img/printer.png" alt="Imprimir"/></div></li>
       <li name="favorites"><div><img src="../../../img/favorites.png" alt="Favorits"/></div></li>
       <li name="help_icon" class="help_icon"><div><img src="../../../img/help_icon.png" alt="Ajuda"/></div></li>
      </ul>
     </div>
   </aside>
   <div id="sidebar-hide" name="sidebar-hide"><img src="../../../img/arrows.png"/></div>
   <section>
     <div id="toc" class="hidden">
      <div class="menucontent">
        <ul>
        <li id="u1" class="parentnode"><p><a class="unit" href="../../../WebContent/u1/introduccio.html">1. Serveis de noms i configuració automàtica</a></p><ul class="expander"><li id="u1introduccio"><a href="../../../WebContent/u1/introduccio.html">Introducció</a></li><li id="u1resum"><a href="../../../WebContent/u1/resum.html">Resum</a></li><li id="u1resultats"><a href="../../../WebContent/u1/resultats.html">Resultats d'aprenentatge</a></li><li id="u1referencies"><a href="../../../WebContent/u1/referencies.html">Més informació</a></li><li id="u1a1" class="tocsection"><p id='u1a1continguts'><a class="section" href="../../../WebContent/u1/a1/continguts.html">Instal·lació i administració de serveis de noms de domini</a><span class="buttonexp"></span></p><ul><li id="u1a1activitats"><a href="../../../WebContent/u1/a1/activitats.html">Activitats</a></li><li id="u1a1exercicis"><a href="../../../WebContent/u1/a1/exercicis.html">Exercicis</a></li><li id="u1a1annexos"><a href="../../../WebContent/u1/a1/annexos.html">Annexos</a></li></ul></li><div data-parent-id='u1a1' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u1/a1/continguts.html#el_servei_de_resolucio_de_noms">El servei de resolució de noms</a></li><li><a href="../../../WebContent/u1/a1/continguts.html#funcionalitat_del_sistema_de_noms_jerarquics">Funcionalitat del sistema de noms jeràrquics</a></li><li><a href="../../../WebContent/u1/a1/continguts.html#instal_lacio_i_configuracio_del_servei_dns">Instal·lació i configuració del servei DNS</a></li><li><a href="../../../WebContent/u1/a1/continguts.html#resolucio_forwarding_i_memoria_cau">Resolució, 'forwarding' i memòria cau</a></li><li><a href="../../../WebContent/u1/a1/continguts.html#creacio_de_zones">Creació de zones</a></li><li><a href="../../../WebContent/u1/a1/continguts.html#transferencies_de_zona">Transferències de zona</a></li><li><a href="../../../WebContent/u1/a1/continguts.html#extensions_del_protocol_dns">Extensions del protocol DNS</a></li></ul></div></div><li id="u1a2" class="tocsection"><p id='u1a2continguts'><a class="section" href="../../../WebContent/u1/a2/continguts.html">Instal·lació i administració de serveis de configuració automàtica de xarxa</a><span class="buttonexp"></span></p><ul><li id="u1a2activitats"><a href="../../../WebContent/u1/a2/activitats.html">Activitats</a></li><li id="u1a2exercicis"><a href="../../../WebContent/u1/a2/exercicis.html">Exercicis</a></li><li id="u1a2annexos"><a href="../../../WebContent/u1/a2/annexos.html">Annexos</a></li></ul></li><div data-parent-id='u1a2' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u1/a2/continguts.html#configuracio_automatitzada_de_xarxa">Configuració automatitzada de xarxa</a></li><li><a href="../../../WebContent/u1/a2/continguts.html#funcionament_del_protocol_dhcp">Funcionament del protocol DHCP</a></li><li><a href="../../../WebContent/u1/a2/continguts.html#instal_lacio_del_servidor_dhcp">Instal·lació del servidor DHCP</a></li><li><a href="../../../WebContent/u1/a2/continguts.html#configuracio_del_servei">Configuració del servei</a></li><li><a href="../../../WebContent/u1/a2/continguts.html#assignacions_estatiques_i_dinamiques">Assignacions estàtiques i dinàmiques</a></li><li><a href="../../../WebContent/u1/a2/continguts.html#opcions_addicionals_de_configuracio">Opcions addicionals de configuració</a></li><li><a href="../../../WebContent/u1/a2/continguts.html#documentacio_de_procediments">Documentació de procediments</a></li></ul></div></div></ul></li><li id="" class="indexnode"><p><a href="../../../index.html">Anar a l&#39;&iacute;ndex general</a></p></li>
        </ul>
      </div>
    </div>
   </section>
   <section>
   <div id="settings" class="hidden">
    <div class="menucontent">
     <div class="allsettings">
     <div class="settings">
      <label>Font i Color</label>
		<div class="setting-option">
	        <ul class="fontBackground">
				<li id="style-newspaper" title="Newspaper" class="appearance-style-newspaper"><span>Newspaper</span></li>
                <li id="style-novel" title="Novel" class="appearance-style-novel"><span>Novel</span></li>
                <li id="style-ebook" title="eBook" class="appearance-style-ebook"><span>eBook</span></li>
				<li id="style-inverse" title="Inverse" class="appearance-style-inverse active"><span>Inverse</span></li>
				<li id="style-athelas" title="Athelas" class="appearance-style-athelas"><span>Athelas</span></li>
			</ul>
		</div>
     </div>
	<div class="settings">
      <label>Amplada</label>
		<div class="setting-option">
	        <div id="slider-width"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
		<div class="setting-option">
	        <div id="slider-font"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
	  <div class="setting-option">
       <form action="" class="sett-options">
		<ul>
		    <li><input type="checkbox" id="secondary-content" /><label for="secondary-content">Mostra recursos complementaris</label></li>
		    <li><input type="checkbox" id="main-images" /><label for="main-images">Mostra imatges</label></li>
		    <li><input type="checkbox" id="text-alignment" /><label for="text-alignment">Text justificat</label></li>
			<li><input type="checkbox" id="text-hyphen" /><label for="text-hyphen">Partici&oacute; sil·l&agrave;bica</label></li>
		</ul>
       </form>
	  </div>
     </div>
     </div>
    </div>
   </div>
   </section>
 <section>
 <div id="favorites" class="hidden"></div>
 </section>   
 <div id="bridge" class="hidden"></div>
 <div id="help" class="hidden">
  <div class="helptitle">Dreceres del teclat<hr></div>
  <div class="helpsection"><span>General</span>
   <ul>
    <li><span class="shortcut">g</span>: Anar al men&uacute; de navegaci&oacute;</li>
    <li><span class="shortcut">o</span>: Anar a opcions</li>
    <li><span class="shortcut">s</span>: Guardar la p&agrave;gina actual a favorits</li>
    <li><span class="shortcut">p</span>: Imprimir la p&agrave;gina actual</li>
    <li><span class="shortcut">?</span>: Mostrar/Ocultar l&#39;ajuda</li>
   </ul>
  </div>
  <div class="helpsection"><span>Navegaci&oacute;</span>
   <ul>
    <li><span class="shortcut">i</span>: Anar a l&#39;&iacute;ndex general</li>
    <li><span class="shortcut">t</span>: Anar a l&#39;inici de p&agrave;gina</li>
    <li><span class="shortcut">b</span>: Anar al final de p&agrave;gina</li>
    <li><span class="shortcut">j</span>: Anar cap endavant dintre la p&agrave;gina</li>
    <li><span class="shortcut">k</span>: Anar cap enrere dintre la p&agrave;gina</li>
    <li><span class="shortcut">h</span>: Anar a la p&agrave;gina anterior:</li>
    <li><span class="shortcut">l</span>: Anar a la p&agrave;gina seg&uuml;ent:</li>
   </ul>
   </div>
 </div>
 <div id="favcounter" name="favcounter" class="hidden"><span></span></div>
 <div id="navmenu" class="navmenu"><ul class="webnav"><li><a href="../../../index.html" title="Anar a l&#39;&iacute;ndex general">Inici</a></li><li><a href="../introduccio.html">Serveis de noms i configuració automàtica</a></li><li>Instal·lació i administració de serveis de configuració automàtica de ...</li></ul></div>
	<div id="content" lang="ca" class="hyphenate text">
     <article lang="ca" class="sheet">
        <h1><a id="instal_lacio_i_administracio_de_serveis_de_configuracio_automatica_de_xarxa"> Instal·lació i administració de serveis de configuració automàtica de xarxa </a></h1>
    	
<p>
El servei <strong>DHCP</strong> permet la configuració d’adreces IP, màscares, passarel·les per defecte (<em>gateways</em>) i moltes altres opcions de configuració de manera totalment dinàmica.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">DHCP</p>
<p>
DHCP és l’acrònim de Dynamic Host Configuration Protocol, en català, protocol de configuració dinàmica d’equips.
</p>
</div></div>
<p>
Una manera planera d’entendre el DHCP és imaginar que, en arrencar, els equips clients fan un crit per la xarxa i pregunten “Que hi ha algú?”, “Qui soc jo?”. El servidor del DHCP els contesta proporcionant-los tota la informació necessària perquè sàpiguen qui són i com han de configurar els seus paràmetres de xarxa.
</p>

<p>
L’administrador de xarxa té la tasca de configurar els equips que la componen. Això significa configurar els servidors, els equips clients, concentradors, encaminadors… Cada equip de la xarxa s’ha d’identificar amb l’adreça IP corresponent i la màscara de xarxa, i generalment disposarà d’un camí d’accés a Internet.
</p>

<p>
Tant els usuaris com els serveis requeriran l’accés a altres equips identificant-los pel nom de domini en lloc de fer-ho per l’adreça IP, que és més difícil de recordar. Fer això equip per equip resulta una feina feixuga i repetitiva si no es disposa de serveis de xarxa que la facilitin.
</p>

<h2><a id="configuracio_automatitzada_de_xarxa" >Configuració automatitzada de xarxa</a></h2>
<div class="level2">

<p>
El servei DHCP proporciona un mecanisme de configuració centralitzat dels equips de la xarxa. En lloc de configurar un per un els equips de xarxa amb adreces i valors estàtics, un servidor DHCP anirà assignant als equips clients els valors que els corresponguin. Aquesta assignació es fa per un període de temps finit, passat el qual caldrà renovar-la.
</p>

<p>
Els principals avantatges d’utilitzar DHCP són, d’una banda, evitar conflictes d’adreces IP (adreces repetides i adreces errònies), ja que passar equip per equip a canviar la configuració és molt més pesat i propens a l’error que fer-ho editant un sol fitxer de configuració en el servidor DHCP; i, de l’altra, que fer l’administració centralitzada representa un estalvi de temps i de feina.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Avantatges del DHCP</p>
<p>
El servei DHCP té diversos avantatges:
</p>
<ul>
<li class="level1"><div class="li"> Evita errors i conflictes IP.</div>
</li>
<li class="level1"><div class="li"> Centralitza l’administració.</div>
</li>
<li class="level1"><div class="li"> Estalvia temps.</div>
</li>
<li class="level1"><div class="li"> Simplifica l’administració.</div>
</li>
</ul>
</div></div><div class="iocimportant"><div class="ioccontent">
<p>
El servei DHCP simplifica l’administració de la configuració dels equips de xarxa fent-la centralitzada, dinàmica i amb concessions per períodes de temps finits.
</p>
</div></div>
<p>

</p>

<p>
La concessió dinàmica d’adreces IP i d’altres paràmetres de configuració de xarxa es realitza per un període de temps determinat, que varia en funció de les necessitats del client i del servidor.
</p>
<div class="ioctextl"><div class="ioccontent"><p class="ioctitle">Exemples d&#039;ús del servei DHCP</p>
<p>
Els següents són alguns exemples d’ús del servei DHCP:
</p>
<ul>
<li class="level1"><div class="li"> En una biblioteca que admet connexions Wi-Fi, els clients obtindran concessions per un temps reduït, per exemple, minuts.</div>
</li>
<li class="level1"><div class="li"> Un usuari d’Internet que rep al seu equip de casa una adreça IP dinàmica del seu proveïdor d’accés a Internet (ISP) tindrà una concessió que segurament serà per hores.</div>
</li>
<li class="level1"><div class="li"> En la xarxa corporativa d’una empresa que s’ha configurat dinàmicament usant DHCP, els equips rebran concessions dinàmiques per períodes de temps llargs, per exemple, de dies.</div>
</li>
</ul>
</div></div>
</div>

<h3><a id="configuracio_d_un_equip_de_xarxa" >Configuració d&#039;un equip de xarxa</a></h3>
<div class="level3">

<p>
Qualsevol equip que pertany a una xarxa requereix que es configuri amb uns paràmetres mínims, que són l’adreça IP, la màscara i la porta d’enllaç per defecte (també anomenada <em>gateway</em>). L’adreça IP identifica l’equip de manera única i la màscara permet determinar la xarxa o subxarxa en què es troba l’equip. Amb aquests dos paràmetres n’hi ha prou per tenir connectivitat en la xarxa. Si es vol disposar d’accés fora de la xarxa pròpia (per exemple, a Internet o a la resta de la xarxa corporativa) cal definir també l’encaminador o <em>gateway</em>. A part de la configuració bàsica, els equips poden necessitar (de fet, ho necessiten) més paràmetres de configuració, com, per exemple, el nom del <em>host</em>, els servidors <acronym title="Domain Name System">DNS</acronym> a usar, el fitxer d’iniciació per a arrencades PXE…
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Tot equip de xarxa necessita disposar d’una <strong>adreça IP</strong> que l’identifiqui de manera única a la xarxa. Li cal també una <strong>màscara</strong> per poder distingir en l’adreça IP la part d’<strong>adreça de xarxa</strong> i la d’<strong>adreça de <em>host</em></strong>. Finalment, és imprescindible disposar de l’adreça de la <strong>porta d’enllaç predeterminada</strong> o passarel·la per defecte (<em>gateway</em>), per disposar d’accés a xarxes externes.
</p>
</div></div><div class="ioctextl"><div class="ioccontent"><p class="ioctitle">Exemple de configuració de xarxa d&#039;un equip domèstic</p>
<p>
La majoria d’usuaris disposen a casa d’un equip (o més) connectat a un encaminador (<em>router</em>) que proporciona l’accés a Internet. Aquest equip està configurat com a client DHCP i en iniciar-se rep la configuració de xarxa de l’encaminador. Podeu comprovar a casa quina configuració teniu. Una configuració d’exemple podria ser:
</p>
<pre class="code">        Adreça IP. . . . . . . . . . . . .: 192.168.1.33
        Màscara de subxarxa . . . . . . . : 255.255.255.0
        Porta d&#039;enllaç predeterminada . . : 192.168.1.1
        Servidor DHCP . . . . . . . . . . : 192.168.1.1
        Servidors DNS . . . . . . . . . . : 80.58.61.250
                                            80.58.61.254</pre>
</div></div>
<p>
Aquest procés de configuració cal que es faci per a cada equip de la xarxa. Fer-ho manualment implica configurar equip per equip sense cometre errades en teclejar les adreces i les màscares. Qualsevol canvi en l’estructura de la xarxa, com per exemple redefinir les subxarxes o modificar algunes adreces IP, significa tornar a configurar manualment els equips implicats. És evident que tota aquesta feinada no és agradable per a l’administrador de xarxa (és molt avorrida!). Tant si la xarxa corporativa consta de pocs equips com de molts, cal una solució que permeti automatitzar la configuració de xarxa de cada equip de manera centralitzada.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">L&#039;inconvenient de la configuració estàtica</p>
<p>
La configuració estàtica implica configurar els equips un a un. Fins i tot encara que es tingui accés remot als equips (per Telnet o SSH), com que cal modificar la configuració de xarxa, no es pot fer assegut des de l’equip de l’administrador, sinó que cal anar equip per equip a modificar la configuració.
</p>
</div></div><div class="iocimportant"><div class="ioccontent">
<p>
Les opcions de configuració de xarxa es poden assignar a cada equip <strong>estàticament</strong> o es poden configurar de manera <strong>dinàmica</strong> utilitzant DHCP.
</p>
</div></div>
<p>
Com a administradors de xarxa, la gestió centralitzada que proporciona DHCP ens permet modificar la xarxa afegint, eliminant i redefinint equips amb un cost mínim.
</p>

</div>

<h3><a id="tipus_d_assignacions_d_adreces_ip" >Tipus d&#039;assignacions d&#039;adreces IP</a></h3>
<div class="level3">

<p>
Cada equip de xarxa té assignada una adreça IP que l’identifica de manera única dins de la xarxa. La composició de l’adreça IP i la màscara determinen la xarxa o subxarxa a la qual pertany. A més, es configuren altres paràmetres de xarxa com la porta d’enllaç predeterminada, servidors <acronym title="Domain Name System">DNS</acronym>… Això es pot configurar manualment anant equip per equip i introduint aquesta informació.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Quan l’adreça IP i els altres paràmetres necessaris de configuració de la xarxa es configuren equip per equip, manualment, es diu que tenen una adreça <strong>IP estàtica</strong>.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">Reconfiguració d&#039;una xarxa</p>
<p>
Imagineu de quin humor estarà l’administrador d’una xarxa corporativa de 1.000 equips amb adreces estàtiques quan cal reconfigurar-la en un cap de setmana!
</p>
</div></div>
<p>
Quan la configuració de xarxa d’un equip no es fa manualment i localment en l’equip sinó que es fa per mitjà d’un servidor DHCP, es diu que l’equip utilitza una adreça <strong>IP dinàmica</strong>. Per realitzar configuracions de xarxa dinàmicament caldran un o més servidors DHCP (a manera de redundància), que proporcionaran la configuració als equips clients (els que cal configurar). Per tant, serà una estructura client/servidor. Les adreces IP dinàmiques que rep el client les podem classificar en dues categories: <strong>assignació dinàmica de rang</strong> i <strong>assignació fixa</strong>.
</p>

<p>
El servidor DHCP disposa d’un rang d’adreces que pot assignar als clients que demanen una adreça IP. Quan el servidor assigna una adreça qualsevol del rang al client (a l’atzar) es tracta d’una assignació dinàmica de rang. El client no sap quina adreça IP tindrà i no hi ha manera de predir quina se li concedirà en una futura configuració. A cada nova assignació, l’adreça IP pot ser diferent.
</p>

<p>
Una assignació fixa es produeix quan el servidor DHCP assigna sempre la mateixa adreça al client. Per assignar sempre la mateixa adreça IP al client cal que el servidor pugui identificar inequívocament el client (per l’adreça MAC). El servidor disposa d’una taula amb les correspondències entre les adreces MAC i les adreces IP fixes.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">MAC</p>
<p>
Cada interfície de xarxa s’identifica de manera única físicament per l’adreça MAC (<em>media acces control</em> o adreça d’accés al medi).
</p>
</div></div><div class="iocimportant"><div class="ioccontent">
<p>
Quan la configuració de xarxa d’un equip es fa per mitjà d’un servidor DHCP es diu que utilitza una adreça IP <strong>dinàmica</strong>. Aquesta adreça pot variar dins d’un <strong>rang</strong> d’adreces disponibles del servidor DHCP o pot ser <strong>fixa</strong>.
</p>
</div></div>
<p>
Els avantatges de disposar d’una adreça IP fixa són que la vostra identificació a Internet (la vostra adreça IP) no varia i tothom us pot identificar sempre per la mateixa IP. Podeu proporcionar serveis a altres equips i els clients us identifiquen sempre amb la mateixa adreça sense haver de recordar en cada moment quina adreça IP teniu avui (com passa en el cas d’una IP dinàmica).
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">DNS dinàmic</p>
<p>
Hi ha serveis de <acronym title="Domain Name System">DNS</acronym> dinàmic (DDNS) que permeten assignar un nom de domini a equips amb adreça IP dinàmica.
</p>
</div></div>
</div>

<h2><a id="funcionament_del_protocol_dhcp" >Funcionament del protocol DHCP</a></h2>
<div class="level2">

<p>
El protocol DHCP està descrit, com la majoria de protocols de xarxa, per un document oficial anomenat <acronym title="Request for Comments">RFC</acronym>. Aquest document ha sofert una evolució al llarg dels anys per anar-se adaptant a les necessitats de cada moment. Tot protocol implica un diàleg entre els equips que intervenen en un procés. Ens caldrà, doncs, analitzar quin és i com es produeix aquest diàleg. Finalment es descriurà el significat de termes tan usuals en el DHCP com <em>rangs</em>, <em>exclusions</em>, <em>concessions</em> i <em>reserves</em>.
</p>
<div class="ioctextl"><div class="ioccontent"><p class="ioctitle">RFC</p>
<p>
<em>Request for Comments</em> (<acronym title="Request for Comments">RFC</acronym>) són memoràndums sobre noves investigacions, innovacions i metodologies relacionades amb les tecnologies d’Internet. Els publica l’Internet Engineering Task Force (IETF) i defineixen a escala mundial els protocols i les seves revisions. És a dir, són les publicacions oficials que descriuen els protocols.
</p>
</div></div>
</div>

<h3><a id="evolucio_del_protocol_dhcp" >Evolució del protocol DHCP</a></h3>
<div class="level3">

<p>
El servei DHCP és un servei del tipus client/servidor que proporciona la configuració de xarxa als clients que ho sol·liciten. Proporciona els paràmetres bàsics de xarxa com l’adreça IP, la màscara de xarxa, la porta d’enllaç i altres paràmetres necessaris per a la connexió a una xarxa IP. Es tracta d’un protocol de la capa d’aplicació del model TCP/IP.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
L’<acronym title="Request for Comments">RFC</acronym> 951 és el document base que descriu el protocol BOOTP.
</p>
</div></div><div class="iocimportant"><div class="ioccontent">
<p>
El protocol DHCP està basat en l’arquitectura de serveis client/servidor i utilitza com a transport el protocol UDP de la pila de protocols TCP/ IP. El servidor DHCP es comunica amb els clients utilitzant paquets UDP, que rep en el seu port 67 i envia al port 68 del client.
</p>
</div></div>
<p>
La configuració dinàmica d’equips de xarxa es va iniciar amb el protocol BOOTP (BOOT Strap Protocol o protocol d’arrencada). Era un protocol més bàsic que principalment permetia definir l’adreça IP, la màscara de xarxa i la passarel·la per defecte per al client. El BOOTP (<acronym title="Request for Comments">RFC</acronym> 951, any 1985) és un protocol pensat per proporcionar automàticament la IP a clients de xarxa en el procés d’arrencada. Originàriament s’utilitzava per a estacions de treball sense disc que obtenien la configuració de xarxa del protocol BOOTP i també obtenien el nom d’un fitxer d’arrencada que s’havia de baixar per mitjà del TFTP, que usualment era el sistema operatiu.
</p>

<p>
El BOOTP va donar pas al protocol DHCP, que n’és una evolució amb moltes més prestacions. El DHCP sorgeix l’octubre de 1993 mitjançant l’<acronym title="Request for Comments">RFC</acronym> 1531. Ràpidament evoluciona gràcies a diversos <acronym title="Request for Comments">RFC</acronym>, com l’<acronym title="Request for Comments">RFC</acronym> 1541 (el mateix 1993), que serà substituït per l’<acronym title="Request for Comments">RFC</acronym> 2131, el març del 1997. Aquest document és la base del protocol DHCP actual. A grans trets, el protocol es descriu en l’<acronym title="Request for Comments">RFC</acronym> 2131 per a xarxes Ipv4, el conjunt d’opcions de configuració de DHCP es descriuen en l’<acronym title="Request for Comments">RFC</acronym> 2132 i l’especificació del DHCP per a xarxes Ipv6 és en l’<acronym title="Request for Comments">RFC</acronym> 8415.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">RFC del DHCP</p>
<p>
Principals <acronym title="Request for Comments">RFC</acronym> dedicats al DHCP:
</p>
<ul>
<li class="level1"><div class="li"> <acronym title="Request for Comments">RFC</acronym> 2131, març 1997: “DHCP: Dynamic Host Configuration Protocol”</div>
</li>
<li class="level1"><div class="li"> <acronym title="Request for Comments">RFC</acronym> 2132: “DHCP options”</div>
</li>
<li class="level1"><div class="li"> <acronym title="Request for Comments">RFC</acronym> 3396: “Encoding long options”</div>
</li>
<li class="level1"><div class="li"> <acronym title="Request for Comments">RFC</acronym> 4361: “Node-specific client identifiers for DHCPv4”</div>
</li>
<li class="level1"><div class="li"> <acronym title="Request for Comments">RFC</acronym> 8415: “DHCPv6: Dynamic Host Configuration Protocol Ipv6”</div>
</li>
</ul>
</div></div>
</div>

<h3><a id="el_model_funcional_del_protocol_dhcp" >El model funcional del protocol DHCP</a></h3>
<div class="level3">

<p>
El protocol DHCP descriu el diàleg que es produeix entre client i servidor per a la concessió de configuracions IP. En una xarxa amb configuració d’equips dinàmica, un o més servidors DHCP escoltaran les peticions dels clients en el port 67. Els clients DHCP sol·licitaran al servidor DHCP una configuració IP i començarà un procés de negociació que ha d’acabar (si tot va bé) amb la concessió d’una adreça IP al client. Els servidors parlen al port 68 dels clients.
</p>

<p>
La negociació que s’estableix es pot definir a grans trets de la manera següent:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Ports DHCP</p>
<p>
El protocol DHCP utilitza UDP en la capa de transport. Utilitza dos ports:
</p>
<ul>
<li class="level1"><div class="li"> Port 67, on escolta el servidor.</div>
</li>
<li class="level1"><div class="li"> Port 68, on escolta el client.</div>
</li>
</ul>
</div></div><ol>
<li class="level1"><div class="li"> El client sol·licita una adreça IP (de fet, una configuració de xarxa).</div>
</li>
<li class="level1"><div class="li"> El servidor mira les adreces IP disponibles dins del rang d’adreces dinàmiques de què disposa per concedir i n’ofereix una al client.</div>
</li>
<li class="level1"><div class="li"> Si el client l’accepta, envia una sol·licitud al servidor per fer-la seva.</div>
</li>
<li class="level1"><div class="li"> Si al servidor li sembla bé, accepta la petició del client i li confirma que pot utilitzar aquesta adreça IP, que l’hi concedeix per un període de temps limitat.</div>
</li>
</ol>

<p>
La concessió de l’adreça IP és per un període de temps establert pel servidor. Això significa que, transcorregut aquest període, el client haurà de renegociar la concessió en un procés similar al descrit anteriorment. En la <span class="figref"><a href="#Figure1"><span>figura</span></a></span> (“Model funcional del protocol DHCP”) es pot veure el diàleg de quatre fases entre el client i el servidor.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">UDP en les transmissions DHCP</p>
<p>
L’intercanvi d’informació entre client i servidor no és gaire gran (poc volum de dades) i no requereix un flux permanent (una conversa continuada). És per això que el protocol que s’utilitza en les transmissions DHCP és l’UDP.
</p>
</div></div>
<p>
El procés real, però, és més detallat. El podem repassar. Consta principalment de quatre parts: la petició del client o <em>discovery</em>, l’oferta del servidor o <em>offer</em>, l’acceptació de l’adreça IP pel client o <em>request</em> i la confirmació del servidor o <em>acknowledgement</em>. A part d’aquest tipus de missatges, el protocol DHCP en defineix d’altres com el de petició d’informació o <em>information</em> i el d’alliberament de l’adreça IP o <em>releasing</em>.
</p>
<div class="iocfigure"><a name="Figure1"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Model funcional del protocol DHCP

</figcaption><img src="../media/ic10m08u1_05.png" alt="" /></figure>
</div>
<p>
Els següents són els tipus de paquets DHCP:
</p>
<ul>
<li class="level1"><div class="li"> <em>DHCP discover</em></div>
</li>
<li class="level1"><div class="li"> <em>DHCP offer</em></div>
</li>
<li class="level1"><div class="li"> <em>DHCP request</em></div>
</li>
<li class="level1"><div class="li"> <em>DHCP ack</em> / <em>DHCP nack</em></div>
</li>
<li class="level1"><div class="li"> <em>DHCP decline</em></div>
</li>
<li class="level1"><div class="li"> <em>DHCP release</em></div>
</li>
<li class="level1"><div class="li"> <em>DHCP information</em></div>
</li>
</ul>

</div>

<h4><a id="dhcp_discover" >DHCP &#039;discover&#039;</a></h4>
<div class="level4">

<p>
En un procés de configuració dinàmica d’un client de DHCP, el paquet <em>DHCP discover</em> és el primer que s’envia. L’envia el client per tal de demanar una configuració IP a algun servidor. Generalment, el client s’acaba d’inicialitzar i vol obtenir una configuració dinàmica de xarxa. El client no sap a quina xarxa pertany (no té adreça IP ni màscara de xarxa) ni tampoc sap quins servidors DHCP hi ha en la xarxa (si n’hi ha cap).
</p>

<p>
Per tant, el client genera un paquet de difusió (<em>broadcast</em>) destinat a tots els equips de la xarxa on sol·licita una configuració IP. En la xarxa pot haver-hi cap, un o més d’un servidor DHCP per atendre aquesta petició. És responsabilitat de l’administrador de xarxes configurar correctament l’estructura i els serveis de xarxa, de manera que si defineix clients de DHCP hi hagi servidors DHCP que atenguin les seves peticions.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Una difusió o <em>broadcast</em> s’adreça a la IP 255.255.255.255 o a l’adreça MAC FF:FF:FF:FF:FF:FF, que és acceptada per tots els equips.
</p>
</div></div>
</div>

<h4><a id="dhcp_offer" >DHCP &#039;offer&#039;</a></h4>
<div class="level4">

<p>
En rebre una sol·licitud de configuració d’un client (<em>DHCP discover</em>), un servidor DHCP mira d’atendre-la proporcionant una adreça IP del rang d’adreces dinàmiques que gestiona (hi pot haver més d’un servidor DHCP en la mateixa xarxa).
</p>

<p>
El servidor tracta d’assignar una IP del conjunt o rang (també anomenat <em>pool</em>) d’adreces dinàmiques que gestiona. Per fer-ho, ha de mirar quines de les adreces li queden lliures i disponibles per concedir al client. Cada vegada que el servidor concedeix una adreça IP a un client ho anota en un fitxer de registre de les concessions efectuades. Cada vegada que finalitza una concessió el servidor pot tornar a utilitzar l’adreça IP per a un altre client.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Diversos servidors DHCP</p>
<p>
Es pot configurar més d’un servidor DHCP, tant per a còpia de seguretat o <em>backup</em> com per incrementar el rendiment en compartir la càrrega de les peticions.
</p>
</div></div><div class="iocimportant"><div class="ioccontent">
<p>
Tota <strong>concessió</strong> (o <em>lease</em>) DHCP és per un període determinat de temps, i un cop transcorregut cal renovar-la.
</p>
</div></div>
<p>
El mecanisme que utilitza el servidor per escollir l’adreça IP dins del conjunt d’adreces IP disponibles varia en funció del programa de servidor que s’utilitzi. A més, es poden configurar innumerables opcions del servidor per establir com s’han de fer les concessions. Un cas típic és el de les adreces fixes. A un determinat client se li assigna sempre la mateixa adreça IP. Per això cal disposar de la llista d’adreces MAC dels clients als quals es vol assignar una adreça IP fixa.
</p>

<p>
El servidor selecciona una adreça IP disponible i la reserva per al client (encara no està assignada). Tot seguit envia un paquet <em>DHCP offer</em> (unidestinació o <em>unicast</em>) al client amb tota la informació de configuració requerida. L’adreça IP i MAC origen identifiquen el servidor que fa l’oferta. El destinatari s’indica per la seva adreça MAC (que és coneguda). El camp IP del destinatari és l’adreça IP que el servidor ofereix (penseu que el client encara no té adreça IP). Un altre concepte important és per quant temps es realitza la concessió. El paquet inclou camps per completar la resta de configuració de xarxa, per exemple, la porta d’enllaç per defecte, els servidors <acronym title="Domain Name System">DNS</acronym>…
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Tipus d&#039;adreçament</p>
<p>
Hi ha diversos tipus d’adreçament:
</p>
<ul>
<li class="level1"><div class="li"> Unidestinació o <em>unicast</em>: a un equip</div>
</li>
<li class="level1"><div class="li"> Multidestinació o <em>multicast</em>: a un conjunt d’equips</div>
</li>
<li class="level1"><div class="li"> De difusió o <em>broadcast</em>: a tothom</div>
</li>
</ul>
</div></div>
</div>

<h4><a id="dhcp_request" >DHCP &#039;request&#039;</a></h4>
<div class="level4">

<p>
Quan el client rep una oferta de configuració IP per part d’un servidor, la pot acceptar o rebutjar. Si el client no accepta l’oferta, simplement realitzarà un nou <em>DHCP discovery</em>. Això és suficient perquè el servidor s’adoni que l’oferta ha estat rebutjada.
</p>

<p>

</p>

<p>
Si el client accepta l’oferta, ho ha de comunicar al servidor. El mecanisme per fer-ho és mitjançant un paquet <em>DHCP request</em> enviat un altre cop per difusió. A hores d’ara, el client encara no disposa de l’adreça IP per utilitzar-la. El servidor l’ha reservat, però encara no ha donat el sí definitiu perquè sigui concedida al client.
</p>

<p>
El motiu pel qual el client demana quedar-se la concessió (<em>DHCP request</em>) que ha rebut utilitzant difusió és fer públic a tothom de la xarxa que ha acceptat una oferta d’un servidor DHCP concret. Recordeu que la petició del client es fa per difusió i, per tant, pot rebre ofertes de diferents servidors DHCP. Quan accepta una de les ofertes, no ha de dir res als altres servidors que ha refusat. Simplement fent pública quina oferta accepta, la resta de servidors DHCP entenen que la seva oferta s’ha rebutjat.
</p>

</div>

<h4><a id="dhcp_acknowledgement_dhcpack_dhcpnack" >DHCP &#039;acknowledgement&#039; (DHCPACK/DHCPNACK)</a></h4>
<div class="level4">

<p>
L’últim pas en una negociació DHCP bàsica el realitza el servidor quan finalment autoritza la concessió enviant el paquet DHCPACK (<em>DHCP akcnowledgement</em>). A partir d’aquest moment, el client ja pot fer ús de l’adreça IP i de la configuració de xarxa rebuda. DHCPACK inclou tota la informació referent a la durada de la concessió i les dades necessàries per gestionar quan expira.
</p>

<p>
El servidor anotarà en el registre de concessions la que acaba de realitzar i en detallarà tots els aspectes, en especial el temps de concessió. El paquet d’acceptació de la concessió DHCPACK és un paquet unidestinació adreçat a la MAC del client. Recordeu que el client encara no disposa d’una adreça IP vàlida; en disposarà en rebre el DHCPACK.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">ACK i NACK</p>
<p>
ACK i NACK són dos acrònims usuals en el món de la informàtica. Signifiquen conformitat (acceptació) i no conformitat (refús) respectivament.
</p>
</div></div>
<p>
Quan un servidor DHCP detecta que la IP que havia reservat per a un client i que li anava a concedir ja està en ús (per una configuració incorrecta), el servidor envia al client un paquet DHCPNACK i indica la no autorització de la concessió. El client que rep un DHCPNACK ha de tornar a iniciar tot el procés de negociació començant un altre cop pel <em>DHCP discovery</em>.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Exemple de mala configuració d&#039;un equip</p>
<p>
Un exemple de mala configuració és la d’un equip que s’ha engegat amb una adreça IP estàtica errònia que se solapa amb les adreces IP que reparteix el servidor. El mecanisme usat per comprovar si l’adreça IP ja està essent utilitzada és un <em>ping</em>. Si no respon ningú és que està lliure (segurament).
</p>
</div></div>
</div>

<h4><a id="dhcp_decline" >DHCP &#039;decline&#039;</a></h4>
<div class="level4">

<p>
Per la seva part, el client també pot examinar l’adreça IP oferta pel servidor per comprovar si està en ús o no. Pot fer altres proves per veure si li sembla correcta o no l’oferta rebuda del servidor. Per exemple, en el cas de renovació d’una adreça IP, el client pot rebre una IP diferent a la que utilitza i no interessar-li. En aquests casos, el client pot enviar un paquet <em>DHCP decline</em> al servidor per indicar que la seva oferta ha estat rebutjada.
</p>

</div>

<h3><a id="dhcp_release" >DHCP &#039;release&#039;</a></h3>
<div class="level3">

<p>
Quan un client ja no necessita més l’ús de la configuració IP que ha rebut, la pot alliberar enviant al servidor un paquet <em>DHCP release</em>. En fer-ho, el servidor afegeix l’adreça IP al conjunt d’adreces dinàmiques que té disponibles. També fa l’anotació pertinent en el registre de concessions (<em>leases</em>) per indicar que ha finalitzat l’ús de l’adreça. De totes maneres, molt sovint el client no pot arribar a emetre aquest paquet perquè és apagat per l’usuari sense deixar temps al sistema per alliberar la IP.
</p>

</div>

<h4><a id="dhcp_information" >DHCP &#039;information&#039;</a></h4>
<div class="level4">

<p>
En qualsevol moment el client pot sol·licitar més informació sobre la configuració de xarxa al servidor utilitzant un paquet <em>DHCP information</em>. En el paquet DHCP <em>offer</em> que el servidor envia al client, consten les informacions generals de configuració de xarxa que es trameten en l’oferta: adreça IP, màscara de xarxa, porta d’enllaç predeterminada, servidor <acronym title="Domain Name System">DNS</acronym>, fitxer a baixar per a arrencades PXE i molts altres paràmetres que poden estar configurats per enviar-se en l’oferta. El client pot tornar a demanar al servidor la informació d’aquests paràmetres o pot sol·licitar informació per a la configuració d’altres paràmetres (WINS, NetBIOS, <em>hostname</em>…). El client només pot realitzar una petició d’informació <em>DHCP information</em> al servidor un cop està configurat.
</p>

</div>

<h4><a id="peticio_de_renovacio_concessio_d_una_ip_concreta" >Petició de renovació/concessió d&#039;una IP concreta</a></h4>
<div class="level4">

<p>
El procés de quatre fases usuals de DHCP consistent en <em>discovery</em> / <em>offer</em> / <em>request</em> / <em>ack</em> es produeix quan el client sol·licita una adreça IP de nou. Sabem que les concessions són per un interval de temps finit, passat el qual cal que el client en demani la renovació. Existeix, doncs, un procés de renovació simplificat. El client demana continuar usant la mateixa adreça IP amb un paquet DHCP <em>request</em> i el servidor li concedeix o no amb els paquets DHCP ACK/NACK.
</p>

<p>
Un altre cas és un client que demana usar (renovar) una adreça IP que el servidor no li pot concedir (està en ús, no és del rang que gestiona…). En aquesta situació, el servidor envia un DHCP NACK.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Macchanger</p>
<p>
Aquesta ordre GNU/Linux permet emmascarar l’adreça MAC pròpia (<em>mascarade</em>), simular que és una altra.
</p>
</div></div>
</div>

<h3><a id="atacs_al_funcionament_del_dhcp" >Atacs al funcionament del DHCP</a></h3>
<div class="level3">

<p>
Com qualsevol altre servei de xarxa, el servidor DHCP és susceptible de patir atacs malintencionats. L’atac més fàcil i clàssic és el DoS o denegació de servei. Consisteix a inundar de peticions un servidor per tal de saturar-lo i bloquejar-ne el funcionament. Un client pot realitzar innumerables peticions <em>DHCP discovery</em> fingint que són clients diferents (emmascarant la seva MAC) amb la intenció d’esgotar les adreces IP disponibles del servidor o simplement amb la intenció de sobrecarregar-lo amb tantes peticions que no doni a l’abast a atendre-les o que ho faci lentament.
</p>

<p>
Un altre tipus d’atac consisteix a falsejar la informació que s’envia al client. Recordeu que el client fa una sol·licitud d’IP en forma de difusió (<em>broadcast</em>) i la seva petició pot ser atesa per un o més servidors DHCP. Un dels servidors DHCP pot ser un atacant que intenta proporcionar informació de configuració falsa al client, per exemple, indicant un servidor <acronym title="Domain Name System">DNS</acronym> també maliciós. Aquest pot falsejar les identitats de les màquines de la xarxa i que quan el client s’adreci a la seva entitat bancària el servidor <acronym title="Domain Name System">DNS</acronym> en realitat li proporcioni una IP d’una màquina que falseja la de l’entitat bancària. 
</p>

<p>
Per posar remei a la inseguretat en la comunicació client/servidor DHCP, el protocol permet utilitzar mecanismes d’autenticació i xifratge. Aquests mecanismes queden fora de l’abast d’aquesta explicació.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Tipus d&#039;atacs DNS</p><ul>
<li class="level1"><div class="li"> Clients no autoritzats: accés a servidors <acronym title="Domain Name System">DNS</acronym> per part de clients no autoritzats. </div>
</li>
<li class="level1"><div class="li"> Servidors no autoritzats: servidors <acronym title="Domain Name System">DNS</acronym> impostors que suplanten els vertaders servidors.</div>
</li>
</ul>
</div></div>
</div>

<h3><a id="conflictes_amb_les_adreces_ip" >Conflictes amb les adreces IP</a></h3>
<div class="level3">

<p>
Un dels principals motius per utilitzar DHCP és simplificar el procés de configuració de xarxa i minimitzar els conflictes per encavalcament d’adreces IP. Per desgràcia, això no garanteix que no es puguin produir conflictes. Per exemple, ens podem trobar en situacions en què dues màquines diferents tinguin la mateixa IP per una simple mala configuració del servidor DHCP. Un altre cas típic és el d’un client que s’ha configurat ell mateix una IP estàtica quan en la xarxa ja hi havia un equip que utilitzava la mateixa adreça IP assignada pel servidor DHCP.
</p>

<p>
Un problema habitual per als administradors poc experimentats és definir una configuració de xarxa local al client (<em>hostname</em>, servidor <acronym title="Domain Name System">DNS</acronym>, porta d’enllaç a utilitzar…), però demanar l’adreça IP dinàmicament. La configuració dinàmica no és solament la IP i la màscara sinó que el servidor DHCP pot proporcionar altres paràmetres de xarxa que sobreescriuran els que el client tenia definits localment (aquest és l’objectiu del DHCP!).
</p>

</div>

<h3><a id="rangs_i_concessions" >Rangs i concessions</a></h3>
<div class="level3">

<p>
Els clients DHCP obtenen del servidor una configuració de xarxa. Descrivim ara alguns dels termes que apareixen en aquest procés i que formen part de la configuració DHCP.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
La configuració rebuda per DHCP sobreescriu la configuració local del client.
</p>
</div></div><ul>
<li class="level1"><div class="li"> <strong>Rang</strong>: anomenen <em>rang d’adreces IP</em> el conjunt d’adreces dinàmiques que el servidor té disponibles per assignar als clients. Les adreces IP disponibles s’agrupen per oferir-se a les diverses subxarxes que atén el servidor. Una mateixa subxarxa pot disposar de diversos rangs. Segurament s’entendrà més fàcilment amb un exemple:</div>
</li>
</ul>
<pre class="code">subnet 140.220.191.0 netmask 255.255.255.0 {
            range 140.220.191.150 239.252.197.250;
}

subnet 239.252.197.0 netmask 255.255.255.0 {
            range 239.252.197.10 239.252.197.107;
            range 239.252.197.113 239.252.197.250;
}</pre>

<p>
En l’exemple anterior s’observa que la primera subxarxa disposa d’un rang de 101 adreces dinàmiques (de la 140.220.191.150 a la 250). La segona subxarxa permet assignar dinàmicament dos rangs d’adreces no correlatius.
</p>
<ul>
<li class="level1"><div class="li"> <strong>Exclusions</strong>: entenem per <em>exclusions</em> aquelles adreces IP que no s’ofereixen dinàmicament per part del servidor. És a dir, que no formen part de cap rang.</div>
</li>
<li class="level1"><div class="li"> <strong>Concessions</strong>: l’assignació d’una adreça IP i la resta de paràmetres de xarxa a un client per part del servidor és una concessió o <em>lease</em>. Els clients reben les concessions per períodes de temps finits que, en finalitzar, cal renegociar. Tant el client com el servidor s’anoten les concessions, el client la que rep i el servidor les que concedeix. Quan finalitza una concessió, el servidor pot decidir revocar-la o ampliar-la.</div>
</li>
</ul>

<p>
El client pot decidir renunciar a la concessió en qualsevol moment. Si el client vol allargar la concessió inicia un diàleg DHCP abreujat amb el servidor que pot acabar amb una renovació o amb la pèrdua de la concessió (sempre pot tornar a començar el procés). Tant el servidor com el client miren normalment les concessions que s’han efectuat entre ells amb anterioritat per tal de, si és possible, repetir la mateixa assignació.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Alliberament d&#039;una concessió</p>
<p>
El client pot alliberar (<em>release</em> en anglès) una concessió directament des de la línia de comandes. 
En un entorn Linux:<br/>

<em>dhclient -r</em><br/>

En un entorn Windows:<br/>

<em>ipconfig /release</em>
</p>
</div></div><ul>
<li class="level1"><div class="li"> <strong>Reserves</strong>: anomenem <em>reserves</em> aquelles adreces IP que s’assignen per DHCP però de manera fixa. És a dir, són adreces que s’assignen dinàmicament però sempre i únicament a un <em>host</em> determinat. Fixeu-vos que tot i ser una adreça dinàmica només s’utilitza si el <em>host</em> associat en fa ús. Si el <em>host</em> està apagat, l’adreça no es pot usar per a altres <em>hosts</em>, està reservada. Un exemple de reserva podria ser:</div>
</li>
</ul>
<pre class="code">subnet 140.220.191.0 netmask 255.255.255.0 {
       host iocserver {
           hardware ethernet 08:00:2b:4c:59:23;
           fixed-address 140.220.191.1;
       }
      range 140.220.191.150 239.252.197.250;
       }</pre>

<p>
En aquest exemple es pot veure que l’adreça 140.220.191.1 és una adreça reservada exclusivament per al <em>host</em> iocserver, que s’identifica mitjançant la seva adreça MAC.
</p>

</div>

<h3><a id="dhcp_un_servei_client_servidor" >DHCP, un servei client/servidor</a></h3>
<div class="level3">

<p>
El servei DHCP és un més dels serveis de xarxa que tenen l’estructura client/servidor. Els servidors DHCP són els equips que tenen en execució el programa servidor. És el programa encarregat d’atendre les peticions dels clients i oferir-los la configuració de xarxa, tot portant el registre de les IP que concedeix i de totes les accions que realitza. Els clients DHCP són aquells equips que realitzen peticions a un servidor DHCP per obtenir una configuració de xarxa.
</p>

</div>

<h4><a id="client_dhcp" >Client DHCP</a></h4>
<div class="level4">

<p>
Un equip client DHCP és un equip que sol·licita l’adreça IP i altres paràmetres de configuració de xarxa a un servidor DHCP en lloc de tenir-los definits localment en l’equip.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Com acostuma a passar amb els serveis client/servidor, un equip pot realitzar les dues funcions al mateix temps.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">ISP</p>
<p>
ISP: <em>Internet service provider</em> o proveïdor de servei/accés a Internet. Ho són, per exemple, les empreses Ono, Vodafone o Jazztel.
</p>
</div></div>
<p>
Si connecteu el vostre equip informàtic a la xarxa Internet per mitjà d’un ISP (<em>Internet service provider</em> o proveïdor d’accés a Internet), segurament rebreu una IP dinàmica del vostre proveïdor. Quan es realitzava una trucada telefònica amb mòdem i usant el protocol PPP (Point to Point Protocol o protocol punt a punt), el proveïdor proporcionava una adreça IP dinàmica. Si utilitzeu ADSL i un encaminador o <em>router</em>, segurament l’encaminador us proporciona una adreça IP dinàmica privada a l’ordinador de casa. Al mateix temps, l’encaminador obté una adreça IP dinàmica pública del proveïdor. Aquestes adreces IP dinàmiques són fixes (sempre les mateixes) o dinàmiques de rang (pot ser qualsevol adreça IP del conjunt d’adreces IP que té disponibles per concedir el servidor DHCP).
</p>
<div class="ioctextl"><div class="ioccontent"><p class="ioctitle">L&#039;encaminador: servidor i client DHCP</p>
<p>
Un cas típic en una xarxa privada a casa és disposar d’un encaminador ADSL connectat a un proveïdor ISP. L’encaminador actua com a client DHCP en la seva interfície de xarxa pública (la de l’ADSL), la que connecta a Internet. 
</p>

<p>
Alhora, l’encaminador fa usualment de servidor DHCP per als ordinadors de casa proporcionant-los una adreça IP. En general els ordinadors dels usuaris es configuren com a clients DHCP.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">IP pública / IP privada</p>
<p>
La diferència entre una IP pública i una IP privada és que la pública és visible per a tots els equips d’Internet, mentre que la privada és visible només dins de la mateixa xarxa local.
</p>
</div></div>
<p>
El client DHCP ha de tenir en funcionament un dimoni encarregat de la gestió de les tasques DHCP pròpies del client. Realitza la part de negociació encarregada al client (<em>DHCP discovery</em>, <em>request</em>) i també porta un registre de les concessions (<em>leases</em>) rebudes. Aquest registre és el que utilitza el client per tornar a demanar la mateixa IP que tenia anteriorment. Un cop rebuda la concessió, el programa client queda “adormit”, pendent de tornar-se a executar automàticament quan calgui renegociar la concessió. Sense intervenció de l’usuari, el programa client s’activa i segueix el procediment necessari per renegociar l’adreça IP cada cop que el temps de la concessió s’exhaureix.
</p>

<p>
Els programes client varien d’un sistema operatiu a un altre i la manera d’executar-los també. Generalment es disposa d’un client executable en mode text o ordres i d’una interfície gràfica (<acronym title="Graphical User Interface">GUI</acronym>, <em>graphics user interface</em> o interfície gràfica d’usuari) per a la configuració. No cal dir que els sistemes Windows tendeixen a la configuració gràfica usant finestres i a la configuració i execució interna d’amagat de l’usuari. Normalment, en els sistemes GNU/Linux la configuració es fa usant fitxers de text o opcions que es donen a ordres executables. La interfície gràfica acostuma a ser un <em>frontend</em> per cridar l’ordre. Segons sigui el sistema operatiu es pot consultar el fitxer de registre de les concessions rebudes pel client, el fitxer de <em>leases</em>, més o menys detalladament.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Configuració client</p>
<p>
Usualment, les configuracions client es poden fer de tres maneres diferents:
</p>
<ul>
<li class="level1"><div class="li"> Fitxer de text: editar directament els fitxers de configuració.</div>
</li>
<li class="level1"><div class="li"> Menús en mode text: usant algun programa de menús amb interfície de text.</div>
</li>
<li class="level1"><div class="li"> Aplicació gràfica: usant una aplicació de finestres en l’entorn gràfic.</div>
</li>
</ul>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">&#039;Frontend&#039;</p>
<p>
Part que està formada per una interfície gràfica i que acostuma a recollir dades interactuant amb l’usuari. És molt comú en els entorns Unix/Linux tenir comandes molt potents amb una varietat d’opcions i disposar d’algun <em>frontend</em> per a aquella comanda perquè la interacció sigui més amigable.
</p>
</div></div>
<p>
Generalment, el programa client es pot configurar per definir com es comunicarà amb el servidor: informació a demanar, informació a proporcionar al servidor, opcions per defecte…
</p>

</div>

<h4><a id="servidor_dhcp" >Servidor DHCP</a></h4>
<div class="level4">

<p>
L’administrador de xarxa és l’encarregat de pensar la ubicació del servidor o servidors DHCP en l’estructura corporativa. Com més complicada sigui la topologia de la xarxa, més difícil en serà la gestió. Una xarxa corporativa bàsica pot disposar d’un únic servidor DHCP que ofereix els seus serveis a tots els equips de la xarxa. Els clients poden estar en una mateixa subxarxa o en diverses subxarxes, però totes amb connectivitat amb el servidor DHCP. Aquest també pot ser l’esquema d’una xarxa privada a casa, on un encaminador (el de l’ISP, per exemple) proporciona el servei DHCP a tots els ordinadors de la casa.
</p>

<p>
Si la xarxa corporativa creix i passa a tenir subxarxes segmentades amb tallafocs, la configuració del servidor DHCP es complica. Si es vol continuar disposant d’un únic servidor per a tota la xarxa, caldrà que els tallafocs (<em>firewalls</em>) deixin passar els paquets DHCP entre les subxarxes i el servidor. Una altra opció és posar un servidor DHCP per a cada subxarxa o grups de subxarxes. Fent-ho així, l’administració de cada servidor és més senzilla, però hi ha més servidors a administrar. Una xarxa amb una casuística completa és la que té diversos servidors DHCP per a diverses parts de la xarxa i tallafocs entre clients i servidors que han de permetre el pas de paquets DHCP.
</p>

<p>
Si el servidor DHCP és l’encarregat de donar adreces IP als clients, qui li proporciona una adreça IP a ell? Ho fa o bé un altre servidor DHCP (i podríem tornar a fer la mateixa pregunta indefinidament) o bé l’administrador. Usualment, en una xarxa corporativa el servidor DHCP utilitza una IP estàtica definida per l’administrador. Això li permet estar sempre disponible per als clients amb la mateixa IP i no el fa dependre d’un servidor extern.
</p>

<p>
Hi ha diversos programes servidors DHCP que es poden classificar en dos grans grups: els que treballen en mode text i els que ho fan en mode gràfic. Cada administrador treballa amb les seves eines preferides. Les tasques bàsiques per aprendre a utilitzar un servidor DHCP són: observar, fer una llista de la configuració actual, activar/aturar el servei, modificar la configuració, monitorar els <em>logs</em> (registre de successos del servei) i, evidentment, saber instal·lar i desinstal·lar l’aplicació servidor.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Els fitxers de <em>logs</em> (successos) recullen els esdeveniments que es volen monitorar.
</p>
</div></div>
<p>
Com la majoria de serveis de xarxa, el servei DHCP s’executa en segon pla en forma de dimoni. El servidor DHCP sempre està engegat escoltant en el port 67 les peticions que rep dels clients. Quan rep una petició entrant, el programa executable del servidor DHCP la processa i posa en marxa tot el mecanisme DHCP pertinent per tornar a escoltar noves peticions. De fet, el servidor sempre escolta peticions i les processa simultàniament (segons la configuració).
</p>

<p>
Els fitxers del registre del servei, on s’anoten les concessions, mantenen la informació encara que el servei s’aturi o que el servidor s’apagui. En tornar a engegar-lo es llegiran de nou els fitxers de registres per tal de saber quines són les concessions que s’havien realitzat.
</p>

</div>

<h2><a id="instal_lacio_del_servidor_dhcp" >Instal·lació del servidor DHCP</a></h2>
<div class="level2">

<p>
El servei de xarxa DHCP està estructurat en forma de servei client/servidor; per tant, caldrà disposar del programari apropiat per interpretar cada un d’aquests rols. El programari que fa la funció de client ja està usualment integrat en el sistema operatiu. És a dir, per disposar de la part client del servei DHCP normalment no cal instal·lar res.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Els fitxers de concessions permeten mantenir la coherència de l’assignació d’adreces IP entre aturades del servei.
</p>
</div></div>
<p>
Així, doncs, quan parlem d’instal·lar un servei DHCP fem referència al procés d’instal·lació i configuració del programari del servidor DHCP. Evidentment també caldrà configurar els clients adequadament per fer ús del servei.
</p>

<p>
La instal·lació del programari que proporciona el servei DHCP es fa de manera molt similar (per no dir idèntica) al programari d’altres serveis de xarxa com <acronym title="Domain Name System">DNS</acronym>, HTTP o <acronym title="File Transfer Protocol">FTP</acronym>. Es tracta d’instal·lar el programari de l’aplicació servidor i fer-ne la configuració apropiada. 
</p>

<p>
Per fer-ho cal fer les reflexions i els passos següents:
</p>
<ol>
<li class="level1"><div class="li"> Preguntarse: Quin programari proporciona aquest servei? Quines característiques té? Com es pot adquirir?</div>
</li>
<li class="level1"><div class="li"> Obtenir l’aplicació que proporciona el servei DHCP.</div>
</li>
<li class="level1"><div class="li"> Observar l’estat de la xarxa actual. Està ja el servei en funcionament? Existeix ja una configuració DHCP activa?</div>
</li>
<li class="level1"><div class="li"> Instal·lar l’aplicació servidor.</div>
</li>
<li class="level1"><div class="li"> Comprovar que la instal·lació s’ha fet correctament.</div>
</li>
<li class="level1"><div class="li"> Configurar el servei en el servidor i activar els clients perquè l’utilitzin.</div>
</li>
<li class="level1"><div class="li"> Comprovar que el servei funciona correctament.</div>
</li>
</ol>

</div>

<h3><a id="aplicacions_servidor_dhcp" >Aplicacions servidor DHCP</a></h3>
<div class="level3">

<p>
Sempre que l’administrador vol posar en funcionament un nou servei de xarxa cal que primerament analitzi quines aplicacions hi ha al mercat que ofereixen aquest servei. És feina seva estudiar les característiques de les diverses aplicacions, avaluar-ne l’eficiència, el cost, el que en diuen altres usuaris… La manera més fàcil de fer això és navegar per Internet, consultar les revistes especialitzades o demanar consell a informàtics experts.
</p>

<p>
Usualment, però, l’administrador acaba utilitzant l’aplicació servidor DHCP que li proporciona el mateix sistema operatiu. Si utilitzeu Windows, l’empresa Microsoft disposa d’una aplicació pròpia, però també en podeu trobar d’altres a Internet. Igualment, si utilitzeu GNU/Linux segurament la mateixa distribució ja proporciona un servidor DHCP. De totes maneres també en podeu obtenir d’altres a Internet.
</p>

</div>

<h2><a id="configuracio_del_servei" >Configuració del servei</a></h2>
<div class="level2">

<p>
Per configurar el servei DHCP primer cal saber observar i manipular la configuració de xarxa existent, i això consisteix a:
</p>
<ul>
<li class="level1"><div class="li"> Fer la llista de la configuració de xarxa actual.</div>
</li>
<li class="level1"><div class="li"> Comprovar l’estat del servei de xarxa.</div>
</li>
<li class="level1"><div class="li"> Activar/desactivar el servei de xarxa.</div>
</li>
<li class="level1"><div class="li"> Monitorar el servei i el procés del servidor.</div>
</li>
</ul>

<p>
Les tasques principals per configurar un servidor DHCP són les següents:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Exemples de configuració</p>
<p>
A GNU/Linux és molt usual que el paquet que proporciona un servei inclogui un fitxer d’exemple de configuració. El servei DHCP inclou el fitxer dhcpd.conf i la pàgina de manual del mateix nom.
</p>
</div></div><ul>
<li class="level1"><div class="li"> Instal·lar el programari del servidor DHCP.</div>
</li>
<li class="level1"><div class="li"> Activar/desactivar el servei del DHCP.</div>
</li>
<li class="level1"><div class="li"> Fer la llista de la configuració actual del servidor DHCP.</div>
</li>
<li class="level1"><div class="li"> Modificar la configuració del servidor DHCP.</div>
</li>
<li class="level1"><div class="li"> Monitorar els <em>logs</em> del servei DHCP i els fitxers de registre de les concessions (<em>leases</em>).</div>
</li>
</ul>

<p>
Abans d’endinsar-nos en la configuració del servei és molt útil observar una configuració ja existent. Un exemple de fitxer de configuració del servei DHCP és el que es mostra a continuació:
</p>
<pre class="code"># a) opcions globals del servidor DHCP (usuals)
ddns-update-style interim;
ignore client-updates;

# b) definició de la xarxa a la qual s&#039;ofereix el servei DHCP
subnet 192.168.0.0 netmask 255.255.255.0 {
   # opcions genèriques per a tots els equips de la xarxa
   option routers      192.168.0.1;
   option subnet-mask     255.255.255.0;
   option domain-name     &quot;domain.org&quot;;
   option domain-name-servers  192.168.1.1;

   # definició del rang d&#039;IP dinàmiques a usar 
   # i dels temps de les concessions
   range dynamic-bootp 192.168.0.128 192.168.0.254;
   default-lease-time 21600;
   max-lease-time 43200;

  # c) opcions d&#039;equips individuals
  # el servidor NS obté sempre una adreça fixa basada en MAC
  host ns {
   next-server marvin.redhat.com;
   hardware ethernet 12:34:56:78:AB:CD;
   fixed-address 207.175.42.254;
  }
}</pre>

<p>
En aquest fitxer de configuració es pot veure que hi ha tres àmbits diferents de definició:
</p>
<ol>
<li class="level1"><div class="li"> <strong>Opcions globals del servidor DHCP</strong>. Són opcions que indiquen al servidor la manera d’actuar. També són opcions generals que cal aplicar a totes les concessions que es realitzin, independentment de la xarxa o equip.</div>
</li>
<li class="level1"><div class="li"> <strong>Definicions i opcions de xarxa</strong>. Es defineixen tantes (sub)xarxes com atén el servidor. Cada definició de subxarxa consta de l’adreça IP de la xarxa i la màscara corresponent. Entre claus s’indiquen totes les opcions específiques per a les concessions de les adreces IP corresponents a la subxarxa. És habitual indicar el rang o <em>pool</em> d’adreces dinàmiques a usar, la porta d’enllaç predeterminada, el servidor de noms…</div>
</li>
<li class="level1"><div class="li"> <strong>Opcions d’equips individuals</strong>. Dins d’una subxarxa es poden definir opcions per a equips individuals. Cal identificar els equips per la seva adreça MAC i, entre claus, indicar les opcions que els són específiques. Això permet assignar adreces fixes dinàmicament (equivalent al protocol BOOTP) usant les opcions de maquinari Ethernet i <em>fixed-address</em>.</div>
</li>
</ol>

<p>
Les opcions globals de configuració DHCP es poden redefinir amb valors diferents dins d’un bloc de xarxa concret. Dins d’un equip també es poden definir opcions amb valors diferents als definits per a la xarxa o globalment. Tal com passa en els llenguatges de programació, preval el valor més intern, el de <em>host</em> per damunt del de xarxa i el de xarxa per damunt del global.
</p>

</div>

<h3><a id="configuracio_basica" >Configuració bàsica</a></h3>
<div class="level3">

<p>
Per fer funcionar el servidor DHCP cal configurar-lo. Per poder arrencar li cal saber a quina xarxa donarà servei i quin és el rang d’adreces IP que pot usar dinàmicament per a les concessions als clients.
</p>

<p>
El paquet DHCP conté un fitxer d’exemple al directori /user/share/doc/ dhcp*/dhcpd.conf.sample. Aquest fitxer es pot copiar a /etc/dhcpd.conf i passarà a ser la configuració bàsica del servidor DHCP. Podem veure’n el contingut fent:
</p>
<pre class="code">root@server:~# ls -l /usr/share/doc/isc-dhcp-server/examples/dhcpd.conf.example
-rw-r--r-- 1 root root 3496 de des.  11  2018 /usr/share/doc/isc-dhcp-server/examples/dhcpd.conf.example
root@server:~# head /etc/dhcp/dhcpd.conf 
# dhcpd.conf
#
# Sample configuration file for ISC dhcpd
#

# option definitions common to all supported networks...
option domain-name &quot;example.org&quot;;
option domain-name-servers ns1.example.org, ns2.example.org;

default-lease-time 600;
root@server:~# </pre>

<p>
En la configuració per defecte es poden analitzar els diversos elements que es configuren:
</p>
<ul>
<li class="level1"><div class="li"> Opcions globals: indiquen al servidor que ignori les actualitzacions dels clients i el tipus de DDNS a usar (actualitzacions dinàmiques de <acronym title="Domain Name System">DNS</acronym>).</div>
</li>
<li class="level1"><div class="li"> Definició de subxarxa: cal definir tants blocs de subxarxa com subxarxes atengui el servidor DHCP.</div>
</li>
<li class="level1"><div class="li"> Opcions genèriques de subxarxa: es poden indicar opcions genèriques per als equips d’una subxarxa. Evidentment poden diferir de les opcions d’altres subxarxes.</div>
</li>
<li class="level1"><div class="li"> Les opcions principals de xarxa a descriure són l’encaminador, la màscara de xarxa, el domini…</div>
</li>
<li class="level1"><div class="li"> Les opcions principals a descriure del servei DHCP són el rang d’adreces IP dinàmiques a usar i el temps màxim de concessió.</div>
</li>
<li class="level1"><div class="li"> Perquè un <em>host</em> determinat tingui sempre la mateixa adreça IP es poden fer entrades individualitzades per a <em>hosts</em> concrets. Els <em>hosts</em> s’identifiquen per la seva adreça MAC.</div>
</li>
<li class="level1"><div class="li"> A un <em>host</em> concret se li poden aplicar opcions individualitzades, com per exemple definir el seu nom. Les opcions individuals prevalen sobre les genèriques.</div>
</li>
</ul>

</div>

<h3><a id="configuracio_avancada" >Configuració avançada</a></h3>
<div class="level3">

<p>
El protocol DHCP permet configuracions d’una certa complexitat. Podeu consultar la documentació del DHCP i les pàgines del manual sobre el dimoni dhcpd i el fitxer de configuració dhcpd.conf.
</p>

<p>
Les característiques principals que s’hi descriuen són l’agrupació d’entrades en grups i classes i la possibilitat que el DHCP es comuniqui amb el <acronym title="Domain Name System">DNS</acronym> (actualitzacions DDNS) per crear entrades <acronym title="Domain Name System">DNS</acronym> quan un equip rep una configuració DHCP.
</p>

<p>
Vegeu un exemple de configuració amb opcions més avançades:
</p>
<pre class="code"># option definitions common to all supported networks...
option domain-name &quot;example.org&quot;;
option domain-name-servers ns1.example.org, ns2.example.org;

default-lease-time 600;
max-lease-time 7200;

ddns-update-style none;
authoritative;

subnet 10.5.5.0 netmask 255.255.255.224 {
  range 10.5.5.26 10.5.5.30;
  option domain-name-servers ns1.internal.example.org;
  option domain-name &quot;internal.example.org&quot;;
  option routers 10.5.5.1;
  option broadcast-address 10.5.5.31;
  default-lease-time 600;
  max-lease-time 7200;
}

host fantasia {
  hardware ethernet 08:00:07:26:c0:a5;
  fixed-address fantasia.example.com;
}

# You can declare a class of clients and then do address allocation
# based on that.   The example below shows a case where all clients
# in a certain class get addresses on the 10.17.224/24 subnet, and all
# other clients get addresses on the 10.0.29/24 subnet.

class &quot;foo&quot; {
  match if substring (option vendor-class-identifier, 0, 4) = &quot;SUNW&quot;;
}

shared-network 224-29 {
  subnet 10.17.224.0 netmask 255.255.255.0 {
    option routers rtr-224.example.org;
  }
  subnet 10.0.29.0 netmask 255.255.255.0 {
    option routers rtr-29.example.org;
  }
  pool {
    allow members of &quot;foo&quot;;
    range 10.17.224.10 10.17.224.250;
  }
  pool {
    deny members of &quot;foo&quot;;
    range 10.0.29.10 10.0.29.230;
  }
}</pre>

</div>

<h4><a id="base_de_dades_de_concessions_fetes_pel_servidor" >Base de dades de concessions fetes pel servidor</a></h4>
<div class="level4">

<p>

</p>

<p>
El servidor desa en una base de dades local (de fet, són fitxers de text) les concessions (<em>leases</em>) que realitza. D’aquesta manera en pot seguir la pista en tot moment. Generalment les té a la memòria (per permetre’n un accés més ràpid), però en manté una còpia al disc. Si, per exemple, el sistema o el servei es reinicia, pot saber quines són les concessions que encara estan actives (i, per tant, quines adreces IP no té disponibles).
</p>

<p>
Usualment el fitxer de concessions és a /var/lib/dhcp. Vegeu-ne el contingut fent:
</p>
<pre class="code">root@server:~# cat /var/lib/dhcp/dhcpd.leases
# The format of this file is documented in the dhcpd.leases(5) manual page.
# This lease file was written by isc-dhcp-4.4.1

# authoring-byte-order entry is generated, DO NOT DELETE
authoring-byte-order little-endian;

root@server:~#</pre>

</div>

<h2><a id="assignacions_estatiques_i_dinamiques" >Assignacions estàtiques i dinàmiques</a></h2>
<div class="level2">

<p>
Els clients de xarxa o bé tenen una configuració estàtica on es defineixen els seus paràmetres o bé reben la configuració per DHCP. El procés de configurar un client DHCP és tan senzill com activar aquesta última opció usant algun dels mètodes adients.
</p>

<p>
La configuració dels clients DHCP consisteix en el següent:
</p>
<ul>
<li class="level1"><div class="li"> Observar la configuració de xarxa actual del client.</div>
</li>
<li class="level1"><div class="li"> Configurar el client per rebre dinàmicament una adreça IP. Es tracta d’activar/desactivar la configuració de xarxa dinàmica o estàtica.</div>
</li>
<li class="level1"><div class="li"> Sol·licitar una nova IP al servidor DHCP.</div>
</li>
<li class="level1"><div class="li"> Fer la llista del fitxer de registre de les concessions client rebudes.</div>
</li>
<li class="level1"><div class="li"> Activar/desactivar el servei de xarxa en el client.</div>
</li>
</ul>

</div>

<h3><a id="client_dinamic" >Client dinàmic</a></h3>
<div class="level3">

<p>
Tot equip client de xarxa necessita una configuració apropiada. Si aquesta configuració es defineix element per element en el mateix equip, s’anomena configuració estàtica. Si és així, no cal un servidor DHCP. És quan els clients reben la configuració de xarxa externament que parlem de configuració dinàmica i ens cal un servidor DHCP que la proporcioni.
</p>

<p>

</p>

<p>
La configuració del client es pot fer en mode text editant directament els fitxers, utilitzant interfícies de text o gràfiques (<em>applets</em>).
</p>

</div>

<h4><a id="edicio_dels_fitxers_de_configuracio" >Edició dels fitxers de configuració</a></h4>
<div class="level4">

<p>
Es pot editar directament el fitxer de configuració de la interfície de xarxa pertinent i establir l’opció <em>dhcp</em> a la directiva <em>iface</em> per activar el client DHCP. Si per exemple es vol configurar la interfície de xarxa <em>enp0s3</em>, el fitxer hauria de tenir el següent aspecte:
</p>
<pre class="code">root@server:~# cat /etc/network/interfaces
auto lo
iface lo inet loopback
auto enp0s3
iface enp0s3 inet dhcp
root@server:~# </pre>

</div>

<h4><a id="menus_amb_interficie_de_text" >Menús amb interfície de text</a></h4>
<div class="level4">

<p>
Un altre mecanisme per activar el client DHCP és utilitzar alguna utilitat de menús en entorn de text (varien segons el sistema i se’n poden trobar a Internet), tot i que estan en força desús.
</p>

<p>
La <span class="figref"><a href="#Figure2"><span>figura</span></a></span> que mostra una configuració de client de xarxa estàtica i on es pot veure que la casella que permet activar el client DHCP està desactivada.
</p>
<div class="iocfigure"><a name="Figure2"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Configuració estàtica del client DHCP

</figcaption><img src="../media/ic10m08u1_06.png" alt="" /></figure>
</div>
<p>
El procediment per activar el client de xarxa DHCP és molt senzill. N’hi ha prou d’activar l’opció pertinent, tal com mostra la <span class="figref"><a href="#Figure3"><span>figura</span></a></span> (“Activació del client DHCP usant menús de text”).
</p>
<div class="iocfigure"><a name="Figure3"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Activació del client DHCP usant menús de text

</figcaption><img src="../media/ic10m08u1_07.png" alt="" /></figure>
</div>
</div>

<h4><a id="menus_en_mode_grafic" >Menús en mode gràfic</a></h4>
<div class="level4">

<p>
En mode gràfic, el sistema també proporciona mecanismes per configurar les interfícies de xarxa i establir el mode d’activació a DHCP. En la <span class="figref"><a href="#Figure4"><span>figura</span></a></span> es pot observar que la configuració de la interfície té activada l’opció de configuració de xarxa per DHCP.
</p>
<div class="iocfigure"><a name="Figure4"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Activació del client DHCP usant l’entorn gràfic

</figcaption><img src="../media/connexio-ethernet.png" alt="" /></figure>
</div>
</div>

<h3><a id="renovacio_de_l_adreca_ip" >Renovació de l&#039;adreça IP</a></h3>
<div class="level3">

<p>
El client DHCP pot alliberar l’adreça que utilitza quan ho creu pertinent. En fer-ho, el servidor anota la fi de la concessió i si es tracta d’una adreça dinàmica de rang torna a quedar disponible per assignar-la a un altre client. Quan a un client se li està acabant el temps de concessió ha de tornar a negociar una adreça amb el servidor. De totes maneres, si el client vol, en pot tornar a sol·licitar una en qualsevol moment.
</p>

<p>
El client pot alliberar una adreça (<em>release</em>) que està en ús en qualsevol moment. Pot forçar-ho fent, per exemple:
</p>
<pre class="code">root@client:~# dhclient -r -v enp0s3
Killed old client process
Internet Systems Consortium DHCP Client 4.3.5
Copyright 2004-2016 Internet Systems Consortium.
All rights reserved.
For info, please visit https://www.isc.org/software/dhcp/

Listening on LPF/enp0s3/08:00:27:f8:f9:29
Sending on   LPF/enp0s3/08:00:27:f8:f9:29
Sending on   Socket/fallback
DHCPRELEASE on enp0s3 to 10.0.2.3 port 67 (xid=0x3ab21a2a)</pre>

<p>
Per forçar el client a demanar una nova adreça per a la interfície Ethernet <em>enp0s3</em> es pot fer:
</p>
<pre class="code">root@client:~# dhclient  -v enp0s3
Internet Systems Consortium DHCP Client 4.3.5
Copyright 2004-2016 Internet Systems Consortium.
All rights reserved.
For info, please visit https://www.isc.org/software/dhcp/

Listening on LPF/enp0s3/08:00:27:f8:f9:29
Sending on   LPF/enp0s3/08:00:27:f8:f9:29
Sending on   Socket/fallback
DHCPDISCOVER on enp0s3 to 255.255.255.255 port 67 interval 3 (xid=0xf5a1913d)
DHCPREQUEST of 10.0.2.10 on enp0s3 to 255.255.255.255 port 67 (xid=0x3d91a1f5)
DHCPOFFER of 10.0.2.10 from 10.0.2.3
DHCPACK of 10.0.2.10 from 10.0.2.3
bound to 10.0.2.10 -- renewal in 506 seconds.</pre>

<p>
La comanda <em>dhclient</em> amb el paràmetre -v (<em>verbose</em>) és molt útil ja que mostra molta informació, i en cas d’error (mala configuració, error de xarxa, etc.) permet afinar molt d’on prové l’error.
</p>

</div>

<h3><a id="registre_de_concessions_rebudes" >Registre de concessions rebudes</a></h3>
<div class="level3">

<p>
El client DHCP porta un registre de les concessions rebudes; d’aquesta manera pot tornar a demanar una concessió abans que expiri l’actual. Aquest registre també serveix per demanar al servidor una adreça IP concreta. Les concessions o <em>leases</em> del client es desen en un fitxer anomenat /var/lib/dhcp/dhclient.leases. Podem veure’n el contingut fent:
</p>
<pre class="code">root@client:~# tail /var/lib/dhcp/dhclient.leases
  option subnet-mask 255.255.255.0;
  option routers 10.0.2.1;
  option dhcp-lease-time 1200;
  option dhcp-message-type 5;
  option domain-name-servers 192.168.1.1;
  option dhcp-server-identifier 10.0.2.3;
  renew 6 2020/07/11 14:20:25;
  rebind 6 2020/07/11 14:28:39;
  expire 6 2020/07/11 14:31:09;
}
root@client:~# </pre>

</div>

<h3><a id="comprovacio_del_funcionament" >Comprovació del funcionament</a></h3>
<div class="level3">

<p>
La millor manera de comprovar el funcionament del DHCP és simplement posant-lo en marxa, és a dir, creant una xarxa amb diversos clients DHCP i un servidor que els atengui. Per saber si el servei funciona cal mirar un per un cada client i comprovar que han rebut la configuració de xarxa correcta. El problema, però, és què fer si els clients no es configuren correctament.
</p>

<p>
Els passos més usuals a seguir per a la resolució de problemes són:
</p>
<div class="iocreference"><div class="ioccontent">
<p>
En l’apartat “Funcionament del protocol DHCP” podeu observar detalladament com és el diàleg entre el client i el servidor.
</p>
</div></div><div class="iocreference"><div class="ioccontent">
<p>
En l’apartat “Renovar l’adreça IP” s’explica com forçar el client a demanar una nova configuració.
</p>
</div></div><div class="iocreference"><div class="ioccontent">
<p>
Podeu manipular vosaltres mateixos la captura del trànsit de xarxa <acronym title="Domain Name System">DNS</acronym> carregant el fitxer de captura del Wireshark que es lliura com a material complementari. Aquest fitxer el trobareu en la secció “Annexos” del web del mòdul.
</p>
</div></div><ul>
<li class="level1"><div class="li"> Comprovar que la xarxa està correctament connectada físicament, és a dir, cables, connectors, interfícies…</div>
</li>
<li class="level1"><div class="li"> Mirar si existeix connectivitat entre els equips, per exemple, usant una configuració estàtica. Això permetrà descartar que els problemes siguin deguts a altres causes. Si el DHCP no va és que no està configurat correctament.</div>
</li>
<li class="level1"><div class="li"> Repassar la configuració del client i del servidor DHCP, especialment la del servidor. Es pot començar fent la configuració tan senzilla com sigui possible. Un cop funciona es pot anar avançant en la seva complexitat.</div>
</li>
<li class="level1"><div class="li"> Examinar els fitxers de concessions, tant el del client com el del servidor, per detectar-hi anomalies.</div>
</li>
<li class="level1"><div class="li"> Quan la comunicació client/servidor no funciona correctament i no sabem per què, és molt útil monitorar el trànsit de xarxa mitjançant alguna eina d’anàlisi dels paquets que viatgen per la xarxa.</div>
</li>
</ul>

<p>
Centrem-nos, doncs, en el monitoratge del trànsit de xarxa per tal de comprovar que el diàleg entre el client i el servidor és l’apropiat. Existeixen moltes eines al mercat (que podeu trobar per Internet) que fan aquesta funció. Una de les més recomanables és Wireshark. Amb aquesta aplicació hem de poder observar l’intercanvi dels paquets <em>DHCP discover</em>, <em>DHCP offer</em>, <em>DHCP request</em> i <em>DHCP ack</em> que es produeix quan tot el procés DHCP funciona correctament. Si aquest intercanvi no es produeix és que hi ha algun problema.
</p>

<p>
En la <span class="figref"><a href="#Figure5"><span>figura</span></a></span> (“Captura d’un diàleg DHCP client/servidor”) podeu observar una captura de trànsit DHCP feta amb Wireshark. La captura s’ha fet al servidor i s’ha forçat al client a demanar de nou una configuració de xarxa amb la utilitat <em>dhclient</em>.
</p>
<div class="iocfigure"><a name="Figure5"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Captura d’un diàleg DHCP client

</figcaption><img src="../media/ic10m08u1_09.png" alt="" /></figure>
<div class="footfigure">servidor</div></div>
</div>

<h2><a id="opcions_addicionals_de_configuracio" >Opcions addicionals de configuració</a></h2>
<div class="level2">

<p>
Com en la majoria de serveis actuals, la quantitat d’opcions de configuració és impressionant, per no dir aterridora. L’administrador de xarxa ha de conèixer les opcions bàsiques per configurar el servei DHCP, que inclouen l’assignació d’una configuració de xarxa bàsica, els temps de les concessions, assignacions dinàmiques i fixes, i fitxers d’arrencada via PXE. 
</p>

<p>
Existeixen centenars d’opcions de configuració que permeten especificar la configuració del client fins al mínimin detall. Més important encara, existeixen diversos mecanismes per agrupar les opcions per <em>host</em>, subxarxa, classe, <em>pool</em>…, fet que premet definir “prototipus” de configuració per aplicar a <em>hosts</em> segons si tenen o no unes característiques determinades.
</p>

<p>
També existeixen extensions DHCP que permeten usar expressions i llenguatges de programació per poder realitzar configuracions complexes que permeten decidir quin tipus de configuració assignar al client. 
</p>

</div>

<h3><a id="opcions_de_configuracio_del_servidor_i_ambit_d_aplicacio" >Opcions de configuració del servidor i àmbit d&#039;aplicació</a></h3>
<div class="level3">

<p>
Les opcions de configuració DHCP són múltiples i comprenen molts àmbits. Algunes permeten la compatibilitat amb sistemes antics, d’altres, amb altres tipus de xarxes… No és imaginable que un administrador de xarxes les conegui totes a fons. Normalment fa ús d’un conjunt reduït d’opcions que és més que suficient per administrar la majoria de xarxes.
</p>

<p>
La configuració DHCP es pot definir tant en el client com en el servidor, tot i que usualment es fa en el servidor. La tasca principal és configurar un servidor per tal de proporcionar les opcions apropiades a cada subxarxa. De totes maneres, però, un client també pot disposar d’un fitxer de configuració en el qual es defineixen quins són els seus requeriments i com ha de ser el diàleg amb el servidor. Per exemple, es defineixen quines opcions ha de sol·licitar, valors per defecte de determinades opcions (per si el servidor no en proporciona). El client també pot definir informació que proporcionarà al servidor per tal que aquest prengui decisions dinàmicament.
</p>

<p>
Caldrà, doncs, entendre quins són els àmbits (<em>scope</em>) de definició de sentències i opcions, com s’agrupen les subxarxes i els <em>hosts</em>, quines són les opcions globals, com es realitzen les definicions condicionals i molts altres detalls.
</p>

</div>

<h4><a id="ambit_de_definicio" >Àmbit de definició</a></h4>
<div class="level4">

<p>
Els clients es poden agrupar en diversos àmbits per tal de definir les opcions que han de rebre. El mateix servidor DHCP pot actuar de manera diferent segons quin sigui l’àmbit de definició.
</p>

<p>
Alguns dels conceptes a tractar són:
</p>
<ul>
<li class="level1"><div class="li"> <em>Subnets</em></div>
</li>
<li class="level1"><div class="li"> Període de concessió</div>
</li>
<li class="level1"><div class="li"> Adreces fixes o reservades: identificació de <em>hosts</em></div>
</li>
<li class="level1"><div class="li"> PXE: protocol d’arrencada via xarxa</div>
</li>
<li class="level1"><div class="li"> Àmbit d’aplicació</div>
</li>
<li class="level1"><div class="li"> <em>Pool</em></div>
</li>
</ul>

<p>
Les sentències d’àmbit d’aplicació més usuals són <em>subnet</em> i <em>host</em>, que permeten identificar una subxarxa i un host concret respectivament. Les subxarxes es poden agrupar en <em>shared-network</em> i els clients es poden agrupar usant la sentència <strong><em>group</em></strong>. Les opcions es poden definir en funció de determinats requisits que compleixi el client mitjançant la sentència <strong><em>class</em></strong> i les <strong>declaracions condicionals</strong>.
</p>

<p>
El servei DHCP es pot configurar amb multitud de sentències que es poden repassar a l’<acronym title="Request for Comments">RFC</acronym> 2131 i a la pàgina de manual dhcpd.conf(5). Els clients DHCP reben del servidor la configuració de xarxa. Usualment parlem de l’adreça IP i la màscara, però de fet poden rebre gran quantitat de paràmetres de configuració de xarxa i informació sobre diversos serveis de xarxa disponibles. El client, per la seva part, pot sol·licitar paràmetres concrets al servidor. Quan configura el servei DHCP, l’administrador de xarxa no ha d’especificar totes les opcions possibles (de fet són moltíssimes), sinó només les que siguin necessàries per a cada client. Algunes opcions prenen valors per defecte i no cal especificar-les, d’altres no poden ser alterades pel servidor.
</p>

<p>
Una de les possibilitats que ofereix el DHCP és configurar les opcions de xarxa en funció de qui i de com és el client. És a dir, assignar al client una configuració de xarxa o una altra en funció de la informació que proporciona. Fixeu-vos que no es tracta d’entrades <em>host</em> estàtiques per a cada client, sinó que un mateix client tindrà una o altra configuració segons la informació que proporcioni.
</p>

</div>

<h2><a id="documentacio_de_procediments" >Documentació de procediments</a></h2>
<div class="level2">

<p>
Una de les feines més desconegudes en el món de la informàtica és la confecció de manuals i documentació de suport. Com a clients, molt sovint ens queixem que ens falta informació o que està mal redactada. Com a administradors de xarxa, en canvi, no trobem mai temps per anotar les coses. Mentre les tenim al cap no creiem necessari fer la documentació, i després ja ens és impossible fer-ho, i sovint és just quan ens faria falta haver-ho fet.
</p>

<p>
Cal tenir clara la informació que cal documentar, tant per a l’usuari com per a l’administrador.
</p>

<p>
El client ha de saber:
</p>
<div class="iocreference"><div class="ioccontent">
<p>
Un altre exemple de captura DHCP es lliura com a material d’estudi. En aquesta captura hi ha dos servidors DHCP diferents en la xarxa i es poden observar paquets NACK. Trobareu aquest fitxer en la secció “Annexos” del web del mòdul.
</p>
</div></div><ul>
<li class="level1"><div class="li"> Com contactar amb el servidor DHCP. Quin programari ha d’utilitzar i com l’ha de configurar per fer ús del servei.</div>
</li>
<li class="level1"><div class="li"> Quina és la informació que obtindrà via DHCP. Cal saber consultar aquesta informació i saber què significa, per a què serveix.</div>
</li>
</ul>

<p>
La documentació de l’usuari ha de descriure el procés per activar el client DHCP, amb l’ajut de captures de pantalla. Calen també exemples de llista de concessions rebudes: on són i com es poden consultar. La part més important és mostrar un exemple de configuració de xarxa rebuda en el qual es detalli el significat de cada element i explicar a l’usuari com fer aquesta consulta.
</p>

</div>

	 </article>
     <div class="pnpage">
      <div class="left-corner"></div>
      <div id="prevpage">Anar a la p&agrave;gina anterior:<br /><a href="../../../WebContent/u1/a1/annexos.html">Annexos</a></div>
      <div id="nextpage">Anar a la p&agrave;gina seg&uuml;ent:<br /><a href="../../../WebContent/u1/a2/activitats.html">Activitats</a></div>
      <div class="right-corner"></div>
     </div>
    </div>
    <footer class="footer">
      <div><small>Aquest document està subjecte a una llicència oberta de Creative Commons, es reserva el dret de reconeixement de l'autoria, d'exigir que no se'n faci cap mena d'ús comercial. Si altereu o transformeu aquesta obra, o en genereu obres derivades, només podeu distribuir l'obra generada amb una llicència idèntica a aquesta.</small></div>
    </footer>
 </div>
 <div id="back_preview" class="hidden"></div>
 <div id="preview" class="hidden">
  <div class="prevcontent"></div>
 </div>
 <div id="help-tooltips">
  <div id="help-toc" class="hidden tooltip"><span>Taula de continguts:</span> Ofereix una vista general de l&#39;estructura del m&ograve;dul, que us facilitar&agrave; la navegaci&oacute; a trav&eacute;s dels seus continguts.<span class="arrow-left"></span></div> 
  <div id="help-settings" class="hidden tooltip"><span>Opcions de format:</span> Permet configurar el format de lectura a partir de les vostres prefer&egrave;ncies, modificant la mida de la lletra, el color del fons, l&#39;amplada de la p&agrave;gina o l&#39;ocultaci&oacute; dels continguts complementaris, entre d&#39;altres.<span class="arrow-left"></span></div>
  <div id="help-printer" class="hidden tooltip"><span>Imprimir:</span>  Envia el contingut seleccionat a la impressora.<span class="arrow-left"></span></div>
  <div id="help-favorites" class="hidden tooltip"><span>Prefereits:</span> Permet desar aquelles parts del contingut a les que us interessi accedir en un moment posterior; us permetr&agrave; anar creant un repositori personalitzat de les seccions que considereu m&eacute;s rellevants. Un cop l&#39;hageu començat a fer servir se us mostrar&agrave; a sota un comptador que us informar&agrave; del nombre de preferits que s&#39;hagin emmagatzemat fins al moment.<span class="arrow-left"></span></div>
  <div id="help-favcounter" class="hidden tooltip"><span>Comptador i llistat de preferits:</span> Indica el nombre de preferits que s&#39;han desat fins el moment; clicant damunt seu accedireu al llistat de preferits, i a trav&eacute;s d&#39;aquest podreu accedir directament als continguts que hageu emmagatzemat.<span class="arrow-left"></span></div>
  <div id="help-help_icon" class="hidden tooltip"><span>Ajuda:</span> Aquesta opci&oacute; activa la informaci&oacute; de les funcionalitats del web tot situant el punter del ratol&iacute; al damunt dels diferents &iacute;tems.<span class="arrow-left"></span></div>
  <div id="help-sidebar-hide" class="hidden tooltip"><span>Mostrar/Ocultar barra lateral:</span>  Deshabilita la barra d&#39;opcions, permetent la seva recuperaci&oacute; quan es desitgi.<span class="arrow-left"></span></div>
  <div id="help-search" class="hidden tooltip"><span>Cerca:</span>  Introdu&iuml;u les paraules clau sobre aquells conceptes que desitgeu localitzar en els continguts del m&ograve;dul. Tamb&eacute; podeu excloure un terme de la cerca tot afegint-hi el signe &#8220;-&#8221; al davant.<span class="arrow-top"></span></div>
  <div id="help-header" class="hidden tooltip"><span>Cap&ccedil;alera:</span>  Indica l&#39;apartat o secci&oacute; que es mostra en pantalla. Tingueu present que les capçaleres de segon, tercer i quart nivell tamb&eacute; es poden desar com a marcadors.<span class="arrow-left"></span></div>
</div> 
</body>
</html>
