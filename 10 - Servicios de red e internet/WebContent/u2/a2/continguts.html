<!doctype html>

<!--[if lt IE 7 ]> <html class="ie ie6 no-js" lang="ca"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie ie7 no-js" lang="ca"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie ie8 no-js" lang="ca"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie ie9 no-js" lang="ca"> <![endif]-->
<!--[if gt IE 9]><!--><html class="no-js" lang="ca"><!--<![endif]-->
<!-- the "no-js" class is for Modernizr. -->

<head id="www-sitename-com" data-template-set="html5-reset">

	<meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html">
        
	<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>Serveis de Xarxa i Internet</title>
	
<!-- <meta name="title" content=""> --> 
	<meta name="description" content="">
	<!-- Google will often use this as its description of your page/site. Make it good. -->
	
	<meta name="google-site-verification" content="">
	<!-- Speaking of Google, don't forget to set your site up: http://google.com/webmasters -->
	
	<meta name="author" content="Institut Obert de Catalunya">
	<meta name="Copyright" content="Copyright Institut Obert de Catalunya 2011. All Rights Reserved.">

	<!-- Dublin Core Metadata : http://dublincore.org/ -->
	<meta name="DC.title" content="Serveis de Xarxa i Internet">
	<meta name="DC.subject" content="Informàtica i comunicacions">
	<meta name="DC.creator" content="Institut Obert de Catalunya">
	
	<!--  Mobile Viewport Fix
	j.mp/mobileviewport & davidbcalhoun.com/2010/viewport-metatag 
	device-width : Occupy full width of the screen in its current orientation
	initial-scale = 1.0 retains dimensions instead of zooming out if page height > device height
	maximum-scale = 1.0 retains dimensions instead of zooming in if page width < device width
	-->
	<!-- Uncomment to use � use thoughtfully!
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	-->

	<link rel="shortcut icon" href="../../../img/favicon.ico">
	<!-- This is the traditional favicon.
		 - size: 16x16 or 32x32
		 - transparency is OK
		 - see wikipedia for info on browser support: http://mky.be/favicon/ -->
		 
	<link rel="apple-touch-icon" href="../../../img/apple-touch-icon.png">
	<!-- The is the icon for iOS's Web Clip.
		 - size: 57x57 for older iPhones, 72x72 for iPads, 114x114 for iPhone4's retina display (IMHO, just go ahead and use the biggest one)
		 - To prevent iOS from applying its styles to the icon name it thusly: apple-touch-icon-precomposed.png
		 - Transparency is not recommended (iOS will put a black BG behind the icon) -->
	
	<!-- CSS: screen, mobile & print are all in the same file -->
	<link rel="stylesheet" href="../../../_/css/style.css">

	<!-- CSS: jQuery UI -->
	<link rel="stylesheet" href="../../../_/css/jquery-ui.css">
	
	<!-- all our JS is at the bottom of the page, except for Modernizr. -->
	<script src="../../../_/js/modernizr-1.7.min.js"></script>
	<script src="../../../_/js/Hyphenator.js" type="text/javascript"></script>
	<script type="text/javascript">
	   Hyphenator.config({
		minwordlength : 4
	   });
	   Hyphenator.run();
	</script>
    <script src="../../../_/js/build.js" type="text/javascript"></script>
</head>

<body class="style-newspaper">

<div class="wrapper"><!-- not needed? up to you: http://camendesign.com/code/developpeurs_sans_frontieres -->

	<header id="header">
		<div class="head"><a href="http://ioc.gencat.cat"><img src="../../../img/logo.png" alt="Institut Obert de Catalunya"/></a><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/es/deed.ca"><img src="../../../img/license.png" alt="Llic&egrave;ncia" class="license"/></a></div>
		<div class="headdocument"><a href="../../../index.html">Serveis de Xarxa i Internet</a></div>
        <div id="search" class="search" name="search">
         <form id="frmsearch" action="../../../search.html" method="get">
          <input type="text" name="q"/>
        </form>
        </div>
	</header>
   <div id="upbutton" class="upbutton" style="display:none;"><img src="../../../img/uparrow.png" alt="Pujar a l'inici de p&agrave;gina"/></div>
   <aside id="aside">
    <div id="menu">
      <ul>
       <li name="toc"><div><img src="../../../img/toc.png" alt="&Iacute;ndex"/></div></li>
       <li name="settings"><div><img src="../../../img/settings.png" alt="Configuraci&oacute;"/></div></li>
       <li name="printer"><div><img src="../../../img/printer.png" alt="Imprimir"/></div></li>
       <li name="favorites"><div><img src="../../../img/favorites.png" alt="Favorits"/></div></li>
       <li name="help_icon" class="help_icon"><div><img src="../../../img/help_icon.png" alt="Ajuda"/></div></li>
      </ul>
     </div>
   </aside>
   <div id="sidebar-hide" name="sidebar-hide"><img src="../../../img/arrows.png"/></div>
   <section>
     <div id="toc" class="hidden">
      <div class="menucontent">
        <ul>
        <li id="u2" class="parentnode"><p><a class="unit" href="../../../WebContent/u2/introduccio.html">2. Serveis web i de transferència de fitxers</a></p><ul class="expander"><li id="u2introduccio"><a href="../../../WebContent/u2/introduccio.html">Introducció</a></li><li id="u2resum"><a href="../../../WebContent/u2/resum.html">Resum</a></li><li id="u2resultats"><a href="../../../WebContent/u2/resultats.html">Resultats d'aprenentatge</a></li><li id="u2referencies"><a href="../../../WebContent/u2/referencies.html">Referències</a></li><li id="u2a1" class="tocsection"><p id='u2a1continguts'><a class="section" href="../../../WebContent/u2/a1/continguts.html">Instal·lació i administració de servidors web</a><span class="buttonexp"></span></p><ul><li id="u2a1activitats"><a href="../../../WebContent/u2/a1/activitats.html">Activitats</a></li><li id="u2a1exercicis"><a href="../../../WebContent/u2/a1/exercicis.html">Exercicis</a></li><li id="u2a1annexos"><a href="../../../WebContent/u2/a1/annexos.html">Annexos</a></li></ul></li><div data-parent-id='u2a1' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u2/a1/continguts.html#funcionament_del_servei_web">Funcionament del servei web</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#instal_lacio_i_configuracio_de_servidors_web">Instal·lació i configuració de servidors web</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#moduls_dinamics">Mòduls dinàmics</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#creacio_i_configuracio_de_llocs_web_virtuals">Creació i configuració de llocs web virtuals</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#autenticacio">Autenticació</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#comunicacions_segures">Comunicacions segures</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#monitoratge_del_servei">Monitoratge del servei</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#registres_del_servei">Registres del servei</a></li></ul></div></div><li id="u2a2" class="tocsection"><p id='u2a2continguts'><a class="section" href="../../../WebContent/u2/a2/continguts.html">Instal·lació i administració de serveis de transferència de fitxers</a><span class="buttonexp"></span></p><ul><li id="u2a2activitats"><a href="../../../WebContent/u2/a2/activitats.html">Activitats</a></li><li id="u2a2exercicis"><a href="../../../WebContent/u2/a2/exercicis.html">Exercicis</a></li><li id="u2a2annexos"><a href="../../../WebContent/u2/a2/annexos.html">Annexos</a></li></ul></li><div data-parent-id='u2a2' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u2/a2/continguts.html#servei_de_transferencia_de_fitxers">Servei de transferència de fitxers</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#instal_lacio_i_configuracio_del_servidor">Instal·lació i configuració del servidor</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#creacio_d_usuaris_i_grups">Creació d'usuaris i grups</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#configuracio_de_l_acces_anonim">Configuració de l’accés anònim</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#limitacions_d_acces">Limitacions d’accés</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#modes_d_acces_al_servidor">Modes d'accés al servidor</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#comunicacions_segures">Comunicacions segures</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#clients_grafics_i_de_text">Clients gràfics i de text</a></li></ul></div></div></ul></li><li id="" class="indexnode"><p><a href="../../../index.html">Anar a l&#39;&iacute;ndex general</a></p></li>
        </ul>
      </div>
    </div>
   </section>
   <section>
   <div id="settings" class="hidden">
    <div class="menucontent">
     <div class="allsettings">
     <div class="settings">
      <label>Font i Color</label>
		<div class="setting-option">
	        <ul class="fontBackground">
				<li id="style-newspaper" title="Newspaper" class="appearance-style-newspaper"><span>Newspaper</span></li>
                <li id="style-novel" title="Novel" class="appearance-style-novel"><span>Novel</span></li>
                <li id="style-ebook" title="eBook" class="appearance-style-ebook"><span>eBook</span></li>
				<li id="style-inverse" title="Inverse" class="appearance-style-inverse active"><span>Inverse</span></li>
				<li id="style-athelas" title="Athelas" class="appearance-style-athelas"><span>Athelas</span></li>
			</ul>
		</div>
     </div>
	<div class="settings">
      <label>Amplada</label>
		<div class="setting-option">
	        <div id="slider-width"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
		<div class="setting-option">
	        <div id="slider-font"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
	  <div class="setting-option">
       <form action="" class="sett-options">
		<ul>
		    <li><input type="checkbox" id="secondary-content" /><label for="secondary-content">Mostra recursos complementaris</label></li>
		    <li><input type="checkbox" id="main-images" /><label for="main-images">Mostra imatges</label></li>
		    <li><input type="checkbox" id="text-alignment" /><label for="text-alignment">Text justificat</label></li>
			<li><input type="checkbox" id="text-hyphen" /><label for="text-hyphen">Partici&oacute; sil·l&agrave;bica</label></li>
		</ul>
       </form>
	  </div>
     </div>
     </div>
    </div>
   </div>
   </section>
 <section>
 <div id="favorites" class="hidden"></div>
 </section>   
 <div id="bridge" class="hidden"></div>
 <div id="help" class="hidden">
  <div class="helptitle">Dreceres del teclat<hr></div>
  <div class="helpsection"><span>General</span>
   <ul>
    <li><span class="shortcut">g</span>: Anar al men&uacute; de navegaci&oacute;</li>
    <li><span class="shortcut">o</span>: Anar a opcions</li>
    <li><span class="shortcut">s</span>: Guardar la p&agrave;gina actual a favorits</li>
    <li><span class="shortcut">p</span>: Imprimir la p&agrave;gina actual</li>
    <li><span class="shortcut">?</span>: Mostrar/Ocultar l&#39;ajuda</li>
   </ul>
  </div>
  <div class="helpsection"><span>Navegaci&oacute;</span>
   <ul>
    <li><span class="shortcut">i</span>: Anar a l&#39;&iacute;ndex general</li>
    <li><span class="shortcut">t</span>: Anar a l&#39;inici de p&agrave;gina</li>
    <li><span class="shortcut">b</span>: Anar al final de p&agrave;gina</li>
    <li><span class="shortcut">j</span>: Anar cap endavant dintre la p&agrave;gina</li>
    <li><span class="shortcut">k</span>: Anar cap enrere dintre la p&agrave;gina</li>
    <li><span class="shortcut">h</span>: Anar a la p&agrave;gina anterior:</li>
    <li><span class="shortcut">l</span>: Anar a la p&agrave;gina seg&uuml;ent:</li>
   </ul>
   </div>
 </div>
 <div id="favcounter" name="favcounter" class="hidden"><span></span></div>
 <div id="navmenu" class="navmenu"><ul class="webnav"><li><a href="../../../index.html" title="Anar a l&#39;&iacute;ndex general">Inici</a></li><li><a href="../introduccio.html">Serveis web i de transferència de fitxers</a></li><li>Instal·lació i administració de serveis de transferència de fitxers...</li></ul></div>
	<div id="content" lang="ca" class="hyphenate text">
     <article lang="ca" class="sheet">
        <h1><a id="instal_lacio_i_administracio_de_serveis_de_transferencia_de_fitxers"> Instal·lació i administració de serveis de transferència de fitxers </a></h1>
    	
<p>
L’<strong><acronym title="File Transfer Protocol">FTP</acronym></strong> (File Transfer Protocol o <strong>protocol de transferència de fitxers</strong>) és el protocol que proporciona el servei de transferència de fitxers més usat. Es basa en una arquitectura client/servidor i utilitza el protocol de transport TCP. Permet la transferència de fitxers de qualsevol tipus entre dos equips. El servidor actua a mode de repositori de fitxers i el client s’hi connecta per baixar (<em>download</em>) o pujar (<em>upload</em>) fitxers.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Seguretat de la xarxa</p>
<p>
En els orígens d’Internet, els usuaris eren part implicada i no els va passar pel cap que hi poguessin haver usuaris amb ànim d’“atacar” altres sistemes.
</p>
</div></div><div class="iocimportant"><div class="ioccontent">
<p>
El <strong>protocol <acronym title="File Transfer Protocol">FTP</acronym></strong> (File Transfer Protocol o protocol de transferència de fitxers) és un protocol TCP que permet la transferència de fitxers en ambdós sentits entre un client i un servidor. Aquesta transferència és independent de la plataforma usada i del tipus de fitxers manejats.
</p>
</div></div>
<p>
La necessitat d’un mecanisme de transferència de fitxers sorgeix des de bon principi a Internet i el 1980 ja apareix la primera especificació de l’<acronym title="File Transfer Protocol">FTP</acronym>. L’octubre de 1985 es publica l’<acronym title="Request for Comments">RFC</acronym> 959, que és la base del protocol actual. A aquest <acronym title="Request for Comments">RFC</acronym> se n’hi han afegit posteriorment d’altres per incorporar seguretat, internacionalització… Tractant-se d’un protocol tan “vell”, no és estrany que sigui insegur. De fet, la majoria de protocols originaris d’Internet ho són (HTTP, SMTP…).
</p>

<p>
Una de les virtuts del model <acronym title="File Transfer Protocol">FTP</acronym> és que permet transferir fitxers (també modificar-los, esborrar-los, afegir-los…) independentment de la plataforma i del sistema on resideixen. És a dir, l’<acronym title="File Transfer Protocol">FTP</acronym> amaga els detalls d’implementació. Un client (que funcioni amb sistema operatiu Unix, per exemple) baixa un fitxer de text d’un servidor <acronym title="File Transfer Protocol">FTP</acronym> sense saber el tipus de màquina ni el tipus de sistema de fitxers del servidor (Windows, per exemple).
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Els objectius del servei <acronym title="File Transfer Protocol">FTP</acronym> són els següents:
</p>
<ul>
<li class="level1"><div class="li"> Compartir fitxers tant de dades com de programes.</div>
</li>
<li class="level1"><div class="li"> Permetre prosseguir les transferències de fitxers un cop interrompudes (reprendre les baixades).</div>
</li>
<li class="level1"><div class="li"> Transferir dades de manera eficient i fiable.</div>
</li>
</ul>
</div></div>
<p>
La debilitat principal del protocol <acronym title="File Transfer Protocol">FTP</acronym> és la falta de seguretat. Tot el flux de dades viatja en text pla, sense encriptar, fins i tot els noms d’usuari i les contrasenyes. Això ha obligat a adoptar noves estratègies per proporcionar confidencialitat a les transmissions.
</p>

<h2><a id="servei_de_transferencia_de_fitxers" >Servei de transferència de fitxers</a></h2>
<div class="level2">

<p>
El servei <acronym title="File Transfer Protocol">FTP</acronym> es basa en l’arquitectura client/servidor, de manera que caldrà descriure’l en cada un d’ells. En aquest apartat es descriuen els diferents modes d’operació d’un servidor <acronym title="File Transfer Protocol">FTP</acronym>, les seves funcionalitats i els tipus d’accés permesos. Els servidors poden oferir els seus serveis a tota la comunitat d’Internet o a un entorn restringit, com per exemple una xarxa local. En el primer cas es parla d’un servidor d’accés públic global, en el segon cas, d’un servidor local o corporatiu. El servei pot ser ofert a qualsevol usuari, incloent usuaris anònims, o es pot restringir a usuaris i grups determinats. 
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
El servidor <acronym title="File Transfer Protocol">FTP</acronym> es pot classificar segons sigui:
</p>
<ul>
<li class="level1"><div class="li"> D’accés <strong>públic</strong> / d’accés <strong>corporatiu</strong></div>
</li>
<li class="level1"><div class="li"> D’accés amb usuari <strong>identificat</strong> / d’accés amb usuari <strong>anònim</strong></div>
</li>
<li class="level1"><div class="li"> De mode de transferència <strong><acronym title="American Standard Code for Information Interchange">ASCII</acronym></strong> / de mode de transferència <strong>binari</strong></div>
</li>
</ul>
</div></div>
<p>
De forma inusual, el servei <acronym title="File Transfer Protocol">FTP</acronym> utilitza dos ports del sistema. A través del port 21 es realitza la interpretació de les instruccions. El port 20 és destinat a la transferència de dades, tot i que es pot utilitzar un altre port dinàmic en el seu lloc. El mode real de funcionament de la transmissió de dades i els ports implicats depenen del mode de funcionament, que pot ser actiu o passiu.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
El mode de funcionament de la transferència <acronym title="File Transfer Protocol">FTP</acronym> pot ser actiu o passiu.
La funcionalitat del servei es classifica en:
</p>
<ul>
<li class="level1"><div class="li"> Mode intèrpret del protocol.</div>
</li>
<li class="level1"><div class="li"> Mode de transferència de dades.</div>
</li>
</ul>
</div></div>
</div>

<h3><a id="tipus_de_clients_i_servidors" >Tipus de clients i servidors</a></h3>
<div class="level3">

<p>
El <strong>servidor <acronym title="File Transfer Protocol">FTP</acronym></strong> és una màquina que executa un programari determinat que proporciona el servei <acronym title="File Transfer Protocol">FTP</acronym> a clients <acronym title="File Transfer Protocol">FTP</acronym>. Usualment, en entorns GNU/Linux aquest programa és un dimoni, anomenat usualment <em>ftpd</em> o similar. En funció del tipus d’usuaris que permet connectar i de l’àmbit d’accés que permet, el podem classificar de maneres diferents.
</p>

<p>
Segons el tipus de clients que accepta, podem classificar els servidors <acronym title="File Transfer Protocol">FTP</acronym> de la manera següent:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Usuari identificat</strong>. El servidor requereix un nom d’usuari i una contrasenya vàlids per accedir al servei. Els comptes d’usuari poden ser gestionats directament per l’aplicació del servidor o se’n pot delegar l’autenticació al sistema operatiu.</div>
</li>
<li class="level1"><div class="li"> <strong>Accés anònim</strong>. Un servidor que permet accessos anònims permet que qualsevol usuari pugui accedir al repositori de fitxers. Usualment cal indicar com a nom d’usuari “anonymous” i com a contrasenya s’accepta qualsevol text, però per convenció s’escriu el correu electrònic de l’usuari.</div>
</li>
</ul>

<p>
Segons l’àmbit del servei que proporciona, podem classificar els servidors <acronym title="File Transfer Protocol">FTP</acronym> de la manera següent:
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Alguns servidors <acronym title="File Transfer Protocol">FTP</acronym> permeten l’accés anònim acceptant qualsevol nom d’usuari i qualsevol contrasenya o fins i tot sense contrasenya.
</p>
</div></div><ul>
<li class="level1"><div class="li"> <strong>Servidor públic</strong>. Molts servidors <acronym title="File Transfer Protocol">FTP</acronym> a Internet ofereixen servei d’accés anònim a mode de repositoris de programari perquè els usuaris el puguin utilitzar. N’hi ha que actuen com a rèpliques (miralls, <em>mirrors</em>) d’altres repositoris per tal d’apropar les baixades a l’usuari. Aquest servei és usualment només de lectura (pel client) i en sistemes GNU/Linux s’ubica sovint en els directoris /var/ftp o /var/ftp/pub.</div>
</li>
<li class="level1"><div class="li"> <strong>Servidor corporatiu</strong>. No cal oferir per força els serveis <acronym title="File Transfer Protocol">FTP</acronym> a Internet; l’administrador de xarxa pot configurar el servidor <acronym title="File Transfer Protocol">FTP</acronym> per oferir els serveis als equips que cregui oportuns. Dins d’una xarxa corporativa es pot disposar d’un o més servidors <acronym title="File Transfer Protocol">FTP</acronym> que permeten l’accés als usuaris de la xarxa (tant a usuaris identificats com a usuaris anònims de la xarxa corporativa).</div>
</li>
</ul>

<p>
Evidentment, el servidor <acronym title="File Transfer Protocol">FTP</acronym> pot combinar els models anteriors i proporcionar accés tant a usuaris identificats com a usuaris anònims, i pot diferenciar els recursos que ofereix en funció de si són usuaris interns de la xarxa corporativa o d’Internet.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Exemple de mirall</p>
<p>
Si us voleu baixar un GNU/Linux Live, en lloc de contactar el servidor de Fedora o Ubuntu, ho podeu fer en un mirall de RedIRIS, que és més proper.
</p>
</div></div>
<p>
El <strong>client <acronym title="File Transfer Protocol">FTP</acronym></strong> és el programari que s’utilitza per establir una connexió amb el servidor per tal de poder baixar o pujar fitxers al servidor. El client pot llistar, modificar i afegir fitxers al servidor, a més de realitzar altres accions, sempre que hi estigui autoritzat. L’aplicació client pot ser basada en text o d’entorn gràfic, però en qualsevol cas ha de poder establir connexió amb el servidor.
</p>

<p>
La connexió <acronym title="File Transfer Protocol">FTP</acronym> es pot indicar mitjançant un <acronym title="Uniform Resource Locator">URL</acronym> del tipus ftp://servidor/fitxer, on <em>fitxer</em> pot ser una trajectòria. De fet, l’<acronym title="Uniform Resource Locator">URL</acronym> pot ser més detallat:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">URL</p>
<p>
Acrònim d’<em>Uniform Resource Locator</em> (en català, localitzador uniforme de recursos). Sovint és usat com a sinònim d’<acronym title="Uniform Resource Identifier">URI</acronym> (<em>Uniform Resource Identifier</em>, identificador uniforme de recursos), tot i que no és el mateix.
</p>
</div></div><pre class="code">ftp://usuari:contrasenya@servidor:port/fitxer</pre>

<p>
En aquest format s’indica l’usuari i la contrasenya, el servidor, el port d’accés i el fitxer al qual es vol accedir. En determinats sistemes operatius es pot usar aquesta sintaxi en la línia d’ordres per indicar un fitxer remot, igual que es faria per indicar un fitxer local.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
El <strong>servidor</strong> proporciona un repositori de fitxers i una aplicació que permet que els <strong>clients</strong> s’hi connectin i facin ús dels fitxers (baixar-los o pujar-ne). L’<acronym title="Uniform Resource Locator">URL</acronym> per accedir a un fitxer per <acronym title="File Transfer Protocol">FTP</acronym> es pot expressar així: <strong>ftp://usuari:contrasenya@servidor:port/fitxer</strong>.
</p>
</div></div>
</div>

<h3><a id="funcionament_del_servei_ftp" >Funcionament del servei FTP</a></h3>
<div class="level3">

<p>
L’<acronym title="File Transfer Protocol">FTP</acronym> és un protocol d’aplicació basat en TCP/IP que utilitza TCP com a capa de transport. El servidor escolta connexions entrants de clients pel port 21 i inicia una sessió si l’autenticació s’estableix correctament. El servidor pot funcionar com un servei per si mateix (<em>stand-alone</em>) o pot estar configurat per funcionar dins d’un superservei de xarxa com, per exemple, inetd o xinetd. Si funciona en mode de servei propi és el servidor qui escolta les connexions entrants i les atén. Si s’executa dins del superservei de xarxa, aquest és qui detecta les connexions entrants i activa el dimoni de l’<acronym title="File Transfer Protocol">FTP</acronym> perquè les atengui. Un cop ateses, el dimoni de l’<acronym title="File Transfer Protocol">FTP</acronym> acaba i torna a ser el superservidor de xarxa el que es queda escoltant.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
El port 21 és el port del canal de control. El port 20 és el del canal de dades.
</p>
</div></div><div class="ioctextl"><div class="ioccontent"><p class="ioctitle">Serveis autònom i xinetd</p>
<p>
En el servei autònom (<em>stand-alone</em>) el servidor escolta per si mateix les connexions entrants. En el servei xinetd o inetd, el servidor està dins d’un superservei de xarxa. inetd és un superdimoni de xarxa que escolta connexions entrants de diferents protocols i executa el dimoni del servei corresponent en rebre una connexió. xinetd n’és la versió millorada.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">Tipus de client</p><ul>
<li class="level1"><div class="li"> Identificat: té accés al sistema de fitxers complet.</div>
</li>
<li class="level1"><div class="li"> Anònim: és engabiat en un punt de l’arbre de fitxers.</div>
</li>
</ul>
</div></div>
<p>
L’accés als recursos del servidor varia usualment en funció de si el client és anònim o està identificat. Els clients identificats poden navegar per l’estructura de fitxers segons els seus permisos. Els clients anònims usualment estan engabiats (<em>chroot</em>) en una part de l’arbre de fitxers i no en poden sortir. Usualment, el servidor fa correspondre el directori de publicació (/var/ftp o /srv/ftp en sistemes GNU/Linux) amb el directori arrel (/) d’accés del client. El client pot descendir a partir d’aquest punt, però no pot anar a directoris superiors.
</p>
<div class="ioctextl"><div class="ioccontent"><p class="ioctitle">Chroot</p>
<p>
En sistemes GNU/Linux, <em>chroot</em> és una utilitat o una tècnica consistent a “engabiar” serveis en una part del disc com si fos el disc sencer, de manera que es fa correspondre un directori particular (on hi ha el servei) a una arrel de disc virtual. Els usuaris del servei creuen que naveguen per tot el disc, però en realitat estan “engabiats” en una estructura virtual.
</p>
</div></div>
<p>
Els modes en què es transfereixen els fitxers entre el client i el servidor poden ser múltiples. Els dos més importants són aquests:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">ASCII</p>
<p>
Acrònim d’American Standard Code for Information Interchange. En català, codi estàndard americà per a l’intercanvi d’informació.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">Format del salt de línia</p>
<p>
Penseu en el típic problema del salt de línia que varia segons el sistema operatiu. El servidor, per exemple, envia text usant el caràcter LF com a salt de línia (usa Unix) i el receptor els desa usant la combinació de caràcters CR+LF (que és el format usat pel seu sistema operatiu diferent d’Unix).
</p>
</div></div><ul>
<li class="level1"><div class="li"> <strong><acronym title="American Standard Code for Information Interchange">ASCII</acronym></strong>. El fitxer es transmet caràcter a caràcter. Els caràcters han de correspondre als caràcters del codi bàsic <acronym title="American Standard Code for Information Interchange">ASCII</acronym>. Si el fitxer conté caràcters <acronym title="American Standard Code for Information Interchange">ASCII</acronym> no vàlids, la transferència fallarà. Per tant, es tracta d’un mode vàlid únicament per transferir text net. El receptor farà les conversions de caràcter necessàries per desar les dades en el format que requereixi.</div>
</li>
</ul>
<ul>
<li class="level1"><div class="li"> <strong>Binari</strong> (<em>binary</em>). Quan el mode de transferència és binari, el fitxer s’envia bit a bit sense interpretació de cap mena. És el mode que cal usar per transmetre programes, imatges, vídeo, so, dades binàries…</div>
</li>
</ul>

</div>

<h3><a id="especificacio_del_protocol_ftp" >Especificació del protocol FTP</a></h3>
<div class="level3">

<p>
El protocol <acronym title="File Transfer Protocol">FTP</acronym> és un protocol de capa d’aplicació basat en TCP com a capa de transport. Utilitza el port 21 per al canal de control i el port 20 per al canal de dades. És un dels pocs protocols actuals que encara utilitzen més d’un port per a la comunicació. El port 21 s’utilitza com a canal de comunicació entre client i servidor. És per on es transmeten les ordres, però no els fitxers. Aquests es transmeten per una connexió diferent, per un canal diferent, que en principi utilitza el port 20 del servidor.
</p>

<p>
Tant en el client com en el servidor hi ha dues entitats clarament diferenciades:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Intèrpret del protocol</strong>: és l’encarregat de l’intercanvi d’ordres i respostes entre client i servidor. Utilitza el canal de control establert entre el port de sortida del client i el port 21, on escolta el servidor. És l’encarregat d’interpretar les ordres de l’aplicació client convertint-les en instruccions <acronym title="File Transfer Protocol">FTP</acronym>, executar-les en el servidor i retornar les respostes al client. No s’encarrega de la transferència de fitxers.</div>
</li>
<li class="level1"><div class="li"> <strong>Transferència de dades</strong>: és la part encarregada d’intercanviar els fitxers i directoris entre client i servidor. En el funcionament bàsic, el canal de dades s’estableix entre un nou port del client (port dinàmic i específic per a la transmissió del fitxer) i el port 20 (<em>ftp-data</em>) del servidor.</div>
</li>
</ul>

<p>
La connexió TCP del canal de dades entre client i servidor es pot establir de dues maneres diferents:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Modes de connexió FTP</p><ul>
<li class="level1"><div class="li"> Actiu: el servidor usa el port 20. Correspon a l’ordre PORT del protocol.</div>
</li>
<li class="level1"><div class="li"> Passiu: el servidor usa un port dinàmic (no el 20). Correspon a l’ordre PASV del protocol.</div>
</li>
</ul>
</div></div><ul>
<li class="level1"><div class="li"> <strong>Mode actiu</strong>: generalment és el mode per defecte. Abans de fer una sol·licitud al servidor que impliqui transferir dades pel canal de dades, el client indica al servidor el port dinàmic que utilitzarà. Per tant, el canal de dades s’estableix entre aquest port dinàmic del client i el port 20 del servidor. Servidor i client estableixen una nova connexió TCP per aquest canal.</div>
</li>
<li class="level1"><div class="li"> <strong>Mode passiu</strong>: el client fa una sol·licitud de mode passiu al servidor. Aquest respon enviant el seu port dinàmic, per on s’establirà el canal de dades (en lloc del port 20). Llavors el client inicia una nova connexió TCP entre un port dinàmic nou seu i el port dinàmic del servidor. Aquest és el canal de dades.</div>
</li>
</ul>

<p>
En resum, podríem dir que el client es posa en contacte amb el servidor connectant-se al port 21. Mitjançant aquest canal de comunicació, client i servidor governen tota la sessió <acronym title="File Transfer Protocol">FTP</acronym>. Les transferències de fitxers es realitzen per una altra connexió que es pot crear i destruir al llarg de la sessió (per exemple, per a cada baixada o segons els períodes d’inactivitat). En la <span class="figref"><a href="#Figure1"><span>figura</span></a></span> es pot veure l’esquema de connexió i de ports entre un client i un servidor <acronym title="File Transfer Protocol">FTP</acronym>.
</p>
<div class="iocfigure"><a name="Figure1"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Model funcional del protocol <acronym title="File Transfer Protocol">FTP</acronym>

</figcaption><img src="../media/ic10m08u2_05.png" alt="" /></figure>
</div>
<p>
El protocol <acronym title="File Transfer Protocol">FTP</acronym> descriu diferents categories d’ordres que el client pot realitzar (no les confongueu amb les ordres concretes de l’aplicació client). Aquestes s’agrupen en tres grups:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Ordres i respostes FTP</p>
<p>
En el document <acronym title="Request for Comments">RFC</acronym> 959 hi ha la llista d’ordres i la taula de codis/missatges de resposta del protocol <acronym title="File Transfer Protocol">FTP</acronym>. Aquest document és l’especificació de l’estàndard <acronym title="File Transfer Protocol">FTP</acronym>.
</p>
</div></div><ol>
<li class="level1"><div class="li"> <strong>Ordres de control d’accés</strong>: les que gestionen l’accés al servei <acronym title="File Transfer Protocol">FTP</acronym>. Per exemple, inici i finalització de la sessió, validació de l’usuari i la contrasenya, canvis de directori i de sistemes de fitxers…</div>
</li>
<li class="level1"><div class="li"> <strong>Ordres de paràmetres de transferència</strong>: gestionen les opcions relacionades amb la transferència de fitxers com, per exemple, el mode de transferència binari o <acronym title="American Standard Code for Information Interchange">ASCII</acronym>, els ports, el tipus de mode passiu o actiu…</div>
</li>
<li class="level1"><div class="li"> <strong>Ordres de servei <acronym title="File Transfer Protocol">FTP</acronym></strong>: són les ordres d’allò que es vol fer en una sessió <acronym title="File Transfer Protocol">FTP</acronym> com, per exemple, baixar un fitxer, pujar-lo, modificar-ne el nom…</div>
</li>
</ol>

<p>
Per a cada ordre del client, el servidor emet una resposta pel canal de control en què indica l’estatus de l’execució de l’ordre rebuda. Per exemple, el client envia el seu nom d’usuari i contrasenya, el servidor els valida i retorna una resposta positiva. Si l’ordre implica la transferència de dades, aquesta es realitza pel canal de dades.
</p>

<p>
El protocol <acronym title="File Transfer Protocol">FTP</acronym> defineix un conjunt de respostes <acronym title="File Transfer Protocol">FTP</acronym> consistents en un codi numèric de tres xifres i un text descriptiu de la resposta, com per exemple “250 Directory successfully changed”. Tot el diàleg client/servidor té forma d’ordres i respostes.
</p>
<div class="iocreference"><div class="ioccontent">
<p>
Poseu observar en els exemples de sessió <acronym title="File Transfer Protocol">FTP</acronym> d’aquest mòdul els codis de resposta que es donen a les diverses ordres que realitza el client. Els trobareu a l’apartat “2.6 Modes d’accés al servidor”.
</p>
</div></div>
</div>

<h2><a id="instal_lacio_i_configuracio_del_servidor" >Instal·lació i configuració del servidor</a></h2>
<div class="level2">

<p>
Hi ha moltes aplicacions <acronym title="File Transfer Protocol">FTP</acronym> en el mercat, tant per a clients com per a servidors. Al mateix temps, hi ha versions de text i gràfiques per a cada cas. Hi ha moltes aplicacions que són de font pública i que es poden baixar gratuïtament.
</p>

<p>
La majoria de sistemes GNU/Linux proporcionen l’aplicació client <strong>ftp</strong> o <strong>lftp</strong> (<em>lftp</em> és una versió més nova i simple). També disposen d’una aplicació servidor, entre d’altres, anomenada <strong>vsftpd</strong> (<em>very secure <acronym title="File Transfer Protocol">FTP</acronym> daemon</em> o dimoni <acronym title="File Transfer Protocol">FTP</acronym> molt segur).
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Aplicacions FTP recomanables</p>
<p>
Més que fer una enumeració de les aplicacions <acronym title="File Transfer Protocol">FTP</acronym> actuals, us suggerim que busqueu a Internet quines aplicacions estan “de moda” i esbrineu les característiques que les fan especials.
</p>
</div></div>
<p>
Una de les eines més usades per fer baixades <acronym title="File Transfer Protocol">FTP</acronym> de repositoris públics són els navegadors web. 
Els navegadors web permeten utilitzar el protocol <acronym title="File Transfer Protocol">FTP</acronym> per realitzar baixades, però no proporcionen totes les prestacions que pot arribar a tenir un client <acronym title="File Transfer Protocol">FTP</acronym> específic. Per accedir a un servidor <acronym title="File Transfer Protocol">FTP</acronym> amb un navegador, n’hi ha prou d’indicar l’<acronym title="Uniform Resource Locator">URL</acronym> del protocol i el servidor al qual es vol accedir (per exemple: ftp://ftp.rediris.es).
</p>

<p>
Així, doncs, quan parlem d’instal·lar el servei <acronym title="File Transfer Protocol">FTP</acronym> fem referència al procés d’instal·lació i configuració del programari del servidor. Això es fa de manera molt similar a la d’altres serveis de xarxa (com els serveis DHCP, <acronym title="Domain Name System">DNS</acronym>, HTTP…): es tracta d’instal·lar els paquets o <em>tarballs</em> (fitxers .tar) de l’aplicació servidor i fer-ne la configuració apropiada. 
</p>

<p>
Per fer això cal plantejar-se els passos següents:
</p>
<ul>
<li class="level1"><div class="li"> Quin programari proporciona aquest servei? Quines característiques té? Com es pot adquirir?</div>
</li>
<li class="level1"><div class="li"> Obtenir l’aplicació que proporciona el servei <acronym title="File Transfer Protocol">FTP</acronym>.</div>
</li>
<li class="level1"><div class="li"> Observar l’estat de la xarxa actual. Està ja el servei en funcionament? Existeix ja un servidor <acronym title="File Transfer Protocol">FTP</acronym> instal·lat i actiu?</div>
</li>
<li class="level1"><div class="li"> Instal·lar l’aplicació servidor.</div>
</li>
<li class="level1"><div class="li"> Comprovar que la instal·lació s’ha efectuat correctament.</div>
</li>
<li class="level1"><div class="li"> Configurar el servei en el servidor i comprovar que els clients hi poden accedir.</div>
</li>
<li class="level1"><div class="li"> Comprovar que el servei funciona correctament.</div>
</li>
</ul>

<p>
Usualment l’administrador acaba utilitzant l’aplicació servidor que li proporciona el mateix sistema operatiu que està utilitzant. Si utilitzeu Windows, l’empresa Microsoft ofereix una aplicació pròpia, però també en podeu trobar d’altres a Internet. Igualment, si utilitzeu GNU/Linux, segurament la mateixa distribució ja proporciona un servidor <acronym title="File Transfer Protocol">FTP</acronym> o bé n’existeix algun de clàssic provinent d’Unix. De totes maneres en podeu obtenir d’altres a Internet. 
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Cerca d&#039;FTP a Internet</p>
<p>
Usualment, l’administrador s’informa mitjançant el seu cercador preferit, per exemple Google, i de webs com la Viquipèdia. Proveu a buscar “<acronym title="File Transfer Protocol">FTP</acronym>” o “<acronym title="File Transfer Protocol">FTP</acronym> server” en aquests llocs web.
</p>
</div></div><div class="iocimportant"><div class="ioccontent">
<p>
L’eina que s’utilitzarà en aquesta unitat per oferir el servei <acronym title="File Transfer Protocol">FTP</acronym> és l’aplicació <strong>vsftpd</strong> o <em>very secure <acronym title="File Transfer Protocol">FTP</acronym> daemon</em>.
</p>
</div></div>
</div>

<h3><a id="instal_lacio_de_l_aplicacio_servidor" >Instal·lació de l&#039;aplicació servidor</a></h3>
<div class="level3">

<p>
Els usuaris de GNU/Linux poden buscar fàcilment per Internet paquets de servidor <acronym title="File Transfer Protocol">FTP</acronym> usant eines com <em>yum</em> o <em>apt-get</em> i els repositoris de paquets apropiats segons quina sigui la distribució que utilitzin. A més, sempre poden usar els cercadors web per localitzar tot allò que els faci falta.
</p>

<p>
Un cop instal·lat el programari caldrà identificar què s’ha instal·lat. Quins paquets i què contenien. A vegades no s’instal·laran paquets sinó fitxers <em>tarball</em>, el contingut dels quals també caldrà saber examinar. És important saber identificar quins dels components instal·lats corresponen a fitxers executables, quins a fitxers de configuració i quins a fitxers de documentació.
</p>

<p>
Tot servei instal·lat s’ha de configurar apropiadament i posar en marxa. Per tant, caldrà saber gestionar l’estat del servei (engegar, aturar, reiniciar…) i definir l’estat que ha de tenir en els diferents <em>runlevels</em> (nivells d’execució) del sistema.
</p>

<p>
En definitiva, el procediment d’instal·lar inclourà usualment:
</p>
<ul>
<li class="level1"><div class="li"> Buscar el programari del servei (sigui en format de paquets .deb, .rpm o .tar) i descarregar-lo utilitzant l’eina apropiada segons quina sigui la distribució que s’utilitzi.</div>
</li>
<li class="level1"><div class="li"> Examinar el sistema per identificar quin programari, quins paquets, hi ha instal·lats relacionats amb el servei.</div>
</li>
<li class="level1"><div class="li"> Identificar els components del servei. Quins són els fitxers executables, quins els de configuració i quins els de documentació.</div>
</li>
<li class="level1"><div class="li"> Consultar i establir l’estat del servei (engegar i aturar) i saber establir l’estat per defecte per a cada <em>runlevel</em>.</div>
</li>
</ul>

</div>

<h2><a id="creacio_d_usuaris_i_grups" >Creació d&#039;usuaris i grups</a></h2>
<div class="level2">

<p>
L’accés a un servidor <acronym title="File Transfer Protocol">FTP</acronym> es pot considerar des de diferents angles. Des del punt de vista de la configuració de xarxes (ports, tallafocs, <em>TCP wrappers</em>…) es poden filtrar els amfitrions (<em>hosts</em>) que poden accedir al servidor <acronym title="File Transfer Protocol">FTP</acronym>. Des del punt de vista dels usuaris, poden ser usuaris anònims, locals i virtuals.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Els <strong>usuaris</strong> es poden classificar en:
</p>
<ul>
<li class="level1"><div class="li"> Usuaris anònims</div>
</li>
<li class="level1"><div class="li"> Usuaris locals del sistema</div>
</li>
<li class="level1"><div class="li"> Usuaris propis del servei <acronym title="File Transfer Protocol">FTP</acronym>, anomenats usuaris <em>virtuals</em></div>
</li>
</ul>
</div></div>
<p>
L’accés anònim al servidor permet que qualsevol client pugui accedir a l’àrea pública del servidor <acronym title="File Transfer Protocol">FTP</acronym> com a usuari “anonymous”. Aquest dret d’accés de lectura es pot concedir o restringir. També se li pot proporcionar a l’usuari anònim el dret a publicar documentació dins de directoris amb els permisos apropiats.
</p>
<div class="iocreference"><div class="ioccontent">
<p>
Podeu trobar més informació sobre els usuaris anònims en l’apartat “Configuració de l’accés anònim”.
</p>
</div></div>
<p>
L’accés al servei com a usuaris locals del sistema permet accedir al servei <acronym title="File Transfer Protocol">FTP</acronym> als usuaris que ho són també del sistema on s’executa el servei. És per això que s’anomenen <em>usuaris locals</em>, perquè són locals a l’amfitrió on s’executa el servei. Aquest accés es pot permetre o restringir segons es desitgi.
</p>

<p>
Finalment hi ha l’accés d’usuaris virtuals. Es tracta d’usuaris identificats (no anònims) que no són (o no necessàriament) usuaris del sistema. Són usuaris propis del servei <acronym title="File Transfer Protocol">FTP</acronym> i caldrà portar-ne la gestió pròpia amb les típics fitxers d’usuaris i contrasenyes.
</p>

</div>

<h3><a id="usuaris_locals" >Usuaris locals</a></h3>
<div class="level3">

<p>
Permetre l’accés al servei <acronym title="File Transfer Protocol">FTP</acronym> d’usuaris locals és ben simple: simplement cal activar la directiva <em>local_enable</em>. Fet això, els usuaris locals tindran accés de descàrrega. Per permetre’ls pujar documents caldrà configurar més directives. 
</p>

<p>
Els usuaris del sistema accedeixen al seu directori d’inici (<em>home</em>), que és el directori de publicació, i en general tenen dret a navegar per tot el sistema de fitxers de manera similar a com ho farien en una sessió d’usuari del sistema. Es pot engabiar (<em>chroot</em>) els usuaris en el seu directori d’inici, de manera que aquest passarà a ser l’arrel del sistema de fitxers al qual poden accedir via <acronym title="File Transfer Protocol">FTP</acronym> i, per tant, no en podran sortir.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Els usuaris <strong>locals</strong> accedeixen al seu directori per defecte de publicació. Poden moure’s únicament pel subarbre del seu <em>home</em> o per tot el sistema de fitxers segons si estan <strong>engabiats</strong> o no.
</p>
</div></div>
</div>

<h3><a id="usuaris_virtuals" >Usuaris virtuals</a></h3>
<div class="level3">

<p>
Generalment, tot servidor <acronym title="File Transfer Protocol">FTP</acronym> permet un tercer tipus d’usuaris que no són ni els anònims ni els usuaris del sistema. Es tracta d’usuaris propis del servei <acronym title="File Transfer Protocol">FTP</acronym>. L’avantatge d’aquest model és la separació entre els usuaris del servei i els usuaris del sistema. Això permet l’accés identificat a serveis <acronym title="File Transfer Protocol">FTP</acronym> sense necessitat de crear comptes d’usuari en el sistema. També permet un grau més gran de portabilitat, ja que el servei es pot traslladar a un altre entorn (amb uns altres usuaris del sistema) i continuar mantenint els usuaris propis del servei. L’inconvenient d’aquest model és que generalment implica dur l’administració d’una gestió d’usuaris paral·lela a la del sistema i crear els fitxers o una base de dades d’usuaris <acronym title="File Transfer Protocol">FTP</acronym> amb els noms i contrasenyes de cada un d’ells.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Els servidors <acronym title="File Transfer Protocol">FTP</acronym> generalment permeten administrar <strong>usuaris específics</strong> del servei <acronym title="File Transfer Protocol">FTP</acronym> (ni locals ni anònims). Això té l’avantatge de la independència respecte dels usuaris del sistema i presenta l’inconvenient de requerir una administració pròpia d’aquests usuaris.
</p>

<p>
En el servidor vsftpd aquests usuaris s’anomenen <strong><em>virtual users</em></strong>. 
</p>
</div></div>
<p>
Els usuaris virtuals són comptes d’usuaris que no existeixen realment com a usuaris del sistema. Això proporciona un grau major de seguretat, ja que un compte d’usuari virtual compromès únicament pot explotar les debilitats del servei <acronym title="File Transfer Protocol">FTP</acronym>. En canvi, un compte del sistema compromès pot intentar explotar debilitats de tot el sistema. Una de les finalitats principals de la possibilitat de crear usuaris virtuals és permetre l’accés a contingut que ha de ser accessible a usuaris no validats en el sistema, però que no es vol fer públic per a tothom.
</p>

<p>
El procés que cal seguir per generar usuaris virtuals en el servidor vsftpd és el següent:
</p>
<ol>
<li class="level1"><div class="li"> Crear la base de dades d’usuaris virtuals.</div>
</li>
<li class="level1"><div class="li"> Crear/editar el fitxer de configuració PAM per usar la base de dades creada anteriorment.</div>
</li>
<li class="level1"><div class="li"> Generar el directori de publicació de l’usuari virtual tot creant aquest usuari.</div>
</li>
<li class="level1"><div class="li"> Generar el fitxer de configuració apropiat per permetre l’ús d’usuaris virtuals.</div>
</li>
</ol>

</div>

<h2><a id="configuracio_de_l_acces_anonim" >Configuració de l’accés anònim</a></h2>
<div class="level2">

<p>
El client que accedeix a un servidor <acronym title="File Transfer Protocol">FTP</acronym> ho pot fer com a usuari identificat (del sistema o del servidor) o amb accés anònim. Tradicionalment, els usuaris anònims tenen accés a un directori de publicació des d’on poden realitzar descàrregues però no pujar documents al servidor (tot i que es pot configurar per permetre-ho). Aquests usuaris s’identifiquen normalment amb el nom “anonymous” i com a contrasenya és costum que introdueixin el seu correu electrònic (vàlid o inventat). 
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
L’<strong>accés d’usuaris anònims</strong> es fa usualment amb el nom d’usuari <strong>anonymous</strong> i una adreça de <strong>correu electrònic</strong> com a contrasenya. Sovint, els comptes anònims s’usen únicament per descarregar fitxers del directori de publicació, però també se’ls pot permetre publicar documents.
</p>
</div></div>
<p>
Quan els usuaris anònims poden publicar documents cal determinar en nom de qui ho fan, és a dir, quin és l’usuari, el grup i els permisos que s’assignen en el sistema de fitxers als documents pujats per aquests usuaris. També es pot configurar si se’ls permet crear directoris dins de l’arbre de publicació o no.
</p>

<p>
En general els elements que cal configurar en un servidor <acronym title="File Transfer Protocol">FTP</acronym> relacionats amb els usuaris anònims són:
</p>
<ul>
<li class="level1"><div class="li"> Determinar si es permet l’accés als usuaris anònims.</div>
</li>
<li class="level1"><div class="li"> Determinar si se’ls concedeix el dret a pujar documents.</div>
</li>
<li class="level1"><div class="li"> Concedir-los o no el dret a crear directoris en el servidor (en l’àrea de publicació).</div>
</li>
<li class="level1"><div class="li"> Determinar l’usuari, el grup i la màscara amb els quals pujar els documents (si se’ls permet fer-ho).</div>
</li>
<li class="level1"><div class="li"> Engabiar (<em>chroot</em>) o no l’usuari en el seu accés al sistema de fitxers.</div>
</li>
<li class="level1"><div class="li"> Establir si cal demanar contrasenya als usuaris anònims.</div>
</li>
<li class="level1"><div class="li"> Generar una llista de contrasenyes (correus electrònics) no acceptades pel sistema.</div>
</li>
<li class="level1"><div class="li"> En el sistema de fitxers del servidor, establir els permisos a fitxers i directoris des dels quals es permeti descarregar documents i als quals es puguin pujar documents.</div>
</li>
</ul>

<p>
En fer-se la instal·lació del servidor <acronym title="File Transfer Protocol">FTP</acronym>, usualment es crea de manera automatitzada un usuari anomenat <strong>ftp</strong>, que és l’usuari del sistema que representarà els usuaris anònims. Aquest usuari no té dret a realitzar sessions interactives amb el sistema, no té <em>shell</em> (<strong>nologin</strong>). Usualment el directori d’inici d’aquest usuari és el directori de publicació del servei <acronym title="File Transfer Protocol">FTP</acronym>. Així, en el cas del servei vsftpd, aquest usuari ftp té com a directori d’inici <strong>/srv/ftp</strong> (tot i que pot variar en segons quines distribucions). És costum que dins d’aquest directori existeixi un directori anomenat <strong>pub</strong>, en el qual hi ha tota la documentació d’accés públic (les descàrregues permeses a tothom). 
</p>

<p>
El codi següent mostra la línia que defineix l’usuari ftp en el fitxer d’usuaris del sistema:
</p>
<pre class="code">root@server:/# grep &quot;ftp&quot; /etc/passwd
ftp:x:116:127:ftp daemon,,,:/srv/ftp:/usr/sbin/nologin
root@server:/# </pre>
<div class="iocimportant"><div class="ioccontent">
<p>
L’usuari del sistema <strong>ftp</strong> és l’usuari usat en les connexions anònimes. Aquest usuari té el directori d’inici <strong>/srv/ftp</strong>.
</p>
</div></div>
</div>

<h2><a id="limitacions_d_acces" >Limitacions d’accés</a></h2>
<div class="level2">

<p>
Existeixen diverses directives que permeten establir múltiples aspectes del funcionament del servei <acronym title="File Transfer Protocol">FTP</acronym>. Aquest apartat se centra en les directives que afecten als aspectes següents:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Directives</p>
<p>
El llistat de totes les directives es pot consultar amb l’ordre:<br/>

<em>man 5 vsftpdconf</em>.
</p>
</div></div><ul>
<li class="level1"><div class="li"> Rendiment</div>
</li>
<li class="level1"><div class="li"> Mode de transferència</div>
</li>
<li class="level1"><div class="li"> Seguretat</div>
</li>
<li class="level1"><div class="li"> Mode del servei: autònom o xinetd</div>
</li>
<li class="level1"><div class="li"> Gestió dels <em>logs</em></div>
</li>
<li class="level1"><div class="li"> Bàners globals i missatges de directori</div>
</li>
</ul>

</div>

<h3><a id="rendiment" >Rendiment</a></h3>
<div class="level3">

<p>
El rendiment o <em>performance</em> permet configurar aspectes com el nombre màxim de connexions que pot atendre el servidor concurrentment, el nombre de connexions que es permet a un mateix client, l’ample de banda màxim permès en les connexions locals i en les anònimes… Aquestes són algunes de les directives relacionades amb el rendiment del servei:
</p>
<ul>
<li class="level1"><div class="li"> <strong><em>accept_timeout</em></strong> (60): estableix el <em>timeout</em> (o temps d’espera) en segons que té un client per establir connexions segures. Entre parèntesi se n’indica el valor per defecte</div>
</li>
<li class="level1"><div class="li"> <strong><em>anon_max_rate</em></strong> (0): estableix la taxa màxima de transferència que es permet als clients anònims. S’estableix en <em>bytes</em> per segon i per defecte val zero, que significa il·limitat.</div>
</li>
<li class="level1"><div class="li"> <strong><em>connect_timeout</em></strong> (60): estableix el temps màxim que té un client per respondre a una connexió de tipus PORT.</div>
</li>
<li class="level1"><div class="li"> <strong><em>data_connection_timeout</em></strong> (300): estableix el nombre màxim de segons en què una sessió de transferència de dades pot estar inactiva. Si se supera aquest límit sense progressar en la transferència la sessió es tanca.</div>
</li>
<li class="level1"><div class="li"> <strong><em>delay_failed_login</em></strong> (1): indica el nombre de segons de pausa abans d’indicar un error d’inici de sessió.</div>
</li>
<li class="level1"><div class="li"> <strong><em>delay_successful_login</em></strong> (0): indica el nombre de segons de pausa abans de permetre una connexió correcta.</div>
</li>
<li class="level1"><div class="li"> <strong><em>idle_session_timeout</em></strong> (300): estableix el nombre màxim de segons que una sessió pot estar inactiva. Passat aquest temps la sessió es tanca.</div>
</li>
<li class="level1"><div class="li"> <strong><em>local_max_rate</em></strong> (0): especifica la taxa màxima de transferència (en <em>bytes</em> per segon) que pot usar un usuari local. Per defecte val zero, que significa il·limitada. </div>
</li>
<li class="level1"><div class="li"> <strong><em>max_clients</em></strong> (0): estableix el nombre màxim de clients que es poden connectar concurrentment. Els clients següents rebran un missatge d’error informant que no es permeten més connexions. Per defecte pren el valor zero, que significa connexions il·limitades.</div>
</li>
<li class="level1"><div class="li"> <strong><em>max_login_fails</em></strong> (3): indica el nombre màxim d’intents d’inici de sessió fallits. Quan s’arriba a aquest número es tanca la sessió.</div>
</li>
<li class="level1"><div class="li"> <strong><em>max_per_ip</em></strong> (0): indica el nombre màxim de clients que es poden connectar simultàniament des de la mateixa adreça IP. Això permet establir límits al nombre de connexions d’un sol client basant-se en la seva adreça IP.</div>
</li>
<li class="level1"><div class="li"> <strong><em>one_process_model</em></strong> (YES): activa el model de funcionament <em>one process per connection</em>, que proporciona més velocitat de processament de les peticions client.</div>
</li>
</ul>

</div>

<h3><a id="mode_d_acces" >Mode d&#039;accés</a></h3>
<div class="level3">

<p>
Els servidors <acronym title="File Transfer Protocol">FTP</acronym> permeten treballar en mode <acronym title="American Standard Code for Information Interchange">ASCII</acronym> i binari. Actualment, el servei es configura en mode binari per defecte. El mode <acronym title="American Standard Code for Information Interchange">ASCII</acronym> pot presentar algunes vulnerabilitats de seguretat en fer un ús més intensiu dels recursos. Aquestes són algunes de les directives que controlen els modes d’accés:
</p>
<ul>
<li class="level1"><div class="li"> <strong><em>ascii_upload_enable</em></strong> (YES): estableix si es permet o no la transferència de dades en mode <acronym title="American Standard Code for Information Interchange">ASCII</acronym> a més del mode binari. Activant aquesta directiva es permet pujar documents al servidor en mode <acronym title="American Standard Code for Information Interchange">ASCII</acronym>.</div>
</li>
<li class="level1"><div class="li"> <strong><em>ascii_download_enable</em></strong> (YES): és la directiva anàloga a l’anterior per permetre o no les descàrregues en mode <acronym title="American Standard Code for Information Interchange">ASCII</acronym>.</div>
</li>
<li class="level1"><div class="li"> <strong><em>async_abor_enable</em></strong> (NO): si s’activa, permet a clients <acronym title="File Transfer Protocol">FTP</acronym> antics cancel·lar descàrregues a mig fer. D’altra manera, aquests clients es bloquejaven.</div>
</li>
</ul>

</div>

<h3><a id="seguretat" >Seguretat</a></h3>
<div class="level3">

<p>
Hi ha diverses qüestions relacionades amb la seguretat d’un servei de xarxa a més de les connexions anònimes i els usuaris locals o virtuals. Algunes són aspectes com el rang de ports a usar, les connexions PASV i PORT, el permís per fer llistats, la configuració PAM a usar, els <em>TCP wrappers</em>…
</p>

<p>
Algunes de les principals directives que tracten aspectes relacionats amb la seguretat són:
</p>
<ul>
<li class="level1"><div class="li"> <strong><em>pasv_min_port</em></strong> (0): indica el mínim port permès per a connexions tipus PASV. Si s’utilitza conjuntament amb la opció <em>pasv_max_port</em> permet definir un rang (mínim-màxim) amb els valors de port dinàmic que es poden utilitzar en connexions passives.</div>
</li>
<li class="level1"><div class="li"> <strong><em>pasv_max_port</em></strong> (0): indica el port màxim que es pot usar en connexions de tipus PASV. En aquestes connexions s’utilitza un port dinàmic que sempre serà igual o inferior a l’especificat aquí.</div>
</li>
<li class="level1"><div class="li"> <strong><em>pasv_enable</em></strong> (YES): si es defineix a <em>NO</em>, no es permetran les connexions PASV, de tipus passiu. Per defecte pren el valor <em>YES</em>.</div>
</li>
<li class="level1"><div class="li"> <strong><em>port_enable</em></strong> (YES): si s’estableix a <em>NO</em> no es permetrà la transferència de dades en mode actiu, és a dir, usant el mètode PORT. Per defecte pren el valor <em>YES</em>.</div>
</li>
<li class="level1"><div class="li"> <strong><em>tcp_wrappers</em></strong> (NO): aquesta opció permet activar la seguretat de les connexions de xarxa usant <em>TCP wrappers</em>. Permet establir regles de connexió en funció dels noms d’amfitrions o de les seves adreces.</div>
</li>
<li class="level1"><div class="li"> <strong><em>ls_recurse_enable</em></strong> (NO): per defecte es desactiva la propietat de poder fer llistats recursius amb l’ordre <em>ls -R</em>. Això generalment es fa per evitar riscos de seguretat, ja que aquesta ordre implica un gran comsum de recursos que pot fer caure el servidor. </div>
</li>
<li class="level1"><div class="li"> <strong><em>local_umask</em></strong> (077): estableix el valor per defecte de la màscara de permisos per a aquells elements que publiquin els usuaris locals.</div>
</li>
<li class="level1"><div class="li"> <strong><em>connect_from_port_20</em></strong> (NO): indica si les connexions de transferència de dades de tipus PORT han d’usar obligatòriament el port 20 o no.</div>
</li>
<li class="level1"><div class="li"> <strong><em>dirlist_enable</em></strong> (YES): especifica si es concedeix el permís de fer llistats. Si s’assigna el valor <em>NO</em>, els clients no podran llistar els directoris.</div>
</li>
<li class="level1"><div class="li"> <strong><em>download_enable</em></strong> (YES). indica si es permet o no la descàrrega de continguts. Evidentment, el cas general és permetre la descàrrega, de manera que per defecte s’estableix a <em>YES</em>.</div>
</li>
<li class="level1"><div class="li"> <strong><em>hide_ids</em></strong> (NO): aquesta opció permet ocultar la informació d’usuari i grup en els llistats dels directoris de manera que es mostri sempre el nom <em>ftp</em>.</div>
</li>
<li class="level1"><div class="li"> <strong><em>hide_file</em></strong> (none): aquesta opció permet indicar patrons de noms de fitxer que seran exclosos dels llistats dels directoris. És a dir, els noms de fitxers i de directoris que coincideixin amb els patrons especificats no seran vistos pels clients.</div>
</li>
<li class="level1"><div class="li"> <strong><em>pam_service_name</em></strong> (vsftpd): indica el nom del servei PAM que s’utilitza. Si usualment la configuració PAM utilitza el directori /etc/pam.d i aquesta directiva s’estableix a vsftpd, significa que espera trobar un fitxer amb aquest nom dins del directori.</div>
</li>
<li class="level1"><div class="li"> <strong><em>ftp_username</em></strong> (ftp): especifica el nom de l’usuari real del sistema que s’utilitzarà quan es realitzin connexions anònimes. És a dir, els clients anònims són mapejats a aquest usuari.</div>
</li>
</ul>

</div>

<h3><a id="mode_del_serveiautonom_o_xinetd" >Mode del servei: autònom o xinetd</a></h3>
<div class="level3">

<p>
El servidor vsftpd pot funcionar en mode autònom (<em>stand-alone</em>) o dins del superservei de xarxa xinetd. A més, es poden executar diverses instàncies del servidor per atendre diferents seus virtuals o per atendre amb més eficiència les peticions. Els següents són exemples de directives del mode autònom:
</p>
<pre class="code"># Standalone mode
listen=YES

This tells vsftpd to run in standalone mode. Do NOT try and run vsftpd from
an inetd with this option set - it won&#039;t work, you may well get 500 OOPS:
could not bind listening socket.

One further note on standalone mode, regarding virtual IPs. This is very
easy - just run one copy of vsftpd per virtual IP (remembering to give each
a separate config file on the command line).
Distinguish which vsftpd is for which virtual IP with a setting like this
in the vsftpd.conf:

listen_address=192.168.1.2</pre>
<ul>
<li class="level1"><div class="li"> <strong><em>listen</em></strong> (YES): és la directiva que indica al servidor que ha de funcionar en mode autònom.</div>
</li>
<li class="level1"><div class="li"> <strong><em>listen_address</em></strong> (adreça IP): indica per quina adreça IP en concret escolta el servidor. Es poden engegar diversos servidors, cada un amb el seu propi fitxer de configuració i atenent a una adreça IP concreta. Així es poden implementar seus virtuals.</div>
</li>
</ul>

<p>
El fragment de codi següent mostra un exemple de fitxer de configuració del servei vsftpd dins del superdimoni de xarxa xinetd. Usualment, els serveis es configuren amb un fitxer amb el mateix nom que el servei dins del directori apropiat de xinetd, usualment /etc/xinetd.d.
</p>
<pre class="code"># vsftpd is the secure FTP server.
service ftp
{
        disable                 = no
        socket_type             = stream
        wait                    = no
        user                    = root
        server                  = /usr/local/sbin/vsftpd
        per_source              = 5
        instances               = 200
        no_access               = 192.168.1.3
        log_on_success          += PID HOST DURATION
        log_on_failure          += HOST
}</pre>
<ul>
<li class="level1"><div class="li"> <strong><em>disable</em></strong> (no): indica que el servei ha de ser escoltat per el xinetd. Si pren el valor <em>YES</em>, el servei queda inhabilitat.</div>
</li>
<li class="level1"><div class="li"> <strong><em>socket_type</em></strong> (stream): indica que utilitza TCP.</div>
</li>
<li class="level1"><div class="li"> <strong><em>wait</em></strong> (no): indica si el servei és amb un sol <em>thread</em> o <em>multithread</em>. És a dir, si s’executa una sola instància del servei per atendre totes les peticions o si xinetd pot llançar múltiples instàncies. El valor <em>no</em> permet ser multithread.</div>
</li>
<li class="level1"><div class="li"> <strong><em>user</em></strong> (root): el servei s’executa en nom de l’usuari <em>root</em>.</div>
</li>
<li class="level1"><div class="li"> <strong><em>server</em></strong> (/usr/local/sbin/vsftpd): especifica el nom de l’executable del servidor.</div>
</li>
<li class="level1"><div class="li"> <strong><em>per_source</em></strong> (5): estableix un màxim de 5 connexions simultànies des d’un mateix client.</div>
</li>
<li class="level1"><div class="li"> <strong><em>instances</em></strong> (200): permet un màxim de 200 connexions concurrents, un màxim de 200 clients simultànis.</div>
</li>
<li class="level1"><div class="li"> <strong><em>no_access</em></strong> (192.168.1.3): denega l’accés al servidor a clients amb aquesta adreça IP origen.</div>
</li>
<li class="level1"><div class="li"> <strong><em>log_on_success</em></strong> (+= PID HOST DURATION): especifica el format dels <em>logs</em> quan es realitzen connexions satisfactòries. Es desa l’adreça IP, el PID i el temps invertit en la connexió.</div>
</li>
<li class="level1"><div class="li"> <strong><em>log_on_failure</em></strong> (+= HOST): especifica el format dels missatges de <em>log</em> per a les connexions fallides. Simplement s’enregistre l’adreça del client.</div>
</li>
</ul>

</div>

<h3><a id="logs" >Logs</a></h3>
<div class="level3">

<p>
Els aspectes principals a descriure en les directives de <em>logs</em> són indicar si cal generar els <em>logs</em> de les connexions clients o no i establir el format que han de tenir els missatges. El següent és un llistat de les principals directives implicades:
</p>
<pre class="code"># Activate logging of uploads/downloads.
xferlog_enable=YES

# You may override where the log file goes if you like. The default is shown
# below.
xferlog_file=/var/log/vsftpd.log

# If you want, you can have your log file in standard ftpd xferlog format.
# Note that the default log file location is /var/log/xferlog in this case.
xferlog_std_format=YES</pre>
<ul>
<li class="level1"><div class="li"> <strong><em>xferlog_enable</em></strong> (YES/NO): indica si cal generar <em>logs</em> de les connexions que es realitzen.</div>
</li>
<li class="level1"><div class="li"> <strong><em>xferlog_file</em></strong> (/var/log/vsftpd.log): indica la ubicació i el nom del fitxer on es desaran els <em>logs</em>.</div>
</li>
<li class="level1"><div class="li"> <strong><em>xferlog_std_format</em></strong> (YES/NO): especifica que el format que han de tenir els missatges de <em>log</em> ha de ser l’estàndard.</div>
</li>
</ul>

</div>

<h3><a id="baners_i_missatges" >Bàners i missatges</a></h3>
<div class="level3">

<p>
En el servidor <acronym title="File Transfer Protocol">FTP</acronym> es poden especificar diversos bàners o missatges de capçalera, que es mostren segons convingui. Per exemple, és habitual mostrar un bàner de benvinguda als usuaris que inicien sessió en el servidor. 
</p>
<pre class="code"># You may fully customise the login banner string:
# This  string option allows you to override the greeting banner displayed by 
# vsftpd when a connection first comes in.
ftpd_banner=Welcome to blah FTP service.

# This  option is the name of a file containing text to display when someone 
# connects to the server. If set, it overrides the banner string provided by the
# ftpd_banner option.
banner_file=</pre>

<p>
Un element diferent dels bàners són els missatges (<em>messages</em>). En els directoris de publicació es poden posar fitxers anomenats <em>.message</em> que poden contenir, per exemple, una descripció dels continguts del directori. El servidor <acronym title="File Transfer Protocol">FTP</acronym> mostra automàticament el contingut d’aquests fitxers en forma de capçalera quan l’usuari accedeix al directori. 
</p>
<pre class="code"># Messages, banners

# Activate directory messages - messages given to remote users when they
# go into a certain directory.
dirmessage_enable=YES

# This option is the name of the file we look for when a new directory is
# entered. The contents are displayed to the remote user. This option is only
# relevant if the option dirmessage_enable is enabled.Default: .message
message_file=</pre>

</div>

<h2><a id="modes_d_acces_al_servidor" >Modes d&#039;accés al servidor</a></h2>
<div class="level2">

<p>
Verificar el funcionament del servidor és tan senzill com tractar de connectar des d’un client <acronym title="File Transfer Protocol">FTP</acronym> al servidor i fer diverses sol·licituds en una mateixa sessió. Des de l’entorn de text, el mecanisme més simple per verificar el funcionament sempre és:
</p>
<ul>
<li class="level1"><div class="li"> Usar un client <acronym title="File Transfer Protocol">FTP</acronym> text i realitzar les comprovacions.</div>
</li>
<li class="level1"><div class="li"> Tractar de simular un diàleg <acronym title="File Transfer Protocol">FTP</acronym> usant una sessió Telnet. Com que el protocol <acronym title="File Transfer Protocol">FTP</acronym> té la particularitat que utilitza dos ports, això serà una mica més difícil. Caldrà un <em>telnet</em> per al diàleg de control i un altre per a cada transferència de dades.</div>
</li>
</ul>

<p>
A part de realitzar una sessió <acronym title="File Transfer Protocol">FTP</acronym> de prova per verificar el funcionament del servei, un administrador també ha de saber:
</p>
<ul>
<li class="level1"><div class="li"> Observar l’estat dels ports amb Nmap.</div>
</li>
<li class="level1"><div class="li"> Observar l’estat del servei.</div>
</li>
<li class="level1"><div class="li"> Monitorar el trànsit <acronym title="File Transfer Protocol">FTP</acronym> amb utilitats tipus <em>ss</em>, <em>netstat</em> i IPTraf.</div>
</li>
<li class="level1"><div class="li"> Monitorar el trànsit amb Wireshark.</div>
</li>
</ul>

</div>

<h3><a id="sessio_ftp" >Sessió FTP</a></h3>
<div class="level3">

<p>
En aquest apartat es mostra un exemple de sessió <acronym title="File Transfer Protocol">FTP</acronym> usant el client text <acronym title="File Transfer Protocol">FTP</acronym> i un exemple de sessió simulant el diàleg amb diverses connexions TCP amb <em>telnet</em>. En una mateixa sessió es poden realitzar diverses ordres de consulta, descàrrega i pujada de fitxers. També es combina la transferència de dades en mode actiu i passiu.
</p>
<div class="iocreference"><div class="ioccontent">
<p>
En la secció “Annexos” del web d’aquest mòdul trobareu una captura del trànsit de xarxa corresponent a una comunicació (diàleg) <acronym title="File Transfer Protocol">FTP</acronym>.
</p>
</div></div>
</div>

<h4><a id="exemple_de_dialeg_ftp" >Exemple de diàleg FTP</a></h4>
<div class="level4">

<p>
El diàleg client-servidor té forma d’ordres i respostes, tal com es pot veure a continuació, on es realitza una connexió <acronym title="File Transfer Protocol">FTP</acronym> i s’executen diverses ordres. S’utilitza el client <acronym title="File Transfer Protocol">FTP</acronym> per defecte i un servidor vsftpd instal·lat al <em>localhost</em>. En aquesta sessió es realitza transferència de dades tant en mode <strong>passiu</strong> com en mode <strong>actiu</strong>.
</p>
<pre class="code">Ordre      ports    comanda/resposta
[root@portatil ~]# ftp localhost 
    c49962 - s21    ... establiment de la connexió TCP... 
    s21 - c4992     Connected to localhost (127.0.0.1). 
    s21 - c4992     220 (vsFTPd 2.0.5) 

Name (localhost): anonymous 
    c4992 - s21     ... enviar el nom d&#039;usuari al servidor...
                    USER anonymous &lt;CRLF&gt;
    s21 - c4992     331 Please specify the password. 

Password: 
    c49962 - s21    ... enviar la contrasenya al servidor...
                    PASS usuari@fpoberta.cat
    s21 - c4992     230  Login successful. 
    s21 - c4992     Remote system type is UNIX. 
    s21 - c4992     Using binary mode to transfer files. 

ftp&gt; cd pub
    c49962 - s21    ... canviar al directori pub...
                    CWD pub 
    s21 - c4992     250 Directory successfully changed.

ftp&gt; dir
    c49962 - s21     ... indicar el port dinàmic client ...
                     PORT 127,0,0,1,137,108 &lt;CRLF&gt; 
    s21 - c49962     200 Port command succesfull
    c49962 - s21     ... llistar el directori ...
                     LIST &lt;CRLF&gt; 
*   s20 - c35180     ... establiment connexió canal dades...
*   c35180 - s20     ... connexió TCP client/servidor...
    s21 - c49962     150 Here comes the directory listing 
*   s20 - c35180     total 2
                     -rw-r--r-- 1 0 0 110 May 31 12:15 llistat 
                     -rw-r--r-- 1 0 0 362047 Feb 23 16:12 services 
                     ... tancament de la connexió de dades...
    s21 - c4992      226 Directory send OK.

ftp&gt; get carta.txt
    c49962 - s21     ... descarregar el fitxer carta.txt...
    c49962 - s21     ... demanar el mode passiu al server... 
                     PASV
    s21 - c49962     227 Entering Passive Mode (127,0,0,1,142,120).
    c49962 - s21     RETR carta.txt
    s21 - c49962     150 Opening BINARY mode data connection 
                     for carta.txt (110 bytes)
*   c435181 - s36472 ... establiment connexió canal dades...
*   s36472 - c435181 ... connexió TCP client/servidor...
*                    ... transferència del contingut del fitxer...
*                    ... tancament de la connexió de dades...
    s21 - c4992      226 File send OK

ftp&gt; quit
    c49962 - s21     QUIT &lt;CRLF&gt;
    s21 - c49962     221 Goodbye.</pre>

<p>
El seguiment de la sessió és el següent:
</p>
<ul>
<li class="level1"><div class="li"> El client <acronym title="File Transfer Protocol">FTP</acronym> es connecta al servidor via <em>localhost</em> i s’identifica com a usuari <em>anonymous</em> amb la contrasenya usuari@fpoberta.cat. Observeu que el servidor respon amb “230  Login successful”: indica que el sistema operatiu és Unix i que el mode de transferència és binari.</div>
</li>
<li class="level1"><div class="li"> El client canvia al directori pub amb l’ordre d’usuari <em>cd pub</em>. Aquesta ordre correspon a l’ordre <em>CWD pub</em> del protocol <acronym title="File Transfer Protocol">FTP</acronym>.</div>
</li>
<li class="level1"><div class="li"> El client demana fer un llistat amb l’ordre <em>dir</em>. Internament, el client aplica aquesta ordre fent dues ordres al servidor: PORT i LIST. Amb l’ordre <em>PORT 127,0,0,1,137,108</em>, el client indica al servidor quin és el seu port dinàmic. La transferència del llistat es realitzarà del port 20 del servidor al port dinàmic del client. El mode de transferència és <strong>actiu</strong>.</div>
</li>
<li class="level1"><div class="li"> Tot seguit l’usuari client demana descarregar un fitxer amb l’ordre <em>GET carta.txt</em>. El client <acronym title="File Transfer Protocol">FTP</acronym> transforma aquesta petició GET en dues ordres al servidor: PASV i RETR. La primera demana al servidor que operi en mode <strong>passiu</strong> i el servidor ho fa responent “227 Entering Passive Mode (127,0,0,1,142,120)”. És a dir, el servidor informa de quin és el port (dinàmic) que utilitzarà per a la transferència de dades en lloc del port per defecte 20. Així, serà el client qui haurà de prendre la iniciativa d’iniciar la connexió de dades. L’ordre RETR fa que el servidor envii al client el fitxer sol·licitat. La comunicació, per tant, és en mode <strong>passiu</strong> del port dinàmic del servidor al port dinàmic del client.</div>
</li>
<li class="level1"><div class="li"> Finalment el client tanca la sessió amb l’ordre <em>quit</em>.</div>
</li>
</ul>
<div class="ioctextl"><div class="ioccontent"><p class="ioctitle">Mode actiu i mode passiu</p>
<p>
Per activar el mode actiu s’utilitza l’ordre PORT A, B, C, D, PH, PL.
</p>

<p>
El client indica el seu port de dades especificant la pròpia adreça IP: A.B.C.D i el port. El port s’indica en dos octets PL i PH tals que el número del port correspon a l’expressió <em>port = PH 256 + PL</em>.
</p>

<p>
Per activar el mode passiu s’utilitza l’ordre PASV.
</p>

<p>
El client sol·licita al servidor treballar en mode passiu. El servidor comunica quin és el seu port de dades (que usarà en lloc del port 20). Emet una resposta amb la informació A, B, C, D, PH, PL, que indica la IP del servidor (A.B.C.D) i el port del servidor en el format <em>port = PH 256 + PL</em> (el valor del port s’obté dels octets PL i PH aplicant l’expressió indicada).
</p>
</div></div>
</div>

<h4><a id="exemple_de_dialeg_ftp_usant_telnet" >Exemple de diàleg FTP usant Telnet</a></h4>
<div class="level4">

<p>
La majoria de protocols TCP inicials d’Internet es poden simular usant Telnet al port pertinent i simulant manualment les ordres del protocol. En el cas del protocol <acronym title="File Transfer Protocol">FTP</acronym> això és molt difícil, ja que requereix dues connexions, una de control i una de dades. 
</p>

<p>
Si el servidor treballa en mode actiu és ell el que estableix la comunicació de dades del seu port 20 a un port dinàmic del client. Per poder recrear aquest diàleg caldria una aplicació que escoltés en el port del client (un Telnet escoltant per aquest port).
</p>

<p>
Si el servidor treballa en mode passiu és el client el que genera la nova connexió de dades al port especificat pel servidor. Això sí que es pot recrear amb un altre Telnet.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Calen dos Telnets per simular una transferència <acronym title="File Transfer Protocol">FTP</acronym> en mode passiu:
</p>
<ul>
<li class="level1"><div class="li"> Un pel port 21, per realitzar el control de la comunicació (del client al servidor).</div>
</li>
<li class="level1"><div class="li"> L’altre (també del client al servidor) per realitzar la transferència d’un port dinàmic del client a un port dinàmic del servidor.</div>
</li>
</ul>
</div></div>
<p>
Vegem-ne un exemple: 
</p>

<p>
 <strong>Sessió 1: canal de control</strong>
</p>
<pre class="code">[user@host ~]# telnet localhost 21 
Trying 127.0.0.1... 
Connected to localhost. 
Escape character is &#039;^]&#039;. 
220 (vsFTPd 2.0.5) 

USER pere 
331 Please specify the password. 

PASS pere 
230 Login successful. 

PWD 
257 &quot;/home/pere&quot;
	
LIST 
425 Use PORT or PASV first. 

PORT 127,0,0,1,231,175 
200 PORT command successful. Consider using PASV. 

LIST 
150 Here comes the directory listing. 
426 Failure writing network stream. 

PASV 
227 Entering Passive Mode (127,0,0,1,202,67) 
*** iniciar sessió 2 en un altre terminal ***

LIST 
150 Here comes the directory listing. 
226 Directory send OK. 

PASV 
227 Entering Passive Mode (127,0,0,1,165,50)
*** iniciar sessió 3 en un altre terminal ***

RETR pere.info 
150 Opening BINARY mode data connection for pere.info (70 bytes). 
226 File send OK.

QUIT 
221 Goodbye. 
Connection closed by foreign host. </pre>

<p>
 <strong>Sessió 2: llistat</strong>
</p>
<pre class="code">[user@host ~]# telnet localhost 51779 
Trying 127.0.0.1... 
Connected to localhost. 
Escape character is &#039;^]&#039;. 
-rw-r--r--    1 500      501          1695 Jun 01 17:19 nou.odt 
-rw-rw-r--    1 500      501            70 Jun 01 17:14 pere.info 
Connection closed by foreign host. </pre>

<p>
 <strong>Sessió 3: &#039;<em>get</em>’ del fitxer</strong>
</p>
<pre class="code">[user@host ~]# telnet localhost 42290 
Trying 127.0.0.1... 
Connected to localhost. 
Escape character is &#039;^]&#039;. 
per crear un usuari com per exemple pere: 
# useradd pere 
# passwd pere 
Connection closed by foreign host.</pre>

<p>
El seguiment del diàleg és el següent:
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Per saber quines són les comandes possibles del protocol <acronym title="File Transfer Protocol">FTP</acronym> cal consultar l’<acronym title="Request for Comments">RFC</acronym> del protocol.
</p>
</div></div><ul>
<li class="level1"><div class="li"> Fer un Telnet al port 21 del servidor, identificar-se amb les ordres del protocol USER i PASS. Esbrinar quin és el directori per defecte amb l’ordre PWD.</div>
</li>
<li class="level1"><div class="li"> En intentar fer un llistat del directori amb l’ordre LIST, el servidor contesta que primer cal executar l’ordre PORT o PASV. És a dir, que el client indiqui quin és el seu port de dades o que li mani al servidor treballar en mode passiu (perquè sigui el servidor qui indiqui el seu port dinàmic).</div>
</li>
<li class="level1"><div class="li"> El client indica el seu port de dades amb l’ordre <em>PORT 127,0,0,1,231,175</em>. Aquesta ordre indica la IP del client (127.0.0.1) i el port de dades a usar, el 59311 (231 * 256 + 175 = 59.311). En aquest punt el servidor, intenta una nova connexió TCP entre el seu port 20 i el port indicat pel client. Com que el client no atén aquesta connexió, es produeix un error i el servidor no realitza la transferència. </div>
</li>
<li class="level1"><div class="li"> En el tercer bloc del llistat Telnet, el client executa l’ordre PASV, que provoca que el servidor respongui indicant el port dinàmic de dades que utilitzarà en lloc del port 20. El servidor respon “227 Entering Passive Mode (127,0,0,1,202,67)”. Indica la seva IP (127,0,0,1) i el port que utilitzarà: 202 * 256 + 67 = 51.779.  </div>
</li>
<li class="level1"><div class="li"> En un altre terminal del client es pot iniciar una segona sessió Telnet a aquest port, tal com es pot veure a “Sessió 2: llistat”: <em>telnet localhost 51779</em>. En aquesta connexió es rebrà la transferència del canal de dades de l’ordre que es realitzi a continuació (si és de transferència). </div>
</li>
<li class="level1"><div class="li"> En el canal de control es realitza l’ordre LIST i automàticament en la sessió 2 apareix el contingut del llistat i es tanca la connexió per part del servidor.</div>
</li>
<li class="level1"><div class="li"> Tot seguit es realitza el mateix procés per descarregar el fitxer pere.info. El client realitza l’ordre PASV en el canal de control perquè el servidor indiqui el port de dades que utilitzarà. </div>
</li>
<li class="level1"><div class="li"> Establir una tercera sessió fent un <em>telnet</em> al servidor al port que ha indicat (65 * 256 + 50 = 42.290). En fer l’ordre <em>RETR pere.info</em> (equivalent al GET del fitxer), el contingut del fitxer es transfereix a la sessió 3. El llistat que es mostra després de l’establiment de connexió correspon al contingut del fitxer.</div>
</li>
<li class="level1"><div class="li"> Per acabar, es tanca la connexió del canal de control amb l’ordre QUIT (equivalent al BYE).</div>
</li>
</ul>

</div>

<h2><a id="comunicacions_segures" >Comunicacions segures</a></h2>
<div class="level2">

<p>
Una característica fonamental del protocol <acronym title="File Transfer Protocol">FTP</acronym> és que quan es va dissenyar no es va tenir en compte la seguretat, més enllà de l’usuari i la contrasenya (que és pròpia del sistema operatiu). Com en altres protocols, la informació que porten els paquets viatja per la xarxa com a text pla, sense encriptar. És a dir, que qualsevol persona amb uns mínims coneixements de xarxes, pot capturar aquests paquets i espiar les dades (usuaris, contrasenyes, informació sensible…). Si, a més, fem servir un medi sense fils, encara s’és més vulnerable.
</p>

<p>
Com d’altres protocols, s’han afegit extensions per tal de xifrar les comunicacions. En aquest cas hi ha dues maneres de fer-ho: a través del protocol FTPS i el SFTP.
</p>

</div>

<h3><a id="el_protocol_ftps" >El protocol FTPS</a></h3>
<div class="level3">

<p>
El protocol <strong>FTPS</strong> (<acronym title="File Transfer Protocol">FTP</acronym> sobre SSL/TLS, <em><acronym title="File Transfer Protocol">FTP</acronym> over SSL/TLS</em>) utilitza el mateix mecanisme que altres protocols (HTTPS, etc.). Utilitza la capa de seguretat SSL/TLS per fer que les comunicacions siguin xifrades i proporcionar la confidencialitat i autenticació necessàries per a les comunicacions <acronym title="File Transfer Protocol">FTP</acronym>. Utilitza els mateixos ports que el protocol <acronym title="File Transfer Protocol">FTP</acronym> (20 i 21).
</p>

<p>
El programari <em>vsftpd</em> ja porta preparats uns certificats per tal de poder xifrar les comunicacions, tot i que es poden substituir per d’altres. Per tal d’activar el protocol FTPS cal descomentar les següents línies i reiniciar el servei:
</p>
<pre class="code">ssl_enable=yes
rsa_cert_file=/etc/ssl/certs/ssl-cert-snakeoil.pem
rsa_private_key_file=/etc/ssl/private/ssl-cert-snakeoil.key</pre>

<p>
Vegem amb més detalls les directives:
</p>
<ul>
<li class="level1"><div class="li"> <strong><em>ssl_enable</em></strong>: habilita SSL per tal d’activar el protocol FTPS.</div>
</li>
<li class="level1"><div class="li"> <strong><em>rsa_cert_file</em></strong>: conté el certificat públic.</div>
</li>
<li class="level1"><div class="li"> <strong><em>rsa_private_key_file</em></strong>: conté la clau privada.</div>
</li>
</ul>

<p>
El client normal d’<acronym title="File Transfer Protocol">FTP</acronym> que porten la majoria de distribucions no suporta SSL. Cal instal·lar algun client de text que ho suporti, com <em>ftp-ssl</em> o <em>lftp</em>.
</p>
<pre class="code">usuari@client:~$ ftp 10.0.2.15
Connected to 10.0.2.15.
220 (vsFTPd 3.0.3)
Name (10.0.2.15:usuari): usuari
530 Non-anonymous sessions must use encryption.
Login failed.
421 Service not available, remote server has closed connection
ftp&gt; quit
usuari@client:~$ ftp-ssl 10.0.2.15
Connected to 10.0.2.15.
220 (vsFTPd 3.0.3)
Name (10.0.2.9:usuari): usuari
234 Proceed with negotiation.
[SSL Cipher ECDHE-RSA-AES256-GCM-SHA384]
331 Please specify the password.
Password:
230 Login successful.
Remote system type is UNIX.
Using binary mode to transfer files.
ftp&gt;</pre>

<p>
Amb els clients gràfics també cal indicar que s’usa SSL, tal com es pot veure en la <span class="figref"><a href="#ftp-filezilla"><span>figura</span></a></span>.
</p>
<div class="iocfigure"><a name="ftp-filezilla"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Connexió a un servidor amb suport FTPS

</figcaption><img src="../media/ftp-filezilla.png" alt="" /></figure>
</div>
</div>

<h3><a id="el_protocol_sftp" >El protocol SFTP</a></h3>
<div class="level3">

<p>
El protocol <strong>SFTP</strong> és una implementació diferent del protocol <acronym title="File Transfer Protocol">FTP</acronym>. De fet, és una extensió del protocol SSH (<em>Secure SHell</em>), que és qui realment ofereix el xifrat. En aquest cas, el protocol utilitza el port 22, que és el d’SSH. Aquest protocol <strong>no</strong> és compatible amb l’FTPS.
</p>

<p>
No s’ha de confondre amb el protocol <em>Simple File Transfer Protocol</em> (protocol simple per a la transferència de fitxers), ja que coincideixen les sigles SFTP. Aquest era una versió lleugera del protocol <acronym title="File Transfer Protocol">FTP</acronym> que utilitzava el port 115 (<acronym title="Request for Comments">RFC</acronym> 913) i que avui en dia no s’utilitza, ja que en el seu lloc es fa servir el TFTP (Trivial <acronym title="File Transfer Protocol">FTP</acronym>).
</p>

<p>
Per poder utilitzar el protocol SFTP cal instal·lar un altre programari, com per exemple la <em>suite</em> <em>openSSH</em>, que incorpora un propi servidor <acronym title="File Transfer Protocol">FTP</acronym>.
</p>
<pre class="code">root@server:/# apt install openssh-server
Reading package lists... Done
Building dependency tree       
Reading state information... Done
The following additional packages will be installed:
  openssh-sftp-server
Suggested packages:
  molly-guard monkeysphere rssh ssh-askpass ufw
The following NEW packages will be installed:
  openssh-server openssh-sftp-server
0 upgraded, 2 newly installed, 0 to remove and 182 not upgraded.
Need to get 397 kB of archives.
After this operation, 1609 kB of additional disk space will be used.
Do you want to continue? [Y/n] </pre>

<p>
I des d’un client ja ens podem connectar al servidor amb la comanda <em>sftp</em>:
</p>
<pre class="code">usuari@client:~$ sftp 10.0.2.15
The authenticity of host &#039;10.0.2.15 (10.0.2.15)&#039; can&#039;t be established.
ECDSA key fingerprint is SHA256:2cqYKzks+fFtaQutgx8jLfvy8X08lEzxgPdkXYg2DKw.
Are you sure you want to continue connecting (yes/no)? yes
Warning: Permanently added &#039;10.0.2.15&#039; (ECDSA) to the list of known hosts.
usuari@10.0.2.15&#039;s password: 
Connected to 10.0.2.15.
sftp&gt;</pre>

<p>
En el cas de voler-se connectar amb un client gràfic com, per exemple, FileZilla, també cal indicar que s’usa SFTP, tal com es pot veure en la <span class="figref"><a href="#ftp-filezilla-sftp"><span>figura</span></a></span>:
</p>
<div class="iocfigure"><a name="ftp-filezilla-sftp"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Connexió a un servidor amb suport SFTP

</figcaption><img src="../media/ftp-filezilla-sftp.png" alt="" /></figure>
</div>
</div>

<h2><a id="clients_grafics_i_de_text" >Clients gràfics i de text</a></h2>
<div class="level2">

<p>
Abans de la popularització del World Wide Web, el servei <acronym title="File Transfer Protocol">FTP</acronym> era profusament usat per a l’intercanvi d’informació i la transferència de fitxers, generalment en mode text o consola, ja que aquest era el mode més comú de treball. Més endavant van anar apareixent eines gràfiques que permetien gestionar còmodament, amb pocs clics, les descàrregues. Avui en dia les eines gràfiques han quedat superades pels omnipresents navegadors, la interfície amb la qual la majoria d’usuaris dialoguen amb el món. 
</p>

</div>

<h3><a id="clients_de_text" >Clients de text</a></h3>
<div class="level3">

<p>
Alguns dels clients més populars per treballar en mode text són:
</p>
<ul>
<li class="level1"><div class="li"> <strong>ftp</strong>: el client <acronym title="File Transfer Protocol">FTP</acronym>, utilitat incorporada en tots els sistemes GNU/Linux del món.</div>
</li>
<li class="level1"><div class="li"> <strong>wget</strong>: una de les eines actualment més populars per a la descàrrega de continguts d’<acronym title="File Transfer Protocol">FTP</acronym> i HTTP (entre d’altres).</div>
</li>
<li class="level1"><div class="li"> <strong>SFTP</strong>: eina del paquet ofimàtic SSH que permet la connexió <acronym title="File Transfer Protocol">FTP</acronym> segura.</div>
</li>
</ul>

</div>

<h4><a id="client_ftp" >Client FTP</a></h4>
<div class="level4">

<p>
Un client <acronym title="File Transfer Protocol">FTP</acronym> es pot connectar molt fàcilment des del mode d’ordres de la majoria de sistemes operatius. Únicament s’ha d’executar l’ordre <em>ftp &lt;servidor&gt;</em>, i automàticament s’inicia una connexió entre el client i el servidor indicat. Usualment, l’aplicació client permet un ús interactiu i es poden obrir i tancar sessions i treballar en diferents servidors al gust del client. 
</p>

<p>
Vegeu un exemple de sessió client:
</p>
<pre class="code">$ ftp ftp.uoc.net            # inicia una sessió al servidor ftp.uoc.net 
&gt; quit                       # finalitza la sessió al servidor ftp.uoc.net 

$ ftp                        # engega l&#039;aplicació client
&gt; open ftp.rediris.es        # connecta al servidor FTP de RedIRIS
&gt; get carta.txt              # descarrega el fitxer carta.txt
&gt; get file1.txt /tmp/nou.txt # desa file1.txt a /tmp amb el nom nou.txt
&gt; quit                       # finalitza la sessió al servidor atual
&gt; open servidor_nou          # inicia una connexió a un altre servidor
&gt; put /tmp/nou.txt           # puja el fitxer al directori actiu amb el nom nou.txt
&gt; cd dir1                    # canvia el directori de destinació a dir1
&gt; put carta.txt              # puja el fitxer carta.txt al directori actual (dir1)</pre>

<p>
El client disposa de les ordres <acronym title="File Transfer Protocol">FTP</acronym> que el servidor implementi. No necessàriament s’implementen totes les ordres descrites en el protocol. A més, l’usuari pot disposar de més ordres si el client i el servidor permeten extensions del protocol (utilitats addicionals). 
</p>

<p>
Les ordres més usuals són <strong><em>get</em></strong>, <strong><em>mget</em></strong>, <strong><em>put</em></strong> i <strong><em>mput</em></strong> per baixar i pujar fitxers; <strong><em>cd</em></strong> i <strong><em>ls</em></strong> per canviar i llistar directoris; <strong><em>ascii</em></strong> i <strong><em>binary</em></strong> per indicar el mode de transferència; <strong><em>!ordre</em></strong> per executar una ordre de sistema operatiu en el servidor, i <strong><em>help</em></strong> per mostrar la llista d’ordres.
</p>

<p>
A continuació es mostra la llista d’ordres que implementa el servidor al qual ens hem connectat:
</p>
<pre class="code">ftp&gt; help 
Commands may be abbreviated. Commands are: 
! debug mdir  sendport  site 
$       dir     mget    put     size 
account disconnect mkdir pwd    status 
append  exit    mls     quit    struct 
ascii   form    mode    quote   system 
bell    get     modtime recv    sunique 
binary  glob    mput    reget   tenex 
bye     hash    newer   rstatus tick 
case    help    nmap    rhelp   trace 
cd      idle    nlist   rename  type 
cdup    image   ntrans  reset   user 
chmod   lcd     open    restart umask 
close   ls      prompt  rmdir   verbose 
cr      macdef  passive runique ? 
delete  mdelete proxy   send</pre>

<p>
Aquest és un altre exemple de sessió de text amb un client <acronym title="File Transfer Protocol">FTP</acronym>:
</p>
<pre class="code">[pere@host ~]# ftp localhost 
Name (localhost:root): pere 
Password: 

ftp&gt; pwd 
257 &quot;/home/pere&quot; 
ftp&gt; ls 
-rw-rw-r-- 1 500 501 70 Jun 01 17:14 pere.info 

ftp&gt; cd /tmp 
ftp&gt; ls 
-rw-rw-rw- 1 0 0 1695 Jun 01 17:15 fitxa.odt

ftp&gt; !pwd 
/root 

ftp&gt; get fitxa.odt 
local: fitxa.odt remote: fitxa.odt 

ftp&gt; cd ~ 
250 Directory successfully changed. 

ftp&gt; pwd 
257 &quot;/home/pere&quot; 

ftp&gt; !pwd 
/root 
ftp&gt; get pere.info 
local: pere.info remote: pere.info 

ftp&gt; put fitxa.odt nou.odt 
local: fitxa.odt remote: nou.odt 

ftp&gt; put pere.info /tmp/pere.txt 
local: pere.info remote: /tmp/pere.txt 

ftp&gt; cd pub 
ftp&gt; put pere.info 
local: pere.info remote: pere.info 
553 Could not create file. 

ftp&gt; bye 
221 Goodbye. </pre>

<p>
El seguiment del diàleg mostra les accions següents:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Ús del servei FTP</p>
<p>
L’ús del servei <acronym title="File Transfer Protocol">FTP</acronym> exigeix una bona gimnàstica mental, ja que l’usuari ha de ser conscient en tot moment de quin és el seu sistema de fitxers local i quin és el sistema remot. La majoria d’ordres tenen una versió per al sistema de fitxers local (<em>lcd</em> o “local cd”, per exemple) i una altra per al sistema remot (<em>cd</em>).
</p>
</div></div><ul>
<li class="level1"><div class="li"> Connectar al servidor com a usuari identificat: pere. El directori actiu en el servidor <acronym title="File Transfer Protocol">FTP</acronym> és el dirctori d’inici de l’usuari (en aquest exemple /home/pere), com mostra l’ordre <strong><em>pwd</em></strong>.</div>
</li>
<li class="level1"><div class="li"> Canviar el directori actiu en el servidor amb l’ordre <strong><em>cd</em></strong>. Observar que en el client el directori actiu és un altre, de fet en el client sembla que som l’usurari <em>root</em> en el seu dirctori d’inici. L’ordre “<em>!pwd</em>” executa en el <em>shell</em> del client l’ordre que se li mani.</div>
</li>
<li class="level1"><div class="li"> La instrucció <em>get fitxa.odt</em> descarrega el fitxer d’aquest nom del servidor i el desa en el directori actiu del client amb el mateix nom.</div>
</li>
<li class="level1"><div class="li"> Es torna a canviar de directori actiu en el servidor (es retorna al dirctori d’inici) i es descarrega el fitxer pere.info. Es desa novament amb el mateix nom en el directori actiu en el client.</div>
</li>
<li class="level1"><div class="li"> L’ordre <em>put fitxa.odt nou.odt</em> permet desar el fitxer fitxa.odt que hi ha en el directori actiu del client amb un nom nou en el directori actiu del servidor.</div>
</li>
<li class="level1"><div class="li"> Es pot pujar un fitxer indicant tant la ubicació origen en el client com la ubicació de destinació en el servidor. L’ordre <em>put pere.info /tmp/pere.txt</em> desa el fitxer pere.info que hi ha en el directori actiu del client a /tmp en el servidor amb el nom pere.txt.</div>
</li>
<li class="level1"><div class="li"> L’últim exemple mostra que no es pot pujar un fitxer a una ubicació en què no es disposa de permisos per fer-ho.</div>
</li>
</ul>

<p>
Per obtenir informació d’una ordre en concret del client <acronym title="File Transfer Protocol">FTP</acronym> es pot consultar la pàgina del manual del client, o també es pot usar l’ordre <em>help</em> dins de l’intèrpret client.
</p>
<pre class="code">[user@host ~]$ ftp
ftp&gt; help get
get       	receive file
ftp&gt; help mget
mget      	get multiple files</pre>

</div>

<h4><a id="client_wget" >Client Wget</a></h4>
<div class="level4">

<p>
La utilitat principal de Wget és descarregar un fitxer o un conjunt de fitxers d’un servidor <acronym title="File Transfer Protocol">FTP</acronym> (també d’altres protocols) de forma desatesa, és a dir, sense fer-ho interactivament fitxer a fitxer. Si no indiquem l’usuari i la contrasenya amb els quals ens volem connectar, es realitza una connexió anònima.
</p>
<pre class="code">root@server:/# wget ftp://ftp.rediris.es/welcome.msg
--2020-09-26 14:41:11--  ftp://ftp.rediris.es/welcome.msg
           =&gt; &#039;welcome.msg&#039;
Resolving ftp.rediris.es (ftp.rediris.es)... 130.206.13.2, 2001:720:418:cafd::2
Connecting to ftp.rediris.es (ftp.rediris.es)|130.206.13.2|:21... connected.
Logging in as anonymous ... Logged in!
==&gt; SYST ... done.    ==&gt; PWD ... done.
==&gt; TYPE I ... done.  ==&gt; CWD not needed.
==&gt; SIZE welcome.msg ... 93
==&gt; PASV ... done.    ==&gt; RETR welcome.msg ... done.
Length: 93 (unauthoritative)

welcome.msg                       100%[===========================================================&gt;]      93  --.-KB/s    in 0s      

2020-09-26 14:41:12 (3.42 MB/s) - &#039;welcome.msg&#039; saved [93]

root@server:/# </pre>

<p>
El llistat següent mostra, d’entre totes les opcions de wget, les referides al servei <acronym title="File Transfer Protocol">FTP</acronym>:
</p>
<pre class="code">root@server:/# wget -h
GNU Wget 1.10.1, un baixador de xarxa no interactiu.
Forma d&#039;ús: wget [OPCIÓ]... [URL]...
... output suprimit ...

Opcions de FTP:
       --ftp-user=USUARI       estableix l&#039;usuari d&#039;FTP a USUARI.
       --ftp-password=PASS     estableix la contrasenya d&#039;FTP a PASS.
       --no-remove-listing     no suprimir els fitxers «.listing».
       --no-glob               inhabilita l&#039;ús de comodins de fitxers per a FTP.
       --no-passive-ftp        inhabilita el mode de transferència passiu.
       --preserve-permissions  manté els permisos del fitxer remot
       --retr-symlinks         en mode de recursió, baixa els fitxers
                               apuntats per enllaços simbòlics que no siguen
                               directoris
... output suprimit ...</pre>

</div>

<h4><a id="client_sftp" >Client SFTP</a></h4>
<div class="level4">

<p>
La utilitat SFTP és molt potent i és utilitzada per navegadors de fitxers (per exemple, Nautilus) per poder mostrar sistemes de fitxers remots connectats per <acronym title="File Transfer Protocol">FTP</acronym>. Aquest és el seu format:
</p>
<pre class="code">root@server:/# sftp -h    
usage: sftp [-46aCfpqrv] [-B buffer_size] [-b batchfile] [-c cipher]
          [-D sftp_server_path] [-F ssh_config] [-i identity_file] [-l limit]
          [-o ssh_option] [-P port] [-R num_requests] [-S program]
          [-s subsystem | sftp_server] destination</pre>

<p>
Vegeu un exemple de sessió client usant SFTP per realitzar una transferència segura de fitxers:
</p>
<pre class="code">root@server:/# sftp pere@localhost
Connecting to localhost... 
pere@localhost&#039;s password: 

sftp&gt; pwd 
Remote working directory: /home/pere 

sftp&gt; ls 
nou.odt    pere.info  

sftp&gt; put pere.info /tmp/pere.bak 
Uploading pere.info to /tmp/pere.bak 
pere.info                                100%   70     0.1KB/s   00:00    

sftp&gt; get /tmp/pere.bak 
Fetching /tmp/pere.bak to pere.bak 
/tmp/pere.bak                            100%   70     0.1KB/s   00:00 </pre>

</div>

<h3><a id="clients_grafics" >Clients gràfics</a></h3>
<div class="level3">

<p>
Actualment hi ha una gran varietat de clients gràfics que tenen més o menys èxit. Un dels més populars és FileZilla. En la <span class="figref"><a href="#Figure2"><span>figura</span></a></span> podem observar el client FileZilla connectat a la seu ftp.redhat.com. 
</p>
<div class="iocfigure"><a name="Figure2"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Pantalla del client gràfic FileZilla

</figcaption><img src="../media/ic10m08u2_06.png" alt="" /></figure>
</div>
<p>
En el sistema GNU/Linux usualment hi ha algun tipus d’aplicació per navegar pel sistema de fitxers, com Konqueror o Nautilus, depenent de l’escriptori instal·lat. Aquestes eines permeten no només navegar per sistemes de fitxers, sinó també connectar a recursos externs per <acronym title="File Transfer Protocol">FTP</acronym> o SFTP. La <span class="figref"><a href="#Figure3"><span>figura</span></a></span> mostra un exemple del funcionament:
</p>
<div class="iocfigure"><a name="Figure3"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Pantalla del client Nautilus connectat a un recurs per SFTP

</figcaption><img src="../media/ic10m08u2_07.png" alt="" /></figure>
</div>
</div>

<h3><a id="el_navegador_com_a_client" >El navegador com a client</a></h3>
<div class="level3">

<p>
Avui dia una de les eines imprescindibles per als usuaris d’Internet és el navegador (normalment considerat navegador web). Cada usuari utilitza el que prefereix. Alguns dels més destacats actualment són Firefox i Chrome. Els navegadors permeten accedir a molts tipus de continguts diferents, entre els quals s’inclouen recursos <acronym title="File Transfer Protocol">FTP</acronym>.
</p>

<p>
Simplement cal introduir l’<acronym title="Uniform Resource Locator">URL</acronym> indicant l’esquema (<em>schema</em>) adequat:
</p>
<pre class="code">ftp://&lt;url&gt;</pre>

<p>
La <span class="figref"><a href="#ftp-distros"><span>figura</span></a></span> mostra un exemple de mirall (<em>mirror</em>) de descàrregues per <acronym title="File Transfer Protocol">FTP</acronym> per a diferents distribucions de Linux. Els usuaris poden descarregar-se sistemes operatius usant un client navegador qualsevol, com Firefox o Chrome.
</p>
<div class="iocfigure"><a name="ftp-distros"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Pàgina de descàrregues per <acronym title="File Transfer Protocol">FTP</acronym> de diferents distribucions de Linux

</figcaption><img src="../media/ftp-distros.png" alt="" /></figure>
</div>
</div>

	 </article>
     <div class="pnpage">
      <div class="left-corner"></div>
      <div id="prevpage">Anar a la p&agrave;gina anterior:<br /><a href="../../../WebContent/u2/a1/annexos.html">Annexos</a></div>
      <div id="nextpage">Anar a la p&agrave;gina seg&uuml;ent:<br /><a href="../../../WebContent/u2/a2/activitats.html">Activitats</a></div>
      <div class="right-corner"></div>
     </div>
    </div>
    <footer class="footer">
      <div><small>Aquest document està subjecte a una llicència oberta de Creative Commons, es reserva el dret de reconeixement de l'autoria, d'exigir que no se'n faci cap mena d'ús comercial. Si altereu o transformeu aquesta obra, o en genereu obres derivades, només podeu distribuir l'obra generada amb una llicència idèntica a aquesta.</small></div>
    </footer>
 </div>
 <div id="back_preview" class="hidden"></div>
 <div id="preview" class="hidden">
  <div class="prevcontent"></div>
 </div>
 <div id="help-tooltips">
  <div id="help-toc" class="hidden tooltip"><span>Taula de continguts:</span> Ofereix una vista general de l&#39;estructura del m&ograve;dul, que us facilitar&agrave; la navegaci&oacute; a trav&eacute;s dels seus continguts.<span class="arrow-left"></span></div> 
  <div id="help-settings" class="hidden tooltip"><span>Opcions de format:</span> Permet configurar el format de lectura a partir de les vostres prefer&egrave;ncies, modificant la mida de la lletra, el color del fons, l&#39;amplada de la p&agrave;gina o l&#39;ocultaci&oacute; dels continguts complementaris, entre d&#39;altres.<span class="arrow-left"></span></div>
  <div id="help-printer" class="hidden tooltip"><span>Imprimir:</span>  Envia el contingut seleccionat a la impressora.<span class="arrow-left"></span></div>
  <div id="help-favorites" class="hidden tooltip"><span>Prefereits:</span> Permet desar aquelles parts del contingut a les que us interessi accedir en un moment posterior; us permetr&agrave; anar creant un repositori personalitzat de les seccions que considereu m&eacute;s rellevants. Un cop l&#39;hageu començat a fer servir se us mostrar&agrave; a sota un comptador que us informar&agrave; del nombre de preferits que s&#39;hagin emmagatzemat fins al moment.<span class="arrow-left"></span></div>
  <div id="help-favcounter" class="hidden tooltip"><span>Comptador i llistat de preferits:</span> Indica el nombre de preferits que s&#39;han desat fins el moment; clicant damunt seu accedireu al llistat de preferits, i a trav&eacute;s d&#39;aquest podreu accedir directament als continguts que hageu emmagatzemat.<span class="arrow-left"></span></div>
  <div id="help-help_icon" class="hidden tooltip"><span>Ajuda:</span> Aquesta opci&oacute; activa la informaci&oacute; de les funcionalitats del web tot situant el punter del ratol&iacute; al damunt dels diferents &iacute;tems.<span class="arrow-left"></span></div>
  <div id="help-sidebar-hide" class="hidden tooltip"><span>Mostrar/Ocultar barra lateral:</span>  Deshabilita la barra d&#39;opcions, permetent la seva recuperaci&oacute; quan es desitgi.<span class="arrow-left"></span></div>
  <div id="help-search" class="hidden tooltip"><span>Cerca:</span>  Introdu&iuml;u les paraules clau sobre aquells conceptes que desitgeu localitzar en els continguts del m&ograve;dul. Tamb&eacute; podeu excloure un terme de la cerca tot afegint-hi el signe &#8220;-&#8221; al davant.<span class="arrow-top"></span></div>
  <div id="help-header" class="hidden tooltip"><span>Cap&ccedil;alera:</span>  Indica l&#39;apartat o secci&oacute; que es mostra en pantalla. Tingueu present que les capçaleres de segon, tercer i quart nivell tamb&eacute; es poden desar com a marcadors.<span class="arrow-left"></span></div>
</div> 
</body>
</html>
