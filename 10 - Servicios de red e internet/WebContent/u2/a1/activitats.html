<!doctype html>

<!--[if lt IE 7 ]> <html class="ie ie6 no-js" lang="ca"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie ie7 no-js" lang="ca"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie ie8 no-js" lang="ca"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie ie9 no-js" lang="ca"> <![endif]-->
<!--[if gt IE 9]><!--><html class="no-js" lang="ca"><!--<![endif]-->
<!-- the "no-js" class is for Modernizr. -->

<head id="www-sitename-com" data-template-set="html5-reset">

	<meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html">
        
	<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>Serveis de Xarxa i Internet</title>
	
<!-- <meta name="title" content=""> --> 
	<meta name="description" content="">
	<!-- Google will often use this as its description of your page/site. Make it good. -->
	
	<meta name="google-site-verification" content="">
	<!-- Speaking of Google, don't forget to set your site up: http://google.com/webmasters -->
	
	<meta name="author" content="Institut Obert de Catalunya">
	<meta name="Copyright" content="Copyright Institut Obert de Catalunya 2011. All Rights Reserved.">

	<!-- Dublin Core Metadata : http://dublincore.org/ -->
	<meta name="DC.title" content="Serveis de Xarxa i Internet">
	<meta name="DC.subject" content="Informàtica i comunicacions">
	<meta name="DC.creator" content="Institut Obert de Catalunya">
	
	<!--  Mobile Viewport Fix
	j.mp/mobileviewport & davidbcalhoun.com/2010/viewport-metatag 
	device-width : Occupy full width of the screen in its current orientation
	initial-scale = 1.0 retains dimensions instead of zooming out if page height > device height
	maximum-scale = 1.0 retains dimensions instead of zooming in if page width < device width
	-->
	<!-- Uncomment to use � use thoughtfully!
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	-->

	<link rel="shortcut icon" href="../../../img/favicon.ico">
	<!-- This is the traditional favicon.
		 - size: 16x16 or 32x32
		 - transparency is OK
		 - see wikipedia for info on browser support: http://mky.be/favicon/ -->
		 
	<link rel="apple-touch-icon" href="../../../img/apple-touch-icon.png">
	<!-- The is the icon for iOS's Web Clip.
		 - size: 57x57 for older iPhones, 72x72 for iPads, 114x114 for iPhone4's retina display (IMHO, just go ahead and use the biggest one)
		 - To prevent iOS from applying its styles to the icon name it thusly: apple-touch-icon-precomposed.png
		 - Transparency is not recommended (iOS will put a black BG behind the icon) -->
	
	<!-- CSS: screen, mobile & print are all in the same file -->
	<link rel="stylesheet" href="../../../_/css/style.css">

	<!-- CSS: jQuery UI -->
	<link rel="stylesheet" href="../../../_/css/jquery-ui.css">
	
	<!-- all our JS is at the bottom of the page, except for Modernizr. -->
	<script src="../../../_/js/modernizr-1.7.min.js"></script>
	<script src="../../../_/js/Hyphenator.js" type="text/javascript"></script>
	<script type="text/javascript">
	   Hyphenator.config({
		minwordlength : 4
	   });
	   Hyphenator.run();
	</script>
    <script src="../../../_/js/build.js" type="text/javascript"></script>
</head>

<body class="style-newspaper">

<div class="wrapper"><!-- not needed? up to you: http://camendesign.com/code/developpeurs_sans_frontieres -->

	<header id="header">
		<div class="head"><a href="http://ioc.gencat.cat"><img src="../../../img/logo.png" alt="Institut Obert de Catalunya"/></a><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/es/deed.ca"><img src="../../../img/license.png" alt="Llic&egrave;ncia" class="license"/></a></div>
		<div class="headdocument"><a href="../../../index.html">Serveis de Xarxa i Internet</a></div>
        <div id="search" class="search" name="search">
         <form id="frmsearch" action="../../../search.html" method="get">
          <input type="text" name="q"/>
        </form>
        </div>
	</header>
   <div id="upbutton" class="upbutton" style="display:none;"><img src="../../../img/uparrow.png" alt="Pujar a l'inici de p&agrave;gina"/></div>
   <aside id="aside">
    <div id="menu">
      <ul>
       <li name="toc"><div><img src="../../../img/toc.png" alt="&Iacute;ndex"/></div></li>
       <li name="settings"><div><img src="../../../img/settings.png" alt="Configuraci&oacute;"/></div></li>
       <li name="printer"><div><img src="../../../img/printer.png" alt="Imprimir"/></div></li>
       <li name="favorites"><div><img src="../../../img/favorites.png" alt="Favorits"/></div></li>
       <li name="help_icon" class="help_icon"><div><img src="../../../img/help_icon.png" alt="Ajuda"/></div></li>
      </ul>
     </div>
   </aside>
   <div id="sidebar-hide" name="sidebar-hide"><img src="../../../img/arrows.png"/></div>
   <section>
     <div id="toc" class="hidden">
      <div class="menucontent">
        <ul>
        <li id="u2" class="parentnode"><p><a class="unit" href="../../../WebContent/u2/introduccio.html">2. Serveis web i de transferència de fitxers</a></p><ul class="expander"><li id="u2introduccio"><a href="../../../WebContent/u2/introduccio.html">Introducció</a></li><li id="u2resum"><a href="../../../WebContent/u2/resum.html">Resum</a></li><li id="u2resultats"><a href="../../../WebContent/u2/resultats.html">Resultats d'aprenentatge</a></li><li id="u2referencies"><a href="../../../WebContent/u2/referencies.html">Referències</a></li><li id="u2a1" class="tocsection"><p id='u2a1continguts'><a class="section" href="../../../WebContent/u2/a1/continguts.html">Instal·lació i administració de servidors web</a><span class="buttonexp"></span></p><ul><li id="u2a1activitats"><a href="../../../WebContent/u2/a1/activitats.html">Activitats</a></li><li id="u2a1exercicis"><a href="../../../WebContent/u2/a1/exercicis.html">Exercicis</a></li><li id="u2a1annexos"><a href="../../../WebContent/u2/a1/annexos.html">Annexos</a></li></ul></li><div data-parent-id='u2a1' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u2/a1/continguts.html#funcionament_del_servei_web">Funcionament del servei web</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#instal_lacio_i_configuracio_de_servidors_web">Instal·lació i configuració de servidors web</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#moduls_dinamics">Mòduls dinàmics</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#creacio_i_configuracio_de_llocs_web_virtuals">Creació i configuració de llocs web virtuals</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#autenticacio">Autenticació</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#comunicacions_segures">Comunicacions segures</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#monitoratge_del_servei">Monitoratge del servei</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#registres_del_servei">Registres del servei</a></li></ul></div></div><li id="u2a2" class="tocsection"><p id='u2a2continguts'><a class="section" href="../../../WebContent/u2/a2/continguts.html">Instal·lació i administració de serveis de transferència de fitxers</a><span class="buttonexp"></span></p><ul><li id="u2a2activitats"><a href="../../../WebContent/u2/a2/activitats.html">Activitats</a></li><li id="u2a2exercicis"><a href="../../../WebContent/u2/a2/exercicis.html">Exercicis</a></li><li id="u2a2annexos"><a href="../../../WebContent/u2/a2/annexos.html">Annexos</a></li></ul></li><div data-parent-id='u2a2' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u2/a2/continguts.html#servei_de_transferencia_de_fitxers">Servei de transferència de fitxers</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#instal_lacio_i_configuracio_del_servidor">Instal·lació i configuració del servidor</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#creacio_d_usuaris_i_grups">Creació d'usuaris i grups</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#configuracio_de_l_acces_anonim">Configuració de l’accés anònim</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#limitacions_d_acces">Limitacions d’accés</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#modes_d_acces_al_servidor">Modes d'accés al servidor</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#comunicacions_segures">Comunicacions segures</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#clients_grafics_i_de_text">Clients gràfics i de text</a></li></ul></div></div></ul></li><li id="" class="indexnode"><p><a href="../../../index.html">Anar a l&#39;&iacute;ndex general</a></p></li>
        </ul>
      </div>
    </div>
   </section>
   <section>
   <div id="settings" class="hidden">
    <div class="menucontent">
     <div class="allsettings">
     <div class="settings">
      <label>Font i Color</label>
		<div class="setting-option">
	        <ul class="fontBackground">
				<li id="style-newspaper" title="Newspaper" class="appearance-style-newspaper"><span>Newspaper</span></li>
                <li id="style-novel" title="Novel" class="appearance-style-novel"><span>Novel</span></li>
                <li id="style-ebook" title="eBook" class="appearance-style-ebook"><span>eBook</span></li>
				<li id="style-inverse" title="Inverse" class="appearance-style-inverse active"><span>Inverse</span></li>
				<li id="style-athelas" title="Athelas" class="appearance-style-athelas"><span>Athelas</span></li>
			</ul>
		</div>
     </div>
	<div class="settings">
      <label>Amplada</label>
		<div class="setting-option">
	        <div id="slider-width"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
		<div class="setting-option">
	        <div id="slider-font"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
	  <div class="setting-option">
       <form action="" class="sett-options">
		<ul>
		    <li><input type="checkbox" id="secondary-content" /><label for="secondary-content">Mostra recursos complementaris</label></li>
		    <li><input type="checkbox" id="main-images" /><label for="main-images">Mostra imatges</label></li>
		    <li><input type="checkbox" id="text-alignment" /><label for="text-alignment">Text justificat</label></li>
			<li><input type="checkbox" id="text-hyphen" /><label for="text-hyphen">Partici&oacute; sil·l&agrave;bica</label></li>
		</ul>
       </form>
	  </div>
     </div>
     </div>
    </div>
   </div>
   </section>
 <section>
 <div id="favorites" class="hidden"></div>
 </section>   
 <div id="bridge" class="hidden"></div>
 <div id="help" class="hidden">
  <div class="helptitle">Dreceres del teclat<hr></div>
  <div class="helpsection"><span>General</span>
   <ul>
    <li><span class="shortcut">g</span>: Anar al men&uacute; de navegaci&oacute;</li>
    <li><span class="shortcut">o</span>: Anar a opcions</li>
    <li><span class="shortcut">s</span>: Guardar la p&agrave;gina actual a favorits</li>
    <li><span class="shortcut">p</span>: Imprimir la p&agrave;gina actual</li>
    <li><span class="shortcut">?</span>: Mostrar/Ocultar l&#39;ajuda</li>
   </ul>
  </div>
  <div class="helpsection"><span>Navegaci&oacute;</span>
   <ul>
    <li><span class="shortcut">i</span>: Anar a l&#39;&iacute;ndex general</li>
    <li><span class="shortcut">t</span>: Anar a l&#39;inici de p&agrave;gina</li>
    <li><span class="shortcut">b</span>: Anar al final de p&agrave;gina</li>
    <li><span class="shortcut">j</span>: Anar cap endavant dintre la p&agrave;gina</li>
    <li><span class="shortcut">k</span>: Anar cap enrere dintre la p&agrave;gina</li>
    <li><span class="shortcut">h</span>: Anar a la p&agrave;gina anterior:</li>
    <li><span class="shortcut">l</span>: Anar a la p&agrave;gina seg&uuml;ent:</li>
   </ul>
   </div>
 </div>
 <div id="favcounter" name="favcounter" class="hidden"><span></span></div>
 <div id="navmenu" class="navmenu"><ul class="webnav"><li><a href="../../../index.html" title="Anar a l&#39;&iacute;ndex general">Inici</a></li><li><a href="../introduccio.html">Serveis web i de transferència de fitxers</a></li><li><a href="continguts.html">Instal·lació i administració de servidors web</a></li><li>Activitats</li></ul></div>
	<div id="content" lang="ca" class="hyphenate text">
     <article lang="ca" class="sheet">
        <h1><a id="activitats"> Activitats </a></h1>
    	
<h2><a id="el_protocol_http" >El protocol HTTP</a></h2>
<div class="level2">

<p>
L’objectiu d’aquesta activitat és comprendre el funcionament general del protocol HTTP.
</p>
<ol>
<li class="level1"><div class="li"> Llisteu els ports usats pel protocol HTTP del fitxer de llistat de ports d’un sistema Linux (usualment /etc/services).</div>
</li>
<li class="level1"><div class="li"> Useu les ordres de monitoratge del trànsit TCP (<em>nmap</em>, <em>netstat</em>, <em>ss</em> i <em>iptraf</em>, entre d’altres) per observar els ports oberts en el client i el servidor.</div>
</li>
<li class="level1"><div class="li"> Monitoreu el trànsit de xarxa d’una connexió HTTP utilitzant una eina tipus Wireshark. Utilitzeu l’opció <em>follow tcp stream</em> per monitorar la conversa.</div>
</li>
</ol>

<p>
<form action=""><div class="solution ioccontent">
<p>
<strong>1.</strong> Llistat dels ports.
</p>
<ul>
<li class="level1"><div class="li"> Els fitxers del servei. Llistar del fitxer de serveis els ports corresponents al servei http. Usualment, en els sistemes Linux aquest fitxer és el <em>/etc/services</em>. Al llistat podreu observar multitud de ports relacionats amb HTTP. De totes maneres els ports més usuals són el 80 per a http, el 8080 per al servei de proxy i el 423 per a https.</div>
</li>
</ul>
<pre class="code">[root@dhcppc1 ~]# cat /etc/services | grep http
#       http://www.iana.org/assignments/port-numbers
http           80/tcp       www www-http    # WorldWideWeb HTTP
http           80/udp       www www-http    # HyperText Transfer Protocol
https          443/tcp                      # MCom
https          443/udp                      # MCom
webcache       080/tcp                      # WWW caching service
webcache       8080/udp                     # WWW caching service</pre>

<p>
<strong>2.</strong> Ordres de monitoratge.
</p>
<ul>
<li class="level1"><div class="li"> Iptraf. Observar el tràfic TCP d’una connexió HTTP amb <pre class="code">iptrafic</pre>
</div>
</li>
</ul>
<pre class="code">[root@portatil ~]# iptraf 
+++ imatge</pre>

<p>
<div class="imgelem">
<img src="../media/m8u2a1_iptraf.png" alt="" /></div>

</p>
<ul>
<li class="level1"><div class="li"> Utilitat <code>netstat</code></div>
</li>
</ul>
<pre class="code">[root@dhcppc1 ~]# netstat -tnv c
Active Internet connections (w/o servers) 
Proto Recv-Q Send-Q Local Address        Foreign Address         State

Active Internet connections (w/o servers)
Proto Recv-Q Send-Q Local Address        Foreign Address         State

Active Internet connections (w/o servers)
Proto Recv-Q Send-Q  Local Address        Foreign Address         State
tcp        0      0  ::ffff:127.0.0.1:80  ::ffff:127.0.0.1:42326  TIME_WAIT
tcp        0      0  ::ffff:127.0.0.1:80  ::ffff:127.0.0.1:42327  TIME_WAIT </pre>

<p>
Com es pot observar del llistat anterior, el client ha fet una connexió des del seu port dinàmic 42327 al port 80 del servidor. Les opcions de 
</p>
<pre class="code">netstat -tnvc</pre>

<p>
 serveixen per indicar que monitoritzi únicament connexions tcp, mostri el número de port i s’executi contínuament per tal de monitoritzar el tràfic. 
</p>
<ul>
<li class="level1"><div class="li"> Utilitat <code>ss</code>. Podem llistar els ports amb l’ordre <pre class="code">ss</pre>

<p>
.
</p>
</div>
</li>
</ul>
<pre class="code">[root@dhcppc1 ~]# ss -nta
State     Recv-Q Send-Q      Local Address:Port      Peer Address:Port
LISTEN         0      0      127.0.0.1:8000                        *:*
LISTEN         0      0      127.0.0.1:2208                        *:*
LISTEN         0      0               *:111                        *:*
LISTEN         0      0             *:43288                        *:*
LISTEN         0      0      127.0.0.1:2207                        *:*
TIME-WAIT      0      0     127.0.0.1:51479               127.0.0.1:80</pre>

<p>
Fixeu-vos que les connexions al port 80 apareixen com a <code>TIME-WAIT</code>, que ja s’han realitzat. Per fer aparèixer la connexió com a <code>ESTABLISHED</code> caldria atrapar just el moment de la petició/resposta entre client i servidor. Recordeu que un cop feta la resposta el servidor usualment tanca la connexió. 
</p>
<ul>
<li class="level1"><div class="li"> Utilitat <code>nmap</code>. Podem llistar l’estat del port on escolta el servidor <em>httpd</em>: </div>
</li>
</ul>
<pre class="code">[root@dhcppc1 ~]# nmap localhost 
Starting Nmap 4.20 ( http://insecure.org ) at 2008-06-07 14:50 CEST
Interesting ports on localhost (127.0.0.1): 

Not shown: 1692 closed ports

PORT     STATE SERVICE
22/tcp   open  ssh
80/tcp   open  http
111/tcp  open  rpcbind
443/tcp  open  https
8000/tcp open http-alt

Nmap finished: 1 IP address (1 host up) scanned in 0.116 seconds </pre>

<p>
<strong>3.</strong> Monitorar el trànsit HTTP amb Wireshark.
</p>

<p>
Si s’utilitza Wireshark per monitorar el trànsit d’una connexió HTTP es poden observar els ports del client (dinàmic) i del servidor (80), el tipus de tràfic TCP, la connexió TCP de tres vies, la petició GET del client i la resposta del servidor. Podeu obtenir una captura del Wireshark del fitxer següent:
</p>

<p>
<div class="mediaf filezip"><div class="mediacontent"><a href="../media/m8u2a1_dialeg_http_localhost.cap.zip">m8u2a1_dialeg_http_localhost.cap</a><span> ( 1.5 KB )</span></div></div>
</p>

<p>
<div class="imgelem">
<img src="../media/m8u2a1_http_localhost_dialeg1.png" alt="" /></div>

</p>

<p>
Si se selecciona algun dels elements de la conversa TCP i s’activa l’opció contextual <em>Follow TCP stream</em> es pot veure tot el diàleg TCP en text pla: 
</p>

<p>
<div class="imgelem">
<img src="../media/m8u2a1_http_localhost_dialeg2.png" alt="" /></div>

</p>

<p>
Podeu consultar també altra documentació d’instal·lació, com per exemple:
</p>

<p>
<a href="https://sites.google.com/site/asxm08edt" class="urlextern" title="https://sites.google.com/site/asxm08edt"  rel="nofollow">M08-SXI Serveis de xarxa i internet</a>
</p>

<p>
<a href="http://tldp.org" class="urlextern" title="http://tldp.org"  rel="nofollow">The Linux Documentation Project</a>
</p>

<p>
<a href="http://www.ietf.org" class="urlextern" title="http://www.ietf.org"  rel="nofollow">Internet Engineering Task Force</a>
</p>

<p>
<a href="http://www.apache.org" class="urlextern" title="http://www.apache.org"  rel="nofollow">Apache</a>
</p>
</div><input class="btn_solution3" type="button" value="Mostra"></input></form>
</p>

</div>

<h2><a id="instal_lacio_i_configuracio_del_servidor_http_apache_en_el_sistema_operatiu_linux" >Instal·lació i configuració del servidor HTTP Apache en el sistema operatiu Linux</a></h2>
<div class="level2">

<p>
L’objectiu d’aquesta activitat és aprendre a instal·lar i configurar un servidor HTTP en un sistema operatiu Linux Debian amb el programari <strong>Apache</strong>.
</p>
<ol>
<li class="level1"><div class="li"> Instal·leu el servidor HTTP Apache. </div>
</li>
<li class="level1"><div class="li"> Descriviu els components que el formen: fitxers executables, fitxers de configuració, de documentació i de monitoratge.</div>
</li>
<li class="level1"><div class="li"> Comproveu l’estat del servei HTTP, activeu-lo i desactiveu-lo.</div>
</li>
<li class="level1"><div class="li"> Monitoreu les activitats realitzades pel servidor Apache mitjançant el registre de <em>logs</em> del sistema. Identifiqueu el PID del procés del servidor.</div>
</li>
<li class="level1"><div class="li"> Configureu la pàgina web principal amb un exemple.</div>
</li>
<li class="level1"><div class="li"> Comproveu el funcionament del servidor amb la comanda telnet i obtingeu la pàgina web principal.</div>
</li>
</ol>

<p>
<form action=""><div class="solution ioccontent">
<p>
<strong>1. Instal·lació del servidor HTTP Apache</strong>
</p>

<p>
Instal·lem el servidor amb la comanda <em>apt-get</em>:
</p>
<pre class="code">root@server:~# apt install apache2
S&#039;està llegint la llista de paquets… Fet 
S&#039;està construint l&#039;arbre de dependències       
S&#039;està llegint la informació de l&#039;estat… Fet
El paquets següents s&#039;han instal·lat automàticament i ja no serà necessaris:
  python-dbus python-gi python-wicd rfkill wicd-daemon wicd-gtk wireless-tools
Empreu «apt autoremove» per a suprimir-los.
S&#039;instal·laran els següents paquets extres:
  apache2-bin apache2-data apache2-utils libapr1 libaprutil1 libaprutil1-dbd-sqlite3 libaprutil1-ldap
Paquets suggerits:
  apache2-doc apache2-suexec-pristine | apache2-suexec-custom
S&#039;instal·laran els paquets NOUS següents:
  apache2 apache2-bin apache2-data apache2-utils libapr1 libaprutil1 libaprutil1-dbd-sqlite3 libaprutil1-ldap
0 actualitzats, 8 nous a instal·lar, 0 a suprimir i 164 no actualitzats.
S&#039;ha d&#039;obtenir 2189 kB d&#039;arxius.
Després d&#039;aquesta operació s&#039;empraran 7567 kB d&#039;espai en disc addicional.
Voleu continuar? [S/n]</pre>

<p>
Podem obtenir una informació detallada del programari Apache instal·lat (versió, arquitectura, dependències, etc.) amb la comanda <em>dpkg</em>:
</p>
<pre class="code">root@server:~# dpkg -s apache2
Package: apache2
Status: install ok installed
Priority: optional
Section: httpd
Installed-Size: 599
Maintainer: Debian Apache Maintainers &lt;debian-apache@lists.debian.org&gt;
Architecture: amd64
Version: 2.4.38-3+deb10u3
Replaces: apache2.2-bin, apache2.2-common, libapache2-mod-proxy-uwsgi (&lt;&lt; 2.4.33)
Provides: httpd, httpd-cgi
Depends: apache2-bin (= 2.4.38-3+deb10u3), apache2-data (= 2.4.38-3+deb10u3), apache2-utils (= 2.4.38-3+deb10u3), lsb-base, mime-support, perl:any, procps
Pre-Depends: dpkg (&gt;= 1.17.14)
Recommends: ssl-cert
Suggests: apache2-doc, apache2-suexec-pristine | apache2-suexec-custom, www-browser
Breaks: libapache2-mod-proxy-uwsgi (&lt;&lt; 2.4.33)
Conflicts: apache2.2-bin, apache2.2-common
Conffiles:
 /etc/apache2/apache2.conf 20589b50379161ebc8cb35f761af2646
...</pre>

<p>
<strong>2. Components</strong>
</p>

<p>
Podem classificar els components en 3 categories:
</p>
<ol>
<li class="level1"><div class="li"> Fitxers executables</div>
</li>
<li class="level1"><div class="li"> Fitxers de configuració </div>
</li>
<li class="level1"><div class="li"> Fitxers de documentació</div>
</li>
</ol>

<p>
A través del paquet de la instal·lació podem observar quins són els fitxers executables, de configuració i de documentació, simplement aplicant algun filtre: 
</p>
<ul>
<li class="level1"><div class="li"> Executables:</div>
</li>
</ul>
<pre class="code">root@server:~# dpkg -L apache2 | grep bin/
/usr/sbin/a2enmod
/usr/sbin/a2query
/usr/sbin/apache2ctl
/usr/sbin/a2disconf
/usr/sbin/a2dismod
/usr/sbin/a2dissite
/usr/sbin/a2enconf
/usr/sbin/a2ensite
/usr/sbin/apachectl
root@server:~# </pre>

<p>
Podem incloure també els scripts:
</p>
<pre class="code">root@server:~# dpkg -L apache2 | grep init.d/
/etc/init.d/apache-htcacheclean
/etc/init.d/apache2
root@server:~#</pre>
<ul>
<li class="level1"><div class="li"> Configuració:</div>
</li>
</ul>
<pre class="code">root@server:~# dpkg -L apache2 | grep etc/apache2 
/etc/apache2
/etc/apache2/apache2.conf
/etc/apache2/conf-available
/etc/apache2/conf-available/charset.conf
/etc/apache2/conf-available/localized-error-pages.conf
/etc/apache2/conf-available/other-vhosts-access-log.conf
/etc/apache2/conf-available/security.conf
/etc/apache2/conf-available/serve-cgi-bin.conf
/etc/apache2/conf-enabled
/etc/apache2/envvars
/etc/apache2/magic
/etc/apache2/mods-available
/etc/apache2/mods-available/access_compat.load
/etc/apache2/mods-available/actions.conf
/etc/apache2/mods-available/actions.load
/etc/apache2/mods-available/alias.conf
...</pre>
<ul>
<li class="level1"><div class="li"> Documentació:</div>
</li>
</ul>
<pre class="code">root@server:~# dpkg -L apache2 | grep share/
/usr/share/apache2
/usr/share/apache2/apache2-maintscript-helper
/usr/share/apache2/ask-for-passphrase
/usr/share/bash-completion
/usr/share/bash-completion/completions
/usr/share/bash-completion/completions/a2enmod
/usr/share/bug
/usr/share/bug/apache2
/usr/share/doc
/usr/share/doc/apache2
/usr/share/doc/apache2/NEWS.Debian.gz
/usr/share/doc/apache2/PACKAGING.gz
/usr/share/doc/apache2/README.Debian.gz
/usr/share/doc/apache2/README.backtrace
/usr/share/doc/apache2/README.multiple-instances
/usr/share/doc/apache2/changelog.Debian.gz
/usr/share/doc/apache2/changelog.gz
/usr/share/doc/apache2/copyright
/usr/share/doc/apache2/examples
/usr/share/doc/apache2/examples/apache2.monit
/usr/share/doc/apache2/examples/secondary-init-script
/usr/share/doc/apache2/examples/setup-instance
...</pre>

<p>
Els directoris importants de la instal·lació són:
</p>
<ul>
<li class="level1"><div class="li"> Directori dels fitxers de configuració: <code>/etc/apache2/</code>.</div>
</li>
<li class="level1"><div class="li"> Directori de publicació de les pàgines web: <code>/var/www/html/</code>.</div>
</li>
<li class="level1"><div class="li"> Directori del registre de <em>logs</em>: <code>/var/log/apache2/</code>.</div>
</li>
</ul>

<p>
<strong>3. Estat del servei</strong>
</p>

<p>
Per saber l’estat del servei i quines opcions tenim:
</p>
<pre class="code">root@server:~# /etc/init.d/apache2
Usage: apache2 {start|stop|graceful-stop|restart|reload|force-reload}
root@server:~# </pre>

<p>
Les accions més bàsiques que es poden fer són:
</p>
<ul>
<li class="level1"><div class="li"> start: inicia el servei.</div>
</li>
<li class="level1"><div class="li"> stop: atura el servei.</div>
</li>
<li class="level1"><div class="li"> reload: recarrega els fitxers de configuració.</div>
</li>
<li class="level1"><div class="li"> restart: reinicia el servei.</div>
</li>
<li class="level1"><div class="li"> status: mostra l’estat del servei.</div>
</li>
</ul>

<p>
Per al correcte funcionament del servidor hem de comprovar que el servei està actiu i executant-se (<em>running</em>):
</p>
<pre class="code">root@server:~# /etc/init.d/apache2 status
● apache2.service - The Apache HTTP Server
   Loaded: loaded (/lib/systemd/system/apache2.service; enabled; vendor preset: enabled)
   Active: active (running) since Mon 2020-09-07 21:29:24 CEST; 14min ago
     Docs: https://httpd.apache.org/docs/2.4/
 Main PID: 2349 (apache2)
    Tasks: 55 (limit: 1138)
   Memory: 8.8M
   CGroup: /system.slice/apache2.service
           ├─2349 /usr/sbin/apache2 -k start
           ├─2351 /usr/sbin/apache2 -k start
           └─2352 /usr/sbin/apache2 -k start

de set. 07 21:29:24 server.ioc.cat systemd[1]: Starting The Apache HTTP Server...
de set. 07 21:29:24 server.ioc.cat apachectl[2338]: AH00558: apache2: Could not reliably determine the server&#039;s fully qu…message
de set. 07 21:29:24 server.ioc.cat systemd[1]: Started The Apache HTTP Server.
Hint: Some lines were ellipsized, use -l to show in full.
root@server:~# </pre>

<p>
<strong>4. Monitorització</strong>
</p>

<p>
Els fitxers de monitorització dels serveis bàsics es troben usualment en el directori <code>/var/log</code>. Algun programari, com és el cas, opta per crear una carpeta dins d’aquesta estructura i així, els fitxers de log estan a <code>/var/log/apache2</code>.
</p>
<pre class="code">root@server:~# ls /var/log/apache2
access.log  error.log  other_vhosts_access.log
root@server:~#</pre>

<p>
El servidor Apache manté diversos fils (<em>threads</em>) per poder atendre millor a les diferents peticions de pàgines web de forma independent. Hi ha un procés principal, que s’especifica quan comprovem l’estat del servei. Per poder veure la resta de processos associats i l’usuari que els executa:
</p>
<pre class="code">root@server:~# ps uax | grep apache2
root      2349  0.0  0.4   8428  4328 ?        Ss   21:29   0:00 /usr/sbin/apache2 -k start
www-data  2351  0.0  0.6 754604  6080 ?        Sl   21:29   0:00 /usr/sbin/apache2 -k start
www-data  2352  0.0  0.6 754604  6080 ?        Sl   21:29   0:00 /usr/sbin/apache2 -k start
root      3128  0.0  0.0   6092   892 pts/0    S+   21:54   0:00 grep apache2
root@server:~#</pre>

<p>
Si es vol veure el nombre complet de processos associats al servei i en forma d’arbre (dependència entre ells), es pot fer amb la comanda <em>pstree</em>:
</p>
<pre class="code">root@server:~# pstree -p | grep apache2
           |-apache2(2349)-+-apache2(2351)-+-{apache2}(2382)
           |               |               |-{apache2}(2383)
           |               |               |-{apache2}(2384)
           |               |               |-{apache2}(2385)
           |               |               |-{apache2}(2386)
           |               |               |-{apache2}(2387)
           |               |               |-{apache2}(2388)
...  </pre>

<p>
<strong>5. Configuració de la pàgina web principal</strong>
</p>

<p>
Per tal de configurar la pàgina principal del servidor Apache cal crea un fitxer anomenat index.html (de fet, ja existeix un per defecte) a la carpeta <code>/var/www/html/</code>. Per exemple amb el següent codi <acronym title="HyperText Markup Language">HTML</acronym>:
</p>
<pre class="code">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Pàgina principal&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Pàgina principal&lt;/h1&gt;
        &lt;p&gt;Servidor Apache&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre>

<p>
La pàgina web principal es pot comprovar fàcilment amb un navegador des del mateix servidor introduint-li la següent <acronym title="Uniform Resource Locator">URL</acronym>:
</p>
<pre class="code">http://localhost</pre>

<p>
<strong>6. Comprovació del funcionament del servidor amb la comanda telnet</strong>
</p>

<p>
Amb la petició GET es pot observar com s’obté la pàgina demanada.
</p>
<pre class="code">root@server:~# telnet localhost 80
Trying 127.0.0.1...
Connected to localhost.
Escape character is &#039;^]&#039;.
GET /index.html HTTP/1.0

HTTP/1.1 200 OK
Date: Tue, 08 Sep 2020 04:48:29 GMT
Server: Apache/2.4.38 (Debian)
Last-Modified: Mon, 07 Sep 2020 20:01:44 GMT
ETag: &quot;a8-5aebeb015df61&quot;
Accept-Ranges: bytes
Content-Length: 168
Vary: Accept-Encoding
Connection: close
Content-Type: text/html

&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Pàgina principal&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Pàgina principal&lt;/h1&gt;
        &lt;p&gt;Servidor Apache&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;
Connection closed by foreign host.
root@server:~# </pre>
</div><input class="btn_solution3" type="button" value="Mostra"></input></form>
</p>

</div>

<h2><a id="configuracio_d_una_seu_virtual_basada_en_noms_amb_apache" >Configuració d&#039;una seu virtual basada en noms amb Apache</a></h2>
<div class="level2">

<p>
L’objectiu d’aquesta activitat és aprendre a configurar una seu virtual basada en noms amb Apache.
</p>

<p>
Creeu tres seus virtuals per a un mateix domini amb diferent TLD, que proporcionin el mateix lloc web però en diferents idiomes:
</p>
<ol>
<li class="level1"><div class="li"> .cat: en català</div>
</li>
<li class="level1"><div class="li"> .es: en castellà</div>
</li>
<li class="level1"><div class="li"> .com: en anglès</div>
</li>
</ol>

<p>
<form action=""><div class="solution ioccontent">
<p>
Primer de tot, en no disposar del servei <acronym title="Domain Name System">DNS</acronym> executant-se, cal modificar primer el fitxer <code>/etc/hosts</code> i afegir la línia:
</p>
<pre class="code">172.16.0.1      www.ioc.cat www.ioc.es www.ioc.com</pre>

<p>
Per a cada seu virtual cal crear un fitxer de configuració per a cada un. En aquest cas són:
</p>
<ol>
<li class="level1"><div class="li"> /etc/apache2/sites-available/ioc-cat.conf</div>
</li>
<li class="level1"><div class="li"> /etc/apache2/sites-available/ioc-es.conf</div>
</li>
<li class="level1"><div class="li"> /etc/apache2/sites-available/ioc-en.conf</div>
</li>
</ol>

<p>
I el contingut de cada fitxer és:
</p>
<ul>
<li class="level1"><div class="li"> /etc/apache2/sites-available/ioc-cat.conf</div>
</li>
</ul>
<pre class="code">&lt;VirtualHost *:80&gt;
    ServerName www.ioc.cat
    DocumentRoot /var/www/html/cat
&lt;/VirtualHost&gt;</pre>
<ul>
<li class="level1"><div class="li"> /etc/apache2/sites-available/ioc-es.conf</div>
</li>
</ul>
<pre class="code">&lt;VirtualHost *:80&gt;
    ServerName www.ioc.es
    DocumentRoot /var/www/html/es
&lt;/VirtualHost&gt;</pre>
<ul>
<li class="level1"><div class="li"> /etc/apache2/sites-available/ioc-en.conf</div>
</li>
</ul>
<pre class="code">&lt;VirtualHost *:80&gt;
    ServerName www.ioc.com
    DocumentRoot /var/www/html/en
&lt;/VirtualHost&gt;</pre>

<p>
Les pàgines web principals de cada seu virtual són:
</p>
<ol>
<li class="level1"><div class="li"> /var/www/html/cat/index.html</div>
</li>
<li class="level1"><div class="li"> /var/www/html/es/index.html</div>
</li>
<li class="level1"><div class="li"> /var/www/html/en/index.html</div>
</li>
</ol>

<p>
Cal habilitar els llocs virtuals amb la comanda <em>a2ensite</em> i reiniciar el servidor. 
</p>
<pre class="code">a2ensite ioc-cat
a2ensite ioc-es
a2ensite ioc-en
/etc/init.d/apache2 restart</pre>

<p>
La comanda <em>a2ensite</em> el que fa és afegir un enllaç simbòlic des de la carpeta <code>/etc/apache2/sites-enabled</code> al fitxer en qüestió (que es troba a <code>/etc/apache2/sites-available</code>). D’aquesta manera es pot tenir una multitud de seus virtuals, però només activades aquelles desitjades. La comanda per deshabilitar un lloc virtual és <em>a2dissite</em> i el que fa bàsicament és eliminar aquest enllaç simbòlic.
</p>

<p>
Amb aquset sistema es controlen les seus virtuals per separat, i en el cas de voler modificar alguna, per exemple, només es deshabilita aquella seu (i la resta continuarien operatives).
</p>

<p>
<strong>Referències</strong>
</p>

<p>
<a href="https://httpd.apache.org/docs/2.4/vhosts" class="urlextern" title="https://httpd.apache.org/docs/2.4/vhosts"  rel="nofollow">Apache Virtual Host documentation</a>
</p>
</div><input class="btn_solution3" type="button" value="Mostra"></input></form>
</p>

</div>

<h2><a id="configuracio_d_una_seu_virtual_basada_en_ip_amb_apache" >Configuració d&#039;una seu virtual basada en IP amb Apache</a></h2>
<div class="level2">

<p>
L’objectiu d’aquesta activitat és aprendre a configurar una seu virtual basada en IP amb Apache.
</p>

<p>
Creeu 2 noves IP, cadascuna d’elles lligada a una seu virtual diferent. Opcionalment li podeu assignar un nom de domini.
</p>

<p>
<form action=""><div class="solution ioccontent">
<p>
Afegim les noves IP a la que ja teníem:
</p>
<pre class="code">root@server:~# ip address add 10.0.2.11/24 dev enp0s3
root@server:~# ip address add 10.0.2.12/24 dev enp0s3
root@server:~# ip address show enp0s3
2: enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000
    link/ether 08:00:27:5f:62:59 brd ff:ff:ff:ff:ff:ff
    inet 10.0.2.9/24 brd 10.0.2.255 scope global dynamic enp0s3
       valid_lft 71645sec preferred_lft 71645sec
    inet 10.0.2.11/24 scope global secondary enp0s3
       valid_lft forever preferred_lft forever
    inet 10.0.2.12/24 scope global secondary enp0s3
       valid_lft forever preferred_lft forever
    inet6 fe80::a00:27ff:fe5f:6259/64 scope link 
       valid_lft forever preferred_lft forever
root@server:~# </pre>

<p>
En no disposar del servei <acronym title="Domain Name System">DNS</acronym> executant-se, cal modificar el fitxer <code>/etc/hosts</code> per tal que tingui el següent aspecte:
</p>
<pre class="code">root@server:~# echo &quot;127.0.0.1        localhost&quot; &gt; /etc/hosts
root@server:~# echo &quot;10.0.2.11        www1.ioc.cat&quot; &gt;&gt; /etc/hosts
root@server:~# echo &quot;10.0.2.12        www2.ioc.cat&quot; &gt;&gt; /etc/hosts
root@server:~# cat /etc/hosts
127.0.0.1        localhost
10.0.2.11        www1.ioc.cat
10.0.2.12        www2.ioc.cat
root@server:~#</pre>

<p>
Creem l’estructura de directoris per a les nostres seus virtuals:
</p>
<pre class="code">mkdir /var/www/web1
mkdir /var/www/web2</pre>

<p>
Creem el fitxer <code>/var/www/web1/index.html</code> corresponent a la 1a seu virtual amb el següent codi <acronym title="HyperText Markup Language">HTML</acronym>:
</p>
<pre class="code">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Seu virtual basada en IP1&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Seu virtual basada en IP1&lt;/h1&gt;
        &lt;p&gt;MP08. Serveis de xarxa i Internet&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre>

<p>
Creem el fitxer <code>/var/www/web2/index.html</code> corresponent a la segona seu virtual amb el següent codi <acronym title="HyperText Markup Language">HTML</acronym>:
</p>
<pre class="code">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Seu virtual basada en IP1&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Seu virtual basada en IP1&lt;/h1&gt;
        &lt;p&gt;MP08. Serveis de xarxa i Internet&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre>

<p>
Afegim al final del fitxer <code>/etc/apache2/apache2.conf</code> la configuració per a les seus virtuals:
</p>
<pre class="code">&lt;VirtualHost 10.0.2.11:*&gt;
    DocumentRoot /var/www/web1
    ServerName www1.ioc.cat
&lt;/VirtualHost&gt;
&lt;VirtualHost 10.0.2.12:*&gt;
    DocumentRoot /var/www/web2
    ServerName www2.ioc.cat
&lt;/VirtualHost&gt;</pre>

<p>
Reiniciem i comprovem que ha arrancat bé:
</p>
<pre class="code">root@server:~# systemctl restart apache2
root@server:~# systemctl status apache2
● apache2.service - The Apache HTTP Server
   Loaded: loaded (/lib/systemd/system/apache2.service; enabled; vendor preset: enabled)
   Active: active (running) since Tue 2020-09-08 10:22:42 CEST; 8s ago
     Docs: https://httpd.apache.org/docs/2.4/
  Process: 6364 ExecStart=/usr/sbin/apachectl start (code=exited, status=0/SUCCESS)
 Main PID: 6368 (apache2)
    Tasks: 55 (limit: 1138)
   Memory: 9.4M
   CGroup: /system.slice/apache2.service
           ├─6368 /usr/sbin/apache2 -k start
           ├─6369 /usr/sbin/apache2 -k start
           └─6370 /usr/sbin/apache2 -k start

de set. 08 10:22:42 server.ioc.cat systemd[1]: Starting The Apache HTTP Server...
de set. 08 10:22:42 server.ioc.cat apachectl[6364]: AH00557: apache2: apr_sockaddr_info_get() failed for server.ioc.cat
de set. 08 10:22:42 server.ioc.cat apachectl[6364]: AH00558: apache2: Could not reliably determine the server&#039;s fully qualified 
de set. 08 10:22:42 server.ioc.cat systemd[1]: Started The Apache HTTP Server.</pre>

<p>
Llistem les seus web virtuals del servidor. Podem veure com a l’apartat <em>VirtualHost configuration</em> es veuen les diferents seus virtuals del servidor:
</p>
<pre class="code">root@server:~# source /etc/apache2/envvars
root@server:/root# /sbin/apache2 -S
AH00557: apache2: apr_sockaddr_info_get() failed for server.ioc.cat
AH00558: apache2: Could not reliably determine the server&#039;s fully qualified domain name, using 127.0.0.1. Set the &#039;ServerName&#039; directive globally to suppress this message
VirtualHost configuration:
10.0.2.11:*          www1.ioc.cat (/etc/apache2/apache2.conf:229)
10.0.2.12:*          www2.ioc.cat (/etc/apache2/apache2.conf:233)
*:80                   127.0.0.1 (/etc/apache2/sites-enabled/000-default.conf:1)
ServerRoot: &quot;/etc/apache2&quot;
Main DocumentRoot: &quot;/var/www/html&quot;
Main ErrorLog: &quot;/var/log/apache2/error.log&quot;
Mutex ldap-cache: using_defaults
Mutex default: dir=&quot;/var/run/apache2/&quot; mechanism=default 
Mutex watchdog-callback: using_defaults
PidFile: &quot;/var/run/apache2/apache2.pid&quot;
Define: DUMP_VHOSTS
Define: DUMP_RUN_CFG
User: name=&quot;www-data&quot; id=33
Group: name=&quot;www-data&quot; id=33
root@server:/root# </pre>

<p>
Comprovem que funcionen amb un navegador:
</p>

<p>
<div class="imgelem">
<img src="../media/apache-ipbased.png" alt="" /></div>

</p>
</div><input class="btn_solution3" type="button" value="Mostra"></input></form>
</p>

</div>

<h2><a id="autenticacio_amb_apache" >Autenticació amb Apache</a></h2>
<div class="level2">

<p>
L’objectiu d’aquesta activitat és compendre els diferents mètodes que proporciona Apache per autenticar-se al servidor i poder accedir a recursos privats.
</p>

<p>
Protegiu una carpeta al servidor web per tal que només es pugui accedir amb els següents mètodes d’autenticació:
</p>
<ol>
<li class="level1"><div class="li"> Autenticació bàsica</div>
</li>
<li class="level1"><div class="li"> Autenticació mitjançant PAM</div>
</li>
<li class="level1"><div class="li"> Autenticació amb LDAP</div>
</li>
</ol>

<p>
<form action=""><div class="solution ioccontent">
<p>
<strong>1. Autenticació bàsica</strong>
</p>

<p>
Creem l’usuari amb el qual entrarem al directori protegit: 
</p>
<pre class="code">htpasswd -c /var/www/passwd usuari </pre>

<p>
Creem la carpeta privada i afegim un fitxer:
</p>
<pre class="code">mkdir /var/www/html/privat
touch /var/www/html/privat/arxiu.txt</pre>

<p>
Afegim el següent codi al fitxer /etc/apache2/sites-available/000-default.conf: 
</p>
<pre class="code">&lt;VirtualHost *:80&gt;
    ServerAdmin webmaster@localhost
    DocumentRoot /var/www/html
    ErrorLog ${APACHE_LOG_DIR}/error.log
    CustomLog ${APACHE_LOG_DIR}/access.log combined

    &lt;Directory /var/www/html/privat&gt;
        AuthType Basic
        AuthName &quot;Fitxers restringits&quot;
        AuthBasicProvider file
        AuthUserFile /var/www/passwd
        Require valid-user
    &lt;/Directory&gt;
&lt;/VirtualHost&gt;</pre>

<p>
I reiniciem el servidor: 
</p>
<pre class="code">/etc/init.d/apache2 restart</pre>

<p>
Visualitzem-ho des del navegador:
</p>

<p>
<div class="imgelem">
<img src="../media/apache-auth1.png" alt="" /></div>

</p>

<p>
Vegem com queda un cop entrat l’usuari i la contrasenya:
</p>

<p>
<div class="imgelem">
<img src="../media/apache-auth2.png" alt="" /></div>

</p>

<p>
<strong>2. Autenticació mitjançant PAM</strong>
</p>

<p>
Instal·lem els paquets necessaris: 
</p>
<pre class="code">apt-get install libapache2-mod-authnz-external pwauth</pre>

<p>
Creem la carpeta privada i afegim un fitxer:
</p>
<pre class="code">mkdir /var/www/html/privatPAM
touch /var/www/html/privatPAM/arxiu.txt</pre>

<p>
Creem el <em>host</em> virtual privatPAM a /etc/apache2/sites-available/privatPAM.conf:
</p>
<pre class="code">&lt;IfModule mod_authnz_external.c&gt;
	AddExternalAuth pwauth /usr/sbin/pwauth 
	SetExternalAuthMethod pwauth pipe 
&lt;/IfModule&gt;
&lt;Directory /var/www/html/privatPAM&gt; 
	AuthType Basic 
	AuthName &quot;Fitxers restringits PAM&quot; 
	AuthBasicProvider external 
	AuthExternal pwauth 
	Require valid-user 
&lt;/Directory&gt; </pre>

<p>
Habilitem el lloc perquè funcioni amb PAM i reiniciem el servidor:
</p>
<pre class="code">a2ensite privatPAM
/etc/init.d/apache2 restart</pre>

<p>
Comprovem-ho, visualitzant-ho des del navegador:
</p>

<p>
<div class="imgelem">
<img src="../media/apache-pam1.png" alt="" /></div>

</p>

<p>
Vegem com queda un cop entrat l’usuari i la contrasenya:
</p>

<p>
<div class="imgelem">
<img src="../media/apache-pam2.png" alt="" /></div>

</p>

<p>
<strong>3. Autenticació amb LDAP</strong>
</p>

<p>
Instal·lem openLDAP:
</p>
<pre class="code">apt-get install slapd ldap-utils</pre>

<p>
Reconfigurem openLDAP amb les opcions següents:
</p>
<ul>
<li class="level1"><div class="li"> Nom del domini: ioc.cat</div>
</li>
<li class="level1"><div class="li"> Nom de la organització: ioc</div>
</li>
<li class="level1"><div class="li"> Contrasenya de l’administrador</div>
</li>
<li class="level1"><div class="li"> Motor de la base de dades: MDB</div>
</li>
<li class="level1"><div class="li"> Eliminació de la base de dades al purgar: NO</div>
</li>
<li class="level1"><div class="li"> Moure la base de dades anterior: SÍ</div>
</li>
<li class="level1"><div class="li"> Permetre LDAP v2: NO</div>
</li>
</ul>
<pre class="code">dpkg-reconfigure slapd</pre>

<p>
Creem el grup usuaris ouUsuaris.ldif:
</p>
<pre class="code"># Unitat organitzativa usuaris
dn: ou=usuaris,dc=ioc,dc=cat
objectClass: organizationalUnit
ou: usuaris</pre>

<p>
L’afegim amb <em>ldapadd</em>:
</p>
<pre class="code">ldapadd -x -D cn=admin,dc=ioc,dc=cat -W -f ouUsuaris.ldif</pre>

<p>
Creem l’usuari usuariLDAP en el fitxer usuariLDAP.ldif:
</p>
<pre class="code">dn: uid=usuariLDAP,ou=usuaris,dc=ioc,dc=cat
objectClass: inetOrgPerson
objectClass: posixAccount
objectClass: shadowAccount
uid: usuariLDAP
sn: Cognom LDAP
givenName: Nom
cn: Nom Cognom LDAP
displayName: Nom Cognom LDAP
uidNumber: 10001
gidNumber: 5001
userPassword: usuariLDAP
gecos: Nom Cognom LDAP
loginShell: /bin/bash
homeDirectory: /home/usuari</pre>

<p>
i l’afegim
</p>
<pre class="code">ldapadd -x -D cn=admin,dc=ioc,dc=cat -W -f usuariLDAP.ldif</pre>

<p>
Realitzem una cerca sobre LDAP per comprovar que s’ha creat bé amb <em>ldapsearch</em>:
</p>
<pre class="code">ldapsearch -x -LLL -b dc=ioc,dc=cat &#039;uid=usuariLDAP&#039; cn gidNumber</pre>

<p>
Habilitem el mòdul per a l’autenticació LDAP amb <em>a2enmod</em>:
</p>
<pre class="code">root@server:~# /sbin/a2enmod ldap authnz_ldap 
Enabling module ldap.
Considering dependency ldap for authnz_ldap:
Module ldap already enabled
Enabling module authnz_ldap.
To activate the new configuration, you need to run:
  systemctl restart apache2
root@server:~# </pre>

<p>
Creem el lloc virtual privatLDAP amb el fitxer /etc/apache2/sites-available/privatLDAP.conf:
</p>
<pre class="code">&lt;Directory /var/www/html/privatLDAP&gt;
    AuthName &quot;Autenticació LDAP&quot;
    AuthType Basic
    AuthBasicProvider ldap
    AuthLDAPURL ldap://www.ioc.cat/dc=ioc,dc=cat?uid?sub?(objectClass=*)
	Require valid-user
	LogLevel debug
&lt;/Directory&gt;</pre>

<p>
Creem la carpeta i habilitem el lloc web virtual.
</p>
<pre class="code">mkdir /var/www/html/privatLDAP 
/sbin/a2ensite privatLDAP 
/etc/init.d/apache2 restart</pre>

<p>
Creem la pàgina web al fitxer /var/www/html/privatLDAP/index.html:
</p>
<pre class="code">&lt;html&gt;
&lt;body&gt;
    Carpeta privada LDAP
&lt;/body&gt;
&lt;/html&gt;</pre>

<p>
Realitzem la comprovació amb el navegador:
</p>

<p>
<div class="imgelem">
<img src="../media/apache-ldap1.png" alt="" /></div>

</p>

<p>
Un cop autenticats correctament, podem accedir a la pàgina web privada:
</p>

<p>
<div class="imgelem">
<img src="../media/apache-ldap2.png" alt="" /></div>

</p>
</div><input class="btn_solution3" type="button" value="Mostra"></input></form>
</p>

</div>

<h2><a id="xifrat_amb_apache" >Xifrat amb Apache</a></h2>
<div class="level2">

<p>
L’objectiu d’aquesta activitat és aprendre a configurar el servidor Apache per tal que les comunicacions siguin segures amb el protocol HTTPS, és a dir, encriptades per tal que cap persona, amb l’ajuda d’eines de monitoratge del trànsit pugui veure el contingut transmès. Aquesta configuració és vital, sobretot quan es transmeten contrasenyes, però també és fonamental per mantenir la privacitat dels usuaris.
</p>

<p>
Realitzeu les tasques següents:
</p>
<ol>
<li class="level1"><div class="li"> Genereu un certificat autosignat amb una validesa d’un any utilitzant l’algorisme RSA de 2048 bits, tot generant els fitxers per a la clau pública i la clau privada.</div>
</li>
<li class="level1"><div class="li"> Modifiqueu el fitxer <code>/etc/apache2/sites-available/default-ssl.conf</code> per tal d’incloure els certificats i que SSL estigui actiu.</div>
</li>
<li class="level1"><div class="li"> Habliliteu el mòdul SSL i el lloc virtual default-ssl.</div>
</li>
<li class="level1"><div class="li"> Mostreu des del client com us connecteu mitjançant https.</div>
</li>
</ol>

<p>
<form action=""><div class="solution ioccontent">
<p>
<strong>1. Generació del certificat autosignat</strong>
</p>

<p>
Generem el certificat autosignat i creem les claus.
</p>
<pre class="code">root@server:/root# mkdir /etc/apache2/ssl
root@server:/root# openssl req -x509 -nodes -days 365 -newkey rsa:2048 -keyout /etc/apache2/ssl/apache.key -out /etc/apache2/ssl/apache.crt
Generating a RSA private key
...........................................................................................................+++++
...+++++
writing new private key to &#039;/etc/apache2/ssl/apache.key&#039;
-----
You are about to be asked to enter information that will be incorporated
into your certificate request.
What you are about to enter is what is called a Distinguished Name or a DN.
There are quite a few fields but you can leave some blank
For some fields there will be a default value,
If you enter &#039;.&#039;, the field will be left blank.
-----
Country Name (2 letter code) [AU]:ES
State or Province Name (full name) [Some-State]:Catalonia
Locality Name (eg, city) []:Barcelona
Organization Name (eg, company) [Internet Widgits Pty Ltd]:IOC
Organizational Unit Name (eg, section) []:
Common Name (e.g. server FQDN or YOUR name) []:ioc.cat
Email Address []:
root@server:/root# </pre>

<p>
Mostrem les claus:
</p>
<pre class="code">root@server:/root# ls /etc/apache2/ssl
apache.crt  apache.key
root@server:/root# </pre>

<p>
<strong>2. Activació del SSL</strong>
</p>

<p>
Modifiquem el fitxer <code>/etc/apache2/sites-available/default-ssl.conf</code>:
</p>
<pre class="code">SSLEngine On
SSLCertificateFile /etc/apache2/ssl/apache.crt
SSLCertificateKeyFile /etc/apache2/ssl/apache.key</pre>

<p>
<strong>3. Hablilitació del lloc virtual</strong>
</p>

<p>
Habilitem el mòdul SSL i el lloc virtual default-ssl:
</p>
<pre class="code">root@server:~# a2enmod ssl
Considering dependency setenvif for ssl:
Module setenvif already enabled
Considering dependency mime for ssl:
Module mime already enabled
Considering dependency socache_shmcb for ssl:
Enabling module socache_shmcb.
Enabling module ssl.
See /usr/share/doc/apache2/README.Debian.gz on how to configure SSL and create self-signed certificates.
To activate the new configuration, you need to run:
  systemctl restart apache2
root@server:~# a2ensite default-ssl
Enabling site default-ssl.
To activate the new configuration, you need to run:
  systemctl reload apache2
root@server:~# systemctl restart apache2</pre>

<p>
<strong>4. Comprovació amb el client</strong>
</p>

<p>
A la <acronym title="Uniform Resource Locator">URL</acronym> cal posar https://. Demanarà d’afegir una excepció si volem continuar (<em>Avançat, Afegeix excepció, Confirma</em>).
</p>

<p>
<div class="imgelem">
<img src="../media/apache-connexio-no-segura.png" alt="" /></div>

</p>
</div><input class="btn_solution3" type="button" value="Mostra"></input></form>
</p>

</div>

<h2><a id="instal_lacio_i_configuracio_del_servidor_iis_en_el_sistema_operatiu_windows" >Instal·lació i configuració del servidor IIS en el sistema operatiu Windows</a></h2>
<div class="level2">

<p>
L’Internet Information Server (IIS) és el servidor web que incorpora la companyia Microsoft en els seus sistemes operatius Windows Server, tot i que també pot funcionar en clients com Windows 10, on és especialment útil per a tasques de desenvolupament.
</p>

<p>
L’objectiu d’aquesta activitat és aprendre a instal·lar i configurar un servidor IIS en un sistema operatiu Windows Server.
</p>

<p>
Realitzeu les tasques següents:
</p>
<ol>
<li class="level1"><div class="li"> Instal·leu el servidor IIS. </div>
</li>
<li class="level1"><div class="li"> Comproveu l’estat del servei HTTP, activeu-lo i desactiveu-lo.</div>
</li>
<li class="level1"><div class="li"> Descriviu l’estructura del servidor IIS. </div>
</li>
<li class="level1"><div class="li"> Configureu la pàgina web principal amb un exemple.</div>
</li>
<li class="level1"><div class="li"> Configureu dues seus virtuals basades en noms.</div>
</li>
</ol>

<p>
<form action=""><div class="solution ioccontent">
<p>
<strong>1. Instal·lació del servidor <acronym title="Domain Name System">DNS</acronym></strong>
</p>

<p>
El procés d’instal·lació pot variar depenent de la versió del servidor.
</p>

<p>
Primer de tot, cal anar al <em>dashboard</em> de l’administrador del servidor i escollir l’opció d’afegir noves característiques o rols.
</p>

<p>
<div class="imgelem">
<img src="../media/iis1.png" alt="" /></div>

</p>

<p>
Seleccionem:
</p>
<ul>
<li class="level1"><div class="li"> <em>Role-based or featured-based installation</em></div>
</li>
<li class="level1"><div class="li"> El propi servidor</div>
</li>
</ul>

<p>
<div class="imgelem">
<img src="../media/iis2.png" alt="" /></div>

</p>
<ul>
<li class="level1"><div class="li"> <em>Add features</em></div>
</li>
<li class="level1"><div class="li"> Opcions per defecte…</div>
</li>
<li class="level1"><div class="li"> <em>Install</em></div>
</li>
</ul>

<p>
Comprovem que s’ha instal·lat. Apareix a sota del menú principal de configuració.
</p>

<p>
<div class="imgelem">
<img src="../media/iis3.png" alt="" /></div>

</p>

<p>
<strong>2. Estat del servei</strong>
</p>

<p>
Per saber l’estat del servei cal anar a l’apartat IIS del <em>dashboard</em> i anar a les opcions de serveis (<em>services</em>). Fent botó dret tindrem les opcions d’iniciar, aturar i reiniciar els diferents serveis.
</p>

<p>
<div class="imgelem">
<img src="../media/iis4.png" alt="" /></div>

</p>

<p>
<strong>3. Estructura del servidor web</strong>
</p>

<p>
Des de l’administrador del servidor, i dins del IIS, anem a l’apartat de <em>Servers</em>, i clicant el botó dret en el servidor actual, obrim l’administrador del servidor IIS:
</p>

<p>
<div class="imgelem">
<img src="../media/iis5.png" alt="" /></div>

</p>

<p>
A partir d’aquí, s’obre l’administrador del servei IIS, que té la següent estructura:
</p>

<p>
<div class="imgelem">
<img src="../media/iis6.png" alt="" /></div>

</p>

<p>
Si despleguem de l’arbre de l’esquerra l’apartat <em>Sitios</em>, podem veure els diferents llocs web que tenim. En aquest cas, després d’una instal·lació neta, només hi ha la pàgina web per defecte. A la part dreta hi ha les accions que es poden realitzar. És útil la d’explorar, ja que ens porta a la carpeta de publicació, que per defecte és <code>C:\inetpub\wwwroot</code>, i el fitxer inicial és <code>iisstart.htm</code>. 
</p>

<p>
<div class="imgelem">
<img src="../media/iss7.png" alt="" /></div>

</p>

<p>
També podem examinar quin aspecte té la pàgina web per defecte:
</p>

<p>
<div class="imgelem">
<img src="../media/iss8.png" alt="" /></div>

</p>

<p>
<strong>4. Pàgina principal</strong>
</p>

<p>
Per canviar la pàgina principal, cal modificar el fitxer.
</p>

<p>
Posem la següent pàgina <code>iisstart.htm</code>, per exemple, amb el següent codi <acronym title="HyperText Markup Language">HTML</acronym>:
</p>
<pre class="code">&lt;html&gt;
    &lt;head&gt;
        &lt;title&gt;Institut Obert de Catalunya&lt;/title&gt;
    &lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;Institut Obert de Catalunya&lt;/h1&gt;
        &lt;p&gt;MP08. Serveis de xarxa i Internet&lt;/p&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre>

<p>
Si comprovem la pàgina, veiem que efectivament es canvia:
</p>

<p>
<div class="imgelem">
<img src="../media/iss9.png" alt="" /></div>

</p>

<p>
<strong>5. Creació de seus virtuals basades en noms</strong>
</p>

<p>
Per no haver d’instal·lar un servidor <acronym title="Domain Name System">DNS</acronym> utilitzarem el fitxer <em>hosts</em>. Aquest fitxer està situat a la carpeta <code>C:\Windows\System32\drivers\etc</code> en un sistema Windows. Utilitzarem el domini ioc.cat i les seus web1 i web2.
</p>
<pre class="code">C:\Users\Administrador&gt;echo 127.0.0.1        localhost &gt; C:\Windows\System32\drivers\etc\hosts

C:\Users\Administrador&gt;echo 10.0.2.15        web1.ioc.cat &gt;&gt; C:\Windows\System32\drivers\etc\hosts

C:\Users\Administrador&gt;echo 10.0.2.15        web2.ioc.cat &gt;&gt; C:\Windows\System32\drivers\etc\hosts

C:\Users\Administrador&gt;type C:\Windows\System32\drivers\etc\hosts
127.0.0.1        localhost
10.0.2.15        web1.ioc.cat
10.0.2.15        web2.ioc.cat

C:\Users\Administrador&gt;</pre>

<p>
Creem l’estructura de carpetes per a les dues seus virtuals:
</p>
<pre class="code">mkdir C:\inetpub\web1
mkdir C:\inetpub\web2</pre>

<p>
I creem les pàgines web per a cada seu virtual.
</p>

<p>
La configuració IIS és la següent: des de <em>Sitios</em>, triem <em>Agregar sitio web</em>.
</p>

<p>
<div class="imgelem">
<img src="../media/iss10.png" alt="" /></div>

</p>

<p>
Un cop creats, podem comprovar la configuració:
</p>

<p>
<div class="imgelem">
<img src="../media/iss11.png" alt="" /></div>

</p>

<p>
Finalment, comprovem les diferents seus virtuals:
</p>

<p>
<div class="imgelem">
<img src="../media/iss12.png" alt="" /></div>

</p>
</div><input class="btn_solution3" type="button" value="Mostra"></input></form>
</p>

</div>

	 </article>
     <div class="pnpage">
      <div class="left-corner"></div>
      <div id="prevpage">Anar a la p&agrave;gina anterior:<br /><a href="../../../WebContent/u2/a1/continguts.html">Instal·lació i administració de servidors web</a></div>
      <div id="nextpage">Anar a la p&agrave;gina seg&uuml;ent:<br /><a href="../../../WebContent/u2/a1/exercicis.html">Exercicis</a></div>
      <div class="right-corner"></div>
     </div>
    </div>
    <footer class="footer">
      <div><small>Aquest document està subjecte a una llicència oberta de Creative Commons, es reserva el dret de reconeixement de l'autoria, d'exigir que no se'n faci cap mena d'ús comercial. Si altereu o transformeu aquesta obra, o en genereu obres derivades, només podeu distribuir l'obra generada amb una llicència idèntica a aquesta.</small></div>
    </footer>
 </div>
 <div id="back_preview" class="hidden"></div>
 <div id="preview" class="hidden">
  <div class="prevcontent"></div>
 </div>
 <div id="help-tooltips">
  <div id="help-toc" class="hidden tooltip"><span>Taula de continguts:</span> Ofereix una vista general de l&#39;estructura del m&ograve;dul, que us facilitar&agrave; la navegaci&oacute; a trav&eacute;s dels seus continguts.<span class="arrow-left"></span></div> 
  <div id="help-settings" class="hidden tooltip"><span>Opcions de format:</span> Permet configurar el format de lectura a partir de les vostres prefer&egrave;ncies, modificant la mida de la lletra, el color del fons, l&#39;amplada de la p&agrave;gina o l&#39;ocultaci&oacute; dels continguts complementaris, entre d&#39;altres.<span class="arrow-left"></span></div>
  <div id="help-printer" class="hidden tooltip"><span>Imprimir:</span>  Envia el contingut seleccionat a la impressora.<span class="arrow-left"></span></div>
  <div id="help-favorites" class="hidden tooltip"><span>Prefereits:</span> Permet desar aquelles parts del contingut a les que us interessi accedir en un moment posterior; us permetr&agrave; anar creant un repositori personalitzat de les seccions que considereu m&eacute;s rellevants. Un cop l&#39;hageu començat a fer servir se us mostrar&agrave; a sota un comptador que us informar&agrave; del nombre de preferits que s&#39;hagin emmagatzemat fins al moment.<span class="arrow-left"></span></div>
  <div id="help-favcounter" class="hidden tooltip"><span>Comptador i llistat de preferits:</span> Indica el nombre de preferits que s&#39;han desat fins el moment; clicant damunt seu accedireu al llistat de preferits, i a trav&eacute;s d&#39;aquest podreu accedir directament als continguts que hageu emmagatzemat.<span class="arrow-left"></span></div>
  <div id="help-help_icon" class="hidden tooltip"><span>Ajuda:</span> Aquesta opci&oacute; activa la informaci&oacute; de les funcionalitats del web tot situant el punter del ratol&iacute; al damunt dels diferents &iacute;tems.<span class="arrow-left"></span></div>
  <div id="help-sidebar-hide" class="hidden tooltip"><span>Mostrar/Ocultar barra lateral:</span>  Deshabilita la barra d&#39;opcions, permetent la seva recuperaci&oacute; quan es desitgi.<span class="arrow-left"></span></div>
  <div id="help-search" class="hidden tooltip"><span>Cerca:</span>  Introdu&iuml;u les paraules clau sobre aquells conceptes que desitgeu localitzar en els continguts del m&ograve;dul. Tamb&eacute; podeu excloure un terme de la cerca tot afegint-hi el signe &#8220;-&#8221; al davant.<span class="arrow-top"></span></div>
  <div id="help-header" class="hidden tooltip"><span>Cap&ccedil;alera:</span>  Indica l&#39;apartat o secci&oacute; que es mostra en pantalla. Tingueu present que les capçaleres de segon, tercer i quart nivell tamb&eacute; es poden desar com a marcadors.<span class="arrow-left"></span></div>
</div> 
</body>
</html>
