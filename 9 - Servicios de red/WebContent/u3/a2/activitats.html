<!doctype html>

<!--[if lt IE 7 ]> <html class="ie ie6 no-js" lang="ca"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie ie7 no-js" lang="ca"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie ie8 no-js" lang="ca"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie ie9 no-js" lang="ca"> <![endif]-->
<!--[if gt IE 9]><!--><html class="no-js" lang="ca"><!--<![endif]-->
<!-- the "no-js" class is for Modernizr. -->

<head id="www-sitename-com" data-template-set="html5-reset">

	<meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html">
        
	<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>Serveis de xarxa</title>
	
<!-- <meta name="title" content=""> --> 
	<meta name="description" content="">
	<!-- Google will often use this as its description of your page/site. Make it good. -->
	
	<meta name="google-site-verification" content="">
	<!-- Speaking of Google, don't forget to set your site up: http://google.com/webmasters -->
	
	<meta name="author" content="Institut Obert de Catalunya">
	<meta name="Copyright" content="Copyright Institut Obert de Catalunya 2011. All Rights Reserved.">

	<!-- Dublin Core Metadata : http://dublincore.org/ -->
	<meta name="DC.title" content="Serveis de xarxa">
	<meta name="DC.subject" content="Informàtica i comunicacions">
	<meta name="DC.creator" content="Institut Obert de Catalunya">
	
	<!--  Mobile Viewport Fix
	j.mp/mobileviewport & davidbcalhoun.com/2010/viewport-metatag 
	device-width : Occupy full width of the screen in its current orientation
	initial-scale = 1.0 retains dimensions instead of zooming out if page height > device height
	maximum-scale = 1.0 retains dimensions instead of zooming in if page width < device width
	-->
	<!-- Uncomment to use � use thoughtfully!
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	-->

	<link rel="shortcut icon" href="../../../img/favicon.ico">
	<!-- This is the traditional favicon.
		 - size: 16x16 or 32x32
		 - transparency is OK
		 - see wikipedia for info on browser support: http://mky.be/favicon/ -->
		 
	<link rel="apple-touch-icon" href="../../../img/apple-touch-icon.png">
	<!-- The is the icon for iOS's Web Clip.
		 - size: 57x57 for older iPhones, 72x72 for iPads, 114x114 for iPhone4's retina display (IMHO, just go ahead and use the biggest one)
		 - To prevent iOS from applying its styles to the icon name it thusly: apple-touch-icon-precomposed.png
		 - Transparency is not recommended (iOS will put a black BG behind the icon) -->
	
	<!-- CSS: screen, mobile & print are all in the same file -->
	<link rel="stylesheet" href="../../../_/css/style.css">

	<!-- CSS: jQuery UI -->
	<link rel="stylesheet" href="../../../_/css/jquery-ui.css">
	
	<!-- all our JS is at the bottom of the page, except for Modernizr. -->
	<script src="../../../_/js/modernizr-1.7.min.js"></script>
	<script src="../../../_/js/Hyphenator.js" type="text/javascript"></script>
	<script type="text/javascript">
	   Hyphenator.config({
		minwordlength : 4
	   });
	   Hyphenator.run();
	</script>
    <script src="../../../_/js/build.js" type="text/javascript"></script>
</head>

<body class="style-newspaper">

<div class="wrapper"><!-- not needed? up to you: http://camendesign.com/code/developpeurs_sans_frontieres -->

	<header id="header">
		<div class="head"><a href="http://ioc.gencat.cat"><img src="../../../img/logo.png" alt="Institut Obert de Catalunya"/></a><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/es/deed.ca"><img src="../../../img/license.png" alt="Llic&egrave;ncia" class="license"/></a></div>
		<div class="headdocument"><a href="../../../index.html">Serveis de xarxa</a></div>
        <div id="search" class="search" name="search">
         <form id="frmsearch" action="../../../search.html" method="get">
          <input type="text" name="q"/>
        </form>
        </div>
	</header>
   <div id="upbutton" class="upbutton" style="display:none;"><img src="../../../img/uparrow.png" alt="Pujar a l'inici de p&agrave;gina"/></div>
   <aside id="aside">
    <div id="menu">
      <ul>
       <li name="toc"><div><img src="../../../img/toc.png" alt="&Iacute;ndex"/></div></li>
       <li name="settings"><div><img src="../../../img/settings.png" alt="Configuraci&oacute;"/></div></li>
       <li name="printer"><div><img src="../../../img/printer.png" alt="Imprimir"/></div></li>
       <li name="favorites"><div><img src="../../../img/favorites.png" alt="Favorits"/></div></li>
       <li name="help_icon" class="help_icon"><div><img src="../../../img/help_icon.png" alt="Ajuda"/></div></li>
      </ul>
     </div>
   </aside>
   <div id="sidebar-hide" name="sidebar-hide"><img src="../../../img/arrows.png"/></div>
   <section>
     <div id="toc" class="hidden">
      <div class="menucontent">
        <ul>
        <li id="u4" class="parentnode"><p><a class="unit" href="../../../WebContent/u4/introduccio.html">4. Accés a sistemes remots</a></p><ul class="expander"><li id="u4introduccio"><a href="../../../WebContent/u4/introduccio.html">Introducció</a></li><li id="u4mapa"><a href="../../../WebContent/u4/mapa.html">Mapa conceptual</a></li><li id="u4referencies"><a href="../../../WebContent/u4/referencies.html">Més informació</a></li><li id="u4resultats"><a href="../../../WebContent/u4/resultats.html">Resultats d'aprenentatge</a></li><li id="u4resum"><a href="../../../WebContent/u4/resum.html">Resum</a></li><li id="u4a1" class="tocsection"><p id='u4a1continguts'><a class="section" href="../../../WebContent/u4/a1/continguts.html">Introducció a l'accés remot a equips</a><span class="buttonexp"></span></p><ul><li id="u4a1activitats"><a href="../../../WebContent/u4/a1/activitats.html">Activitats</a></li><li id="u4a1exercicis"><a href="../../../WebContent/u4/a1/exercicis.html">Exercicis d'autoavaluació</a></li></ul></li><div data-parent-id='u4a1' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u4/a1/continguts.html#usos_mes_frequeents_de_l_acces_remot_a_ordinadors">Usos més freqüents de l'accés remot a ordinadors</a></li><li><a href="../../../WebContent/u4/a1/continguts.html#diferents_tipus_d_acces_remot">Diferents tipus d'accés remot</a></li></ul></div></div><li id="u4a2" class="tocsection"><p id='u4a2continguts'><a class="section" href="../../../WebContent/u4/a2/continguts.html">Administració remota basada en la línea d'ordres</a><span class="buttonexp"></span></p><ul><li id="u4a2activitats"><a href="../../../WebContent/u4/a2/activitats.html">Activitats</a></li><li id="u4a2annexos"><a href="../../../WebContent/u4/a2/annexos.html">Annexos</a></li><li id="u4a2exercicis"><a href="../../../WebContent/u4/a2/exercicis.html">Exercicis d'autoavaluació</a></li></ul></li><div data-parent-id='u4a2' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u4/a2/continguts.html#telnet">Telnet</a></li><li><a href="../../../WebContent/u4/a2/continguts.html#introduccio_a_ssh">Introducció a SSH</a></li></ul></div></div><li id="u4a3" class="tocsection"><p id='u4a3continguts'><a class="section" href="../../../WebContent/u4/a3/continguts.html">Administració remota amb interfície gràfica</a><span class="buttonexp"></span></p><ul><li id="u4a3activitats"><a href="../../../WebContent/u4/a3/activitats.html">Activitats</a></li><li id="u4a3annexos"><a href="../../../WebContent/u4/a3/annexos.html">Annexos</a></li><li id="u4a3exercicis"><a href="../../../WebContent/u4/a3/exercicis.html">Exercicis d'autoavaluació</a></li></ul></li><div data-parent-id='u4a3' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u4/a3/continguts.html#la_transparencia_de_xarxa_del_sistema_x_window">La transparència de xarxa del sistema X Window</a></li><li><a href="../../../WebContent/u4/a3/continguts.html#vnc_virtual_network_computing">VNC Virtual Network Computing</a></li></ul></div></div><li id="u4a4" class="tocsection"><p id='u4a4continguts'><a class="section" href="../../../WebContent/u4/a4/continguts.html">Gestió remota mitjançant una aplicació local</a><span class="buttonexp"></span></p><ul><li id="u4a4activitats"><a href="../../../WebContent/u4/a4/activitats.html">Activitats</a></li><li id="u4a4exercicis"><a href="../../../WebContent/u4/a4/exercicis.html">Exercicis d'autoavaluació</a></li></ul></li><div data-parent-id='u4a4' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u4/a4/continguts.html#introduccio_a_webmin">Introducció a Webmin</a></li></ul></div></div></ul></li><li id="" class="indexnode"><p><a href="../../../index.html">Anar a l&#39;&iacute;ndex general</a></p></li>
        </ul>
      </div>
    </div>
   </section>
   <section>
   <div id="settings" class="hidden">
    <div class="menucontent">
     <div class="allsettings">
     <div class="settings">
      <label>Font i Color</label>
		<div class="setting-option">
	        <ul class="fontBackground">
				<li id="style-newspaper" title="Newspaper" class="appearance-style-newspaper"><span>Newspaper</span></li>
                <li id="style-novel" title="Novel" class="appearance-style-novel"><span>Novel</span></li>
                <li id="style-ebook" title="eBook" class="appearance-style-ebook"><span>eBook</span></li>
				<li id="style-inverse" title="Inverse" class="appearance-style-inverse active"><span>Inverse</span></li>
				<li id="style-athelas" title="Athelas" class="appearance-style-athelas"><span>Athelas</span></li>
			</ul>
		</div>
     </div>
	<div class="settings">
      <label>Amplada</label>
		<div class="setting-option">
	        <div id="slider-width"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
		<div class="setting-option">
	        <div id="slider-font"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
	  <div class="setting-option">
       <form action="" class="sett-options">
		<ul>
		    <li><input type="checkbox" id="secondary-content" /><label for="secondary-content">Mostra recursos complementaris</label></li>
		    <li><input type="checkbox" id="main-images" /><label for="main-images">Mostra imatges</label></li>
		    <li><input type="checkbox" id="text-alignment" /><label for="text-alignment">Text justificat</label></li>
			<li><input type="checkbox" id="text-hyphen" /><label for="text-hyphen">Partici&oacute; sil·l&agrave;bica</label></li>
		</ul>
       </form>
	  </div>
     </div>
     </div>
    </div>
   </div>
   </section>
 <section>
 <div id="favorites" class="hidden"></div>
 </section>   
 <div id="bridge" class="hidden"></div>
 <div id="help" class="hidden">
  <div class="helptitle">Dreceres del teclat<hr></div>
  <div class="helpsection"><span>General</span>
   <ul>
    <li><span class="shortcut">g</span>: Anar al men&uacute; de navegaci&oacute;</li>
    <li><span class="shortcut">o</span>: Anar a opcions</li>
    <li><span class="shortcut">s</span>: Guardar la p&agrave;gina actual a favorits</li>
    <li><span class="shortcut">p</span>: Imprimir la p&agrave;gina actual</li>
    <li><span class="shortcut">?</span>: Mostrar/Ocultar l&#39;ajuda</li>
   </ul>
  </div>
  <div class="helpsection"><span>Navegaci&oacute;</span>
   <ul>
    <li><span class="shortcut">i</span>: Anar a l&#39;&iacute;ndex general</li>
    <li><span class="shortcut">t</span>: Anar a l&#39;inici de p&agrave;gina</li>
    <li><span class="shortcut">b</span>: Anar al final de p&agrave;gina</li>
    <li><span class="shortcut">j</span>: Anar cap endavant dintre la p&agrave;gina</li>
    <li><span class="shortcut">k</span>: Anar cap enrere dintre la p&agrave;gina</li>
    <li><span class="shortcut">h</span>: Anar a la p&agrave;gina anterior:</li>
    <li><span class="shortcut">l</span>: Anar a la p&agrave;gina seg&uuml;ent:</li>
   </ul>
   </div>
 </div>
 <div id="favcounter" name="favcounter" class="hidden"><span></span></div>
 <div id="navmenu" class="navmenu"><ul class="webnav"><li><a href="../../../index.html" title="Anar a l&#39;&iacute;ndex general">Inici</a></li><li><a href="../introduccio.html">Servidors web i intermediaris</a></li><li><a href="continguts.html">Interconnexió de xarxes privades amb xarxes públiques</a></li><li>Activitats</li></ul></div>
	<div id="content" lang="ca" class="hyphenate text">
     <article lang="ca" class="sheet">
        <h1><a id="activitats"> Activitats </a></h1>
    	
<h2><a id="instal_lacio_del_programari_squid_en_el_sistema_operatiu_windows" >Instal·lació del programari Squid en el sistema operatiu Windows</a></h2>
<div class="level2">

<p>
L’objectiu d’aquesta activitat és establir les principals mesures de seguretat perimetral que ens permetin filtrar els continguts de les pàgines web per, en conseqüència, bloquejar aquells continguts o recursos que puguin resultar ofensius o no siguin adients per als usuaris més vulnerables com, per exemple, els menors d’edat.
</p>

<p>
Un servidor intermediari (<em>proxy server</em>) és un servei que s’ocupa de rebre les peticions de pàgines web del client, sol·licitar la pàgina al servidor i retornar-la al client. Actua com a intermediari en la navegació, s’utilitza per compartir la connexió a Internet, o bé, per bloquejar recursos atès que hi ha la possibilitat de tancar tots els ports i, únicament, habilitar el servidor intermediari (<em>proxy</em>) per navegar.
</p>

<p>
En el nostre cas, podem treballar amb el programari Squid. N’haurem d’obtenir la versió més actual (o estable) mitjançant la pàgina web <a href="http://www.serassio.it/" class="urlextern" title="http://www.serassio.it/"  rel="nofollow">http://www.serassio.it/</a>, concretament, des de l’apartat de descàrregues <em>downloads</em>.
</p>

<p>
<form action=""><div class="solution ioccontent">
<p>
L’Squid és un servidor intermediari força complert que pot actuar tant de servidor intermediari com de memòria cau, per exemple, amb els protocols HTTP o <acronym title="File Transfer Protocol">FTP</acronym>; també pot facilitar l’acceleració HTTP, cau de consultes <acronym title="Domain Name System">DNS</acronym> i tasques addicionals de seguretat com poden ser la filtració de continguts i el control d’accés segons l’adreça IP i l’usuari.
</p>

<p>
Un cop haguem descarregat l’arxiu en format zip, haurem de descomprimir-lo en una carpeta que anomenarem Squid i que deixarem dins del disc dur principal (C:\).
</p>

<p>
<div class="imgelem">
<img src="../media/wic10_m7_uf3_u3_18a.gif" alt="" /></div>

</p>

<p>
Un cop ja haguem desat els arxius del programari Squid dins del disc dur, haurem de configurar-lo; per aconseguir-ho, haurem d’obrir la carpeta <em>etc</em> (C:\Squid\etc). Un cop hi accedim, trobarem que hi ha diversos arxius que tenen format .<em>conf.default</em>; a partir d’ara, haurem de modificar els formats per deixar-los en format .<em>conf</em>.
</p>

<p>
<div class="imgelem">
<img src="../media/wic10_m7_uf3_u3_19.gif" alt="" /></div>

</p>

<p>
Arribats a aquest punt, haurem d’accedir a l’arxiu squid.conf mitjançant la seva edició per configurar les regles d’accés, els permisos dels clients, etc. Per defecte, la xarxa local té permisos per les adreces de classe A, B i C.
</p>

<p>
Classe A → Rang de 10.0.0.0 a 10.255.255.255<br/>
 Classe B → Rang de 172.16.0.0 a 172.31.255.255<br/>
 Classe C → Rang de 192.168.0.0 a 192.168.255.255
</p>

<p>
Els ports per defecte serien:
</p>
<pre class="code">acl Safe_ports port 80            # http
acl Safe_ports port 21            # ftp
acl Safe_ports port 443           # https 
acl Safe_ports port 70            # gopher
acl Safe_ports port 210           # wais
acl Safe_ports port 1025-65535    # unregistered ports
acl Safe_ports port 280           # http-mgmt
acl Safe_ports port 488           # gss-http
acl Safe_ports port 591           # filemaker
acl Safe_ports port 777           # multiling http</pre>

<p>
Si necessitéssim establir més ports, hauríem de copiar una de les línies i introduir-hi el número del port corresponent. En conseqüència, aquests ports passaran pel servidor intermediari.
</p>

<p>
Val a dir que hi ha ports que els connectarà directament sense utilitzar el servidor intermediari, això és, l’HTTPS (443) que, si considerem que és encriptat, no el pot manipular el servidor intermediari.
</p>
<pre class="code">acl SSL_ports port 443</pre>

<p>
Considerant que el programari Squid utilitza el port 3128 per rebre les connexions, podem afegir algunes més; per exemple, si hem considerat poc viable canviar el port 3128 per 8080, o bé, afegir-la. Per fer-ho, haurem de copiar la línia i posar el número de port corresponent (per exemple, http_port 3128) i, a continuació, traurem el símbol # al principi de la línia cache_dir ufs c:/squid/var/cache 100 16 256.
</p>

<p>
Paral·lelament, també podrem augmentar la grandària de la memòria per a l’emmagatzematge de 100 a un altre valor de, per exemple, 1000. D’altra banda, també podem buscar la línia visible_hostname i hi col·locarem el nom de la nostra màquina. En aquest, si no el coneixem, haurem d’adreçar-nos a Inici i, a continuació, escriurem i executarem msinfo32 per veure el nom del sistema.
</p>

<p>
A continuació, buscarem la secció de les llistes d’accés; la secció ACCESS CONTROLS de l’arxiu <em>squid.conf</em> la identificarem perquè conté la paraula acl.
</p>
<pre class="code">acl all src 0.0.0.0/0.0.0.0
acl manager proto cache_object
acl localhost src 127.0.0.1/255.255.255.255
acl to_localhost dst 127.0.0.0/8
acl SSL_ports port 443 563
acl Safe_ports port 80 # http
acl Safe_ports port 21 # ftp
acl Safe_ports port 443 563 #
https, snews acl Safe_ports port 70 # gopher
acl Safe_ports port 210 # wais 
acl Safe_ports port 1025-65535 # unregistered ports 
acl Safe_ports port 280 # http-mgmt 
acl Safe_ports port 488 # gss-http
acl Safe_ports port 591 # filemaker 
acl Safe_ports port 777 # multiling
http acl CONNECT method CONNECT </pre>

<p>
I, a sota, escriurem acl la_nostra_xarxa src 192.168.0.0/255.255.255.0; val a dir que també podem crear un arxiu .txt i guardar-lo a c:\squid\etc on emmagatzemarem la (o les) adreces d’Internet (IP) que vulguem que accedeixin als serveis de xarxa.
</p>

<p>
Per exemple:<br/>
192.168.0.1<br/>
192.168.0.2<br/>
192.168.1.3
</p>

<p>
192.168.3.45 → Únicament les màquines amb aquestes adreces IP accediran a la xarxa d’Internet. En aquest cas, l’arxiu s’anomenarà permesos.txt i es guardarà a c:\squid\etc.
</p>

<p>
Sota de la línia acl CONNECT method CONNECT, haurem d’escriure acl la_nostra_xarxa src “c:/squid/etc/permesos.txt”
</p>

<p>
Buscarem la línia <code>http_access allow manager localhost</code> i, a sota d’aquesta línia, afegirem http_acess allow la_nostra_xarxa.
</p>

<p>
Des del punt de vista de les memòries cau, crearem els següents directoris de forma manual:
</p>
<pre class="code">C:\squid\var\cache
C:\squid\var\cache0
C:\squid\var\cache1
C:\squid\var\cache2
C:\squid\var\cache3
C:\squid\var\cache4
C:\squid\var\cache5
C:\squid\var\cache6
C:\squid\var\cache7
C:\squid\var\cache8
C:\squid\var\cache9
C:\squid\var\cacheA
C:\squid\var\cacheB
C:\squid\var\cacheC
C:\squid\var\cacheD
C:\squid\var\cacheE
C:\squid\var\cacheF</pre>

<p>
És a dir, ens adreçarem al directori var i crearem un directori anomenat cau (<em>cache</em>) i, a continuació, crearem diversos directoris anomenats de 00 fins a 0F (es tracta de la numeració hexadecimal).
</p>

<p>
En el cas que, per exemple, volguéssim establir un control parental mitjançant la limitació de l’accés a determinades pàgines web, haurem de crear, mitjançant el bloc de notes, dos arxius de text.
</p>

<p>
Per exemple, podem crear un arxiu anomenat <em>prohibits.txt</em> que contindrà aquells llocs web <a href="http://www.sex.com" class="urlextern" title="http://www.sex.com"  rel="nofollow">www.sex.com</a>, <a href="http://www.yonkis.com" class="urlextern" title="http://www.yonkis.com"  rel="nofollow">www.yonkis.com</a>, etc.) als quals no vulguem que accedeixin els usuaris de la xarxa que administrem. Val a dir que, si bloquegem una paraula, el programari Squid bloquejarà tots els llocs web que la continguin en la seva adreça web. Per exemple, tot i que restringim la paraula anglesa <em>sex</em>, la paraula <em>sexta</em> tampoc estarà permesa).
</p>

<p>
El segon arxiu de text s’anomenarà <em>extensions.txt</em> i serà el que ens ajudarà a bloquejar la descarrega d’arxius amb extensions no desitjades com, per exemple, <code>.mp3$</code>, <code>.exe$</code>, <code>.avi$</code>, etc. A continuació, els cridarem amb les següents línies de codi:
</p>

<p>
acl prohibits url_regex “/squid/etc/ prohibits.txt”
acl extensions urlpath_regex “/squid/etc/extensions.txt”
Per tant, l’arxiu podria quedar com segueix:
acl all src 0.0.0.0/0.0.0.0
acl manager proto cache_object
acl localhost src 127.0.0.1/255.255.255.255
acl to_localhost dst 127.0.0.0/8
acl SSL_ports port 443 563
acl Safe_ports port 80 # http
acl Safe_ports port 21 # ftp
acl Safe_ports port 443 563 # https, snews
acl Safe_ports port 70 # gopher
acl Safe_ports port 210 # wais 
acl Safe_ports port 1025-65535 # unregistered ports
acl Safe_ports port 280 # http-mgmt
acl Safe_ports port 488 # gss-http
acl Safe_ports port 591 # filemaker 
acl Safe_ports port 777 # multiling http 
acl CONNECT method CONNECT 
acl la_nostra_xarxa src “/squid/etc/permesos.txt”
acl prohibits url_regex “/squid/etc/prohibits.txt”
acl extensions urlpath_regex “/squid/etc/extensions.txt”
</p>

<p>
Arribats a aquest punt, ens adreçarem al terminal de comandes (Inici &amp;gt; Executar &amp;gt; cmd) i executarem <code>c:\squid\sbin\squid.exe –z</code>.
</p>

<p>
<div class="imgelem">
<img src="../media/wic10_m7_uf3_u3_20.jpg" title="wic10_m7_uf3_u3_20.jpg" alt="wic10_m7_uf3_u3_20.jpg" /></div>

</p>

<p>
Podem instal·lar el programari en dos modalitats possibles, això és, com servei que arrenca automàticament quan s’encén l’ordinador, o bé, arrencar el programari Squid manualment per cada cop que sigui necessari. Per instal·lar-lo en mode de servei, executarem <em>c:\squid\sbin\squid.exe –i</em> i, a continuació, per arrencar-lo,<em> net start squid. </em>Si optem per aquesta modalitat, haurem d’obrir el port3128 en el tallafocs (<em>firewall</em>); també haurem d’obrir tots aquells ports d’escolta que haguem definit amb anterioritat.
</p>

<p>
Un cop ja tinguem registrat el programari Squid en el nostre ordinador, ja podrem posar-lo en marxa . Per fer-ho, haurem de reiniciar, o bé, adreçar-nos a Inici &amp;gt; Executar i escriurem i executarem <em>services.msc</em>. Dins de la llista que aparegui, haurem de cercar <em>Squid</em> per, un cop ens haguem situat a sobre, clicar amb el botó dret del ratolí en l’opció Iniciar.
</p>

<p>
<div class="imgelem">
<img src="../media/wic10_m7_uf3_u3_21.gif" alt="" /></div>

</p>

<p>
Ara bé, en el cas que no haguéssim instal·lat el programari com un servei, senzillament, haurem d’executar C:\squid\sbin\squid.exe. Mentre s’executi, la pantalla apareixerà en negre; per desconnectar el programari, haurem de tancar aquesta mateixa finestra.
</p>

<p>
<div class="imgelem">
<img src="../media/wic10_m7_uf3_u3_22.jpg" title="wic10_m7_uf3_u3_22.jpg" alt="wic10_m7_uf3_u3_22.jpg" /></div>

</p>

<p>
Un cop configurat el programari, ja podem configurar els navegadors web. En aquest cas, pel navegador web Internet Explorer, haurem d’adreçar-nos a la pestanya Opcions d’Internet &amp;gt; Connexions &amp;gt; Configuració de XAL.
</p>

<p>
<div class="imgelem">
<img src="../media/wic10_m7_uf3_u3_23.gif" alt="" /></div>

</p>

<p>
Aquesta configuració no solament la utilitzarà el navegador web Internet Explorer, sinó que també la utilitzarà el seu programari de conversa instantània (<em>Windows Live Messenger</em>) i altres programes que comparteixen aquesta configuració.
</p>

<p>
<div class="imgelem">
<img src="../media/wic10_m7_uf3_u3_24.gif" alt="" /></div>

</p>

<p>
En el cas del navegador web Firefox, haurem d’adreçar-nos a la pestanya Eines &amp;gt; Opcions i, un cop dins, picarem sobre l’opció Avançat &amp;gt; Xarxa &amp;gt; Paràmetres.
</p>

<p>
<div class="imgelem">
<img src="../media/wic10_m7_uf3_u3_25.gif" alt="" /></div>

</p>
</div><input class="btn_solution3" type="button" value="Mostra"></input></form>
</p>

</div>

<h2><a id="permetre_o_denegar_l_acces_des_de_certs_rangs_d_adreces_de_internet_ip" >Permetre o denegar l&#039;accés des de certs rangs d&#039;adreces de Internet (IP)</a></h2>
<div class="level2">

<p>
L’objectiu d’aquesta activitat és establir un nivell superior a l’hora de restringir continguts o recursos d’Internet mitjançant les adreces d’Internet (IP) aprofitant que el programari Squid permet la validació o la denegació de l’accés a Internet a partir dels diferents rangs d’adreces d’Internet (IP); de fet, si tenim una xarxa dissenyada de manera que cada departament d’una organització utilitzi un rang concret, podrem permetre o denegar l’accés a un departament de manera senzilla.
</p>

<p>
Amb Squid és molt senzill permetre o denegar l’accés a Internet a partir dels diferents rangs d’adreces de Internet (IP); de fet, si tenim una xarxa dissenyada de forma que cada departament d’una organització utilitzi un rang concret, podrem permetre o denegar l’accés a un departament de forma senzilla.
</p>

<p>
De fet, si no volem modificar l’arxiu <em>squid.conf</em>, podem crear una llista de control d’accés (<acronym title="Access Control List">ACL</acronym>, <em>acces control list</em>) que carregui els departaments des d’un arxiu extern. Per aconseguir-ho, podem crear un arxiu <em>/etc/squid/depts-prohibs.txt</em> on, per exemple, indicarem els rangs d’adreces d’Internet que no volem que naveguin.
</p>

<p>
Ara bé, considerant que una organització pot estar integrada per múltiples departaments, pot sorgir un inconvenient, això és, cada cop que vulguem permetre o denegar l’accés a Internet a un dels departaments, haurem d’editar l’arxiu <em>depts-prohibs.txt</em>. Per tant, considerant que això pot resultar una mica incòmode, podem crear dos <em>scripts</em> d’UNIX que facin el treball per nosaltres perquè, únicament, haguem d’executar els <em>scripts</em>.
</p>

<p>
<form action=""><div class="solution ioccontent">
<p>
Considerant que dins d’una organització poden conviure diferents departaments, hem d’establir una metodologia per definir el departament a qui es vulgui prohibir o permetre l’accés a Internet. Per tant, si som dins del terminal de comandes, haurem d’obrir l’editor de textos i crear els dos <em>scripts</em> necessaris.
</p>

<p>
Per una banda, haurem d’escriure un primer <em>script</em> on es sol·licitarà el departament (adreça d’Internet) a qui s’ha de denegar l’accés.
</p>
<pre class="code">//Nom de l&#039;script: prohibir-depts.sh
# /bin/bash
#
# Script per prohibir la navegació d&#039;un dels departaments de l&#039;organització

# Es crearà el rang del departament en /etc/squid/depts-prohibs.txt

# Indicar el número del departament quan s&#039;executi l&#039;script

if [$# ne 1] then

  echo &quot;És necessari introduir el número de departament que s&#039;ha de prohibir&quot;
  
  exit -1

fi

echo Prohibir navegar departament $1, subxarxa 10.0.$1.0/24

echo 10.0.$1.0/24 &gt;&gt; /etc/squid/depts-prohibs.txt

/etc/init.d/squid reload

echo Les subxarxes denegades són:

cat /etc/squid/depts.prohibs.txt

//Nom de l&#039;script: permetre-depts.sh

# /bin/bash
#
# Script per permetre la navegació d&#039;un dels departaments de l&#039;organització

# S&#039;eliminarà el rang del departament en /etc/squid/depts-prohibs.txt

# Indicar el número del departament quan s&#039;executi l&#039;script

if [$# ne 1] then

  echo &quot;És necessari introduir el número de departament que s&#039;ha de prohibir&quot;
  
  exit -1

fi

subxarxa=10.0.$1.0/24

echo Permetre navegar al departament $1, subxarxa $subxarxa

patro=&#039;echo /10.0.$1.0/d&#039;

cat /etc/squid/depts.prohibs.txt | sed –e $patro &gt; /tmp/temp.txt

cat /tmp/temp.txt &gt; /etc/squid/ depts-prohibs.txt

/etc/init.d/squid reload

echo Les subxarxes denegades són:

cat /etc/squid/depts-prohibs.txt</pre>

<p>
En aquest cas, si desitgéssim que el departament número 1 (suposant que, per exemple, haguéssim assignat el número 1 i l’adreça de subxarxa 10.0.1.0/24 al departament de Comptabilitat) no navegués, executaríem <em>prohibir-depts 1</em>. Ara bé, si volguéssim permetre que el departament de Comptabilitat (el número 1) navegui, hauríem d’executar <em>permetre-depts 1</em>.
</p>

<p>
Val a dir que, tot i que puguem agilitzar la feina mitjançant la utilització dels <em>scripts </em><em>prohibir-depts</em> i <em>permetre-depts</em>, encara pot resultar una mica incòmode realitzar canvis atès que l’administrador de la xarxa hauria d’iniciar sessió en el servidor per SSH i llençar l’<em>script</em> corresponent. Per tant, una possible opció seria crear una pàgina amb el llenguatge de programació PHP (<em>hypertext preprocessor</em>) amb botons de comandes on, amb un clic, podríem executar els <em>scripts</em> còmodament des del navegador.
</p>
</div><input class="btn_solution3" type="button" value="Mostra"></input></form>
</p>

</div>

<h2><a id="el_tallafocs_iptables" >El tallafocs Iptables</a></h2>
<div class="level2">

<p>
L’objectiu d’aquesta activitat és conèixer l’amplitud de recursos de què disposa l’Iptables, això és, el tallafoc que, des de la versió 2.4 del nucli de Linux, s’utilitza per gestionar les connexions. Val a dir que les possibilitats de l’Iptables són pràcticament infinites, atès que un administrador de xarxa en pot treure el màxim profit possible, ja que pot fer configuracions extremadament complexes.
</p>

<p>
A grans trets, l’Iptables permet crear regles que analitzaran els paquets de dades que entrin, surtin o passin per la nostra màquina. D’acord amb les condicions que establim, podrem prendre la decisió de permetre o denegar que els paquets continuïn el seu camí.
</p>

<p>
Per tant, hem de crear les regles principals que ajudin a analitzar els principals aspectes dels paquets de dades.
</p>
<div class="iocfigure"><a name=""></a><figure>
<figcaption><span class="figuretitle">Figura</span></figcaption><img src="../media/wic10_m7_uf3_u3_26.gif" alt="" /></figure>
<div class="footfigure"></div></div>
<p>
<form action=""><div class="solution ioccontent">
<p>
Per crear les regles, podem analitzar molts aspectes dels paquets de dades. De fet, podem filtrar els paquets segons un ventall de paràmetres:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Tipus de paquet de dades</strong></div>
<ul>
<li class="level2"><div class="li"> Tipus INPUT: Paquets que arriben a la nostra màquina.</div>
</li>
<li class="level2"><div class="li"> Tipus OUTPUT: Paquets que surten de la nostra màquina.</div>
</li>
<li class="level2"><div class="li"> Tipus FORWARD: Paquets que passen per la nostra màquina.</div>
</li>
</ul>
</li>
</ul>

<p>
<div class="imgelem">
<img src="../media/wic10_m7_uf3_u3_27.gif" alt="" /></div>

</p>
<ul>
<li class="level1"><div class="li"> <strong>Interfície per la qual entren (-i ? input) o surten (-o ? output) els paquets</strong></div>
<ul>
<li class="level2"><div class="li"> eth0, eth1, wlan0, ppp0, …</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <strong>Adreça d’Internet (IP) d’origen dels paquets (-s ? source)</strong></div>
<ul>
<li class="level2"><div class="li"> Adreça IP concreta, per exemple, 10.0.0.3</div>
</li>
<li class="level2"><div class="li"> Rang de xarxa, per exemple, 10.0.0.0/8</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <strong>Adreça d’Internet de destí dels paquets (-d ? destination)</strong></div>
<ul>
<li class="level2"><div class="li"> Adreça IP concreta, per exemple, 10.0.0.3</div>
</li>
<li class="level2"><div class="li"> Rang de xarxa, per exemple, 10.0.0.0/8</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <strong>Protocol dels paquets (-p ? protocol)</strong></div>
<ul>
<li class="level2"><div class="li"> TCP, UDP, ICMP, ..</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <strong>Fer NAT (modificar l’adreça d’Internet d’origen i destí per connectar la nostra xarxa a una altra xarxa o a Internet)</strong></div>
<ul>
<li class="level2"><div class="li"> Filtrar abans d’encaminar: PREROUTING</div>
</li>
<li class="level2"><div class="li"> Filtrar després d’encaminar: POSTROUTING</div>
</li>
</ul>
</li>
</ul>

<p>
Una opció senzilla per treballar amb Iptables és permetre les comunicacions que ens interessin i, a continuació, denegar la resta de les comunicacions. S’acostuma a definir la política, per defecte, d’acceptar (ACCEPT) i, després, crear regles concretes per permetre les comunicacions que ens interessin i, per últim, denegar la resta de les comunicacions.
</p>

<p>
Una opció força interessant és, si som en el terminal de comandes, obrir un editor de textos i crear un <em>script</em> en el qual disposarem la seqüència de regles que desitgem aplicar en el nostre sistema.
</p>
<pre class="code"># !/bin/sh

# Script tallafocs.sh per la configuració del iptables

# En primer lloc, esborrarem totes les regles prèvies que puguin existir

iptables –F

iptables –X

iptables –Z

iptables –t nat –F

# a continuació, definirem que la política per defecte sigui ACCEPTAR

iptables –P INPUT ACCEPT

iptables –P OUTPUT ACCEPT

iptables –P FORWARD ACCEPT

iptables –t nat –P PREROUTING ACCEPT

iptables –t nat –P POSTROUTING ACCEPT

# Per evitar possibles errors en el sistema, haurem d&#039;acceptar totes les comunicacions

# per la interfície lo (localhost)

iptables –A INPUT –i lo –j ACCEPT

# Acceptarem les comunicacions que ens interessin i, a continuació, denegarem la resta.

# Per exemple, podem denegar l&#039;accés al departament de Comptabilitat

iptables – A FORWARD –s 10.0.0.0/24 –j DROP

# Acceptarem els protocols SMTP, POP3 i FTP (correu electrònic i ftp)

iptables –A FORWARD – s 10.0.0.0/8 –p tcp - -dport 25 –j ACCEPT

iptables –A FORWARD – s 10.0.0.0/8 –p tcp - -dport 110 –j ACCEPT

iptables –A FORWARD – s 10.0.0.0/8 –p tcp - -dport 20 –j ACCEPT

iptables –A FORWARD – s 10.0.0.0/8 –p tcp - -dport 21 –j ACCEPT

# HTTP i HTTPS no calen perquè el nostre servidor serà un servidor intermediari (proxy)

# Deixarem comentades les línies, no fos cas que algun dia les necessitéssim

# iptables –A FORWARD – s 10.0.0.0/8 –p tcp - -dport 80 –j ACCEPT

# iptables –A FORWARD – s 10.0.0.0/8 –p tcp - -dport 443 –j ACCEPT

# El servidor de noms de domini no serà necessari perquè

# El nostre servidor serà DNS

#Deixarem comentades les línies relacionades amb el protocol TCP i UDP per si de cas

# iptables –A FORWARD – s 10.0.0.0/8 –p tcp - -dport 53 –j ACCEPT

# iptables –A FORWARD – s 10.0.0.0/8 –p udp - -dport 53 –j ACCEPT

# A l&#039;ordinador de l&#039;administrador de la xarxa li donarem accés a tot arreu

iptables – A FORWARD –s 10.0.0.7 –j ACCEPT

# Denegarem la resta de comunicacions (per exemple evitarem el P2P)

iptables – A FORWARD – s 10.0.0.0/8 –j DROP

#Fem NAT si l&#039;adreça d&#039;Internet d&#039;origen 10.0.0.0/8 i surten per eth0

iptables –t nat –A POSTROUTING –s 10.0.0.0/8 –o eth0 –j MASQUERADE

# Activem l&#039;encaminament

echo 1 &gt; /proc/sys/net/ipv4/ip_forward

# Comprovarem com queden les regles

iptables –L –n</pre>

<p>
De les regles establertes dins de l’script, podem destacar “-A FORWARD” que permet referir-nos als paquets que passaran pel nostre servidor. Des del punt de vista de les condicions establertes, “-s 10.0.0.0/8” farem referència a aquells paquets l’adreça d’Internet d’origen dels quals estigui en el rang 10.0.0.0/8.
</p>

<p>
Quan introduïm “-p tcp” fem referència als paquets que utilitza el protocol tcp. Per altra banda, amb “- -dport 25” ens referim als paquets que tinguin assignat com a port de destí el 25, és a dir, el corresponent al protocol SMTP (el correu que surt); si no haguéssim introduït “- -dport” voldria dir que no ens importa ni el port ni el protocol.
</p>
</div><input class="btn_solution3" type="button" value="Mostra"></input></form>
</p>

</div>

	 </article>
     <div class="pnpage">
      <div class="left-corner"></div>
      <div id="prevpage">Anar a la p&agrave;gina anterior:<br /><a href="../../../WebContent/u3/a2/continguts.html">Interconnexió de xarxes privades amb xarxes públiques</a></div>
      <div id="nextpage">Anar a la p&agrave;gina seg&uuml;ent:<br /><a href="../../../WebContent/u3/a2/exercicis.html">Exercicis d'autoavaluació</a></div>
      <div class="right-corner"></div>
     </div>
    </div>
    <footer class="footer">
      <div><small>Aquest document està subjecte a una llicència oberta de Creative Commons, es reserva el dret de reconeixement de l'autoria, d'exigir que no se'n faci cap mena d'ús comercial. Si altereu o transformeu aquesta obra, o en genereu obres derivades, només podeu distribuir l'obra generada amb una llicència idèntica a aquesta.</small></div>
    </footer>
 </div>
 <div id="back_preview" class="hidden"></div>
 <div id="preview" class="hidden">
  <div class="prevcontent"></div>
 </div>
 <div id="help-tooltips">
  <div id="help-toc" class="hidden tooltip"><span>Taula de continguts:</span> Ofereix una vista general de l&#39;estructura del m&ograve;dul, que us facilitar&agrave; la navegaci&oacute; a trav&eacute;s dels seus continguts.<span class="arrow-left"></span></div> 
  <div id="help-settings" class="hidden tooltip"><span>Opcions de format:</span> Permet configurar el format de lectura a partir de les vostres prefer&egrave;ncies, modificant la mida de la lletra, el color del fons, l&#39;amplada de la p&agrave;gina o l&#39;ocultaci&oacute; dels continguts complementaris, entre d&#39;altres.<span class="arrow-left"></span></div>
  <div id="help-printer" class="hidden tooltip"><span>Imprimir:</span>  Envia el contingut seleccionat a la impressora.<span class="arrow-left"></span></div>
  <div id="help-favorites" class="hidden tooltip"><span>Prefereits:</span> Permet desar aquelles parts del contingut a les que us interessi accedir en un moment posterior; us permetr&agrave; anar creant un repositori personalitzat de les seccions que considereu m&eacute;s rellevants. Un cop l&#39;hageu començat a fer servir se us mostrar&agrave; a sota un comptador que us informar&agrave; del nombre de preferits que s&#39;hagin emmagatzemat fins al moment.<span class="arrow-left"></span></div>
  <div id="help-favcounter" class="hidden tooltip"><span>Comptador i llistat de preferits:</span> Indica el nombre de preferits que s&#39;han desat fins el moment; clicant damunt seu accedireu al llistat de preferits, i a trav&eacute;s d&#39;aquest podreu accedir directament als continguts que hageu emmagatzemat.<span class="arrow-left"></span></div>
  <div id="help-help_icon" class="hidden tooltip"><span>Ajuda:</span> Aquesta opci&oacute; activa la informaci&oacute; de les funcionalitats del web tot situant el punter del ratol&iacute; al damunt dels diferents &iacute;tems.<span class="arrow-left"></span></div>
  <div id="help-sidebar-hide" class="hidden tooltip"><span>Mostrar/Ocultar barra lateral:</span>  Deshabilita la barra d&#39;opcions, permetent la seva recuperaci&oacute; quan es desitgi.<span class="arrow-left"></span></div>
  <div id="help-search" class="hidden tooltip"><span>Cerca:</span>  Introdu&iuml;u les paraules clau sobre aquells conceptes que desitgeu localitzar en els continguts del m&ograve;dul. Tamb&eacute; podeu excloure un terme de la cerca tot afegint-hi el signe &#8220;-&#8221; al davant.<span class="arrow-top"></span></div>
  <div id="help-header" class="hidden tooltip"><span>Cap&ccedil;alera:</span>  Indica l&#39;apartat o secci&oacute; que es mostra en pantalla. Tingueu present que les capçaleres de segon, tercer i quart nivell tamb&eacute; es poden desar com a marcadors.<span class="arrow-left"></span></div>
</div> 
</body>
</html>
