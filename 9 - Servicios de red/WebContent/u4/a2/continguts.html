<!doctype html>

<!--[if lt IE 7 ]> <html class="ie ie6 no-js" lang="ca"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie ie7 no-js" lang="ca"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie ie8 no-js" lang="ca"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie ie9 no-js" lang="ca"> <![endif]-->
<!--[if gt IE 9]><!--><html class="no-js" lang="ca"><!--<![endif]-->
<!-- the "no-js" class is for Modernizr. -->

<head id="www-sitename-com" data-template-set="html5-reset">

	<meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html">
        
	<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>Serveis de xarxa</title>
	
<!-- <meta name="title" content=""> --> 
	<meta name="description" content="">
	<!-- Google will often use this as its description of your page/site. Make it good. -->
	
	<meta name="google-site-verification" content="">
	<!-- Speaking of Google, don't forget to set your site up: http://google.com/webmasters -->
	
	<meta name="author" content="Institut Obert de Catalunya">
	<meta name="Copyright" content="Copyright Institut Obert de Catalunya 2011. All Rights Reserved.">

	<!-- Dublin Core Metadata : http://dublincore.org/ -->
	<meta name="DC.title" content="Serveis de xarxa">
	<meta name="DC.subject" content="Informàtica i comunicacions">
	<meta name="DC.creator" content="Institut Obert de Catalunya">
	
	<!--  Mobile Viewport Fix
	j.mp/mobileviewport & davidbcalhoun.com/2010/viewport-metatag 
	device-width : Occupy full width of the screen in its current orientation
	initial-scale = 1.0 retains dimensions instead of zooming out if page height > device height
	maximum-scale = 1.0 retains dimensions instead of zooming in if page width < device width
	-->
	<!-- Uncomment to use � use thoughtfully!
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	-->

	<link rel="shortcut icon" href="../../../img/favicon.ico">
	<!-- This is the traditional favicon.
		 - size: 16x16 or 32x32
		 - transparency is OK
		 - see wikipedia for info on browser support: http://mky.be/favicon/ -->
		 
	<link rel="apple-touch-icon" href="../../../img/apple-touch-icon.png">
	<!-- The is the icon for iOS's Web Clip.
		 - size: 57x57 for older iPhones, 72x72 for iPads, 114x114 for iPhone4's retina display (IMHO, just go ahead and use the biggest one)
		 - To prevent iOS from applying its styles to the icon name it thusly: apple-touch-icon-precomposed.png
		 - Transparency is not recommended (iOS will put a black BG behind the icon) -->
	
	<!-- CSS: screen, mobile & print are all in the same file -->
	<link rel="stylesheet" href="../../../_/css/style.css">

	<!-- CSS: jQuery UI -->
	<link rel="stylesheet" href="../../../_/css/jquery-ui.css">
	
	<!-- all our JS is at the bottom of the page, except for Modernizr. -->
	<script src="../../../_/js/modernizr-1.7.min.js"></script>
	<script src="../../../_/js/Hyphenator.js" type="text/javascript"></script>
	<script type="text/javascript">
	   Hyphenator.config({
		minwordlength : 4
	   });
	   Hyphenator.run();
	</script>
    <script src="../../../_/js/build.js" type="text/javascript"></script>
</head>

<body class="style-newspaper">

<div class="wrapper"><!-- not needed? up to you: http://camendesign.com/code/developpeurs_sans_frontieres -->

	<header id="header">
		<div class="head"><a href="http://ioc.gencat.cat"><img src="../../../img/logo.png" alt="Institut Obert de Catalunya"/></a><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/es/deed.ca"><img src="../../../img/license.png" alt="Llic&egrave;ncia" class="license"/></a></div>
		<div class="headdocument"><a href="../../../index.html">Serveis de xarxa</a></div>
        <div id="search" class="search" name="search">
         <form id="frmsearch" action="../../../search.html" method="get">
          <input type="text" name="q"/>
        </form>
        </div>
	</header>
   <div id="upbutton" class="upbutton" style="display:none;"><img src="../../../img/uparrow.png" alt="Pujar a l'inici de p&agrave;gina"/></div>
   <aside id="aside">
    <div id="menu">
      <ul>
       <li name="toc"><div><img src="../../../img/toc.png" alt="&Iacute;ndex"/></div></li>
       <li name="settings"><div><img src="../../../img/settings.png" alt="Configuraci&oacute;"/></div></li>
       <li name="printer"><div><img src="../../../img/printer.png" alt="Imprimir"/></div></li>
       <li name="favorites"><div><img src="../../../img/favorites.png" alt="Favorits"/></div></li>
       <li name="help_icon" class="help_icon"><div><img src="../../../img/help_icon.png" alt="Ajuda"/></div></li>
      </ul>
     </div>
   </aside>
   <div id="sidebar-hide" name="sidebar-hide"><img src="../../../img/arrows.png"/></div>
   <section>
     <div id="toc" class="hidden">
      <div class="menucontent">
        <ul>
        <li id="u4" class="parentnode"><p><a class="unit" href="../../../WebContent/u4/introduccio.html">4. Accés a sistemes remots</a></p><ul class="expander"><li id="u4introduccio"><a href="../../../WebContent/u4/introduccio.html">Introducció</a></li><li id="u4mapa"><a href="../../../WebContent/u4/mapa.html">Mapa conceptual</a></li><li id="u4referencies"><a href="../../../WebContent/u4/referencies.html">Més informació</a></li><li id="u4resultats"><a href="../../../WebContent/u4/resultats.html">Resultats d'aprenentatge</a></li><li id="u4resum"><a href="../../../WebContent/u4/resum.html">Resum</a></li><li id="u4a1" class="tocsection"><p id='u4a1continguts'><a class="section" href="../../../WebContent/u4/a1/continguts.html">Introducció a l'accés remot a equips</a><span class="buttonexp"></span></p><ul><li id="u4a1activitats"><a href="../../../WebContent/u4/a1/activitats.html">Activitats</a></li><li id="u4a1exercicis"><a href="../../../WebContent/u4/a1/exercicis.html">Exercicis d'autoavaluació</a></li></ul></li><div data-parent-id='u4a1' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u4/a1/continguts.html#usos_mes_frequeents_de_l_acces_remot_a_ordinadors">Usos més freqüents de l'accés remot a ordinadors</a></li><li><a href="../../../WebContent/u4/a1/continguts.html#diferents_tipus_d_acces_remot">Diferents tipus d'accés remot</a></li></ul></div></div><li id="u4a2" class="tocsection"><p id='u4a2continguts'><a class="section" href="../../../WebContent/u4/a2/continguts.html">Administració remota basada en la línea d'ordres</a><span class="buttonexp"></span></p><ul><li id="u4a2activitats"><a href="../../../WebContent/u4/a2/activitats.html">Activitats</a></li><li id="u4a2annexos"><a href="../../../WebContent/u4/a2/annexos.html">Annexos</a></li><li id="u4a2exercicis"><a href="../../../WebContent/u4/a2/exercicis.html">Exercicis d'autoavaluació</a></li></ul></li><div data-parent-id='u4a2' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u4/a2/continguts.html#telnet">Telnet</a></li><li><a href="../../../WebContent/u4/a2/continguts.html#introduccio_a_ssh">Introducció a SSH</a></li></ul></div></div><li id="u4a3" class="tocsection"><p id='u4a3continguts'><a class="section" href="../../../WebContent/u4/a3/continguts.html">Administració remota amb interfície gràfica</a><span class="buttonexp"></span></p><ul><li id="u4a3activitats"><a href="../../../WebContent/u4/a3/activitats.html">Activitats</a></li><li id="u4a3annexos"><a href="../../../WebContent/u4/a3/annexos.html">Annexos</a></li><li id="u4a3exercicis"><a href="../../../WebContent/u4/a3/exercicis.html">Exercicis d'autoavaluació</a></li></ul></li><div data-parent-id='u4a3' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u4/a3/continguts.html#la_transparencia_de_xarxa_del_sistema_x_window">La transparència de xarxa del sistema X Window</a></li><li><a href="../../../WebContent/u4/a3/continguts.html#vnc_virtual_network_computing">VNC Virtual Network Computing</a></li></ul></div></div><li id="u4a4" class="tocsection"><p id='u4a4continguts'><a class="section" href="../../../WebContent/u4/a4/continguts.html">Gestió remota mitjançant una aplicació local</a><span class="buttonexp"></span></p><ul><li id="u4a4activitats"><a href="../../../WebContent/u4/a4/activitats.html">Activitats</a></li><li id="u4a4exercicis"><a href="../../../WebContent/u4/a4/exercicis.html">Exercicis d'autoavaluació</a></li></ul></li><div data-parent-id='u4a4' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u4/a4/continguts.html#introduccio_a_webmin">Introducció a Webmin</a></li></ul></div></div></ul></li><li id="" class="indexnode"><p><a href="../../../index.html">Anar a l&#39;&iacute;ndex general</a></p></li>
        </ul>
      </div>
    </div>
   </section>
   <section>
   <div id="settings" class="hidden">
    <div class="menucontent">
     <div class="allsettings">
     <div class="settings">
      <label>Font i Color</label>
		<div class="setting-option">
	        <ul class="fontBackground">
				<li id="style-newspaper" title="Newspaper" class="appearance-style-newspaper"><span>Newspaper</span></li>
                <li id="style-novel" title="Novel" class="appearance-style-novel"><span>Novel</span></li>
                <li id="style-ebook" title="eBook" class="appearance-style-ebook"><span>eBook</span></li>
				<li id="style-inverse" title="Inverse" class="appearance-style-inverse active"><span>Inverse</span></li>
				<li id="style-athelas" title="Athelas" class="appearance-style-athelas"><span>Athelas</span></li>
			</ul>
		</div>
     </div>
	<div class="settings">
      <label>Amplada</label>
		<div class="setting-option">
	        <div id="slider-width"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
		<div class="setting-option">
	        <div id="slider-font"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
	  <div class="setting-option">
       <form action="" class="sett-options">
		<ul>
		    <li><input type="checkbox" id="secondary-content" /><label for="secondary-content">Mostra recursos complementaris</label></li>
		    <li><input type="checkbox" id="main-images" /><label for="main-images">Mostra imatges</label></li>
		    <li><input type="checkbox" id="text-alignment" /><label for="text-alignment">Text justificat</label></li>
			<li><input type="checkbox" id="text-hyphen" /><label for="text-hyphen">Partici&oacute; sil·l&agrave;bica</label></li>
		</ul>
       </form>
	  </div>
     </div>
     </div>
    </div>
   </div>
   </section>
 <section>
 <div id="favorites" class="hidden"></div>
 </section>   
 <div id="bridge" class="hidden"></div>
 <div id="help" class="hidden">
  <div class="helptitle">Dreceres del teclat<hr></div>
  <div class="helpsection"><span>General</span>
   <ul>
    <li><span class="shortcut">g</span>: Anar al men&uacute; de navegaci&oacute;</li>
    <li><span class="shortcut">o</span>: Anar a opcions</li>
    <li><span class="shortcut">s</span>: Guardar la p&agrave;gina actual a favorits</li>
    <li><span class="shortcut">p</span>: Imprimir la p&agrave;gina actual</li>
    <li><span class="shortcut">?</span>: Mostrar/Ocultar l&#39;ajuda</li>
   </ul>
  </div>
  <div class="helpsection"><span>Navegaci&oacute;</span>
   <ul>
    <li><span class="shortcut">i</span>: Anar a l&#39;&iacute;ndex general</li>
    <li><span class="shortcut">t</span>: Anar a l&#39;inici de p&agrave;gina</li>
    <li><span class="shortcut">b</span>: Anar al final de p&agrave;gina</li>
    <li><span class="shortcut">j</span>: Anar cap endavant dintre la p&agrave;gina</li>
    <li><span class="shortcut">k</span>: Anar cap enrere dintre la p&agrave;gina</li>
    <li><span class="shortcut">h</span>: Anar a la p&agrave;gina anterior:</li>
    <li><span class="shortcut">l</span>: Anar a la p&agrave;gina seg&uuml;ent:</li>
   </ul>
   </div>
 </div>
 <div id="favcounter" name="favcounter" class="hidden"><span></span></div>
 <div id="navmenu" class="navmenu"><ul class="webnav"><li><a href="../../../index.html" title="Anar a l&#39;&iacute;ndex general">Inici</a></li><li><a href="../introduccio.html">Accés a sistemes remots</a></li><li>Administració remota basada en la línea d'ordres</li></ul></div>
	<div id="content" lang="ca" class="hyphenate text">
     <article lang="ca" class="sheet">
        <h1><a id="administracio_remota_basada_en_la_linea_d_ordres"> Administració remota basada en la línea d'ordres </a></h1>
    	
<p>
Les connexions remotes mitjançant la línea d’ordres són l’opció que menys capacitats exigeix a la xarxa i per tant es poden fer servir fins i tot en els casos en què el canal de comunicació no té una gran amplada de banda disponible o quan el retard és important. Exigeixen conèixer la sintaxi pròpia de l’intèrpret d’ordres emprat i de les seves eines, però són un mecanisme molt flexible que permet fer moltes automatitzacions.
</p>

<p>
Les eines principals per iniciar una sessió de treball remota amb una línea d’ordres són <strong>Telnet</strong> i <strong>SSH</strong>. Totes dues permeten treballar com si s’estigués davant del teclat i de la pantalla de l’estació remota i estan basades en una arquitectura client-servidor, però les diferències entre elles són profundes. <strong>Telnet</strong> encara s’utilitza per raons històriques: és possible que trobem commutadors o servidors d’impressió als quals podem accedir remotament per fer tasques d’administració. Però el fet que la informació es transmeti com a text clar suposa un problema greu de seguretat. Avui dia el seu ús està completament desaconsellat i s’exigeix prendre mesures addicionals.
</p>

<h2><a id="telnet" >Telnet</a></h2>
<div class="level2">

<p>
La falta de mesures de seguretat modernes impedeix emprar Telnet de manera generalitzada, però encara és una eina molt eficaç per connectar amb servidors que treballen amb text clar (com els servidors HTTP, SMTP) per diagnosticar problemes.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Telnet</p>
<p>
Normalment el servidor Telnet acostuma a esperar les connexions dels clients en el port TCP 23. És un protocol antic, desenvolupat el 1969, que pot ser compromès amb qualsevol programari captador de paquets (<em>packet sniffer)</em>.
</p>
</div></div>
</div>

<h3><a id="instal_lacio_de_telnet" >Instal·lació de Telnet</a></h3>
<div class="level3">

<p>
En la major part de distribucions GNU/Linux el client Telnet ja està instal·lat de manera predeterminada en el sistema, però en cas que no hi sigui es pot instal·lar amb la instrucció següent des de l’intèrpret d’ordres:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">HTTP</p>
<p>
El protocol de transferència d’hipertext o HTTP (<em>hypertext transfer protocol</em>) estableix el protocol per a l’intercanvi de documents d’hipertext i multimèdia a la web.
</p>
</div></div><pre class="code bash"><ol><li class="li1"><div class="de1">#sudo apt-get install Telnet</div></li></ol></pre>

<p>
Normalment utilitzareu la eina Telnet per connectar-vos a altres serveis de xarxa (com HTTP o SMTP), però també podeu instal·lar un servidor Telnet en la vostra màquina i utilitzar-lo per fer connexions remotes. Recordeu, però, que el protocol que utilitza Telnet no és segur i que per tant la vostra connexió sempre estarà en perill de ser interceptada per tercers. Si, per exemple, a una connexió Telnet escriviu alguna contrasenya, aquesta podrà ser interceptada amb facilitat.
</p>
<div class="iocfigure"><a name="Figura6"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Arquitectura client-servidor

</figcaption><img src="../media/smxm7uf4ud4_im6.png" alt="" /></figure>
<div class="footfigure">El servei Telnet utilitza una aquitectura client-servidor. Els clients es connectaran  remotament al servidor Telnet.</div></div>
<p>

</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">SMTP</p>
<p>
SMTP és l’acrònim de <em>simple mail transfer protocol</em>, és a dir, protocol simple de transferència de correu, i és un protocol de xarxa basat en text utilitzat per a l’intercanvi de missatges de correu electrònic.
</p>
</div></div>
<p>
La instal·lació del servidor Telnet es pot fer executant la instrucció següent des de l’intèrpret d’ordres:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">#sudo apt-get install Telnetd</div></li></ol></pre>

<p>
També és convenient instal·lar el dimoni xinetd. Xinetd correspon a l’acrònim <em>eXtended InterNET Daemon</em> (dimoni ampliat d’Internet) i és un servei o dimoni utilitzat en una gran part dels sistemes Unix i GNU/Linux dedicat a administrar la connectivitat basada en Internet. Aquest servei conté mecanismes de control d’accés, la possibilitat d’habilitar i deshabilitar serveis de xarxa. Aquest dimoni, per exemple, s’encarrega d’iniciar serveis com <acronym title="File Transfer Protocol">FTP</acronym> i Telnet.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">#sudo apt-get install xinetd</div></li></ol></pre>

<p>
A continuació ens assegurem de reiniciar els serveis de xarxa per tal d’estar segurs que el servidor Telnet està activat.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">#sudo /etc/init.d/xinetd restart</div></li></ol></pre>

</div>

<h3><a id="acces_remot_mitjancant_telnet" >Accés remot mitjançant Telnet</a></h3>
<div class="level3">

<p>
Un cop instal·lat el servidor Telnet, ja hi podem accedir des de qualsevol màquina que tingui el client instal·lat. La sintaxi bàsica de Telnet és la següent:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">Telnet &lt;hostname&gt; &lt;port&gt;</div></li></ol></pre>
<ul>
<li class="level1"><div class="li"> &lt;hostname&gt; representa l’adreça IP o el nom del servidor al qual ens volem connectar.</div>
</li>
<li class="level1"><div class="li"> &lt;port&gt; és el número de port del servei al qual ens volem connectar. De manera predeterminada és el port 23, que és el port utilitzat per Telnet.</div>
</li>
</ul>

<p>
A la <span class="tabref"><a href="#Table2"><span>taula</span></a></span> podeu veure un llistat d’alguns dels ports TCP més utilitzats habitualment:
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table2"><span>Taula: </span></a>Ports TCP</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Número de port </th><th class="col1 leftalign"> Servei                                                                                                                                                          </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> 21             </td><td class="col1 leftalign"> <acronym title="File Transfer Protocol">FTP</acronym> (file transfer protocol): sistema per transferir fitxers                                                                                                    </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> 22             </td><td class="col1 leftalign"> SSH: protocol i programa que l’implementa. Serveix per accedir a màquines remotes a través de la xarxa de manera segura.                                        </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> 23             </td><td class="col1 leftalign"> Servidor Telnet                                                                                                                                                 </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> 25             </td><td class="col1 leftalign"> SMTP: protocol de xarxa basat en text utilitzat per a l’intercanvi de missatges de correu electrònic.                                                           </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> 53             </td><td class="col1 leftalign"> <acronym title="Domain Name System">DNS</acronym> (domain name server): servei utilitzat per “traduir” les adreces IP a un nom de domini.                                                                     </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> 80             </td><td class="col1"> HTTP: protocol per a l’intercanvi de documents d’hipertext i multimèdia en la web. És el port utilitzat de manera predeterminada pels servidors de pàgines web. </td>
	</tr>
</table></div>
</div>
<p>
Per exemple, si us voleu connectar a un equip que té una IP 192.168.2.5:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">TCP</p>
<p>
El protocol de control de les transmissions (<em>transmission control protocol</em>) és un protocol orientat a la connexió dintre del nivell de transport del model OSI que permet l’entrega de paquets de manera fiable, en el cas de TCP anomenats segments.
</p>
</div></div><pre class="code bash"><ol><li class="li1"><div class="de1">client@client# Telnet 192.168.2.5</div></li><li class="li1"><div class="de1">Trying 192.168.2.5...</div></li><li class="li1"><div class="de1">Connected to 192.168.2.5.</div></li><li class="li1"><div class="de1">Escape character is '^]'.</div></li><li class="li1"><div class="de1">Linkat 2.0</div></li><li class="li1"><div class="de1">servidor login: usuari</div></li><li class="li1"><div class="de1">Password: </div></li><li class="li1"><div class="de1">Last login: Mon Jan  1 12:26:17 GMT 2010 from servidor.local on </div></li><li class="li1"><div class="de1">pts/1</div></li><li class="li1"><div class="de1">Linux equip 2.6.31-17-generic #54-LinkatSMP Thu Dec 10 16:20:31 </div></li><li class="li1"><div class="de1">UTC 2009 i686</div></li><li class="li1"><div class="de1">usuari@ servidor:~$</div></li></ol></pre>

<p>
Com podeu veure, després de diversa informació posem el cursor a la línia d’ordres i podem fer qualsevol tasca com si fóssim a l’equip remot.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Destacat en negreta</p>
<p>
Es troba destacat en negreta tot el que hem escrit en el nostre terminal. La resta s’ha generat de manera automàtica.
</p>
</div></div>
<p>
Una manera diferent de connectar-se és obrint una sessió de Telnet i utilitzar les instruccions per obrir la connexió.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">client@client# Telnet</div></li><li class="li1"><div class="de1">Telnet&gt; open 192.168.2.5</div></li><li class="li1"><div class="de1">Trying 192.168.2.5...</div></li><li class="li1"><div class="de1">Connected to 192.168.2.5.</div></li><li class="li1"><div class="de1">Escape character is '^]'.</div></li><li class="li1"><div class="de1">Linkat 2.0</div></li><li class="li1"><div class="de1">servidor login: usuari</div></li><li class="li1"><div class="de1">Password: </div></li><li class="li1"><div class="de1">Last login: Mon Jan  1 12:26:17 GMT 2010 from servidor.local on </div></li><li class="li1"><div class="de1">pts/1</div></li><li class="li1"><div class="de1">Linux equip 2.6.31-17-generic #54-LinkatSMP Thu Dec 10 16:20:31 </div></li><li class="li1"><div class="de1">UTC 2009 i686</div></li></ol></pre>

<p>
Les instruccions més habituals de Telnet les podeu trobar a la <span class="tabref"><a href="#Table3"><span>taula</span></a></span>.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table3"><span>Taula: </span></a>Algunes instruccions de Telnet</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Instrucció               </th><th class="col1 leftalign">                                                                           </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> c - close                </td><td class="col1 leftalign"> Tancar la connexió.                                                       </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> d - display              </td><td class="col1 leftalign"> Mostrar els paràmetres configurats en la connexió.                        </td>
	</tr>
	<tr class="row3">
		<td class="col0"> o - open hostname [port] </td><td class="col1 leftalign"> Obrir una connexió en un ordinador remot. El paràmetre port és opcional.  </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> q - quit                 </td><td class="col1 leftalign"> Sortir de Telnet.                                                         </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> ?/h - help               </td><td class="col1"> Mostrar l’ajuda de Telnet. Es mostren totes les instruccions disponibles. </td>
	</tr>
</table></div>
</div>
</div>

<h3><a id="acces_a_serveis_web_mitjancant_telnet" >Accés a serveis web mitjançant Telnet</a></h3>
<div class="level3">

<p>
La Linkat2 ens permet, per exemple, establir una connexió amb el servidor de pàgines web local (en la Linkat2 s’executa el servidor HTTP Apache). Una vegada establerta la connexió, podrem dialogar amb el servidor per tal de sol·licitar informació diversa.
</p>
<div class="ioctextl"><div class="ioccontent"><p class="ioctitle">Servidor web Apache</p>
<p>
És un servidor HTTP de codi obert multiplataforma desenvolupat per Apache Software Foundation. Quan en va començar el desenvolupament el 1995, es basava en el codi del servidor web NCSA HTTPd 1.3, però més tard es va reescriure completament.
</p>

<p>
Apache presenta, entre altres característiques, missatges d’error altament configurables, bases de dades d’autenticació i negociació de continguts.
</p>

<p>
Des d’abril de 1996 Apache ha estat el servidor HTTP més popular a la <em>world wide web</em>.
</p>
</div></div>
<p>
Es pot utilitzar per fer comprovacions del funcionament correcte del servidor i per diagnosticar problemes. Per exemple, ens connectem a una pàgina web que acaben de dissenyar i no hi veiem res. Mitjançant l’ús de Telnet podem arribar a veure quin és el problema. També pot ser útil en situacions en què l’equip no disposa de navegador web i volem comprovar si el servidor web respon a les peticions.
</p>

<p>
Un servidor web no permet l’accés mitjançant un intèrpret d’ordres, només respon a les peticions HTTP enviades a aquest, que és exactament el que fan els navegadors web. Un navegador estableix una connexió amb el servidor web i demana una pàgina que utilitza un conjunt d’ordres del protocol HTTP.
</p>

<p>
A continuació simularem una connexió bàsica a un servidor web i obtindrem algunes dades. El servidor web que utilitzarem serà el servidor local (localhost) i el port serà el que utilitzen els servidors web predeterminats, el 80.
</p>

<p>
Un cop establerta la connexió amb el servidor web, és necessari introduir algunes ordres HTTP per obtenir algunes dades del servidor web.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">client@client# Telnet localhost 80</div></li><li class="li1"><div class="de1">Trying localhost...</div></li><li class="li1"><div class="de1">Connected to localhost.</div></li><li class="li1"><div class="de1">Escape character is '^]'.</div></li></ol></pre>

<p>
Fixeu-vos que no demana cap usuari ni cap contrasenya, ja que el servidor web només és capaç de rebre peticions i donar respostes. Utilitzem instruccions del servidor HTTP per demanar informació sobre la capçalera d’una pàgina web situada a l’arrel del servidor i que s’anomena index.html.
</p>
<pre class="code html4strict"><ol><li class="li1"><div class="de1">HEAD /index.html HTTP/1.1&lt;CR&gt;</div></li><li class="li1"><div class="de1">Host:localhost&lt;CR&gt;</div></li><li class="li1"><div class="de1">&lt;CR&gt;</div></li></ol></pre>

<p>
Un cop feta la petició, el servidor respon amb la informació de capçalera relacionada amb la pàgina <acronym title="HyperText Markup Language">HTML</acronym> index.html o un error si heu introduït malament les ordres HTTP. La connexió Telnet es tancarà automàticament.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">&lt;CR&gt;</p>
<p>
CR indica que s’ha d’inserir un salt de línia (Intro). Noteu sobretot el de la tercera línia, que és el que envia la petició al servidor web.
</p>
</div></div><pre class="code bash"><ol><li class="li1"><div class="de1">HTTP/1.1 200 OK</div></li><li class="li1"><div class="de1">Date: Mon, 01 Feb 2010 18:27:53 GMT</div></li><li class="li1"><div class="de1">Server: Apache/2.2.12 (Linkat)</div></li><li class="li1"><div class="de1">Last-Modified: Tue, 15 Dec 2009 12:01:56 GMT</div></li><li class="li1"><div class="de1">ETag: &quot;336be-b1-47ac3281ad04e&quot;</div></li><li class="li1"><div class="de1">Accept-Ranges: bytes</div></li><li class="li1"><div class="de1">Content-Length: 177</div></li><li class="li1"><div class="de1">Vary: Accept-Encoding</div></li><li class="li1"><div class="de1">Content-Type: text/html</div></li><li class="li1"><div class="de1">X-Pad: avoid browser bug</div></li></ol></pre>

<p>
De tota la informació, la més important és la línia en què diu 200 OK, que indica que les ordres s’han introduït correctament i el servidor web ha respost a la petició HTTP. Si introduïu malament alguna de les ordres rebreu una resposta semblant a aquesta:
</p>
<pre class="code html4strict"><ol><li class="li1"><div class="de1">&lt;!DOCTYPE HTML PUBLIC &quot;-//IETF//DTD HTML 2.0//EN&quot;&gt;</div></li><li class="li1"><div class="de1">&lt;html&gt;&lt;head&gt;</div></li><li class="li1"><div class="de1">&lt;title&gt;400 Bad Request&lt;/title&gt;</div></li><li class="li1"><div class="de1">&lt;/head&gt;&lt;body&gt;</div></li><li class="li1"><div class="de1">&lt;h1&gt;Bad Request&lt;/h1&gt;</div></li><li class="li1"><div class="de1">&lt;p&gt;Your browser sent a request that this server could not </div></li><li class="li1"><div class="de1">understand.&lt;br /&gt;</div></li><li class="li1"><div class="de1">&lt;/p&gt;</div></li><li class="li1"><div class="de1">&lt;hr&gt;</div></li><li class="li1"><div class="de1">&lt;address&gt;Apache/2.2.12 Server at 127.0.1.1 Port 80&lt;/address&gt;</div></li><li class="li1"><div class="de1">&lt;/body&gt;&lt;/html&gt;</div></li><li class="li1"><div class="de1">Connection closed by foreign host.</div></li></ol></pre>

<p>
La part que indica que hi ha hagut una petició incorrecta és a la línia on hi ha el títol de la pàgina web: &lt;title&gt;400 Bad Request&lt;/title&gt;. El codi 400 és un dels codis d’error del protocol HTTP que indica que hi ha hagut una mala petició.
</p>

<p>
També es pot demanar una pàgina web sencera utilitzant Telnet. El que s’ha de fer primer és obrir una sessió de Telnet:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">client@client# Telnet localhost 80</div></li><li class="li1"><div class="de1">Trying localhost...</div></li><li class="li1"><div class="de1">Connected to localhost.</div></li><li class="li1"><div class="de1">Escape character is '^]'.</div></li></ol></pre>

<p>
A continuació utilitzem l’ordre del servidor HTTP que serveix per demanar una pàgina web (GET); en concret, demanarem la pàgina web situada a l’arrel del servidor i que s’anomena index.html.
</p>
<pre class="code html4strict"><ol><li class="li1"><div class="de1">GET /index.html HTTP/1.1&lt;CR&gt;</div></li><li class="li1"><div class="de1">Host:localhost&lt;CR&gt;</div></li><li class="li1"><div class="de1">&lt;CR&gt;</div></li></ol></pre>

<p>
Un cop feta la petició el servidor respon amb informació de capçalera relacionada amb la pàgina <acronym title="HyperText Markup Language">HTML</acronym> index.html i finalment proporciona el seu contingut en codi <acronym title="HyperText Markup Language">HTML</acronym>:
</p>
<pre class="code html4strict"><ol><li class="li1"><div class="de1">HTTP/1.1 200 OK</div></li><li class="li1"><div class="de1">Date: Tue, 02 Feb 2010 09:12:21 GMT</div></li><li class="li1"><div class="de1">Server: Apache/2.2.12 </div></li><li class="li1"><div class="de1">Last-Modified: Tue, 15 Dec 2009 12:01:56 GMT</div></li><li class="li1"><div class="de1">ETag: &quot;336be-b1-47ac3281ad04e&quot;</div></li><li class="li1"><div class="de1">Accept-Ranges: bytes</div></li><li class="li1"><div class="de1">Content-Length: 177</div></li><li class="li1"><div class="de1">Vary: Accept-Encoding</div></li><li class="li1"><div class="de1">Content-Type: text/html</div></li><li class="li1"><div class="de1">X-Pad: avoid browser bug</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">&lt;html&gt;&lt;body&gt;&lt;h1&gt;It works!&lt;/h1&gt;</div></li><li class="li1"><div class="de1">&lt;p&gt;This is the default web page for this server.&lt;/p&gt;</div></li><li class="li1"><div class="de1">&lt;p&gt;The web server software is running but no content has been </div></li><li class="li1"><div class="de1">added, yet.&lt;/p&gt;</div></li><li class="li1"><div class="de1">&lt;/body&gt;&lt;/html&gt;</div></li></ol></pre>

<p>
D’aquesta resposta, la primera part o capçalera serà utilitzada pel navegador per interpretar i mostrar correctament la pàgina web; la última part, compresa entre les etiquetes &lt;html&gt; i &lt;/html&gt;, és el contingut web.
</p>

</div>

<h3><a id="acces_a_serveis_de_correu_electronic_mitjancant_telnet" >Accés a serveis de correu electrònic mitjançant Telnet</a></h3>
<div class="level3">

<p>
La distribució Linkat (com la majoria de distribucions GNU/Linux) té instal·lat de manera predeterminada el client Telnet, que permet establir una connexió amb el servidor de correu local. En la Linkat, s’executa el servidor SMTP Postfix, que accepta connexions al port 25. Una vegada establerta la connexió, podrem dialogar amb el servidor per tal de sol·licitar l’entrega d’un missatge de usuari@elmeudomini.net cap a root@localhost.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1"># Telnet localhost 25</div></li><li class="li1"><div class="de1">Trying 127.0.0.1...</div></li><li class="li1"><div class="de1">Connected to localhost.</div></li><li class="li1"><div class="de1">Escape character is '^]'.</div></li><li class="li1"><div class="de1">220 linkat2.qemu ESMTP Postfix</div></li><li class="li1"><div class="de1">HELO elmeudomini.net</div></li><li class="li1"><div class="de1">250 linkat2.qemu</div></li><li class="li1"><div class="de1">MAIL FROM: usuari@elmeudomini.net</div></li><li class="li1"><div class="de1">250 Ok</div></li><li class="li1"><div class="de1">RCPT TO: root@localhost</div></li><li class="li1"><div class="de1">250 Ok</div></li><li class="li1"><div class="de1">DATA</div></li><li class="li1"><div class="de1">354 End data with &lt;CR&gt;&lt;LF&gt;.&lt;CR&gt;&lt;LF&gt;</div></li><li class="li1"><div class="de1">Subject: Aquest és un correu de prova</div></li><li class="li1"><div class="de1">From: usuari@elmeudomini.net</div></li><li class="li1"><div class="de1">To: root@localhost</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Hola,</div></li><li class="li1"><div class="de1">Emprant una connexió Telnet amb el servidor SMTP (Postfix) estem </div></li><li class="li1"><div class="de1">escrivint un missatge de prova per a root@localhost.</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Adéu.</div></li><li class="li1"><div class="de1">.</div></li><li class="li1"><div class="de1">250 Ok: queued as BD700FF3E2</div></li><li class="li1"><div class="de1">quit</div></li><li class="li1"><div class="de1">221 Bye</div></li><li class="li1"><div class="de1">Connection closed by foreign host.</div></li></ol></pre>

<p>
En tancar la connexió amb el servidor SMTP, l’intèrpret d’ordre ens indicarà que hem rebut un nou missatge. El podrem llegir mitjançant l’ordre <strong>mail</strong>.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Instruccions SMTP</p>
<p>
HELO per obrir una sessió amb el servidor. MAIL FROM per indicar qui envia el missatge. RCPT TO per indicar el destinatari. DATA per indicar l’inici del missatge, que finalitzarà quan hi hagi una línia amb tan sols un punt. QUIT per tancar la sessió.
</p>
</div></div><pre class="code bash"><ol><li class="li1"><div class="de1">You have mail in /var/mail/root</div></li><li class="li1"><div class="de1"># mail</div></li><li class="li1"><div class="de1">mailx version nail 11.25 7/29/05.  Type ? for help.</div></li><li class="li1"><div class="de1">&quot;/var/mail/root&quot;: 1 message 1 new</div></li><li class="li1"><div class="de1">&gt;N  1 usuari@elmeudomini Wed Apr  2 13:35   18/664   Aquest és </div></li><li class="li1"><div class="de1">un correu de prova</div></li><li class="li1"><div class="de1">? 1</div></li><li class="li1"><div class="de1">Message  1:</div></li><li class="li1"><div class="de1">From usuari@elmeudomini.net  Wed Apr  2 13:35:26 2008</div></li><li class="li1"><div class="de1">X-Original-To: root@localhost</div></li><li class="li1"><div class="de1">Delivered-To: root@localhost.linkat2.qemu</div></li><li class="li1"><div class="de1">Subject: Aquest és un correu de prova</div></li><li class="li1"><div class="de1">From: usuari@elmeudomini.net</div></li><li class="li1"><div class="de1">To: root@localhost.linkat2.qemu</div></li><li class="li1"><div class="de1">Date: Wed,  2 Apr 2008 13:33:18 +0200 (CEST)</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Hola,</div></li><li class="li1"><div class="de1">Emprant una connexió Telnet amb el servidor SMTP (Post-fix) estem </div></li><li class="li1"><div class="de1">escrivint un missatge de prova per a root@localhost.</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Adéu.</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">?</div></li></ol></pre>

</div>

<h2><a id="introduccio_a_ssh" >Introducció a SSH</a></h2>
<div class="level2">

<p>
SSH és un protocol de xarxa que permet l’intercanvi d’informació de manera segura. Utilitza encriptació i criptografia de clau pública per tal de fer l’autenticació de l’estació remota.
</p>

<p>
Una de les funcions més emprades és iniciar una sessió remota per tal d’executar ordres. Però les seves capacitats són més àmplies, ja que també permet:
</p>
<ul>
<li class="level1"><div class="li"> Transmetre fitxers de manera segura.</div>
</li>
<li class="level1"><div class="li"> Fer túnels per assegurar qualsevol servei que no es transmeti encriptat (HTTP, SMTP, VNC, etc.) o per travessar tallafocs que estiguin bloquejant el protocol.</div>
</li>
<li class="level1"><div class="li"> Reenviament automàtic de sessions X11.</div>
</li>
<li class="level1"><div class="li"> Fins i tot, en fer servir SSHFS, actuar com a sistema de fitxers en xarxa.</div>
</li>
</ul>

<p>
Les seves possibilitats es poden combinar de moltes maneres diferents. Donades les seves capacitats criptogràfiques, SSH és una eina fonamental per a l’administrador de xarxa.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Reenviament de sessions X11</p>
<p>
Permet executar programari en un equip remot visualtizant l’interfície gràfica en l’equip local.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">SSHFS</p>
<p>
<em>SSH File System</em>. Sistema de fitxers en xarxa que fa servir SSH per comunicar els diferents equips.
</p>
</div></div>
</div>

<h3><a id="historia_de_ssh" >Història de SSH</a></h3>
<div class="level3">

<p>
SSH1 i el protocol SSH1 van ser desenvolupats el 1995 per Tatu Ylönen, un investigador de la Universitat Tecnològica de Hèlsinki, a Finlàndia. Després que la xarxa de la seva universitat va ser víctima d’un atac per part d’un programa que captava contrasenyes, Ylönen va desenvolupar SSH1 per a si mateix. Quan les primeres versions van començar a cridar l’atenció, es va adonar que el seu producte de seguretat podria tenir un ús molt més ampli que no només la seva universitat.
</p>

<p>
El juliol de 1995, SSH1 va ser llançat al públic amb llicència de programari lliure, i es permetia que la gent copiés i utilitzés el programa sense cap cost. A finals d’any, s’estima que 20.000 usuaris de 50 països diferents havien adoptat SSH1. Com a conseqüència d’això, Ylönen es va trobar rebent més de 150 missatges de correu electrònic al dia demanant ajuda i preguntant dubtes sobre SSH. En resposta, Ylönen va fundar la companyia SSH Communications Security, Inc (SCS) el desembre de 1995 per mantenir, comercialitzar i continuar el desenvolupament de SSH. Avui és president i director de tecnologia d’aquesta empresa.
</p>

<p>
El 1998, SCS llança el producte de programari SSH Secure Shell (SSH2). No obstant això, SSH2 no substitueix SSH1 definitivament per dues raons. En primer lloc, a SSH2 li faltava una sèrie de característiques pràctiques útils i opcions de configuració de SSH1. En segon lloc, SSH2 tenia una llicència més restrictiva. SSH1, originalment, havia estat disponible gratuïtament per a tothom; fins i tot versions posteriors de SSH1 desenvolupades per SCS estaven disponibles gratuïtament per a la majoria dels usos, fins i tot en entorns comercials, sempre que el programari no es vengués directament.
</p>
<div class="ioctextl"><div class="ioccontent"><p class="ioctitle">OpenBSD</p>
<p>
OpenBSD és un sistema operatiu de tipus Unix, creat a partir de la Berkeley Software Distribution (BSD), un derivat d’Unix desenvolupat a la Universitat de Califòrnia, a Berkeley.
</p>

<p>
El projecte és àmpliament conegut per la insistència dels desenvolupadors en el programari de codi obert, la documentació de qualitat i la concentració en la seguretat i la correcció de codi. El projecte està coordinat des de casa de Raadt a Calgary, Alberta, Canadà. El seu logotip i la mascota són un peix globus anomenat Puffy.OpenBSD inclou de manera predeterminada una sèrie de característiques de seguretat que no es troben o s’han d’instal·lar en altres sistemes operatius.
</p>
</div></div>
<p>
SSH2, per contra, era un producte comercial que només es permetia utilitzar sense cost a les entitats educatives i a organitzacions no governamentals sense ànim de lucre. Com a resultat, quan SSH2 va aparèixer per primera vegada, els usuaris de la major part de SSH1 existents van veure pocs avantatges per canviar a SSH2 i la majoria d’usuaris va continuar utilitzant SSH1.
</p>

<p>
El 1999 els desenvolupadors que volien una versió de programari lliure de SSH van tornar a utilitzar la versió 1.2.12 del programa SSH, que va ser l’última versió alliberada sota una llicència de codi obert. En aquest punt, el desenvolupador Björn Grönvall va utilitzar el codi alliberat de SSH per desenvolupar OSSH amb la intenció de crear un producte similar a SSH però amb llicència de codi lliure. Poc després, els desenvolupadors del sistema operatiu OpenBSD, mentre estaven desenvolupant la versió 2.6 d’OpenBSD van decidir incorporar SSH a la distribució. Durant dos mesos van fer un extens treball en el codi desenvolupat per Grönvall i van crear OpenSSH.
</p>

<p>
Inicialment OpenSSH va ser desenvolupat per OpenBSD, però s’ha adaptat amb èxit a Linux, Solaris, AIX i altres sistemes operatius. Des de la seva creació, OpenSSH ha guanyat cada cop més usuaris i actualment és la implementació més popular de SSH.
</p>

</div>

<h3><a id="alguns_conceptes_criptografics" >Alguns conceptes criptogràfics</a></h3>
<div class="level3">

<p>
La criptografia ens aporta tècniques per encriptar i desencriptar informació, de manera que es puguin transmetre, amb seguretat, missatges per un canal que no és de confiança. L’objectiu evident és assegurar que el missatge transmès romandrà secret. Però a les comunicacions electròniques també s’utilitza sovint per autenticar que l’emissor i el destinatari del missatge són qui pensem i per garantir que el mateix missatge no ha estat alterat durant la seva transmissió.
</p>

<p>
Hi ha diferents tècniques criptogràfiques, però dues de les més emprades són:
</p>
<ul>
<li class="level1"><div class="li"> Criptografia simètrica o de clau compartida</div>
</li>
<li class="level1"><div class="li"> Criptografia asimètrica o de clau pública</div>
</li>
</ul>

</div>

<h4><a id="criptografia_de_clau_compartida" >Criptografia de clau compartida</a></h4>
<div class="level4">

<p>
En emprar un algorisme d’encriptació de clau compartida s’utilitza la mateixa clau per encriptar i desencriptar. Aquesta característica és el seu principal inconvenient, ja que si es vol canviar la clau es necessitarà un mitjà de comunicació segur per fer-la arribar de l’emissor al receptor. El principal avantatge de la criptografia simètrica és la seva velocitat. Alguns algorismes d’encriptació simètrics són: 3DES, AES, Blowfish i IDEA.
</p>

</div>

<h4><a id="criptografia_de_clau_publica" >Criptografia de clau pública</a></h4>
<div class="level4">

<p>
La criptografia asimètrica o de clau pública evita el problema de l’intercanvi de claus. En aquest cast, tant l’emissor com el receptor tindran una parella de claus diferents. A cada parella de claus n’hi ha una de pública i una de privada. La clau privada mai no viatja pel canal de comunicació, cal garantir-ne la protecció. La clau pública, com el seu nom indica, es pot oferir a tothom que la demani, pot viatjar per mitjans insegurs o fins i tot es pot publicar.
</p>

<p>
Cada parella de claus està fortament relacionada:
</p>
<ul>
<li class="level1"><div class="li"> Els missatges que s’encripten emprant una clau pública només es poden desencriptar mitjançant la clau privada associada.</div>
</li>
<li class="level1"><div class="li"> Les claus privades permeten signar un missatge per tal que el receptor verifiqui la identitat de l’emissor. La comprovació de la signatura es farà mitjançant la clau pública associada.</div>
</li>
</ul>

<p>
En una comunicació típica tindrem els passos que es mostren a continuació i que podeu veure de manera gràfica en la <span class="figref"><a href="#Figura7"><span>figura</span></a></span>.
</p>
<ol>
<li class="level1"><div class="li"> L’emissor farà servir la seva pròpia clau privada per signar el missatge.</div>
</li>
<li class="level1"><div class="li"> L’emissor farà servir la clau pública del receptor per encriptar el missatge.</div>
</li>
<li class="level1"><div class="li"> Es transmet el missatge encriptat i signat.</div>
</li>
<li class="level1"><div class="li"> El receptor desencriptarà el missatge fent servir la seva pròpia clau privada.</div>
</li>
<li class="level1"><div class="li"> El receptor comprovarà la signatura del missatge fent servir la clau pública de l’emissor.</div>
</li>
</ol>
<div class="iocfigure"><a name="Figura7"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Comunicació amb clau pública

</figcaption><img src="../media/smxm7uf4ud4_im7.png" alt="" /></figure>
</div>
<p>
En aquest procediment mai no es transmeten les claus privades. L’intercanvi de les claus públiques és senzill, ja que no cal que es transmetin fent ús d’un canal segur. Es garanteix que el missatge no pot ser compromès en la seva transmissió i tant l’emissor com el receptor comproven l’autenticitat de l’altra entitat.
</p>

<p>
El principal inconvenient de la criptografia de clau pública és el seu consum de recursos. És més costosa en temps d’encriptació/desencriptació i el missatge encriptat ocupa més que el text clar. En la <span class="tabref"><a href="#Table4"><span>taula</span></a></span> podeu veure un resum dels principals avantatges i inconvenients de les diferents tècniques criptogràfiques.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table4"><span>Taula: </span></a>Comparació de tècniques criptogràfiques</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Tècnica criptogràfica        </th><th class="col1 leftalign"> Avantatges                                                                                         </th><th class="col2 leftalign"> Inconvenients                                                      </th>
	</tr>
	<tr class="row1">
		<td class="col0"> Criptografia clau compartida </td><td class="col1 leftalign"> Consumeix pocs recursos. S’encripta/desencripta amb gran velocitat                                 </td><td class="col2 leftalign"> L’intercanvi de claus necessita un canal segur                     </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> Criptografia clau pública    </td><td class="col1 leftalign"> No necessita un canal segur per intercanviar les claus.                                            </td><td class="col2"> Consumeix recursos. El procés d’encriptació/desencriptació és lent </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> Criptografia híbrida         </td><td class="col1"> S’encripta/desencripta amb gran velocitat. No necessita un canal segur per intercanviar les claus. </td><td class="col2 leftalign">                                                                    </td>
	</tr>
</table></div>
</div><div class="iocimportant"><div class="ioccontent">
<p>
La criptografia híbrida combina el sistema de clau compartida i el de clau pública per obtenir tots els avantatges sense els inconvenients. En aquest sistema només s’utilitza la criptografia de clau pública per transmetre una clau compartida, normalment generada de manera dinàmica per aquesta comunicació, al receptor. Una vegada s’ha comunicat la clau compartida a totes dues estacions, s’utilitza l’encriptació convencional per tal d’encriptar el gruix del missatge.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">Criptografia híbrida en la realitat</p>
<p>
Moltes eines com SSH, GnuPG o PGP combinen la criptografia de clau compartida i pública. Són criptosistemes híbrids.
</p>
</div></div><div class="iocimportant"><div class="ioccontent">
<p>
Els sistemes basats en criptografia híbrida són tan forts com els sistemes de clau compartida i clau pública que utilitzin.
</p>
</div></div>
</div>

<h3><a id="instal_lacio_de_ssh" >Instal·lació de SSH</a></h3>
<div class="level3">

<p>
SSH utilitza una arquitectura client-servidor, en què el client es connecta a una màquina remota, el servidor. En la major part de distribucions GNU/Linux el client ja és present però, si es vol accedir a una màquina de manera remota, en aquesta màquina hi haurà d’haver instal·lat el servidor SSH.
</p>

<p>
La implementació més popular de SSH és la implementada per la fundació OpenSSH, el servidor openSSH-server. Per procedir a la instal·lació, executem l’ordre següent des del terminal de la màquina a la qual ens connectarem (servidor).
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">#sudo apt-get install openSSH-server</div></li></ol></pre>

<p>
Si no hi ha hagut cap error durant la instal·lació podreu veure un missatge en què es creen les claus necessàries per assegurar les comunicacions segures mitjançant l’encriptació.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">Configurando openSSH-server (1:5.1p1-6ubuntu2) ...</div></li><li class="li1"><div class="de1">Creating SSH2 RSA key; this may take some time ...</div></li><li class="li1"><div class="de1">Creating SSH2 DSA key; this may take some time ...</div></li><li class="li1"><div class="de1"> * Restarting OpenBSD Secure Shell server SSHd           [ OK ]</div></li></ol></pre>

<p>
L’última part de la configuració bàsica es fa de manera automàtica quan intentem connectar un client per primera vegada. És la generació automàtica de la clau compartida que utilitzaran client i servidor per assegurar que les comunicacions són segures.
</p>

<p>
La sintaxi bàsica per fer una connexió SSH és:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">SSH usuari@host</div></li></ol></pre>
<ul>
<li class="level1"><div class="li"> <em>usuari</em>: és l’usuari que es connectarà a la màquina remota.</div>
</li>
<li class="level1"><div class="li"> <em>host</em>: representa la IP o el nom de domini del servidor SSH al qual ens volem connectar.</div>
</li>
</ul>

<p>
En aquest cas el servidor SSH té la IP 192.168.1.100
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1"># SSH 192.168.1.100</div></li><li class="li1"><div class="de1">The authenticity of host '192.168.1.100 (192.168.1.100)' can't </div></li><li class="li1"><div class="de1">be established.</div></li><li class="li1"><div class="de1">RSA key fingerprint is </div></li><li class="li1"><div class="de1">ed:3d:c3:ca:5e:19:26:98:50:ca:86:89:9f:35:53:55.</div></li><li class="li1"><div class="de1">Are you sure you want to continue connecting (yes/no)?</div></li></ol></pre>

<p>
Una vegada s’ha comunicat la clau compartida entre totes dues estacions, s’utilitza l’encriptació convencional per tal d’encriptar el gruix del missatge.
</p>

</div>

<h4><a id="instal_lacio_d_openssh-server_per_a_windows" >Instal·lació d&#039;openSSH-server per a Windows</a></h4>
<div class="level4">

<p>
Hi ha diverses implementacions del servidor OpenSSH implementades per al sistema operatiu Windows. Una de les més populars és OpennSSH for Windows, que està disponible gratuïtament.
</p>

<p>
Un cop descarregat l’arxiu setupSSH.exe, només cal executar-lo (vegeu <span class="figref"><a href="#Figura8"><span>figura</span></a></span>).
</p>
<div class="iocreference"><div class="ioccontent">
<p>
Consulteu la secció “Més informació” per veure l’enllaç des d’on podeu descarregar l’OpenSSH for Windows.
</p>
</div></div><div class="iocfigure"><a name="Figura8"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Instal·lació d’OpenSSH per a Windows

</figcaption><img src="../media/smxm7uf4ud4_im8.png" alt="" /></figure>
</div>
<p>
Aquest programari, tal com podem veure en la <span class="figref"><a href="#Figura9"><span>figura</span></a></span>, ens permet, un cop acceptats els termes de llicència que es proposen, instal·lar tant un client com un servidor. Només instal·larem el servidor, ja que com a clients Windows utilitzarem l’eina més popular desenvolupada per la fundació OpenSSH, el programari PuTTY.
</p>
<div class="iocfigure"><a name="Figura9"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Selecció del servidor OpenSSH per procedir a la seva instal·lació

</figcaption><img src="../media/smxm7uf4ud4_im9.png" alt="" /></figure>
</div>
<p>
L’últim pas consisteix a indicar el lloc del disc dur on voldrem instal·lar aquest programari, tal com es veu en la <span class="figref"><a href="#Figura10"><span>figura</span></a></span>.
</p>
<div class="iocfigure"><a name="Figura10"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Selecció del lloc d’instal·lació del programari

</figcaption><img src="../media/smxm7uf4ud4_im10.png" alt="" /></figure>
</div>
<p>
Finalment, desprès de fer la instal·lació i de generar algunes claus ens demana (<span class="figref"><a href="#Figura11"><span>figura</span></a></span>) que editem el fitxer <em>passwd</em> per fer possible l’accés al servidor SSH.
</p>
<div class="iocfigure"><a name="Figura11"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

S’ha d’editar el fitxer passwd abans de poder accedir al servidor

</figcaption><img src="../media/smxm7uf4ud4_im11.png" alt="" /></figure>
</div>
<p>
Els passos que cal seguir són els següents:
</p>
<ol>
<li class="level1"><div class="li"> Obrir un terminal emulador de MS-DOS a Windows.</div>
</li>
<li class="level1"><div class="li"> Canviar el directori on s’ha instal·lat el programa (c:\Archivos de programa\OpenSSH\etc.).</div>
</li>
<li class="level1"><div class="li"> Crear un fitxer de permisos de grup.<pre class="code bash"><ol><li class="li1"><div class="de1">mkgroup -l &gt;&gt; group</div></li></ol></pre>
</div>
</li>
<li class="level1"><div class="li"> Crear un fitxer de permisos d’usuari.<pre class="code bash"><ol><li class="li1"><div class="de1">mkpasswd -l &gt;&gt; passwd</div></li></ol></pre>
</div>
</li>
<li class="level1"><div class="li"> Iniciar el servidor OpenSSH.<pre class="code bash"><ol><li class="li1"><div class="de1">net start openSSHd</div></li></ol></pre>
</div>
</li>
</ol>

<p>
Ara ja podem procedir a connectar-nos des de qualsevol client
</p>

</div>

<h4><a id="instal_lacio_d_un_client_ssh_per_a_windows" >Instal·lació d&#039;un client SSH per a Windows</a></h4>
<div class="level4">

<p>
Una de les aplicacions més populars d’implementacions de clients SSH per a Windows és l’aplicació desenvolupada per OpenSSH anomenada PuTTY.
</p>

<p>
És una aplicació que no necessita instal·lació i que es pot executar directament, amb el resultat que es pot veure en la <span class="figref"><a href="#Figura12"><span>figura</span></a></span>.
</p>
<div class="iocreference"><div class="ioccontent">
<p>
PuTTY Consulteu la secció “Recursos de contingut” per veure l’enllaç des d’on el podeu descarregar.
</p>
</div></div><div class="iocfigure"><a name="Figura12"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Client SSH per a Windows

</figcaption><img src="../media/smxm7uf4ud4_im12.png" alt="" /></figure>
</div>
<p>
La primera vegada que s’estableix la connexió amb un servidor SSH, com es mostra en la <span class="figref"><a href="#Figura13"><span>figura</span></a></span>, es genera automàticament la clau compartida que utilitzaran client i servidor per assegurar que les comunicacions són segures.
</p>
<div class="iocfigure"><a name="Figura13"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Advertència de generació de clau compartida.

</figcaption><img src="../media/smxm7uf4ud4_im13.png" alt="" /></figure>
</div>
<p>
Un cop establerta la connexió i desprès d’autenticar-nos, el programari PuTTY mostra un terminal d’ordres en què podrem executar les ordres de la màquina a la qual ens haguem connectat. En aquest cas, s’ha fet la connexió amb un servidor OpenSSH instal·lat en una màquina Ubuntu. Per tant, es poden executar ordres remotament des d’una màquina Windows en una màquina GNU/Linux tal com es mostra en la <span class="figref"><a href="#Figura14"><span>figura</span></a></span>.
</p>
<div class="iocfigure"><a name="Figura14"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Execució de la instrucció “ps aux” remotament des d’una màquina Windows en una màquina GNU/Linux.

</figcaption><img src="../media/smxm7uf4ud4_im14.png" alt="" /></figure>
</div>
</div>

<h3><a id="connexio_a_una_estacio_remota_amb_ssh" >Connexió a una estació remota amb SSH</a></h3>
<div class="level3">

<p>
La funció més comuna per a SSH és establir una sessió de treball remota fent ús de tècniques criptogràfiques per transmetre la informació. L’ús del client SSH és força senzill.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">SSH usuari@host</div></li></ol></pre>

<p>
És tot el que hem d’escriure per iniciar una sessió remota com l’usuariusuari en l’equip amfitrió (host). En executar l’ordre ens demanarà la contrasenya de l’equip remot i, si l’escrivim de manera correcta, podrem accedir a la sessió de treball remota per escriure ordres. Per finalitzar la connexió escriurem exit.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">usuari1@client$ SSH usuari@192.168.2.5</div></li><li class="li1"><div class="de1">usuari @192.168.2.5's password: </div></li><li class="li1"><div class="de1">Linux servidor 2.6.31-17-generic #54-Linkat SMP Thu Dec 10 </div></li><li class="li1"><div class="de1">16:20:31 UTC 2009 i686</div></li><li class="li1"><div class="de1">Last login: Tue Feb  2 15:48:36 2010 from servidor.local</div></li><li class="li1"><div class="de1">usuari@servidor:~$ exit</div></li><li class="li1"><div class="de1">salir</div></li><li class="li1"><div class="de1">Connection to 192.168.2.5 closed.</div></li></ol></pre>

<p>
Si no s’especifica el nom d’usuari a l’hora d’invocar l’ordre SSH, intentarà fer la connexió amb l’usuari amb el qual estem connectats al terminal de GNU/Linux.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">usuari1@client$ SSH  usuari@192.168.2.5</div></li><li class="li1"><div class="de1">usuari1@192.168.2.5's password:</div></li></ol></pre>

<p>
Fixeu-vos que en aquest cas intenta connectar-se com a usuari1, ja que no s’ha especificat amb quin usuari s’ha de connectar.
</p>

<p>
El client d’<strong>OpenSSH</strong> suporta diferents opcions que es detallen en el seu manual. Algunes de les més freqüents són les descrites en la <span class="tabref"><a href="#Table5"><span>taula</span></a></span>.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table5"><span>Taula: </span></a>Opcions més freqüents del client OpenSSH</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Opció    </th><th class="col1 leftalign"> Funció                                                                                                                                                                                                                                                 </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> * 1      </td><td class="col1 leftalign"> Força l’ús de la versió 1 del protocol. Només es recomana emprar SSH1 per connectar-se a servidors antics que no són compatibles amb SSH2                                                                                                              </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> * 2      </td><td class="col1 leftalign"> Força l’ús de la versió 2 del protocol, SSH2.                                                                                                                                                                                                          </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> * 4      </td><td class="col1 leftalign"> Força l’ús de l’adreçament IPv4                                                                                                                                                                                                                        </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> * 6      </td><td class="col1 leftalign"> Força l’ús de l’adreçament IPv6                                                                                                                                                                                                                        </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> * C      </td><td class="col1 leftalign"> Activa la compressió gzip en la connexió. Es recomana activar la compressió si s’està emprant SSH amb un enllaç lent, com un mòdem. Si l’enllaç és de banda ampla es recomana treballar sense compressió.                                              </td>
	</tr>
	<tr class="row6">
		<td class="col0"> * p port </td><td class="col1"> Port al qual es connectarà en l’equip remot. De manera predeterminada el servidor SSH s’executa en el port TCP 22, però si es tracta d’un servidor accessible des d’Internet és recomanable escollir un altre port per evitar els intents de connexió. </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> * q      </td><td class="col1 leftalign"> No imprimeix els missatges d’advertència, només els errors. Amb una altra -q no imprimeix ni els errors.                                                                                                                                               </td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> * X      </td><td class="col1 leftalign"> Activa la retransmissió X11 per tal que els programes gràfics llançats en l’estació remota obrin la seva interfície gràfica en el servidor X local                                                                                                     </td>
	</tr>
	<tr class="row9">
		<td class="col0 leftalign"> * x      </td><td class="col1 leftalign"> Desactiva la retransmissió X11                                                                                                                                                                                                                         </td>
	</tr>
</table></div>
</div>
<p>
Algunes vegades només es desitja executar una ordre a l’estació remota, no obrir un <em>shell</em> (intèrpret d’ordres) per treballar. En aquest cas, és possible indicar la comanda que cal executar en la mateixa crida de SSH.
</p>

<p>
Per exemple, per tal de veure el final del fitxer de registre /var/log/messages en el servidor 192.168.100.10 faríem:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">usuari1@client:~$ SSH  usuari@192.168.100.10 tail /var/log/</div></li><li class="li1"><div class="de1">messages</div></li><li class="li1"><div class="de1">usuari @192.168.100.10's password: </div></li><li class="li1"><div class="de1">Feb  2 13:10:01 servidor kernel: [16957.326974] USB Mass Storage </div></li><li class="li1"><div class="de1">support registered.</div></li><li class="li1"><div class="de1">Feb  2 13:10:06 servidor kernel: [16962.339915] scsi 6:0:0:0: </div></li><li class="li1"><div class="de1">Direct-Access     Apple    iPod             1.62 PQ: 0 ANSI: 0</div></li><li class="li1"><div class="de1">Feb  2 13:10:06 servidor kernel: [16962.343417] sd 6:0:0:0: </div></li><li class="li1"><div class="de1">Attached scsi generic sg1 type 0</div></li></ol></pre>

</div>

<h3><a id="transferir_fitxers_entre_equips_diferents" >Transferir fitxers entre equips diferents</a></h3>
<div class="level3">

<p>
Entre les utilitats incloses en la distribució d’<strong>OpenSSH</strong> trobem les ordres<strong>scp</strong> i <strong>sftp</strong>. Aquestes ordres permeten transferir fitxers amb totes les garanties de seguretat de SSH.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">tail</p>
<p>
És una instrucció de GNU/Linux que permet veure les 10 últimes línies. El paràmetre npermet especificar el número de línies per mostrar. En aquest cas, se’n mostren 3.
</p>
</div></div>
</div>

<h4><a id="copies_segures_scp" >Còpies segures (scp)</a></h4>
<div class="level4">

<p>
La sintaxi bàsica de la instrucció <em>scp</em> és:
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
scp [opcions] [[user@]host1:]nom_fixer1 [[user@]host2:]nom_fixer2
</p>
</div></div><ul>
<li class="level1"><div class="li"> <em>host1</em> representa la màquina d’origen</div>
</li>
<li class="level1"><div class="li"> <em>host2</em> representa l’estació de destinació</div>
</li>
</ul>

<p>
La comanda <strong>scp</strong> es pot veure com una versió estesa de la comanda <strong>cp</strong>, que permet copiar fitxers fins i tot entre màquines diferents. De fet, és el substitut de SSH per l’ordre <strong>rcp</strong>, que és antiga i insegura. En fer una còpia mitjançant <strong>scp</strong>, es pot escollir qualsevol combinació de fitxers locals o remots tant per l’origen com per la destinació.
</p>

<p>
En l’exemple que podeu veure a continuació copiem el fitxer local fitxer.pdf en una estació remota amb la IP (192.168.100.10).
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">rcp</p>
<p>
És una instrucció GNU/Linux que permet copiar fitxers entre l’equip local i un de remot.
</p>
</div></div><pre class="code bash"><ol><li class="li1"><div class="de1">usuari@client:$ scp fitxer.pdf usuari@192.168.100.10:/home/raul</div></li><li class="li1"><div class="de1">usuari@192.168.100.10's password: </div></li><li class="li1"><div class="de1">fitxer.pdf                        100%  691KB 690.7KB/s   00:01</div></li></ol></pre>

<p>
Si la contrasenya és correcta es procedirà a la transferència de l’arxiu i s’indicarà de manera interactiva el percentatge que ja s’ha enviat, la grandària en kilobytes, l’índex de transferència i el temps transcorregut des del començament de la transmissió.
</p>

<p>
No només es poden copiar fitxers locals en una estació remota, sinó que es poden copiar fitxers de l’estació remota en la local i fins i tot entre dues estacions remotes. En la <span class="tabref"><a href="#Table6"><span>taula</span></a></span> podeu trobar un exemple de cada tipus.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table6"><span>Taula: </span></a>Exemples de diferents usos de la instrucció scp</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Exemple                                                   </th><th class="col1 leftalign"> Comanda                                                                          </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> Copiar fitxer local en equip remot                        </td><td class="col1 leftalign"> scp fitxer usuari@192.168.100.10:/home/usuari                                    </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> Copiar fitxer remot en equip local                        </td><td class="col1 leftalign"> scp usuari@192.168.100.10:/home/usuari/fitxer ./                                 </td>
	</tr>
	<tr class="row3">
		<td class="col0"> Copiar un fitxer d’un equip remot en un altre equip remot </td><td class="col1"> scp usuari@192.168.100.10:/home/usuari/fitxer usuari@192.168.100.11:/home/usuari </td>
	</tr>
</table></div>
</div>
<p>
La pàgina de manual de <strong>scp</strong> ens mostrarà els seus paràmetres, la major part dels quals són els mateixos que té la comanda <strong>SSH</strong>. No obstant això, té algunes opcions pròpies que són particularment útils i que podeu veure en la <span class="tabref"><a href="#Table7"><span>taula</span></a></span>.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table7"><span>Taula: </span></a>Opcions de la instrucció scp</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Opció     </th><th class="col1 leftalign"> Funció                                                                        </th>
	</tr>
	<tr class="row1">
		<td class="col0"> * l limit </td><td class="col1 leftalign"> Establir un límit a l’amplada de banda en kBps.                               </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> * p       </td><td class="col1"> Preservar el temps de modificació, accés i els permisos dels fitxers copiats. </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> * r       </td><td class="col1 leftalign"> Fer una còpia recursiva pels directoris.                                      </td>
	</tr>
</table></div>
</div>
</div>

<h4><a id="transferencies_segures_de_fitxers_sfpt" >Transferències segures de fitxers (sfpt)</a></h4>
<div class="level4">

<p>
L’ordre <strong>sftp</strong> és un substitut per al client de <acronym title="File Transfer Protocol">FTP</acronym>, que és el tradicional però és insegur. En emprar sftp s’estableix una connexió al sistema remot i després, de manera interactiva, es podran indicar ordres per explorar el sistema d’arxius remot i fer modificacions.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">ftp</p>
<p>
El protocol de transferència de fitxers o <acronym title="File Transfer Protocol">FTP</acronym> (de l’anglès <em>file transfer protocol</em>) és un programari estandarditzat per enviar fitxers entre ordinadors amb qualsevol sistema operatiu. Forma part de la capa d’aplicació del model TCP/IP.
</p>
</div></div>
<p>
La sintaxi bàsica de la instrucció <em>sftp</em> és:
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
sftp [opcions] [[user@]host1:]nom_fixer1 [[user@]host2:]nom_fixer2
</p>
</div></div><ul>
<li class="level1"><div class="li"> <em>host1</em>representa la màquina d’origen</div>
</li>
<li class="level1"><div class="li"> <em>host2</em>representa l’estació de destinació</div>
</li>
</ul>

<p>
Un cop establerta la connexió segura, podem executar les mateixes ordres que si ens haguéssim connectat mitjançant <acronym title="File Transfer Protocol">FTP</acronym>. En la <span class="tabref"><a href="#Table8"><span>taula</span></a></span> podeu trobar les ordres que <strong>sftp</strong> pot interpretar.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table8"><span>Taula: </span></a>Ordres que poden ser interpretades per sftp</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Comanda                               </th><th class="col1 leftalign"> Funció                                                                                                                                                       </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> bye, exit, quit                       </td><td class="col1 leftalign"> Finalitzar la sessió                                                                                                                                         </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> cd camí                               </td><td class="col1 leftalign"> Canviar el directori remot                                                                                                                                   </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> chgrp, chown, chmod                   </td><td class="col1 leftalign"> Canviar el grup, el propietari o els permisos en el sistema remot                                                                                            </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> get fitxer                            </td><td class="col1 leftalign"> Transmetre el fitxer remot indicat al directori de treball local                                                                                             </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> put fitxer                            </td><td class="col1 leftalign"> Transmetre el fitxer local indicat al directori de treball remot                                                                                             </td>
	</tr>
	<tr class="row6">
		<td class="col0"> ls, mkdir, pwd, rename, rm, rmdir, ln </td><td class="col1"> Elaborar llistats, crear directoris, consultar la ruta, canviar de nom, eliminar fitxers i directoris i crear enllaços simbòlics al sistema de fitxers remot </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> lcd, lls, lmkdir, lpwd                </td><td class="col1 leftalign"> Versió de les ordres <em>cd</em>, <em>ls</em>, <em>mkdir</em> i <em>pwd</em> per treballar en el sistema de fitxers local                                                        </td>
	</tr>
</table></div>
</div>
<p>
Vegem un exemple de com fer transferències segures entre l’ordinador local i un equip amb la IP 192.168.100.10.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">usuari@client:$ sftp  usuari@192.168.100.10</div></li><li class="li1"><div class="de1">Connecting to 192.168.100.10...</div></li><li class="li1"><div class="de1">usuari@192.168.100.10's password: </div></li><li class="li1"><div class="de1">sftp&gt;</div></li></ol></pre>

<p>
En aquest punt ja s’ha establert la connexió segura amb l’equip remot i ja es poden començar a utilitzar les ordres pròpies de sftp. En l’exemple següent es transferirà el fitxer fitxer.pdf de l’equip remot al local.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">sftp&gt; cd TEMP </div></li><li class="li1"><div class="de1">sftp&gt; get fitxer.pdf</div></li><li class="li1"><div class="de1">Fetching /home/usuari/TEMP/fitxer.pdf to fitxer.pdf</div></li><li class="li1"><div class="de1">/home/usuari/TEMP/fitxer.pdf  100% 9043     8.8KB/s   00:00</div></li></ol></pre>

</div>

<h4><a id="sftp_a_l_escriptori_gnu_linux" >sftp a l&#039;escriptori GNU/Linux</a></h4>
<div class="level4">

<p>
Els escriptoris <strong>Gnome</strong> i <strong>KDE</strong> també proporcionen un accés senzill a servidors SSH per tal de treballar en xarxa. En Gnome el navegador d’arxius<strong>Nautilus</strong> pot mostrar directoris remots com si fossin locals fent servir el Gnome VFS (sistema de fitxers virtual de Gnome) mentre que en KDE es pot fer servir IOSlave FISH per a la mateixa funció. Només cal especificar<em>fish://usuari@host</em> a la barra d’adreces del navegador d’arxius <strong>Konqueror</strong> o <strong>Dolphin</strong>.
</p>

<p>
La distribució Linkat utilitza Gnome. Per tal d’utilitzar gràficament la instrucció <em>sftp</em> en el visualitzador d’arxius Nautilus, només és necessari introduir en la barra de lloc la mateixa ordre que s’utilitza per obrir una connexió SSH:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">SSH usuari@192.168.2.5</div></li></ol></pre>

<p>
El navegador d’arxius Nautilus detecta que es vol fer una connexió segura i demana la contrasenya de l’usuari de l’equip remot amb una finestra similar a la de la <span class="figref"><a href="#Figura15"><span>figura</span></a></span>.
</p>
<div class="iocfigure"><a name="Figura15"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Nautilus demana la contrasenya per connectar-se a l’equip remot

</figcaption><img src="../media/smxm7uf4ud4_im15.png" alt="" /></figure>
</div>
<p>
Si la contrasenya és correcta, s’estableix la connexió remota i Nautilus passa al mode de transferència segura d’arxius. En la <span class="figref"><a href="#Figura16"><span>figura</span></a></span> es pot observar que es visualitzen els arxius de l’equip remot. Utilitzant aquesta finestra, sempre que tingueu els permisos necessaris, podreu copiar arxius, crear carpetes o fer qualsevol altra operació típica d’un navegador de fitxers.
</p>
<div class="iocfigure"><a name="Figura16"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Nautilus permet la transferència segura de fitxers

</figcaption><img src="../media/smxm7uf4ud4_im16.png" alt="" /></figure>
</div>
</div>

<h3><a id="redireccio_de_ports_tcp_i_tunels_amb_ssh" >Redirecció de ports TCP i túnels amb SSH</a></h3>
<div class="level3">

<p>
La major part dels protocols que utilitzem en les nostres comunicacions estan basats en dissenys de fa gairebé 30 anys, quan la seguretat en xarxes telemàtiques no era un problema. Telnet, <acronym title="File Transfer Protocol">FTP</acronym>, POP3, protocols d’ús quotidià, descuiden la seguretat i confidencialitat de les dades que envien. No serveix de res protegir els servidors, implantar una bona política de contrasenyes i actualitzar les versions dels nostres dimonis si després, quan un usuari de POP3, per exemple, vol veure el seu correu electrònic des de la nostra xarxa, envia el seu usuari i contrasenya en text pla per la xarxa.
</p>

<p>
Fent servir SSH es poden establir túnels encriptats pels quals es pot transmetre qualsevol protocol que faci servir TCP. Així és possible, per exemple, emprar un túnel SSH per:
</p>
<ul>
<li class="level1"><div class="li"> Descarregar el correu mitjançant POP3 i enviar-lo fent servir SMTP</div>
</li>
<li class="level1"><div class="li"> Accedir a un servidor web mitjançant HTTP</div>
</li>
<li class="level1"><div class="li"> Accedir a un sistema d’arxius remot mitjançant NFS</div>
</li>
</ul>

<p>
Els protocols de l’exemple (POP3, SMTP, HTTP i NFS) no utilitzen tècniques criptogràfiques. El seu ús en una xarxa que no és de confiança no ens permet garantir la confidencialitat. Però com que tots aquests serveis utilitzen TCP com a protocol de transport, poden ser tunelitzats per SSH.
</p>

<p>
La idea en què es basa aquest procediment, i que es representa en la <span class="figref"><a href="#Figura17"><span>figura</span></a></span>, és la de fer un túnel pel qual viatjaran les dades de manera segura (<em>tunneling</em>). A cada un dels extrems del túnel hi ha les aplicacions estàndard (un dimoni POP3 estàndard, el nostre client de correu preferit, <acronym title="File Transfer Protocol">FTP</acronym>, un navegador web,etc.) i la comunicació s’assegura fent ús de tota la potència criptogràfica de SSH. SSH recull les dades que el client vol enviar i les reenvia pel túnel o canal segur. A l’altre costat del túnel es recullen les dades i es tornen a enviar al servidor corresponent.
</p>
<div class="iocfigure"><a name="Figura17"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Túnel fet amb SSH per fer segures les comunicacions que utilitzen el protocol TCP

</figcaption><img src="../media/smxm7uf4ud4_im17.png" alt="" /></figure>
</div>
<p>
Per exemple, es podria utilitzar un túnel SSH per accedir a un servidor web des d’una IP diferent de la de la nostra màquina. Com es pot veure en la <span class="figref"><a href="#Figura18"><span>figura</span></a></span>, el navegador utilitza el túnel creat per SSH per connectar-se al servidor i navegar per pàgines web utilitzant la IP externa del servidor.
</p>
<div class="iocfigure"><a name="Figura18"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Navegar per Internet utilitzant la IP del servidor

</figcaption><img src="../media/smxm7uf4ud4_im18.png" alt="" /></figure>
</div>
</div>

<h4><a id="tunel_ssh_per_navegar_a_traves_d_una_ip_diferent" >Túnel SSH per navegar a través d&#039;una IP diferent</a></h4>
<div class="level4">

<p>
SSH permet crear un túnel des del vostre equip local fins a un servidor remot. Un cop connectats a aquest servidor remot utilitzem el túnel per fer la navegació per Internet. En la <span class="figref"><a href="#Figura19"><span>figura</span></a></span>, podeu veure les IP de cada un dels equips. Fixeu-vos que tant la màquina local com el servidor remot tenen la seva pròpia IP local i una IP externa (NAT). Per connectar-nos al servidor remot haurem d’utilitzar l’adreça IP externa de la xarxa on està connectat i només funcionarà si l’encaminador al qual ens connectem té el port 22 redirigit al servidor amb el qual farem el túnel. És a dir, quan l’encaminador remot rebi una connexió pel port 22 ha de redirigir aquest trànsit al port 22 del nostre servidor.
</p>
<div class="iocfigure"><a name="Figura19"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Configuració d’equips per fer un túnel SSH

</figcaption><img src="../media/smxm7uf4ud4_im19.png" alt="" /></figure>
</div>
<p>
Abans de fer el túnel SSH, si es fa una connexió a Internet des de l’equip local amb un navegador qualsevol, es farà des de l’adreça IP 89.131.115.1, tal com es pot veure en la <span class="figref"><a href="#Figura20"><span>figura</span></a></span>, en què s’ha utilitzat la pàgina web <a href="http://www.whatismyip.com" class="urlextern" title="http://www.whatismyip.com"  rel="nofollow">www.whatismyip.com</a>, que permet visualitzar l’adreça IP externa.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">NAT (network address yranslation)</p>
<p>
La traducció d’adreces de xarxa és una tècnica que amaga un espai d’adreces, que generalment consisteix en un conjunt d’adreces de xarxa privada, darrere d’una única adreça IP, sovint en l’espai d’adreces IP públiques. Aquest mecanisme s’implementa en un encaminador que utilitza unes taules per assignar les adreces “ocultes” en una sola adreça IP, de manera que els paquets a la sortida semblen originar-se en l’encaminador.
</p>
</div></div><div class="iocfigure"><a name="Figura20"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Pàgina web que mostra la IP externa de l’equip local

</figcaption><img src="../media/smxm7uf4ud4_im20.png" alt="" /></figure>
</div>
<p>
A continuació fem el túnel amb l’equip remot:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">SSH -D 8080 -p 22 -N usuari@82.17.95.21</div></li></ol></pre>

<p>
L’opció <em>-D</em> habilita el readreçament dinàmic de ports locals. Funciona mitjançant l’assignació d’un sòcol per escoltar el port local (en el nostre cas 8080) i, cada vegada que s’estableix una connexió a aquest port, la connexió es transmet pel canal segur. A continuació el protocol d’aplicació és l’encarregat de determinar on es fa la connexió en la màquina remota. De fet, SSH actuarà com un servidor SOCKS.
</p>

<p>
La opció <em>-p</em> permet indicar el port pel qual es farà el túnel SSH, i l’opció <em>N</em> especifica que no es vol executar cap ordre remota (no s’obrirà cap terminal) i és útil quan es fa readreçament de ports.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">SOCKS</p>
<p>
SOCKS és un protocol d’Internet que facilita l’encaminament de paquets de xarxa entre les aplicacions client-servidor a través d’un servidor intermediari.
</p>
</div></div>
<p>
A continuació el que s’ha de fer és indicar al navegador local que utilitzi el túnel SSH creat per navegar per la xarxa d’Internet. Si utilitzeu el navegador Firefox, heu d’anar a Edita&gt;Preferències&gt;Avançat, seleccionar l’opció Xarxa i prémer el botó Paràmetres. S’ha de configurar, tal com mostra la <span class="figref"><a href="#Figura21"><span>figura</span></a></span>, que l’ordinador central SOCKS sigui <em>localhost</em> i que utilitzi el port 8080.
</p>
<div class="iocfigure"><a name="Figura21"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Configuració del navegador Firefox per utilitzar el túnel SSH

</figcaption><img src="../media/smxm7uf4ud4_im21.png" alt="" /></figure>
</div>
<p>
Ara el navegador ja utilitza el túnel SSH i quan es fa una connexió a Internet des de l’equip local es fa des de l’adreça IP 82.17.95.21, tal com es pot veure en la <span class="figref"><a href="#Figura22"><span>figura</span></a></span>, on s’ha utilitzat de nou la pàgina web <a href="http://www.whatismyip.com" class="urlextern" title="http://www.whatismyip.com"  rel="nofollow">www.whatismyip.com</a> per visualitzar l’adreça IP externa.
</p>
<div class="iocfigure"><a name="Figura22"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Pàgina web que mostra la IP externa de l’equip local

</figcaption><img src="../media/smxm7uf4ud4_im22.png" alt="" /></figure>
</div>
</div>

<h4><a id="tunel_ssh_per_accedir_de_manera_segura_al_servei_smtp" >Túnel SSH per accedir de manera segura al servei SMTP</a></h4>
<div class="level4">

<p>
Per establir un túnel SSH entre el port local 10025 i el port 25 (corresponent al servei SMTP) de l’estació 192.168.10.100 establint la connexió amb l’usuari “usuari” faríem:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">SSH usuari@192.168.10.100 -L 10025:192.168.10.100:25</div></li></ol></pre>

<p>
Una vegada establerta la sessió SSH, i mentre es mantingui, existirà un túnel encriptat entre el port TCP local 10025 i el 25 de l’estació 192.168.10.100. D’aquesta manera, per fer una connexió segura amb el servidor SMTP de l’estació remota, hauríem de connectar amb el port local 10025. SSH s’encarregarà de fer el transport de manera segura entre totes dues estacions.
</p>

</div>

<h3><a id="sshmecanismes_d_autenticacio" >SSH: mecanismes d&#039;autenticació</a></h3>
<div class="level3">

<p>
L’autenticació és l’acció de comprovar la identitat del remitent en una comunicació. El servidor SSH, en rebre una sol·licitud de connexió nova, necessita autenticar l’origen d’aquesta connexió com a pas previ per autoritzar o denegar la connexió.
</p>

<p>
El servidor SSH pot emprar quatre mecanismes diferents d’autenticació. Aquests mecanismes, per ordre de preferència, són:
</p>
<ol>
<li class="level1"><div class="li"> Autenticació basada en l’amfitrió</div>
</li>
<li class="level1"><div class="li"> Autenticació de clau pública</div>
</li>
<li class="level1"><div class="li"> Autenticació desafiament-resposta</div>
</li>
<li class="level1"><div class="li"> Autenticació basada en la contrasenya</div>
</li>
</ol>

<p>
És molt important aclarir que abans de l’autenticació, tant a SSH1 com a SSH2, s’establirà una comunicació encriptada entre el client i el servidor. Per establir aquesta connexió encriptada es fan servir tècniques criptogràfiques de clau pública. Una vegada acordada una clau comuna s’utilitzarà una encriptació simètrica per a la resta de la sessió. El procediment per negociar la clau de sessió és diferent per a SSH1 i SSH2; els detalls s’expliquen a la pàgina de manual de <strong>SSHd(8)</strong>. Sempre que sigui possible és recomanable emprar només SSH2 quan s’utilitza Diffie-Hellman per acordar la clau de sessió, a més de comptar amb mecanismes criptogràfics per garantir la integritat de les dades en tota la sessió.
</p>

</div>

<h4><a id="autenticacio_basada_en_l_amfitrio" >Autenticació basada en l&#039;amfitrió</a></h4>
<div class="level4">

<p>
Aquesta és la tècnica més segura, impedeix els atacs basats en la suplantació d’adreces IP, de <acronym title="Domain Name System">DNS</acronym> i de la taula de rutes.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Diffie-Hellman</p>
<p>
El protocol Diffie-Hellman permet la negociació segura de claus entre dues entitats que no han tingut comunicació prèvia, mitjançant un canal insegur i de manera anònima (no autenticada).
</p>
</div></div>
<p>
SSH genera una parella de claus, pública i privada, durant la seva instal·lació en cada equip. Aquestes claus identifiquen l’estació en què s’executa SSH, no els seus usuaris. Són les anomenades claus d’amfitrió i, si el compte de superusuari (<em>root</em>) no està compromès (és a dir, si ningú no s’ha convertit en superusuari de manera fraudulenta), no és necessari canviar-les.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Les claus d’amfitrió es troben en el directori <strong>/etc/SSH</strong> i els seus noms són: <strong>SSH_host_dsa_key</strong>, <strong>SSH_host_dsa_key.pub</strong>, <strong>SSH_host_rsa_key</strong> i <strong>SSH_host_rsa_key.pub</strong>per a SSH2 i <strong>SSH_host_key</strong>/<strong>SSH_host_key.pub</strong> per a SSH1.
</p>

<p>
SSH2 pot emprar els algorismes RSA i DSA, mentre que SSH1 només pot fer servir RSA.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">RSA i DSA</p>
<p>
Són dos algorismes que fan servir l’encriptació de clau pública.RSA són les inicials dels investigadors que van desenvolupar l’algorisme: Ron Rivest, Adi Shamir i Leonard Adleman.DSA són les sigles de<em>digital signature algorithm</em>, és a dir, algoritme de signatura digital.
</p>
</div></div>
<p>
Per tal de que l’autenticació basada en l’amfitrió permeti a l’usuari iniciar sessió mitjançant SSH, cal:
</p>
<ol>
<li class="level1"><div class="li"> Que el servidor pugui verificar la clau d’amfitrió del client. Aquesta verificació es produeix si el servidor registra en el fitxer <strong>known_hosts</strong> la clau d’amfitrió pública del client. (Aquest fitxer es troba a <strong>/etc/SSH/ SSH_known_hosts</strong> per a tot el sistema o bé a <strong>/.SSH/known_hosts</strong> per a cada usuari).</div>
</li>
<li class="level1"><div class="li"> Que la màquina que inicia la connexió estigui llistada en el fitxer <strong>/etc/ SSH/shosts.equiv</strong> (o la seva versió insegura <strong>/etc/hosts.equiv</strong>) i el nom d’usuari en l’estació client i en el servidor sigui el mateix. O bé que en servidor, en el directori de l’usuari que intenta iniciar sessió, hi hagi el fitxer <strong>.shosts</strong> (o la seva versió insegura <strong>.rhosts</strong>), en què apareguin la màquina client i el nom d’usuari en aquella estació.</div>
</li>
</ol>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Fitxer known_hosts</p>
<p>
Quan un client SSH estableix una connexió per primera vegada amb un amfitrió, enregistra en fitxer known_hosts la clau pública de l’estació. La propera vegada que s’estableixi una connexió es comprovarà aquesta clau pública.
</p>
</div></div>
</div>

<h4><a id="autenticacio_de_clau_publica" >Autenticació de clau pública</a></h4>
<div class="level4">

<p>
Aquest sistema es basa, com el seu nom indica, en tècniques criptogràfiques de clau pública en què el que s’encripta mitjançant la clau pública només es pot desencriptar mitjançant la clau privada associada, i en què la clau privada es pot emprar per signar els missatges per tal que el receptor pugui autenticar l’emissor.
</p>

<p>
Cal que l’usuari que vol iniciar una sessió remota al servidor construeixi una parella de claus, normalment fent ús de l’eina <strong>SSH-keygen</strong>. Aquestes claus s’emmagatzemaran en el directori <strong>/.SSH/</strong> (en els fitxers <strong>id_rsa</strong>/<strong>id_rsa.pub</strong>, <strong>id_dsa</strong>/<strong>id_dsa.pub</strong> per a SSH2 o bé <strong>identity</strong>/<strong>identity.pub</strong> per a SSH1).
</p>

<p>
En construir la parella de claus, l’eina <strong>SSH-keygen</strong> ens permetrà definir si volem emprar una clau RSA o DSA. També serà possible protegir les claus mitjançant un mot de pas que serà necessari escriure per desbloquejar la clau i poder emprar-la. De fet, aquesta és una opció molt recomanable; només es deixaran claus sense protegir si es tracta de les claus d’amfitrió o bé si es vol iniciar sessió de manera automatitzada (mitjançant scripts) sense que sigui necessària l’intervenció de l’usuari per desbloquejar les claus.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Frase de pas</p>
<p>
La pàgina de manual SSH-keygen(1) ens recomana emprar una frase de pas per bloquejar les claus. Aquesta frase és com un mot de pas però amb més longitud. De fet, la longitud recomanada és d’entre 10 i 30 caràcters tot i que pot ser més llarga. Hom pot pensar que introduir una frase de pas tan llarga cada vegada que es volen fer servir les claus és incòmode. Per això l’eina SSH-agent pot racionalitzar aquesta funció fent l’ús de SSH amb un mètode d’autenticació de clau pública més còmode.
</p>
</div></div>
<p>
Una vegada s’han generat les claus serà necessari transportar la clau pública a l’estació en què es vol iniciar sessió i afegir-la al fitxer <strong>/.SSH/ authorized_keys</strong> de l’usuari corresponent.
</p>

<p>
A partir d’aquest moment l’usuari podrà iniciar una sessió SSH sense haver d’especificar la seva contrasenya. Però si ha especificat una frase de pas per bloquejar les claus, encara serà necessari introduir-la per poder fer servir les claus.
</p>

</div>

<h3><a id="possibles_atacs_dels_quals_protegeix_ssh" >Possibles atacs dels quals protegeix SSH</a></h3>
<div class="level3">

<p>
Els diferents mecanismes d’autenticació vistos en el punt 2.27, proporcionen connexions segures que protegeixen les comunicacions entre equips. Es protegeixen les comunicacions entre l’equip local i el remot mitjançant l’ús de tècniques criptogràfiques, la qual cosa impossibilita els atacs més comuns.
</p>

</div>

<h4><a id="espionatge_o_captura_de_les_contrasenyes" >Espionatge o captura de les contrasenyes</a></h4>
<div class="level4">

<p>
Una <em>detector</em> és un dispositiu de xarxa, també conegut com a <em>sniffer</em>, que intercepta la informació que es transmet a través del canal de comunicacions, com es pot veure en la <span class="figref"><a href="#Figura23"><span>figura</span></a></span>. Aquesta captura té lloc sense coneixença per part del client o del servidor. Les dades de l’usuari, incloses les contrasenyes, poden ser robades d’aquesta manera en utilitzar protocols insegurs com Telnet i <acronym title="File Transfer Protocol">FTP</acronym>. Com que amb SSH les dades van encriptades, una comunicació SSH no és vulnerable a aquest tipus d’atac i no pot ser desencriptat per l’espia.
</p>
<div class="iocfigure"><a name="Figura23"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Un espia intenta captar la informació encriptada

</figcaption><img src="../media/smxm7uf4ud4_im23.png" alt="" /></figure>
</div>
</div>

<h4><a id="atac" >Atac</a></h4>
<div class="level4">

<p>

</p>

<p>
Si es compromet la primera connexió d’intercanvi de claus entre un client i un equip remot, l’atac <em>man in the middle</em>(home al mig) enganya tant el client com el servidor. Es pensen que es comuniquen directament entre si quan, en realitat, un atacant està interceptant tot el trànsit de dades entre els equips tal com es mostra en la <span class="figref"><a href="#Figura24"><span>figura</span></a></span>.
</p>
<div class="iocfigure"><a name="Figura24"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Atac man in the middle

</figcaption><img src="../media/smxm7uf4ud4_im24.png" alt="" /></figure>
</div>
<p>
El client inicia una connexió amb el servidor. Sense que cap dels dos ho sàpiga, un atacant està a l’espera d’interceptar la seva negociació de claus per fer la connexió. L’atacant rep la sol·licitud del client per establir una connexió i s’autentica com el servidor. L’atacant, llavors, inicia una connexió amb el servidor fent-se passar pel client. En aquest punt s’han establert dues connexions SSH segures i l’atacant llegeix totes les dades que es transfereixen entre el client i el servidor.
</p>

<p>
SSH protegeix les connexions contra els atacs <em>man in the middle</em> a través de l’autenticació del servidor. Si el client no ha estat compromès, l’atacant no té mai accés a la clau privada del servidor i no pot suplantar-lo.
</p>

</div>

<h3><a id="configuracio_del_client_ssh" >Configuració del client SSH</a></h3>
<div class="level3">

<p>
El client d’OpenSSH permet establir la seva configuració d’una manera prou flexible per tal que l’administrador pugui definir una configuració general per a tot el sistema, perquè cada usuari pugui modificar els paràmetres adients per a les seves connexions i, de manera concreta, pugui especificar opcions determinades per a cada connexió individual.
</p>

<p>
El client d’OpenSSH farà servir:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Configuració client SSH</p>
<p>
La configuració del client d’OpenSSH és força flexible. Es pot consultar la documentació oficial de la màquina mitjançant el seu manual SSH_config(5)
</p>
</div></div><ol>
<li class="level1"><div class="li"> Les opcions indicades en la línia d’ordres</div>
</li>
<li class="level1"><div class="li"> Els valors especificats en el fitxer de configuració de l’usuari:<pre class="code bash"><ol><li class="li1"><div class="de1">/.SSH/ SSH_config</div></li></ol></pre>
</div>
</li>
<li class="level1"><div class="li"> Els valors especificats en la configuració per a tot el sistema:<pre class="code bash"><ol><li class="li1"><div class="de1">/etc/SSH/ SSH_config</div></li></ol></pre>
</div>
</li>
</ol>

<p>
Per a cada paràmetre, el client farà servir el primer valor trobat. És a dir, si s’especifica un paràmetre a la línia d’ordres no se’n consultarà el valor en els fitxers de configuració. Dins dels fitxers de configuració és possible definir seccions per a diferents equips (mitjançant la paraula reservada <strong>host</strong>). Les línies buides i les que comencen amb un # (comentari) seran ignorades. En la <span class="tabref"><a href="#Table9"><span>taula</span></a></span> podeu trobar una llista amb les opcions més bàsiques de configuració d’un client.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table9"><span>Taula: </span></a>Algunes de les opcions més bàsiques de la configuració d’un client</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Opció                    </th><th class="col1 leftalign"> Funció                                                                                                                                                                                               </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> Host &lt;patró&gt;             </td><td class="col1 leftalign"> Permet especificar opcions que només s’aplicaran a les connexions amb l’amfitrió indicat. L’amfitrió s’indica mitjançant patrons amb els caràcters * i ? .                                           </td>
	</tr>
	<tr class="row2">
		<td class="col0"> CheckHostIP &lt;yes|no&gt; </td><td class="col1"> El seu valor predeterminat és <em>yes</em>. Si l’opció està activada, es comprovarà l’adreça de l’estació remota mitjançant el fitxer <em>known_hosts</em> per tal d’advertir un possible enverinament de <acronym title="Domain Name System">DNS</acronym>. </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> Cipher i Chipers         </td><td class="col1 leftalign"> Permeten especificar respectivament l’algorisme d’encriptació per les a connexions SSH1 i la precedència d’algorismes que cal emprar en les connexions SSH2.                                         </td>
	</tr>
	<tr class="row4">
		<td class="col0"> Compression &lt;yes|no&gt; </td><td class="col1 leftalign"> Si la connexió és molt lenta la compressió pot millorar els resultats. Si la xarxa té prou amplada de banda normalment no es recomana.                                                               </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> Port &lt;port&gt;          </td><td class="col1 leftalign"> Especifica el port de destinació per a la connexió, de manera predeterminada el 22.                                                                                                                  </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> RekeyLimit &lt;limit&gt;   </td><td class="col1 leftalign"> Especifica el volum màxim d’informació que es pot transmetre abans d’haver de renegociar la clau de sessió. Es poden fer servir els sufixos “K”, “M” o “G”.                                          </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> User &lt;usuari&gt;        </td><td class="col1 leftalign"> Especifica l’usuari per establir la connexió a l’estació remota.                                                                                                                                     </td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> SendEnv &lt;variables&gt;  </td><td class="col1 leftalign"> Permet enviar el valor de les variables d’entorn especificades a l’estació remota                                                                                                                    </td>
	</tr>
</table></div>
</div>
<p>
A continuació podeu veure un exemple d’un arxiu de configuració /.SSH/ SSH_config, és a dir, l’arxiu de configuració d’un usuari particular.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">Host 192.168.2.100</div></li><li class="li1"><div class="de1">Ciphers aes128-cbc</div></li><li class="li1"><div class="de1">Compression yes </div></li><li class="li1"><div class="de1">User usuariSSH</div></li><li class="li1"><div class="de1">Port 30</div></li></ol></pre>

<p>
En aquest cas, el fitxer indica que, quan establim una connexió amb el servidor amb la IP 192.168.2.100, s’ha d’utilitzar un algoritme d’encriptació del tipus AES128-CBC i s’han de comprimir les dades que s’envien. A més, la connexió es farà utilitzant l’usuari usuariSSH i s’establirà la connexió amb el port 30 del servidor. Observeu que, perquè la connexió funcioni, el servidor SSH, al seu torn, haurà d’estar configurat per treballar en el port 30.
</p>

</div>

<h3><a id="configuracio_del_servidor_ssh" >Configuració del servidor SSH</a></h3>
<div class="level3">

<p>
La funció del servidor SSH és esperar les connexions dels clients (normalment al port TCP 22), dur a terme la seva autenticació i, si tot ha anat bé, obrir una sessió de treball, executar una ordre o bé redirigir ports.
</p>

<p>
Cada vegada que es rep un intent de connexió des d’un client, es fan en primer lloc totes les comprovacions i inicialitzacions criptogràfiques per garantir la seguretat. Després es tracta d’autenticar l’usuari i finalment se segueix una sèrie de passos que tenen molt en comú amb qualsevol altra manera d’iniciar sessió a l’equip.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Configuració del servidor SSH</p>
<p>
Es pot trobar informació detallada sobre l’ús del servidor OpenSSH en les pàgines de manual del mateix servidor SSHd(8) i a la dedicada al seu fitxer de configuració SSHd_config(5)
</p>
</div></div><ol>
<li class="level1"><div class="li"> Si es tracta d’una sessió de treball en un terminal d’ordres, s’imprimeixen la data i l’hora de l’última connexió. Es registra l’instant actual per mostrar-lo en la propera connexió i es mostra el contingut del fitxer <strong>/etc/motd</strong> si existeix. L’abreviatura <em>motd</em> significa “missatge del dia”. Aquest fitxer s’ha utilitzat tradicionalment per mostrar un missatge de benvinguda quan un usuari es connecta a l’equip a través del terminal.<br/>
Un usuari, quan es connecta, rep el missatge següent:<pre class="code bash"><ol><li class="li1"><div class="de1">Missatge de benvinguda que es pot modificar canviant el fitxer /etc/motd al servidor.</div></li><li class="li1"><div class="de1">Last login: Wed Feb  3 17:22:05 2010 from 192.168.2.2</div></li><li class="li1"><div class="de1">                      ,    GNU    , </div></li><li class="li1"><div class="de1">                     /             \ </div></li><li class="li1"><div class="de1">                    ((__-^^-,-^^-__)) </div></li><li class="li1"><div class="de1">                     `-_---' `---_-' </div></li><li class="li1"><div class="de1">                      `--|o` 'o|--' </div></li><li class="li1"><div class="de1">                         \  `  /</div></li><li class="li1"><div class="de1">                          ): :(</div></li><li class="li1"><div class="de1">                          :o_o:</div></li><li class="li1"><div class="de1">                           &quot;-&quot;</div></li></ol></pre>

<p>
<br/>
Es pot veure que a més de la informació que hi ha en el fitxer /etc/motd es mostra la informació de l’última vegada que aquest usuari es va connectar al servidor.<br/>
Hi ha algunes distribucions que permeten la instal·lació del paquet <strong>update-motd</strong>. Aquest paquet té per objecte fer que el “missatge del dia” sigui més dinàmic ja que ofereix un marc senzill i net per a la definició de guions de programació que permeten, per exemple, mostrar un missatge diferent cada cop que un usuari es connecta al sistema.
</p>
</div>
</li>
<li class="level1"><div class="li"> Comprova si el fitxer <strong>/etc/nologin</strong> existeix i, en cas afirmatiu, permetrà que només el superusuari es connecti. Tampoc no permetrà que els usuaris que tenen un compte bloquejat es connectin.<br/>
Si existeix (encara que sigui amb contingut buit), quan un usuari s’intenta connectar rep el missatge següent:<pre class="code bash"><ol><li class="li1"><div class="de1">usuari@client:~$ SSH usuari@192.168.2.5</div></li><li class="li1"><div class="de1">usuari@192.168.2.5's password: </div></li><li class="li1"><div class="de1">Connection closed by 192.168.2.5</div></li></ol></pre>

<p>
<br/>
Encara que s’introdueixi la contrasenya correctament, l’equip no deixa que l’usuari es connecti; només el superusuari es podrà connectar.
</p>
</div>
</li>
<li class="level1"><div class="li"> El procés servidor passarà a execució amb privilegis d’usuari normal.</div>
</li>
<li class="level1"><div class="li"> Si l’usuari ha definit el seu entorn s’emprarà el fitxer <strong>/.SSH/environment</strong> i s’executarà la inicialització definida a <strong>/.SSH/rc</strong> o <strong>/etc/SSH/SSHrc</strong></div>
</li>
<li class="level1"><div class="li"> Finalment s’executarà un intèrpret d’ordres per a l’usuari o la seva ordre.</div>
</li>
</ol>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">/etc/motd</p>
<p>
Si existeix, el contingut d’aquest fitxer es mostra en la consola cada vegada que un usuari inicia una sessió. La seva funció és informativa, alguns administradors aprofiten per explicar-hi les regles d’ús del sistema informàtic o la seva adreça de contacte. És molt freqüent emprar <acronym title="American Standard Code for Information Interchange">ASCII</acronym> Art per decorar-lo.
</p>
</div></div>
</div>

<h4><a id="fitxer_de_configuracio_sshd_config" >Fitxer de configuració SSHd_config</a></h4>
<div class="level4">

<p>
Malgrat que en el funcionament del servidor d’OpenSSH intervenen diversos fitxers, el fitxer principal de configuració és <strong>/etc/SSH/SSHd_config</strong>. Aquest fitxer conté diferents paraules clau amb el seu valor. Les línies que comencen amb <strong>#</strong> (comentaris) o les que estan en blanc són ignorades. En la <span class="tabref"><a href="#Taula10"><span>taula</span></a></span> podeu trobar els principals paràmetres de configuració d’un servidor SSH.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Taula10"><span>Taula: </span></a>Paràmetres de configuració del servidor SSH</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Opció                                                                      </th><th class="col1 leftalign"> Funció                                                                                                                                                                                                                                                                                                                                                                            </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> Port ListenAddress                                                         </td><td class="col1 leftalign"> Permeten especificar el port on el servidor escoltarà les connexions dels clients i les adreces on obrirà aquest port. De manera predeterminada s’utilitza el port 22 de qualsevol adreça local. És possible especificar múltiples vegades aquestes opcions, però convé que <em>Port</em> sempre aparegui abans que <em>ListenAddress</em>.                                                 </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> AllowGroups                                                                </td><td class="col1 leftalign"> Si s’especifica seguida d’una llista de grups (separats per espais), només els usuaris que tenen algun dels grups indicats com a grup principal o suplementari podran iniciar sessió. És possible emprar els patrons ? i * en la definició dels grups. Només es poden indicar els grups mitjançant el seu nom, no en format numèric (GID).                                        </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> AllowUsers                                                                 </td><td class="col1 leftalign"> Té la mateixa funció que <em>AllowGroups</em> però per als usuaris. En aquest cas, a més, és possible indicar des de quins amfitrions d’origen s’acceptarà la connexió. Per exemple:<br/>
<br/>
AllowUsers usuari1@192* usuari2                                                                                                                                                              </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> Banner &lt;fitxer&gt;                                                        </td><td class="col1 leftalign"> Envia el contingut del fitxer indicat al client abans de dur a terme l’autenticació.                                                                                                                                                                                                                                                                                              </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> Compression &lt;yes|delayed|no&gt;                                       </td><td class="col1 leftalign"> Especifica si es farà servir la compressió. El valor <em>delayed</em>, l’opció predeterminada, indica que només es farà servir la compressió un cop s’hagi autenticat l’usuari.                                                                                                                                                                                                        </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> DenyGroups                                                                 </td><td class="col1 leftalign"> Permet especificar una llista de grups, separats per espais, als quals no es permetrà iniciar sessió. Es poden especificar els grups mitjançant el seu nom emprant els patrons ? i * de manera opcional.                                                                                                                                                                          </td>
	</tr>
	<tr class="row7">
		<td class="col0 leftalign"> DenyUsers                                                                  </td><td class="col1 leftalign"> Igual que <em>DenyGroups</em> però per als usuaris. En aquest cas és possible indicar un equip (o subxarxa) per a cada usuari.                                                                                                                                                                                                                                                         </td>
	</tr>
	<tr class="row8">
		<td class="col0 leftalign"> LoginGraceTime                                                             </td><td class="col1 leftalign"> Període de temps màxim per dur a terme l’autenticació. El valor 0 expressa que no hi ha límit.                                                                                                                                                                                                                                                                                    </td>
	</tr>
	<tr class="row9">
		<td class="col0 leftalign"> MaxAuthTries                                                               </td><td class="col1 leftalign"> Nombre màxim d’intents d’autenticació que es poden fer.                                                                                                                                                                                                                                                                                                                           </td>
	</tr>
	<tr class="row10">
		<td class="col0 leftalign"> MaxStartups                                                                </td><td class="col1 leftalign"> Nombre màxim de connexions simultànies que encara no han completat la seva autenticació.                                                                                                                                                                                                                                                                                          </td>
	</tr>
	<tr class="row11">
		<td class="col0 leftalign"> PasswordsAuthenticati on &lt;yes|no&gt;                                      </td><td class="col1 leftalign"> Indica si s’accepta l’autenticació mitjançant contrasenya (<em>password</em>).                                                                                                                                                                                                                                                                                                         </td>
	</tr>
	<tr class="row12">
		<td class="col0 leftalign"> PermitEmptyPasswords &lt;no|yes&gt;                                          </td><td class="col1 leftalign"> Si s’utilitza l’autenticació mitjançant contrasenya, especifica si el servidor permet la connexió a comptes que tenen una contrasenya buida.                                                                                                                                                                                                                                      </td>
	</tr>
	<tr class="row13">
		<td class="col0"> PermitRootLogin &lt;yes|without-password|forced-commands-only|no&gt; </td><td class="col1"> Especifica si s’accepta la connexió de superusuari mitjançant SSH. El valor <em>without-password</em> indica que el superusuari no podrà fer servir l’autenticació basada en contrasenya i el valor <em>forced-commands-only</em>, que només es permetrà l’autenticació de clau pública per executar certes ordres de manera remota (normalment per fer <em>backups</em> o còpies de seguretat). </td>
	</tr>
	<tr class="row14">
		<td class="col0 leftalign"> Protocol                                                                   </td><td class="col1 leftalign"> Especifica quins protocols es podran fer servir en les connexions dels clients (1, 2 o tots dos). És important recordar que el protocol SSH2 és força més segur que SSH1.                                                                                                                                                                                                         </td>
	</tr>
	<tr class="row15">
		<td class="col0 leftalign"> PubkeyAuthentication &lt;yes|no&gt;                                          </td><td class="col1 leftalign"> Especifica si s’acceptarà l’autenticació de clau pública                                                                                                                                                                                                                                                                                                                          </td>
	</tr>
	<tr class="row16">
		<td class="col0 leftalign"> X11Forwarding &lt;no|yes&gt;                                                 </td><td class="col1 leftalign"> Especifica si s’acceptarà el reenviament X11 per tal que les aplicacions gràfiques executades en el servidor obrin la seva finestra en el servidor X del client.                                                                                                                                                                                                                  </td>
	</tr>
</table></div>
</div>
</div>

	 </article>
     <div class="pnpage">
      <div class="left-corner"></div>
      <div id="prevpage">Anar a la p&agrave;gina anterior:<br /><a href="../../../WebContent/u4/a1/exercicis.html">Exercicis d'autoavaluació</a></div>
      <div id="nextpage">Anar a la p&agrave;gina seg&uuml;ent:<br /><a href="../../../WebContent/u4/a2/activitats.html">Activitats</a></div>
      <div class="right-corner"></div>
     </div>
    </div>
    <footer class="footer">
      <div><small>Aquest document està subjecte a una llicència oberta de Creative Commons, es reserva el dret de reconeixement de l'autoria, d'exigir que no se'n faci cap mena d'ús comercial. Si altereu o transformeu aquesta obra, o en genereu obres derivades, només podeu distribuir l'obra generada amb una llicència idèntica a aquesta.</small></div>
    </footer>
 </div>
 <div id="back_preview" class="hidden"></div>
 <div id="preview" class="hidden">
  <div class="prevcontent"></div>
 </div>
 <div id="help-tooltips">
  <div id="help-toc" class="hidden tooltip"><span>Taula de continguts:</span> Ofereix una vista general de l&#39;estructura del m&ograve;dul, que us facilitar&agrave; la navegaci&oacute; a trav&eacute;s dels seus continguts.<span class="arrow-left"></span></div> 
  <div id="help-settings" class="hidden tooltip"><span>Opcions de format:</span> Permet configurar el format de lectura a partir de les vostres prefer&egrave;ncies, modificant la mida de la lletra, el color del fons, l&#39;amplada de la p&agrave;gina o l&#39;ocultaci&oacute; dels continguts complementaris, entre d&#39;altres.<span class="arrow-left"></span></div>
  <div id="help-printer" class="hidden tooltip"><span>Imprimir:</span>  Envia el contingut seleccionat a la impressora.<span class="arrow-left"></span></div>
  <div id="help-favorites" class="hidden tooltip"><span>Prefereits:</span> Permet desar aquelles parts del contingut a les que us interessi accedir en un moment posterior; us permetr&agrave; anar creant un repositori personalitzat de les seccions que considereu m&eacute;s rellevants. Un cop l&#39;hageu començat a fer servir se us mostrar&agrave; a sota un comptador que us informar&agrave; del nombre de preferits que s&#39;hagin emmagatzemat fins al moment.<span class="arrow-left"></span></div>
  <div id="help-favcounter" class="hidden tooltip"><span>Comptador i llistat de preferits:</span> Indica el nombre de preferits que s&#39;han desat fins el moment; clicant damunt seu accedireu al llistat de preferits, i a trav&eacute;s d&#39;aquest podreu accedir directament als continguts que hageu emmagatzemat.<span class="arrow-left"></span></div>
  <div id="help-help_icon" class="hidden tooltip"><span>Ajuda:</span> Aquesta opci&oacute; activa la informaci&oacute; de les funcionalitats del web tot situant el punter del ratol&iacute; al damunt dels diferents &iacute;tems.<span class="arrow-left"></span></div>
  <div id="help-sidebar-hide" class="hidden tooltip"><span>Mostrar/Ocultar barra lateral:</span>  Deshabilita la barra d&#39;opcions, permetent la seva recuperaci&oacute; quan es desitgi.<span class="arrow-left"></span></div>
  <div id="help-search" class="hidden tooltip"><span>Cerca:</span>  Introdu&iuml;u les paraules clau sobre aquells conceptes que desitgeu localitzar en els continguts del m&ograve;dul. Tamb&eacute; podeu excloure un terme de la cerca tot afegint-hi el signe &#8220;-&#8221; al davant.<span class="arrow-top"></span></div>
  <div id="help-header" class="hidden tooltip"><span>Cap&ccedil;alera:</span>  Indica l&#39;apartat o secci&oacute; que es mostra en pantalla. Tingueu present que les capçaleres de segon, tercer i quart nivell tamb&eacute; es poden desar com a marcadors.<span class="arrow-left"></span></div>
</div> 
</body>
</html>
