<!doctype html>

<!--[if lt IE 7 ]> <html class="ie ie6 no-js" lang="ca"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie ie7 no-js" lang="ca"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie ie8 no-js" lang="ca"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie ie9 no-js" lang="ca"> <![endif]-->
<!--[if gt IE 9]><!--><html class="no-js" lang="ca"><!--<![endif]-->
<!-- the "no-js" class is for Modernizr. -->

<head id="www-sitename-com" data-template-set="html5-reset">

	<meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html">
        
	<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>Serveis de xarxa</title>
	
<!-- <meta name="title" content=""> --> 
	<meta name="description" content="">
	<!-- Google will often use this as its description of your page/site. Make it good. -->
	
	<meta name="google-site-verification" content="">
	<!-- Speaking of Google, don't forget to set your site up: http://google.com/webmasters -->
	
	<meta name="author" content="Institut Obert de Catalunya">
	<meta name="Copyright" content="Copyright Institut Obert de Catalunya 2011. All Rights Reserved.">

	<!-- Dublin Core Metadata : http://dublincore.org/ -->
	<meta name="DC.title" content="Serveis de xarxa">
	<meta name="DC.subject" content="Informàtica i comunicacions">
	<meta name="DC.creator" content="Institut Obert de Catalunya">
	
	<!--  Mobile Viewport Fix
	j.mp/mobileviewport & davidbcalhoun.com/2010/viewport-metatag 
	device-width : Occupy full width of the screen in its current orientation
	initial-scale = 1.0 retains dimensions instead of zooming out if page height > device height
	maximum-scale = 1.0 retains dimensions instead of zooming in if page width < device width
	-->
	<!-- Uncomment to use � use thoughtfully!
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	-->

	<link rel="shortcut icon" href="../../../img/favicon.ico">
	<!-- This is the traditional favicon.
		 - size: 16x16 or 32x32
		 - transparency is OK
		 - see wikipedia for info on browser support: http://mky.be/favicon/ -->
		 
	<link rel="apple-touch-icon" href="../../../img/apple-touch-icon.png">
	<!-- The is the icon for iOS's Web Clip.
		 - size: 57x57 for older iPhones, 72x72 for iPads, 114x114 for iPhone4's retina display (IMHO, just go ahead and use the biggest one)
		 - To prevent iOS from applying its styles to the icon name it thusly: apple-touch-icon-precomposed.png
		 - Transparency is not recommended (iOS will put a black BG behind the icon) -->
	
	<!-- CSS: screen, mobile & print are all in the same file -->
	<link rel="stylesheet" href="../../../_/css/style.css">

	<!-- CSS: jQuery UI -->
	<link rel="stylesheet" href="../../../_/css/jquery-ui.css">
	
	<!-- all our JS is at the bottom of the page, except for Modernizr. -->
	<script src="../../../_/js/modernizr-1.7.min.js"></script>
	<script src="../../../_/js/Hyphenator.js" type="text/javascript"></script>
	<script type="text/javascript">
	   Hyphenator.config({
		minwordlength : 4
	   });
	   Hyphenator.run();
	</script>
    <script src="../../../_/js/build.js" type="text/javascript"></script>
</head>

<body class="style-newspaper">

<div class="wrapper"><!-- not needed? up to you: http://camendesign.com/code/developpeurs_sans_frontieres -->

	<header id="header">
		<div class="head"><a href="http://ioc.gencat.cat"><img src="../../../img/logo.png" alt="Institut Obert de Catalunya"/></a><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/es/deed.ca"><img src="../../../img/license.png" alt="Llic&egrave;ncia" class="license"/></a></div>
		<div class="headdocument"><a href="../../../index.html">Serveis de xarxa</a></div>
        <div id="search" class="search" name="search">
         <form id="frmsearch" action="../../../search.html" method="get">
          <input type="text" name="q"/>
        </form>
        </div>
	</header>
   <div id="upbutton" class="upbutton" style="display:none;"><img src="../../../img/uparrow.png" alt="Pujar a l'inici de p&agrave;gina"/></div>
   <aside id="aside">
    <div id="menu">
      <ul>
       <li name="toc"><div><img src="../../../img/toc.png" alt="&Iacute;ndex"/></div></li>
       <li name="settings"><div><img src="../../../img/settings.png" alt="Configuraci&oacute;"/></div></li>
       <li name="printer"><div><img src="../../../img/printer.png" alt="Imprimir"/></div></li>
       <li name="favorites"><div><img src="../../../img/favorites.png" alt="Favorits"/></div></li>
       <li name="help_icon" class="help_icon"><div><img src="../../../img/help_icon.png" alt="Ajuda"/></div></li>
      </ul>
     </div>
   </aside>
   <div id="sidebar-hide" name="sidebar-hide"><img src="../../../img/arrows.png"/></div>
   <section>
     <div id="toc" class="hidden">
      <div class="menucontent">
        <ul>
        <li id="u2" class="parentnode"><p><a class="unit" href="../../../WebContent/u2/introduccio.html">2. Correu electrònic i transmissió d’arxius</a></p><ul class="expander"><li id="u2introduccio"><a href="../../../WebContent/u2/introduccio.html">Introducció</a></li><li id="u2mapa"><a href="../../../WebContent/u2/mapa.html">Mapa conceptual</a></li><li id="u2referencies"><a href="../../../WebContent/u2/referencies.html">Més informació</a></li><li id="u2resultats"><a href="../../../WebContent/u2/resultats.html">Resultats d'aprenentatge</a></li><li id="u2resum"><a href="../../../WebContent/u2/resum.html">Resum</a></li><li id="u2a1" class="tocsection"><p id='u2a1continguts'><a class="section" href="../../../WebContent/u2/a1/continguts.html">Instal·lació de serveis de transferència de fitxers</a><span class="buttonexp"></span></p><ul><li id="u2a1activitats"><a href="../../../WebContent/u2/a1/activitats.html">Activitats</a></li><li id="u2a1exercicis"><a href="../../../WebContent/u2/a1/exercicis.html">Exercicis d'autoavaluació</a></li></ul></li><div data-parent-id='u2a1' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u2/a1/continguts.html#instal_lacio_d_un_servei_d_ftp">Instal·lació d'un servei d'FTP</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#usuaris_i_grups_acces_anonim">Usuaris i grups. Accés anònim</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#permisos_quotes_limit_d_amplada_de_banda">Permisos. Quotes. Límit d'amplada de banda</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#ordres_d_autenticacio_control_gestio_i_transferencia_de_fitxers">Ordres d'autenticació, control, gestió i transferència de fitxers</a></li><li><a href="../../../WebContent/u2/a1/continguts.html#transferencia_en_mode_text_i_binari_comprovacio_del_servei_des_de_linia_d_ordre_i_de_manera_grafica">Transferència en mode text i binari. Comprovació del servei des de línia d'ordre i de manera gràfica</a></li></ul></div></div><li id="u2a2" class="tocsection"><p id='u2a2continguts'><a class="section" href="../../../WebContent/u2/a2/continguts.html">Gestió de serveis de correu electrònic</a><span class="buttonexp"></span></p><ul><li id="u2a2activitats"><a href="../../../WebContent/u2/a2/activitats.html">Activitats</a></li><li id="u2a2exercicis"><a href="../../../WebContent/u2/a2/exercicis.html">Exercicis d'atuavaluació</a></li></ul></li><div data-parent-id='u2a2' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u2/a2/continguts.html#protocols_i_serveis_de_descarrega_de_correu">Protocols i serveis de descàrrega de correu</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#els_serveis_de_correu_electronic">Els serveis de correu electrònic</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#alies_i_busties_d_usuari">Àlies i bústies d'usuari</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#instal_lacio_d_un_servei_de_recollida_de_correu_electronic">Instal·lació d'un servei de recollida de correu electrònic</a></li><li><a href="../../../WebContent/u2/a2/continguts.html#altres_serveis_de_correu_electronic_aplicacions_dels_serveis_de_correu_electronic">Altres serveis de correu electrònic (aplicacions dels serveis de correu electrònic)</a></li></ul></div></div></ul></li><li id="" class="indexnode"><p><a href="../../../index.html">Anar a l&#39;&iacute;ndex general</a></p></li>
        </ul>
      </div>
    </div>
   </section>
   <section>
   <div id="settings" class="hidden">
    <div class="menucontent">
     <div class="allsettings">
     <div class="settings">
      <label>Font i Color</label>
		<div class="setting-option">
	        <ul class="fontBackground">
				<li id="style-newspaper" title="Newspaper" class="appearance-style-newspaper"><span>Newspaper</span></li>
                <li id="style-novel" title="Novel" class="appearance-style-novel"><span>Novel</span></li>
                <li id="style-ebook" title="eBook" class="appearance-style-ebook"><span>eBook</span></li>
				<li id="style-inverse" title="Inverse" class="appearance-style-inverse active"><span>Inverse</span></li>
				<li id="style-athelas" title="Athelas" class="appearance-style-athelas"><span>Athelas</span></li>
			</ul>
		</div>
     </div>
	<div class="settings">
      <label>Amplada</label>
		<div class="setting-option">
	        <div id="slider-width"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
		<div class="setting-option">
	        <div id="slider-font"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
	  <div class="setting-option">
       <form action="" class="sett-options">
		<ul>
		    <li><input type="checkbox" id="secondary-content" /><label for="secondary-content">Mostra recursos complementaris</label></li>
		    <li><input type="checkbox" id="main-images" /><label for="main-images">Mostra imatges</label></li>
		    <li><input type="checkbox" id="text-alignment" /><label for="text-alignment">Text justificat</label></li>
			<li><input type="checkbox" id="text-hyphen" /><label for="text-hyphen">Partici&oacute; sil·l&agrave;bica</label></li>
		</ul>
       </form>
	  </div>
     </div>
     </div>
    </div>
   </div>
   </section>
 <section>
 <div id="favorites" class="hidden"></div>
 </section>   
 <div id="bridge" class="hidden"></div>
 <div id="help" class="hidden">
  <div class="helptitle">Dreceres del teclat<hr></div>
  <div class="helpsection"><span>General</span>
   <ul>
    <li><span class="shortcut">g</span>: Anar al men&uacute; de navegaci&oacute;</li>
    <li><span class="shortcut">o</span>: Anar a opcions</li>
    <li><span class="shortcut">s</span>: Guardar la p&agrave;gina actual a favorits</li>
    <li><span class="shortcut">p</span>: Imprimir la p&agrave;gina actual</li>
    <li><span class="shortcut">?</span>: Mostrar/Ocultar l&#39;ajuda</li>
   </ul>
  </div>
  <div class="helpsection"><span>Navegaci&oacute;</span>
   <ul>
    <li><span class="shortcut">i</span>: Anar a l&#39;&iacute;ndex general</li>
    <li><span class="shortcut">t</span>: Anar a l&#39;inici de p&agrave;gina</li>
    <li><span class="shortcut">b</span>: Anar al final de p&agrave;gina</li>
    <li><span class="shortcut">j</span>: Anar cap endavant dintre la p&agrave;gina</li>
    <li><span class="shortcut">k</span>: Anar cap enrere dintre la p&agrave;gina</li>
    <li><span class="shortcut">h</span>: Anar a la p&agrave;gina anterior:</li>
    <li><span class="shortcut">l</span>: Anar a la p&agrave;gina seg&uuml;ent:</li>
   </ul>
   </div>
 </div>
 <div id="favcounter" name="favcounter" class="hidden"><span></span></div>
 <div id="navmenu" class="navmenu"><ul class="webnav"><li><a href="../../../index.html" title="Anar a l&#39;&iacute;ndex general">Inici</a></li><li><a href="../introduccio.html">Configuració de la xarxa (DNS i DHCP)</a></li><li>Instal·lació de serveis de resolució de noms</li></ul></div>
	<div id="content" lang="ca" class="hyphenate text">
     <article lang="ca" class="sheet">
        <h1><a id="instal_lacio_de_serveis_de_resolucio_de_noms"> Instal·lació de serveis de resolució de noms </a></h1>
    	
<p>
El sistema de noms de domini <strong><acronym title="Domain Name System">DNS</acronym></strong> (<em>domain name system</em>) proporciona un mecanisme eficaç per fer la resolució de noms de domini a adreces IP. Com a usuaris (humans) ens és més fàcil adreçar-nos a un nom de domini (de <em>host</em>, de web, de servidor de correu, etc.) utilitzant un text identificatiu (per exemple, <a href="http://www.ioc.cat" class="urlextern" title="http://www.ioc.cat"  rel="nofollow">www.ioc.cat</a>) que no pas a l’adreça IP pertinent (per exemple, <em>213.73.40.230</em>). El servei <acronym title="Domain Name System">DNS</acronym> no solament permet fer la resolució de noms de domini a adreces IP, sinó també la resolució inversa. És a dir, a partir d’una IP esbrinar el nom de domini.
</p>

<p>
El servei <acronym title="Domain Name System">DNS</acronym> proporciona independència del nom de domini respecte a la IP. Així un domini pot canviar d’IP de manera transparent per als usuaris del domini. Fins i tot és usual que un domini s’identifiqui amb més d’una IP com a mesura de redundància contra la caiguda del sistema o com a balanceig de càrregues. Altres serveis proporcionats pel <acronym title="Domain Name System">DNS</acronym> són la identificació dels servidors de correu d’un domini, de cada un dels <em>hosts</em> que pertanyen a la xarxa, servidors d’impressió, etc.
</p>

<h2><a id="sistemes_de_noms_plans_i_jerarquics" >Sistemes de noms plans i jeràrquics</a></h2>
<div class="level2">

<p>
El problema d’identificar els equips es produeix des de bon principi de l’existència de les xarxes d’ordinadors i no és específic de les xarxes TCP/IP. Cal un mecanisme en “llenguatge humà” per identificar els equips de la xarxa. En especial els que proporcionen serveis als altres equips i usuaris. En la xarxa inicial ARPANET, els equips ja rebien un nom. Aquests noms es feien públics per mitjà d’un fitxer centralitzat que contenia els noms de tots els equips de la xarxa i la seva identificació. Aquest fitxer era el fitxer <em>hosts.txt</em> (en sistemes GNU/Linux, conegut com a /etc/hosts).
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Un sistema de <strong>noms pla</strong> es basa en la utilització d’un <strong>fitxer de text</strong> que descriu cada <em>host</em> amb la seva corresponent adreça IP. Es pot usar per definir àlies per equips locals en xarxes petites, però no és escalable a xarxes grans i molt menys a Internet.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">ARPANET</p>
<p>
ARPANET és la xarxa de commutació de paquets que va desenvolupar el Departament de Defensa dels Estats Units i que va ser la predecessora d’Internet.
</p>
</div></div>
<p>
Exemple de fitxer de noms pla per descriure els àlies d’una xarxa local a la llar:
</p>

<p>

</p>
<pre class="code">[root@portatil ~]# cat /etc/hosts
# Do not remove the following line, or various programs
# that require network functionality will fail.
127.0.0.1     localhost.localdomain   localhost   localhost
::1           localhost6.localdomain6 localhost6
192.168.1.1   router routerWF
192.168.1.31  server1   escriptori  pare
192.168.1.32  estacio1  dormitori   mare 
192.168.1.33  estacio2  nen         jocs    supercrac</pre>
<div class="ioctextl"><div class="ioccontent"><p class="ioctitle">Posar noms als ordinadors de casa:</p>
<p>
El fitxer anterior pertany al PC anomenat <em>server1</em> i posa noms “casolans” als altres ordinadors de la família. Així per exemple l’equip <em>192.168.1.33</em> es pot anomenar de les quatre maneres diferents que s’indiquen.
</p>
</div></div>
<p>
En una xarxa petita es pot generar un fitxer amb el nom i identificador IP de tots els <em>hosts</em>, centralitzat en un servidor, i encarregar-se de distribuir còpies d’aquest fitxer a tots els equips de la xarxa. Però aquest model de coneixement no és escalable. Si la xarxa creix és impossible de mantenir. Utilitzar aquest model significaria que hi ha un equip que centralitza els noms de tots els <em>hosts</em> d’Internet en un sol fitxer! D’altra banda, també significaria que aquest fitxer s’ha de repartir entre tots els equips d’Internet perquè sàpiguen com es diuen els altres equips cada cop que hi ha una actualització. Evidentment cal una altra solució.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
El 1983 sorgeix el <em>domain name system</em> (<acronym title="Domain Name System">DNS</acronym>) per aportar una solució escalable i pràctica. El <acronym title="Domain Name System">DNS</acronym> es basa en una base de dades de noms de domini jeràrquica i distribuïda. <strong>Jeràrquica</strong> perquè s’organitza en una estructura de <strong>dominis</strong> que es poden compondre de subdominis que també es poden dividir en subdominis i així fins a 127 nivells (originàriament). Aquests dominis són gestionats per servidors <acronym title="Domain Name System">DNS</acronym> responsables de cada <strong>zona</strong>. És una base de dades <strong>distribuïda</strong> perquè la informació no està tota junta en un sol repositori central, sinó que la informació es troba repartida per parts en els servidors <acronym title="Domain Name System">DNS</acronym> d’Internet. Cada servidor <acronym title="Domain Name System">DNS</acronym> <strong>autoritari</strong> conté la base de dades de la seva zona.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">Problemes d&#039;actualització d&#039;una xarxa</p>
<p>
Imagineu els problemes que es presenten en voler fer arribar un mateix fitxer a tots els <em>hosts</em>. Hi haurà inconsistències amb equips que han rebut l’actualització i altres que no. El trànsit de copiar el fitxer en cada equip. Un nou equip a Internet vol dir escriure de nou el fitxer i tornar-lo enviar a tothom!
</p>
</div></div>
</div>

<h3><a id="elements_del_sistema_de_noms_de_domini" >Elements del sistema de noms de domini</a></h3>
<div class="level3">

<p>
El servei <acronym title="Domain Name System">DNS</acronym> permet identificar qualsevol equip en la xarxa i assegurarse que no hi ha col·lisions, és a dir, noms duplicats. Es basa en una estructura jeràrquica de noms en forma d’arbre on l’arrel és el node o domini arrel del qual deriven tots els altres nodes. Aquest es divideix en altres dominis com, per exemple, <em>.com</em>, <em>.edu</em>, <em>.org</em>, <em>.cat</em>, etc. Al seu torn, cada domini es pot dividir en altres subdominis i així successivament. Les rutes s’indiquen començant pel subdomini més intern cap al node arrel (<a href="/doku.php?id=fp:smx:m07:mail.ioc.cat" class="wikilink2" title="fp:smx:m07:mail.ioc.cat" rel="nofollow">mail.ioc.cat</a>).
</p>

<p>
Els nodes s’identifiquen per un text (el nom de domini) que no es pot repetir en el mateix nivell, però sí en altres llocs de l’arbre de l’espai de noms. El mateix passa amb els fitxers: no hi pot haver dos fitxers amb el mateix nom en el mateix directori, però sí en ubicacions diferents. Un <strong>domini</strong> és el node indicat i tota la resta de l’arbre que penja d’aquest node (penseu en l’exemple d’un directori: si es vol copiar un directori, s’entén que està format pel mateix directori i tots els subdirectoris que conté). S’entén per <strong>espai de noms</strong> el conjunt de tots els dominis que formen l’arbre <acronym title="Domain Name System">DNS</acronym>.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
El sistema de noms de domini d’Internet <acronym title="Domain Name System">DNS</acronym> utilitza els elements següents:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Espai de noms</strong>. El conjunt de tots els dominis (l’arbre).</div>
</li>
<li class="level1"><div class="li"> <strong>Domini</strong>. Text identificatiu d’un domini.</div>
</li>
<li class="level1"><div class="li"> <strong>FQDN</strong>. Nom de domini absolut començant pel node i acabant en l’arrel.</div>
</li>
<li class="level1"><div class="li"> <strong>Domini absolut</strong>. (FQDN) Els dominis absoluts acaben en punt (.).</div>
</li>
<li class="level1"><div class="li"> <strong>Domini relatiu</strong>. Nom de domini sense qualificar.</div>
</li>
<li class="level1"><div class="li"> <strong>Domini arrel</strong>. Domini del qual deriven tots els altres. S’indica amb un punt o amb la cadena buida.</div>
</li>
</ul>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">Caràcters en els noms de domini</p>
<p>
L’estàndard <acronym title="Domain Name System">DNS</acronym> indica que els noms de domini han de ser de seixanta-quatre caràcters com a màxim, i només poden incloure caràcters llatins, dígits del 0 al 9 i el guió. Les majúscules i minúscules són indiferents. Hi ha mecanismes com l’IDNA (<em>an</em> <em>internationalized domain name</em> o noms de domini internacionalitzats) per permetre utilitzar altres alfabets en els noms de domini.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">Arbres dels sistemes DNS i de fitxers</p>
<p>
El sistema de noms de domini té una estructura similar a l’arbre que s’utilitza per representar un sistema de fitxers. La diferència rau en el fet que les rutes dels sistemes de fitxers s’indiquen des de l’arrel fins al node (per exemple,<em>/etc/bind/bind.conf</em>), i en canvi en el <acronym title="Domain Name System">DNS</acronym> les rutes s’indiquen del node inferior a l’arrel (<a href="/doku.php?id=fp:smx:m07:ns1.ioc.cat" class="wikilink2" title="fp:smx:m07:ns1.ioc.cat" rel="nofollow">ns1.ioc.cat</a>).
</p>
</div></div><div class="ioctextl"><div class="ioccontent"><p class="ioctitle">Dominis d&#039;alt nivell</p>
<p>
Els següents són exemples de dominis d’alt nivell d’alguns països:
</p>
<ul>
<li class="level1"><div class="li"> CAT: Catalunya.</div>
</li>
<li class="level1"><div class="li"> AD: Andorra.</div>
</li>
<li class="level1"><div class="li"> AQ: Antàrtida.</div>
</li>
<li class="level1"><div class="li"> <acronym title="Gigabyte">GB</acronym>: Gran Bretanya.</div>
</li>
<li class="level1"><div class="li"> UK: Regne Unit.</div>
</li>
<li class="level1"><div class="li"> IM: Illa de Man.</div>
</li>
<li class="level1"><div class="li"> MS: Montserrat.</div>
</li>
<li class="level1"><div class="li"> PF: Polinèsia Francesa.</div>
</li>
<li class="level1"><div class="li"> PS: autoritat palestina.</div>
</li>
</ul>
</div></div>
<p>
L’estructura en arbre (jeràrquica) de l’espai de noms proporciona un mecanisme d’identificació únic d’un domini. No pot existir cap domini que tingui exactament el mateix nom absolut <strong>FQDN</strong> (full qualified domain name o <strong>nom de domini complet</strong>). Els dominis es llegeixen des del node a l’arrel. Així un domini que correspongui al departament d’administració de l’organització IOC dins del domini <em>cat</em> s’identifica, per exemple, com a <a href="/doku.php?id=fp:smx:m07:admin.ioc.cat" class="wikilink2" title="fp:smx:m07:admin.ioc.cat" rel="nofollow">admin.ioc.cat</a>. Si ens fixem en el domini anterior, veurem que acaba en punt, és una manera d’indicar el domini arrel. El <strong>domini arrel</strong> es defineix com un domini sense etiqueta, o millor amb la cadena buida com a etiqueta. Això provoca que els dominis que s’indiquin de manera absoluta acabin amb el caràcter punt.
</p>

<p>
Un <strong>domini absolut</strong> o FQDN és el que inclou tots els nodes des del domini fins a l’arrel (inclosa en forma de punt final). Un <strong>domini relatiu</strong> no inclou l’arrel i pot ser relatiu al domini actual. Per exemple, dins del domini de
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">El punt final en els noms de domini</p>
<p>
La majoria de vegades escrivim els dominis com si fossin absoluts, però són relatius al node arrel perquè no posem el punt final. Un altre cop es pot fer l’analogia amb les rutes relatives i les rutes absolutes del sistema de fitxers.
</p>
</div></div>
<p>
l’IOC el domini <em>inf</em> (del departament d’informàtica) és un nom relatiu que fa referència al nom absolut <a href="/doku.php?id=fp:smx:m07:inf.ioc.cat" class="wikilink2" title="fp:smx:m07:inf.ioc.cat" rel="nofollow">inf.ioc.cat</a>.
</p>

</div>

<h3><a id="els_noms_de_domini_d_internet" >Els noms de domini d&#039;Internet</a></h3>
<div class="level3">

<p>
A Internet els noms de dominis segueixen una estructura basada en els seus inicis, però que ha anat evolucionant. El node arrel es va dividir en un conjunt de subdominis anomenats <strong>TLD</strong> (top level domains o <strong>dominis d’alt nivell</strong>). Aquests dominis eren <em>com</em>, <em>edu</em>, <em>gov</em>, <em>mil</em>, <em>org</em>, <em>net</em> i <em>int</em>. Posteriorment se’n van afegir d’altres com <em>cat</em>, <em>name</em>, <em>biz</em>, <em>info</em>, <em>pro</em>, <em>aero</em>, <em>coop</em> i <em>museum</em>. Es volien organitzar els dominis per funcionalitat posant les empreses en els <em>.com</em>, les organitzacions en els <em>.org</em>, etc. Es va veure, però, la necessitat de poder agrupar els dominis de manera geogràfica i van sorgit els famosos identificadors de país. Per a cada país es va generar un TLD de dos caràcters utilitzant el ja existent estàndard internacional ISO 3166 (els famosos <em>.es</em>, <em>.fr</em>, etc.).
</p>

<p>
Els servidors arrel són crucials per al funcionament del <acronym title="Domain Name System">DNS</acronym>, ja que coneixen tots els dominis de primer nivell. Han d’admetre un gran volum de consultes i per això n’hi ha tretze repartits per tot el món. A més a més, d’aquests tretze, alguns tenen rèpliques en diversos continents utilitzant un sistema anomenat <em>anycast</em>.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Origen dels noms de domini</p>
<p>
Si ens fixem en els primers dominis d’alt nivell, estaven basats en una visió estatunidenca del món (de fet la xarxa ARPANET base de l’actual Internet era seva). En estendre Internet globalment i aparèixer dominis d’alt nivell geogràfics, moltes organitzacions es van registrar en més d’un domini (per exemple, <em>empresa.com</em> i <em>empresa.cat</em>).
</p>
</div></div>
</div>

<h2><a id="zones_primaries_secundaries_i_mecanisme_de_resolucio" >Zones primàries/secundàries i mecanisme de resolució</a></h2>
<div class="level2">

<p>
De bon començament sabem que el sistema de noms de domini està basat en una arquitectura client-servidor en què els clients faran preguntes del tipus “quina IP té aquest domini?”, i els servidors miraran de contestarles. Els servidors de noms <acronym title="Domain Name System">DNS</acronym> són els programes que emmagatzemen i gestionen la informació en la base de dades d’una part de l’espai de noms anomenada <em>zona</em>.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Exemple d&#039;administració de subdomini</p>
<p>
El domini <em>.cat</em> és administrat per una entitat que gestiona la zona <em>.cat</em>. Aquest domini conté el subdomini <em>ioc.cat</em>, però ha <strong>delegat</strong> l’administració d’aquest subdomini a l’IOC. Els administradors de l’IOC disposen d’un servidor que gestiona el seu domini com una zona. El domini <em>.cat</em> és l’arbre que inclou tots els dominis que en deriven, també el ioc.cat. Però la zona <em>.cat</em> i la zona <em>ioc.cat</em> no són la mateixa zona. Són administrades per entitats diferents.
</p>
</div></div>
</div>

<h3><a id="les_zones" >Les zones</a></h3>
<div class="level3">

<p>
Primerament hem de descriure què és una zona. Una <strong>zona</strong> és part de l’espai de noms de domini gestionada per un (o més) servidors <acronym title="Domain Name System">DNS</acronym>. Els servidors que gestionen la zona tenen informació completa sobre la zona i es diu que tenen <strong>autoritat</strong> respecte a ella. De bon principi podríem pensar que un servidor <acronym title="Domain Name System">DNS</acronym> gestiona un domini i que una zona és el mateix que un domini, però això no ha de ser necessàriament així. Un domini es divideix en subdominis per facilitar-ne l’administració, i cada part administrada per un (o més) servidor <acronym title="Domain Name System">DNS</acronym> és una zona. El domini és l’arbre de l’espai de noms i la zona és la part de l’arbre administrada per un servidor de noms de domini concret. En la <span class="figref"><a href="#Figura6"><span>figura</span></a></span> es pot veure un espai de noms amb quatre zones i catorze dominis.
</p>
<div class="iocfigure"><a name="Figura6"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Exemple de zones i dominis

</figcaption><img src="../media/smxm7uf1ud1_im6.png" alt="" /></figure>
<div class="footfigure">En la figura es poden veure tants dominis com requadres de lletres agrupats en quatre zones. El nom de domini corresponent a  cada zona (s'anomenen segons el seu node superior) és A, B.A, C.A, I.C.A. Cada una d'aquestes quatre zones tindrà un (o més)  servidors DNS per gestionar-la.</div></div>
<p>
En general, podem dir que una zona conté la informació completa dels equips que formen el domini corresponent a la zona i dels equips dels subdominis que no s’hagin delegat. Aquesta informació s’emmagatzema en la <strong>base de dades de zona</strong>.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Convé tenir clar en tot moment que domini i zona no són equivalents (tot i que poden coincidir).
</p>
<ul>
<li class="level1"><div class="li"> El <strong>domini</strong> és l’arbre de l’espai de noms.</div>
</li>
<li class="level1"><div class="li"> La <strong>zona</strong> és la part de l’arbre administrada per un servidor <acronym title="Domain Name System">DNS</acronym> concret.</div>
</li>
<li class="level1"><div class="li"> La <strong>base de dades de zona</strong> la formen els fitxers que emmagatzemen la descripció dels equips que pertanyen a la zona.</div>
</li>
<li class="level1"><div class="li"> La <strong>delegació</strong> consisteix a passar l’autoritat de la gestió d’un subdomini a una altra entitat.</div>
</li>
</ul>
</div></div>
<p>
<strong>Delegar</strong> l’administració d’un subdomini no és més que passar l’autoritat sobre aquest subdomini a una altra entitat (a uns altres servidors <acronym title="Domain Name System">DNS</acronym>). Aquesta entitat és la responsable de l’administració de la zona delegada. Té tota l’autoritat per fer i desfer al seu criteri. La zona pare perd el control administratiu de la zona delegada i simplement apunta als servidors de noms de la zona delegada per obtenir informació quan la requereix.
</p>

<p>
L’estàndard que defineix el <acronym title="Domain Name System">DNS</acronym> estableix que cal configurar dos o més servidors autoritaris per a cada zona anomenats <em>servidor primari</em> i <em>servidor secundari</em>. El motiu és proporcionar un mecanisme de redundància, robustesa, rendiment i còpia de seguretat. Si el servidor de noms falla i és únic possiblement la xarxa caurà, serà inoperativa.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Els servidors <strong>primari</strong> i <strong>secundari</strong> són autoritat. Només el primari té els fitxers de zona. El secundari n’obté una còpia per transferència.
</p>
</div></div><div class="iocreference"><div class="ioccontent">
<p>
Podeu trobar més informació sobre els mecanismes de transferència entre servidors primaris i secundaris, i sobre el concepte de servidor autoritari, en el subapartat “Realització de transferències entre dos o més servidors” d’aquesta unitat.
</p>
</div></div>
</div>

<h3><a id="la_resolucio_de_noms" >La resolució de noms</a></h3>
<div class="level3">

<p>
Tot sovint en les aplicacions d’usuari i de sistema s’accedeix a recursos pel seu nom de domini. Per exemple, un client web requereix una determinada pàgina web, un navegador de fitxers vol accedir a unes carpetes d’una màquina remota que s’identifiquen pel nom de domini, el sistema ha de validar l’usuari contra un servidor LDAP remot, etc. En cada un d’aquests casos caldrà resoldre una pregunta del tipus <em>aquest domini a quina adreça IP correspon?</em> Aquesta pregunta no la responen les aplicacions individualment (el navegador web, el client d’autenticació…), sinó que utilitzen el resolver per fer-ho.
</p>

<p>
El <em>resolver</em> és la part client de l’arquitectura client-servidor del <acronym title="Domain Name System">DNS</acronym>. Ell ha d’atendre les necessitats de les aplicacions, confeccionar una consulta o <em>query</em>, fer-la a un servidor <acronym title="Domain Name System">DNS</acronym>, obtenir la resposta i passar-la a l’aplicació pertinent. El <em>resolver</em> no és usualment una aplicació sinó un conjunt de biblioteques de funcions. Les aplicacions clients es compilen i enllacen conjuntament amb aquestes biblioteques.
</p>

</div>

<h4><a id="la_resolucio" >La resolució</a></h4>
<div class="level4">

<p>
El mecanisme de resolució de noms <acronym title="Domain Name System">DNS</acronym> consta d’un client o <em>resolver</em> que realitzarà les consultes (o <em>querys</em>) a resoldre a uns servidors <acronym title="Domain Name System">DNS</acronym>.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Si el servidor disposa de la informació perquè forma part de la base de dades de la seva zona, emetrà una resposta <strong>autoritativa</strong>. Si disposa de la resposta perquè la té emmagatzemada temporalment (en un procés anomenat <em>cache</em>) també emetrà la resposta però aquest cop de manera<strong>no autoritativa</strong>. Si no té informació del domini buscat, el servidor pot fer a altres servidors la mateixa consulta en un procés que pot ser <strong>recursiu</strong> o <strong>iteratiu</strong>. Sempre existeix un camí per trobar el domini buscat, que és preguntar als <strong>nodes arrel</strong> (<em>root servers</em>) de l’espai de noms de domini. Partint dels nodes arrel i recorrent l’arbre cap avall, es pot arribar al domini buscat, si és que existeix.
</p>
</div></div>
<p>
Sempre hi ha un camí a un domini existent partint del node arrel. Quan un servidor és consultat sobre un domini que desconeix (no és de la seva zona ni té la resposta en la <em>cache</em>) pot escalar la pregunta a un servidor de l’arrel (<em>root name server</em>). Això significa que els servidors arrel són crucials per al funcionament del <acronym title="Domain Name System">DNS</acronym>.
</p>
<div class="iocexample"><div class="ioccontent"><p class="ioctitle">Exemple de resolució de noms DNS</p>
<p>
Quina adreça IP té el domini <em>ns1.ioc.cat</em>?
</p>

<p>
Si un estudiant australià intenta esbrinar això des del seu servidor de noms de Sindney, probablement acabarà preguntant a un dels nodes arrel per aquest domini. El node arrel desconeix el <em>host ns1</em> del domini de l’IOC, però sí que coneix tots els dominis de primer nivell (TLD). Proporcionarà una llista amb els servidors de noms del domini <em>.cat</em>. Preguntant a algun d’aquests servidors (del domini <em>.cat</em>) s’obtindrà la llista de servidors <acronym title="Domain Name System">DNS</acronym> del domini<em>ioc.cat</em>. Preguntant als servidors d’aquest domini s’obtindrà l’adreça IP del <em>host ns1</em> pel qual el domini <em>ioc.cat</em> és autoritari (forma part de la seva zona).
</p>
</div></div>
</div>

<h4><a id="recursio_i_iteracio" >Recursió i iteració</a></h4>
<div class="level4">

<p>
Quan el client o <em>resolver</em> emet una consulta al servidor <acronym title="Domain Name System">DNS</acronym> local (el servidor de noms que té configurat), aquest la pot tractar de manera <em>recursiva</em> o <em>iterativa</em>. De fet, el client <em>resolver</em> ja farà la consulta indicant si exigeix una resposta recursiva o iterativa. La diferència entre un mode i l’altre és com ha d’actuar el servidor <acronym title="Domain Name System">DNS</acronym> per obtenir la resposta quan no la té en la seva base de dades d’informació.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
En mode <strong>iteratiu</strong> el servidor retorna la millor resposta possible basada en la seva informació local, sense preguntar a ningú més. En el mode <strong>recursiu</strong> el servidor intenta trobar la resposta preguntant a tants altres servidors com calgui per tal d’obtenir-la.
</p>
</div></div>
<p>
Un servidor pot emetre les respostes següents:
</p>
<ol>
<li class="level1"><div class="li"> Respon enviant la dada que li han sol·licitat (un nom de <em>host</em>, una adreça IP, la llista de servidors de noms, de servidors d’autenticació…).</div>
</li>
<li class="level1"><div class="li"> Ha localitzat el domini buscat, però no es disposa de la dada sol·licitada. Cal tenir en compte que es poden sol·licitar altres dades a part de l’adreça IP del domini (per exemple, quins servidors de correu té el domini).</div>
</li>
<li class="level1"><div class="li"> Finalment pot ser que el domini sol·licitat no existeixi.</div>
</li>
</ol>

</div>

<h4><a id="recursio" >Recursió</a></h4>
<div class="level4">

<p>
Quan un servidor rep una consulta del client mira la base de dades local de la seva zona. Si existeix la informació sol·licitada la retorna. Si la dada no forma part de la seva zona, però la té emmagatzemada en <em>cache</em> (per què ja ha realitzat amb anterioritat un consulta similar i ha emmagatzemat temporalment la resposta) també la retorna. Si la dada no forma part del seu espai de noms ni es troba en la <em>cache</em>, el mode recursiu mana al servidor anar preguntant recursivament a altres servidors, apropant-se més a cada pas al domini sol·licitat. Si el servidor no coneix cap servidor més proper al domini buscat a qui preguntar, acaba preguntant als servidors de l’arrel.
</p>
<div class="iocexample"><div class="ioccontent"><p class="ioctitle">Exemple de recursió</p>
<p>
Si es consulta el domini <a href="http://www.inf.ioc.cat" class="urlextern" title="http://www.inf.ioc.cat"  rel="nofollow">www.inf.ioc.cat</a> i el servidor desconeix aquest domini, intentarà contactar amb un servidor de noms del domini <em>inf.ioc.cat</em>. Si tampoc sap com adreçar-se a aquest domini, intentarà contactar amb un servidor de noms de domini <em>ioc.cat</em>. Un altre cop si el desconeix provarà de localitzar un servidor per al domini <em>.cat</em>. Si tampoc és el cas, es posarà en contacte amb un servidor de noms de l’arrel. Un cop en l’arrel, sempre és possible accedir al domini buscat descendint per l’arbre de dominis.
</p>
</div></div>
<p>
Si tots els processos recursius acabessin preguntant als nodes arrel, aquests es saturarien. El servidor que ha rebut la consulta del <em>resolver</em> pregunta al node més proper al domini buscat. Si coneix algun servidor de noms més proper, li ho pregunta i s’evita d’anar a l’arrel.
</p>

<p>
Una altra manera d’evitar la sobrecàrrega dels nodes arrel és l’ús de la informació emmagatzemada de consultes anteriors, que es desa localment en la <em>cache</em> del servidor.
</p>

<p>
Imagineu un alumne de Sydney estudiant de l’IOC que genera una consulta al servidor de noms del seu ISP australià per identificar el domini <a href="http://www.int.ioc.cat" class="urlextern" title="http://www.int.ioc.cat"  rel="nofollow">www.int.ioc.cat</a>. Probablement el servidor desconeix aquest domini i tots els més propers, <em>inf.ioc.cat</em> i <em>ioc.cat</em>. Però segurament en la <em>cache</em> (per altres consultes) té la llista de servidors de noms autoritaris del domini <em>.cat</em>. Serà a un d’aquests servidors (i no un node arrel) a qui farà la consulta que li permetrà accedir descendentment al domini buscat.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Consulta d&#039;informació delegada</p>
<p>
Si es consulta l’adreça <a href="http://www.inf.ioc.cat" class="urlextern" title="http://www.inf.ioc.cat"  rel="nofollow">www.inf.ioc.cat</a> i el servidor que rep la consulta és el servidor de noms del domini<em>ioc.cat,</em> aquest no pregunta cap amunt (a .<em>cat</em> o a l’arrel) sinó que obté de la seva pròpia base de dades la llista dels servidors de noms autoritaris de la zona delegada<em>inf.ioc.cat</em>, als quals preguntarà per obtenir una resposta.
</p>
</div></div>
<p>
Per tant, en el procés recursiu, el servidor de noms que rep la consulta del<em>resolver</em> ha de tornar una resposta que pot procedir de la seva base de dades de zona, de la <em>cache</em>, o de les respostes finals que ha obtingut preguntant recursivament a altres servidors més propers al domini a consultar.
</p>

<p>
Fixeu-vos que un servidor que rep una consulta recursiva del <em>resolver</em> té la feina d’esbrinar per a ell la resposta. Podria repetir la mateixa consulta al servidor més proper fent-la recursiva en lloc d’iterativa. Això exigiria a l’altre servidor fer tota la feina. Aquest plantejament, tot i que possible, es considera abusiu.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Usualment el <strong>client</strong> consulta el seu <acronym title="Domain Name System">DNS</acronym> de manera <strong>recursiva</strong>, i els <strong>servidors</strong> es consulten entre ells de manera <strong>iterativa</strong>.
</p>
</div></div><div class="iocnote"><div class="ioccontent">
<p>
Els nodes arrel no accepten consultes recursives per evitar-ne l’abús i la saturació.
</p>
</div></div>
</div>

<h4><a id="iteracio" >Iteració</a></h4>
<div class="level4">

<p>
En mode iteratiu, un servidor dóna la millor resposta possible basant-se en la pròpia informació (base de dades de zones locals i del <em>cache</em>). En cap
</p>

<p>
cas consulta cap altre servidor. Si no disposa de la resposta, lliura una llista amb els servidors més propers al domini que es busca. La llista pot ser d’un o més servidors i és tasca del servidor que ha fet la consulta decidir a quin d’ells tornar a preguntar (en el cas recursiu).
</p>

<p>
Les consultes iteratives són usualment de servidor a servidor, però no del <em>resolver</em> al servidor. Si el <em>resolver</em> fes una consulta iterativa a un servidor, significaria que quan la resposta fos una referència a un altre servidor, el <em>resolver</em> hauria de fer una altra consulta. Generalment els <em>resolver</em> no tenen aquesta capacitat, simplement fan una consulta recursiva al servidor que tenen configurat i és aquest el que ha de fer tota la feina per obtenir la resposta.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
El client <em>resolver</em> fa una consulta <strong>recursiva</strong> al seu servidor <acronym title="Domain Name System">DNS</acronym> local. Si el servidor <acronym title="Domain Name System">DNS</acronym> disposa de la resposta, la torna . Pot ser de la seva zona i serà una resposta <strong>autoritativa</strong> o pot tenir-la en<em>cache</em> i serà <strong>no autoritativa</strong>.
</p>

<p>
Si no disposa de la resposta, consulta <strong>iterativament</strong> altres servidors apropant-se al domini buscat. Cada servidor que consulta iterativament li pot proporcionar la resposta (autoritativa o no) si la coneix, o una llista de servidors <acronym title="Domain Name System">DNS</acronym> autoritatius per al domini indicat.
</p>
</div></div>
</div>

<h4><a id="resolucio_inversa" >Resolució inversa</a></h4>
<div class="level4">

<p>
El <acronym title="Domain Name System">DNS</acronym> proporciona un mecanisme per obtenir el nom de domini a què correspon una adreça IP. Aquest mecanisme, anomenat <strong>resolució inversa</strong>, es basa en un domini especial anomenat <em>IN-ADDR.ARPA</em>. Hi ha protocols de xarxa que requereixen una resolució inversa correcta per funcionar bé i sovint s’utilitza com a mesura de seguretat per verificar l’existència de l’adreça IP en un domini.
</p>

<p>
S’ha ideat un domini de nom <em>IN-ADDR.ARPA</em> que permet representar en forma de nom de domini totes les adreces IP possibles. El format són etiquetes numèriques del 0-255 que representen cada octet d’una adreça IP. Les etiquetes dels octets es concatenen en ordre invers i se’ls afegeix el sufix <em>IN-ADDR.ARPA</em>. Un nom de domini amb quatre etiquetes d’octets correspon a un<em>host</em>, un nom de domini amb menys etiquetes correspon a una xarxa.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Un host amb l’adreça IP 192.168.1.24 correspon al domini 24.1.168.192.IN-ADDR.ARPA.
</p>
</div></div>
<p>
En l’exemple següent es mostren els servidors de noms del domini ioc.cat i es fa una consulta de resolució inversa a cada un d’ells:
</p>
<div class="iocnote"><div class="ioccontent">
<p>
La xarxa 172.16.32.0/24 correspon al domini ARPA següent: 32.16.172.IN-ADDR.ARPA.
</p>
</div></div><pre class="code bash"><ol><li class="li1"><div class="de1">[root@localhost ~]# host -vt NS ioc.cat</div></li><li class="li1"><div class="de1">Trying &quot;ioc.cat&quot;</div></li><li class="li1"><div class="de1">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 6116</div></li><li class="li1"><div class="de1">;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 0, ADDITIONAL: 2</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; QUESTION SECTION:</div></li><li class="li1"><div class="de1">;ioc.cat.                       IN      NS</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; ANSWER SECTION:</div></li><li class="li1"><div class="de1">ioc.cat.                900     IN      NS      dns1.nominalia.com.</div></li><li class="li1"><div class="de1">ioc.cat.                900     IN      NS      dns2.nominalia.com.</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; ADDITIONAL SECTION:</div></li><li class="li1"><div class="de1">dns1.nominalia.com.     145929  IN      A       62.97.103.68</div></li><li class="li1"><div class="de1">dns2.nominalia.com.     145925  IN      A       213.151.118.169</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Received 108 bytes from 80.58.61.250#53 in 112 ms</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">[root@localhost ~]# host 62.97.103.68</div></li><li class="li1"><div class="de1">68.103.97.62.in-addr.arpa domain name pointer dns1.nominalia.com.</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">[root@localhost ~]# host  213.151.118.169</div></li><li class="li1"><div class="de1">169.118.151.213.in-addr.arpa domain name pointer dns2.nominalia.com.</div></li></ol></pre>

</div>

<h3><a id="el_protocol_dns" >El protocol DNS</a></h3>
<div class="level3">

<p>
El servei de noms de domini utilitza el protocol <acronym title="Domain Name System">DNS</acronym> per fer les consultes i les respostes. Es tracta d’un protocol de capa d’aplicació que pot utilitzar tant UDP com TCP en la capa de transport. Usualment, tant les consultes del client com les respostes del servidor es poden encabir en un datagrama (512 bytes) i s’utilitza UDP (de fet, generalment es diu que el <acronym title="Domain Name System">DNS</acronym> usa UDP). Però si la informació a transmetre és àmplia (per exemple, una resposta amb una llista amb molta informació), la comunicació es passa a TCP automàticament. Un altre cas en què la informació és TCP és quan es realitza la transferència d’informació d’una zona entre servidors primaris i secundaris. El servidor <acronym title="Domain Name System">DNS</acronym> utilitza el port privilegiat 53.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
El <strong>protocol <acronym title="Domain Name System">DNS</acronym></strong> és usualment UDP, però pot ser <strong>TCP i UDP</strong>. Es tracta d’un protocol de capa d’aplicació i utilitza el <strong>port 53</strong>.
</p>
</div></div>
<p>
Els datagrames <acronym title="Domain Name System">DNS</acronym> es componen de diversos apartats tal com es pot veure a la consulta host següent:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# host -a uoc.es </div></li><li class="li1"><div class="de1">Trying &quot;uoc.es&quot;</div></li><li class="li1"><div class="de1">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 14091</div></li><li class="li1"><div class="de1">;; flags: qr rd ra; QUERY: 1, ANSWER: 2, AUTHORITY: 2, ADDITIONAL: 2</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; QUESTION SECTION:</div></li><li class="li1"><div class="de1">;uoc.es.  			IN	ANY</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; ANSWER SECTION:</div></li><li class="li1"><div class="de1">uoc.es.			82747	IN	NS	tibet.uoc.es.</div></li><li class="li1"><div class="de1">uoc.es.			82747	IN	NS	nepal.uoc.es.</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; AUTHORITY SECTION:</div></li><li class="li1"><div class="de1">uoc.es.			82747	IN	NS	nepal.uoc.es.</div></li><li class="li1"><div class="de1">uoc.es.			82747	IN	NS	tibet.uoc.es.</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; ADDITIONAL SECTION:</div></li><li class="li1"><div class="de1">nepal.uoc.es.		73649	IN	A	213.73.40.47</div></li><li class="li1"><div class="de1">tibet.uoc.es.		76582	IN	A	213.73.40.45</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Received 124 bytes from 127.0.0.1#53 in 2 ms</div></li></ol></pre>

<p>
La comunicació <acronym title="Domain Name System">DNS</acronym> és un mecanisme de consulta/resposta entre el client i el servidor. Els datagrames, doncs, seran de <em>query</em> (consulta) o <em>answer</em> (resposta).
</p>

<p>
Els apartats que componen un missatge <acronym title="Domain Name System">DNS</acronym> són:
</p>
<ul>
<li class="level1"><div class="li"> <strong>HEADER</strong>. Capçalera del missatge indicant si és una consulta o una resposta. Conté l’<em>id</em> (identificador) del missatge, <em>flags</em> i un resum de quines seccions del missatge porten informació i quanta.</div>
</li>
<li class="level1"><div class="li"> <strong>QUESTION</strong>. Aquesta secció conté la consulta que s’ha efectuat. És a dir, quina dada s’ha demanat al servidor. Pot ser una resolució d’adreça IP a un domini, demanar la llista de servidors d’impressió, etc.</div>
</li>
<li class="level1"><div class="li"> <strong>ANSWER</strong>. Secció que conté la resposta obtinguda del servidor. S’entén que aquesta secció conté la resposta no autoritativa. A vegades en les utilitats de consulta aquesta secció es mostra com a <em>non-autority answer</em>.</div>
</li>
<li class="level1"><div class="li"> <strong>AUTHORITY</strong>. Aquesta secció conté les respostes que són autoritatives per a la consulta efectuada. Evidentment pot ser buida.</div>
</li>
<li class="level1"><div class="li"> <strong>ADITIONAL</strong>. Conté informació addicional per completar la resposta. En l’exemple s’observa que completa la resolució dels noms de màquina que hi ha a la secció <em>asnwer</em> tot indicant la seva adreça IP corresponent.</div>
</li>
</ul>

</div>

<h3><a id="evolucio_del_protocol_dns_i_queestions_de_seguretat" >Evolució del protocol DNS i qüestions de seguretat</a></h3>
<div class="level3">

<p>
Els protocols <acronym title="Domain Name System">DNS</acronym> han evolucionat molt gràcies a les noves necessitats provocades per l’increment exponencial de les xarxes. Una de les principals vies en evolució és el DDNS o dinàmic <acronym title="Domain Name System">DNS</acronym> i el DNSSEC o <acronym title="Domain Name System">DNS</acronym> segur.
</p>

</div>

<h4><a id="ddns" >DDNS</a></h4>
<div class="level4">

<p>
El protocol DDNS (<em>dynamic <acronym title="Domain Name System">DNS</acronym></em>) permet que les dades del servidor <acronym title="Domain Name System">DNS</acronym> s’actualitzin en temps real. El principal ús és permetre que clients amb adreces IP dinàmiques d’interval puguin disposar d’un nom de domini (a pesar que la seva adreça IP varia d’una sessió a una altra). Un mecanisme consisteix a permetre que els servidors DHCP es comuniquin amb els servidors <acronym title="Domain Name System">DNS</acronym> i els notifiquin les actualitzacions a la base de dades de <acronym title="Domain Name System">DNS</acronym> que cal fer. En funció de les configuracions de xarxa que els servidors DHCP proporcionen als seus clients es fan les actualitzacions al <acronym title="Domain Name System">DNS</acronym>.
</p>

</div>

<h4><a id="dnssec" >DNSSEC</a></h4>
<div class="level4">

<p>
DNSSEC o <em>Domain Name System Security Extensions</em> (extensions de seguretat per a <acronym title="Domain Name System">DNS</acronym>) són un conjunt d’especificacions de seguretat per permetre una comunicació <acronym title="Domain Name System">DNS</acronym> segura, de manera que el client pugui estar plenament segur que qui li respon les consultes és el seu servidor <acronym title="Domain Name System">DNS</acronym> i no un impostar (el <em>man-in-the-middle</em>). També garanteix la integritat de les dades tant de les consultes com de les respostes i a més a més està dissenyat per prevenir atacs de denegació de servei.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle"> Man-in-the-middle</p>
<p>
S’anomena man-in-the-middle aquells equips que es fan passar per altres en una connexió de xarxa. El client creu connectar amb el seu banc, però de fet està connectant amb un “atacant” situat entremig. Aquest atacant rep el trànsit del client i el transfereix al banc, rep la resposta del banc i la passa al client. En aquest procés està en disposició de “manipular” tot aquest trànsit a la seva conveniència.
</p>
</div></div>
<p>

</p>
<div class="ioctextl"><div class="ioccontent"><p class="ioctitle">Servidors DNS enverinats</p>
<p>
Un dels principals problemes del protocol <acronym title="Domain Name System">DNS</acronym> (com de tots els primers protocols d’Internet) és la falta de seguretat. Va ser dissenyat en una època de ‚bon rotllo’ on es confiava amb els altres integrants de la xarxa. Això avui en dia no és massa sensat.
</p>

<p>
Imagineu que un atacant aconsegueix el control d’un servidor <acronym title="Domain Name System">DNS</acronym> o aconsegueix fer passar el seu servidor <acronym title="Domain Name System">DNS</acronym> fals com a servidor d’un conjunt d’usuaris. Cada vegada que aquests clients fan una consulta a Internet, per exemple al seu banc (posant el nom de la web), el servidor <acronym title="Domain Name System">DNS</acronym> enverinat proporciona una adreça IP no del banc real sinó d’una web falsa amb la finalitat de…
</p>

<p>
Cada cop que accedim a una web, un servei, un <em>host</em>, etc. per mitjà del seu nom de domini, confiem que el servidor <acronym title="Domain Name System">DNS</acronym> proporcioni l’adreça IP correcta. Som confiats, oi?
</p>
</div></div>
</div>

<h2><a id="tipus_de_registres" >Tipus de registres</a></h2>
<div class="level2">

<p>
El sistema de noms de domini és una base de dades jeràrquica i distribuïda en què cada servidor de noms gestiona la informació corresponent a la zona de la qual és autoritari. Cada zona conté informació dels<em>hosts</em> que la formen. La informació de zona s’emmagatzema en forma de <strong>registre de recurs o resource record (RR)</strong>. Hi ha la informació que permet identificar cada nom de domini amb l’adreça IP corresponent, anomenat <strong>forward mapping o resolució directa</strong>. També conté la informació per identificar cada adreça IP amb el nom de domini corresponent, anomenat <strong>reverse mapping o resolució inversa</strong>. La informació de zones conté altres informacions que permeten identificar els servidors <acronym title="Domain Name System">DNS</acronym> autoritaris per la zona, els servidors de correu, etc.
</p>

</div>

<h3><a id="base_de_dades_de_zona" >Base de dades de zona</a></h3>
<div class="level3">

<p>
La configuració d’una zona s’emmagatzema en un conjunt de fitxers anomenat <em>fitxers de zona</em>. L’especificació del <acronym title="Domain Name System">DNS</acronym> diu com han de ser aquests fitxers de zona i com s’hi han de descriure els registres de recurs (descripció de cada element que pertany a la zona).
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Aprofitar fitxers de zona</p>
<p>
Els fitxers de zona de descripció del <em>loopback</em> i dels nodes arrel són pràcticament iguals per a totes les zones, de manera que usualment es copien d’una zona ja existent en lloc d’escriure’ls de nou.
</p>
</div></div><div class="iocimportant"><div class="ioccontent">
<p>
El conjunt dels registres de recurs de totes les zones de l’espai de noms formen la <strong>base de dades</strong> distribuïda jeràrquica del sistema <acronym title="Domain Name System">DNS</acronym>.
</p>
</div></div>
<p>
En qualsevol zona hi haurà almenys els <strong>fitxers de zona</strong> següents:
</p>
<ul>
<li class="level1"><div class="li"> Un fitxer amb les associacions dels noms de domini a adreces IP. Aquest fitxer defineix la resolució directa.</div>
</li>
<li class="level1"><div class="li"> Un fitxer per a cada subxarxa amb l’associació de cada adreça IP al seu nom de domini canònic. Defineix la resolució inversa.</div>
</li>
<li class="level1"><div class="li"> Un fitxer amb la definició de la resolució inversa del <em>loopback</em>.</div>
</li>
<li class="level1"><div class="li"> Un fitxer amb la descripció dels nodes arrel d’Internet.</div>
</li>
</ul>

<p>
Un cop els fitxers de zona contenen tots els registres de recurs necessaris cal configurar el servidor de noms perquè utilitzi aquests fitxers. Si bé la configuració dels fitxers de zona és estàndard (definida per l’especificació <acronym title="Domain Name System">DNS</acronym>), la configuració del servidor depèn del programa que s’utilitzi.
</p>

</div>

<h3><a id="registres_de_recurs" >Registres de recurs</a></h3>
<div class="level3">

<p>
Cada fitxer de zona conté un conjunt d’entrades que comencen en la primera columna i cada una defineix un <strong>registre de recurs (RR)</strong>. Els més usuals són <em>SOA</em>, <em>NS</em>, <em>A</em>, <em>CNAME</em>, <em>PTR</em> i <em>MX</em>. L’ordre en què apareixen és indiferent, però usualment és el mateix que apareix en els exemples. Cada línia té el format:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Aplicacions DNS</p>
<p>
Hi ha diverses aplicacions que proporcionen el servei de servidor de noms. La més famosa, estesa i utilitzada és el BIND (Berkleley I N D). En la versió BIND 9 s’utilitza un fitxer de configuració anomenat <em>/etc/named.conf</em> per configurar el servidor i indicar-li quins són i on es troben els fitxers de zona.
</p>
</div></div><pre class="code">domini classe [ttl] tipus rdata:</pre>
<ul>
<li class="level1"><div class="li"> <strong>domini</strong> és el nom de domini que s’està definint,</div>
</li>
<li class="level1"><div class="li"> <strong>classe</strong>, actualment, només pren el valor <em>IN</em> per Internet.</div>
</li>
<li class="level1"><div class="li"> <strong>ttl</strong> és un camp opcional que descriu el temps de vida que cal emmagatzemar aquest registre en <em>cache</em>.</div>
</li>
<li class="level1"><div class="li"> <strong>tipus</strong> és el tipus d’RR que s’està definint.</div>
</li>
<li class="level1"><div class="li"> <strong>rdata</strong> és el valor que s’associa al nom de domini que es defineix.</div>
</li>
</ul>

<p>
Tot i que en cada registre de recurs es pot definir un TTL (<strong>time to live</strong> o temps de vida propi), el més usual és definir un TTL genèric per a totes les entrades del fitxer de zona en lloc de fer-ho una a una. El servidor BIND 9 utilitza la directiva <em>$TTL</em> (per exemple: $ttl1 1h) per indicar el temps que els altres servidors de noms han de guardar en la seva <em>cache</em> les respostes d’aquest servidor (una hora en l’exemple).
</p>

</div>

<h4><a id="registre_soa" >Registre SOA</a></h4>
<div class="level4">

<p>
El registre de recurs <strong>SOA</strong> o <strong>start of authority</strong> (inici de definició de zona amb autoritat) diu que el fitxer de zona on es troba és la millor font de dades per a la zona, que el servidor de noms és autoritari per a la zona. Acostuma a ser el primer RR que hi ha en el fitxer de zona, tot i que no és obligatori. Per cada fitxer de zona hi ha d’haver només un registre SOA.
</p>
<div class="iocreference"><div class="ioccontent">
<p>
En la secció “Annexos” del web d’aquest mòdul trobareu altres tipus de recursos RR. També es poden trobar en l’especificació <acronym title="Domain Name System">DNS</acronym>.
</p>
</div></div>
<p>
Un registre SOA té el format:
</p>
<pre class="code">nomDomini. IN SOA nsPrimari. admin.nsPrimari. (opcions-slaves)</pre>

<p>
Un exemple seria el següent:
</p>
<pre class="code">inf.ioc.cat. IN SOA ns1.inf.ioc.cat. admin.ns1.inf.ioc.cat. ( 1h 3h 1h 1w 1h )</pre>

<p>

</p>

<p>
La descripció de cada camp és la següent:
</p>
<ul>
<li class="level1"><div class="li"> <strong>nomDomini.</strong> indica el nom del domini que s’està definint i pel qual el servidor de noms és autoritari. Fixeu-vos en el punt al final del nom del domini, és important posar-lo.</div>
</li>
<li class="level1"><div class="li"> <strong>IN</strong> indica que la classe és Internet.</div>
</li>
<li class="level1"><div class="li"> <strong>SOA</strong> descriu que és un registre de recurs tipus SOA.</div>
</li>
<li class="level1"><div class="li"> <strong>nsPrimari.</strong> és el nom del <em>host</em> servidor de noms primari per a aquesta zona. Un altre cop pareu atenció al punt del final.</div>
</li>
<li class="level1"><div class="li"> <strong>admin.nsPrimari.</strong> és l’adreça de correu electrònic de l’administrador del servidor de noms de domini, amb el format <em>usuari.servidor</em>. El primer punt que separa el nom d’usuari i el nom del servidor cal interpretar-lo com si fos una @ (<em>usuari@servidor</em>).</div>
</li>
<li class="level1"><div class="li"> <strong>opcions-slaves</strong> són paràmetres que s’indiquen entre parèntesis i que serveixen per definir com ha de ser la comunicació entre el servidor primari (o <em>master</em>) i els servidors secundaris (o <em>slaves</em>). A grans trets s’indiquen els conceptes següents:</div>
<ul>
<li class="level2"><div class="li"> <em>Serial</em>: el número de sèrie de la versió de les dades. A cada canvi de les dades de la zona, el número s’incrementa.</div>
</li>
<li class="level2"><div class="li"> <em>Refresh</em>: temps a transcórrer entre cada refresc de dades del servidor secundari.</div>
</li>
<li class="level2"><div class="li"> <em>Retry</em>: temps d’espera per tornar a intentar un refresc si el servidor secundari ha fallat en l’intent d’actualitzar les seves dades del servidor primari.</div>
</li>
<li class="level2"><div class="li"> <em>Expire</em>: temps a partir del qual les dades del servidor secundari es consideren sense autoritat si no s’han refrescat abans.</div>
</li>
<li class="level2"><div class="li"> <em>Minimum</em>: valor del TTL dels camps per defecte. Recordeu que a cada camp s’hi pot assignar un TTL específic. Segons la versió del servidor indicarà el TTL de les respostes negatives (<em>negative caching</em>), ja que el temps TTL es defineix per la directiva $TTL.</div>
</li>
</ul>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Punt final en el nom de domini</p>
<p>
Posar, o no, el punt al final d’un nom de domini és important. Si acaba amb punt és un nom de domini absolut. Si acaba sense punt, és un nom relatiu i s’hi afegirà el domini per defecte al final.
</p>
</div></div></li>
</ul>

</div>

<h4><a id="registre_ns" >Registre NS</a></h4>
<div class="level4">

<p>
El registre de recurs <strong>NS</strong> o name server (<strong>servidor de noms</strong>) defineix un servidor de noms autoritatiu per a la zona. Hi haurà tantes entrades NS com servidors de noms autoritatius hi ha en la zona. L’estàndard <acronym title="Domain Name System">DNS</acronym> en recomana almenys dos (un de primari o <em>master</em> i un de seguretat secundari o <em>slave</em>).
</p>

<p>
Un registre NS consta dels camps:
</p>
<pre class="code">nomDomini. IN NS nameServer.</pre>

<p>
Un exemple seria aquest:
</p>
<pre class="code">inf.ioc.cat. IN NS ns1.inf.ioc.cat.</pre>

<p>

</p>

<p>
La descripció de cada camp és la següent:
</p>
<ul>
<li class="level1"><div class="li"> <strong>nomDomini.</strong> indica el nom del domini que s’està definint.</div>
</li>
<li class="level1"><div class="li"> <strong>IN</strong> indica que la classe és Internet.</div>
</li>
<li class="level1"><div class="li"> <strong>NS</strong> descriu que es tracta d’un tipus de registre de recurs en què es defineix un servidor de noms.</div>
</li>
<li class="level1"><div class="li"> <strong>nameServer.</strong> és el nom del servidor de noms. Fixeu-vos un altre cop que tant <em>nomDomini.</em> com <em>nameServer.</em> acaben en un punt per indicar que són noms de domini absoluts o FQDN.</div>
</li>
</ul>

<p>
En la següent llista es pot veure part d’una resposta a una consulta nslookup per observar quins són els servidors de noms de <em>yahoo</em>:
</p>
<pre class="code">... output suprimit ...
Authoritative answers can be found from: 
yahoo.com       nameserver = ns2.yahoo.com. 
yahoo.com       nameserver = ns1.yahoo.com. 
yahoo.com       nameserver = ns3.yahoo.com. 
yahoo.com       nameserver = ns4.yahoo.com. 
yahoo.com       nameserver = ns5.yahoo.com. 
yahoo.com       nameserver = ns6.yahoo.com. 
yahoo.com       nameserver = ns8.yahoo.com. 
ns2.yahoo.com   internet address = 68.142.255.16 
ns1.yahoo.com   internet address = 66.218.71.63 
ns3.yahoo.com   internet address = 217.12.4.104 
ns4.yahoo.com   internet address = 68.142.196.63 
ns5.yahoo.com   internet address = 216.109.116.17 
ns6.yahoo.com   internet address = 202.43.223.170 
ns8.yahoo.com   internet address = 202.165.104.22</pre>

</div>

<h4><a id="registre_a" >Registre A</a></h4>
<div class="level4">

<p>
Un registre de recurs <strong>A</strong> o address <strong>(adreça)</strong> associa un nom de <em>host</em> a una adreça IP (resolució directa). Per cada nom de <em>host</em> de la xarxa caldrà disposar d’una entrada on s’associï el nom del <em>host</em> a la seva adreça IP.
</p>

<p>
Un registre A consta dels camps:
</p>
<pre class="code">nomHost. IN A IP</pre>

<p>
Un exemple seria aquest:
</p>
<pre class="code">mahatma.inf.ioc.cat. IN A 192.168.0.2</pre>

<p>
La descripció de cada camp és la següent:
</p>
<ul>
<li class="level1"><div class="li"> <strong>nomHost.</strong> indica el nom del <em>host</em> que s’està definint.</div>
</li>
<li class="level1"><div class="li"> <strong>IN</strong> indica que la classe és Internet.</div>
</li>
<li class="level1"><div class="li"> <strong>A</strong> descriu que es tracta d’un tipus de registre de recurs de definició d’adreça IP.</div>
</li>
<li class="level1"><div class="li"> <strong>IP</strong> és l’adreça IP assignada al <em>host</em>.</div>
</li>
</ul>

<p>
Fixem-nos un altre cop que <em>nomHost.</em> acaba en punt per indicar el seu FQDN. Un <em>host</em> pot tenir més d’una IP assignada al mateix nom de <em>host</em> i s’anomena multi-homed. Simplement caldrà que hi hagi un registre A per a cada adreça IP. Constarà del mateix nom de <em>host</em> a l’esquerra de la definició, i la corresponent adreça IP a la dreta. Per exemple:
</p>
<pre class="code">superserver.dom.com. IN A 10.0.0.1 
superserver.dom.com. IN A 10.0.0.2</pre>
<div class="iocimportant"><div class="ioccontent">
<p>
Els noms definits en els registres de tipus A són noms <strong>canònics</strong>. Un <em>host</em> es pot identificar per més d’un nom, però només un és el nom canònic (original), la resta són <strong>àlies</strong>. Els noms canònics es defineixen amb el tipus de registre A. Els àlies es defineixen amb el tipus de registre CNAME.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">A vs CNAME</p>
<p>
Compte! No s’ha de confondre els registres de recurs <em>A</em> i els <em>CNAME</em>:<em>hosts</em> registre A àlies registre CNAME
</p>
</div></div>
</div>

<h4><a id="registre_cname" >Registre CNAME</a></h4>
<div class="level4">

<p>
Els registres de recurs <strong>CNAME</strong> o canonical name <strong>(nom canònic)</strong> associen un àlies a un nom canònic.
</p>

<p>
Un registre CNAME consta dels camps:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nomHost. IN CNAME hostCanonicalName. | IP</div></li></ol></pre>

<p>
Un exemple seria aquest:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">ftp.inf.ioc.cat. IN CNAME mahatma.inf.ioc.cat.</div></li><li class="li1"><div class="de1">tftp.inf.ioc.cat IN CNAME 192.168.0.2</div></li></ol></pre>

<p>
La descripció de cada camp és la següent:
</p>
<ul>
<li class="level1"><div class="li"> <strong>nomHost.</strong> indica el nom de l’àlies que s’està definint.</div>
</li>
<li class="level1"><div class="li"> <strong>IN</strong> indica que la classe és Internet.</div>
</li>
<li class="level1"><div class="li"> <strong>CNAME</strong> descriu que es tracta d’un registre de recurs de definició d’un àlies.</div>
</li>
<li class="level1"><div class="li"> <strong>hostCanonicalName | IP</strong> és el nom de <em>host</em> canònic al qual s’assigna l’àlies. Fixeu-vos un altre cop que és un FQDN i acaba en punt. Generalment, els registres CNAME tenen a la part dreta de la definició un nom canònic, però de vegades caldrà indicar-hi una adreça IP. Penseu en un<em>host multi-homed</em> amb múltiples adreces IP que a més a més té àlies. Si la definició fos pel nom canònic del <em>host</em>, no se sabria quina de les adreces IP correspon a l’àlies. En aquests casos, el CNAME apunta a una adreça IP.</div>
</li>
</ul>

<p>
La resolució dels àlies s’obté buscant l’entrada de l’àlies en el fitxer de zona. Amb l’entrada CNAME s’obté el nom canònic corresponent a l’àlies. Un altre cop es torna a buscar en el fitxer de zona, ara el nom canònic. Una entrada de tipus A proporcionarà l’adreça IP corresponent (àlies –&gt; CNAME –&gt; nom canònic –&gt; A –&gt; adreça IP). Un àlies mai pot aparèixer a la part dreta d’una definició de registre de recurs.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Exemple de host multi-homed</p>
<p>
Es vol posar l’àlies <em>super1</em> i <em>super2</em> a cada una de les IP del host superserver.com (un <em>host</em> que té dues adreces IP assignades a aquest nom). Les entrades CNAME serien les següents:
</p>
<ul>
<li class="level1"><div class="li"> super1.dom.com. IN CNAME 10.0.0.1.</div>
</li>
<li class="level1"><div class="li"> super2.dom.com. IN CNAME 10.0.0.2.</div>
</li>
</ul>
</div></div>
</div>

<h4><a id="registre_ptr" >Registre PTR</a></h4>
<div class="level4">

<p>
Un registre de recurs <strong>PTR</strong> o pointer <strong>(punter)</strong> associa una adreça IP al nom de <em>host</em> pertinent (resolució inversa). Cal una entrada PTR per a cada interfície de xarxa de la zona.
</p>

<p>
Un registre PTR consta dels camps:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">ipInversa.in-addr.arpa. PTR hostCanonicalName.</div></li></ol></pre>

<p>
Un exemple seria aquest:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">2.20.168.192.in-addr.apra. IN PTR mahatma.inf.ioc.cat.</div></li></ol></pre>

<p>
La descripció de cada camp és la següent:
</p>
<ul>
<li class="level1"><div class="li"> <strong>ipInversa.in-addr.arpa.</strong> indica l’adreça IP escrita en forma de domini<em>in-addr.arpa</em> per poder fer la resolució inversa. Les adreces IP s’escriuen al revés quan formen part del domini <em>in-addr.arpa</em>. Així una IP 192.168.20.2 s’escriu <em>2.20.168.192.in-addr.arpa.</em></div>
</li>
<li class="level1"><div class="li"> <strong>IN</strong> indica que la classe és Internet.</div>
</li>
<li class="level1"><div class="li"> <strong>PTR</strong> descriu que es tracta d’un registre de recurs de definició de la resolució inversa d’una adreça IP.</div>
</li>
<li class="level1"><div class="li"> <strong>hostCanonicalName.</strong> és el nom de <em>host</em> FQDN assignat a l’adreça IP. El nom del <em>host</em> ha de ser per força el nom canònic. No hi pot haver dues definicions de la mateixa IP amb noms diferents (àlies), només de la IP al nom canònic.</div>
</li>
</ul>

</div>

<h4><a id="registre_mx" >Registre MX</a></h4>
<div class="level4">

<p>
Un registre <strong>MX</strong> mail echanger <strong>(servidor de correu electrònic)</strong> defineix un servidor de correu. Es pot posar una entrada MX per a cada servidor de correu, però no és obligatori que n’hi hagi cap.
</p>

<p>
Un registre MX consta dels camps:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nomDomini. IN MX num mailServer.</div></li></ol></pre>

<p>
Un exemple seria aquest:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">inf.ioc.cat. IN MX 10 ns1.inf.ioc.cat.</div></li></ol></pre>

<p>
La descripció de cada camp és la següent:
</p>
<ul>
<li class="level1"><div class="li"> <strong>nomDomini.</strong> indica el nom del domini que s’està definint.</div>
</li>
<li class="level1"><div class="li"> <strong>IN</strong> indica que la classe és Internet.</div>
</li>
<li class="level1"><div class="li"> <strong>MX</strong> descriu que es tracta d’un registre de recurs on es defineix un servidor de correu per a aquest domini.</div>
</li>
<li class="level1"><div class="li"> <strong>num</strong> és un valor numèric que expressa el grau de preferència d’aquest servidor de correu respecte a altres servidors de correu del domini. El valor més baix és el que es prefereix més. Són valors arbitraris que defineix l’administrador de xarxes.</div>
</li>
<li class="level1"><div class="li"> <strong>mailServer.</strong> correspon al nom FQDN del servidor de correu que s’està definint.</div>
</li>
</ul>

<p>
Podem observar la llista de servidors de correu de <em>google</em> fent:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@localhost ~]# host google.com</div></li><li class="li1"><div class="de1">google.com has address 74.125.45.100</div></li><li class="li1"><div class="de1">google.com has address 74.125.127.100</div></li><li class="li1"><div class="de1">google.com has address 74.125.67.100</div></li><li class="li1"><div class="de1">google.com mail is handled by 10 google.com.s9b1.psmtp.com.</div></li><li class="li1"><div class="de1">google.com mail is handled by 100 smtp2.google.com.</div></li><li class="li1"><div class="de1">google.com mail is handled by 10 google.com.s9a2.psmtp.com.</div></li><li class="li1"><div class="de1">google.com mail is handled by 10 google.com.s9b2.psmtp.com.</div></li><li class="li1"><div class="de1">google.com mail is handled by 10 google.com.s9a1.psmtp.com.</div></li><li class="li1"><div class="de1">google.com mail is handled by 100 smtp1.google.com.</div></li></ol></pre>

<p>
Les dues llistes següents mostren exemples dels fitxers de configuració per a la resolució directa i la resolució inversa de la zona <em>ioc.cat</em>. En el primer es defineixen dos servidors de nom, un encaminador, una impressora i dos <em>hosts</em>. El primer dels servidors de noms també fa les funcions de servidor de correu, web i <acronym title="File Transfer Protocol">FTP</acronym>.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">;Exemple de fitxer de zona ioc.cat</div></li><li class="li1"><div class="de1">$TTL 3D</div></li><li class="li1"><div class="de1">ioc.cat. IN SOA ns1.ioc.cat. admin.ioc.cat. {</div></li><li class="li1"><div class="de1">        23;serial</div></li><li class="li1"><div class="de1">        8H;refresh</div></li><li class="li1"><div class="de1">        2H;retry </div></li><li class="li1"><div class="de1">        4W;expire</div></li><li class="li1"><div class="de1">        1D);minimum ttl</div></li><li class="li1"><div class="de1">      NS ns1.ioc.cat.</div></li><li class="li1"><div class="de1">      NS ns2.ioc.cat.</div></li><li class="li1"><div class="de1">      MX 10 correu.ioc.cat.</div></li><li class="li1"><div class="de1">ns1.ioc.cat. A 192.168.0.5; servidor amb 2 ip</div></li><li class="li1"><div class="de1">             A 172.16.20.5</div></li><li class="li1"><div class="de1">ns2.ioc.cat. A 192.168.0.7; servidor dns slave</div></li><li class="li1"><div class="de1">router       A 192.168.0.1; router. Nom relatiu</div></li><li class="li1"><div class="de1">correu   CNAME ns1 ; alias correu</div></li><li class="li1"><div class="de1">www      CNAME ns1 ; alias web</div></li><li class="li1"><div class="de1">ftp      CNAME ns1 ; alias ftp</div></li><li class="li1"><div class="de1">hp-7200c A 192.168.0.2; impressora</div></li><li class="li1"><div class="de1">pc01     A 192.168.0.50</div></li><li class="li1"><div class="de1">pc02     A 192.168.0.51</div></li></ol></pre>

<p>
En la llista següent es pot veure com es defineix una entrada PTR per a cada nom canònic definit en la resolució directa per a una subxarxa concreta. La subxarxa <em>192.168.0.0/24</em> utilitza el fitxer <em>0.168.192.in-addr.arpa</em>.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">; Zona 0.168.192.in-addr.arpa.</div></li><li class="li1"><div class="de1">;Exemple de fitxer de zona inversa ioc.cat</div></li><li class="li1"><div class="de1">; correspon a la xarxa 192.168.0.0/24</div></li><li class="li1"><div class="de1">$TTL 3D</div></li><li class="li1"><div class="de1">ioc.cat. IN SOA ns1.ioc.cat. admin.ioc.cat. {</div></li><li class="li1"><div class="de1">     23; serial</div></li><li class="li1"><div class="de1">     8H; refresh</div></li><li class="li1"><div class="de1">     2H; retry </div></li><li class="li1"><div class="de1">     4W; expire</div></li><li class="li1"><div class="de1">     1D) ; minimum ttl</div></li><li class="li1"><div class="de1">    NS ns1.ioc.cat.</div></li><li class="li1"><div class="de1">5   IN PTR ns1.ioc.cat.</div></li><li class="li1"><div class="de1">7   IN PTR ns2.ioc.cat.</div></li><li class="li1"><div class="de1">1   IN PTR router.ioc.cat.</div></li><li class="li1"><div class="de1">2   IN PTR hp-7200c.ioc.cat.</div></li><li class="li1"><div class="de1">50  IN PTR pc01.ioc.cat.</div></li><li class="li1"><div class="de1">51  IN PTR pc02.ioc.cat.</div></li></ol></pre>

</div>

<h3><a id="altres_registres" >Altres registres</a></h3>
<div class="level3">

<p>
Hi ha altres tipus de registres de recurs que no són tan utilitzats i que es mencionen a continuació:
</p>
<ul>
<li class="level1"><div class="li"> HINFO: (Host Information) informació sobre el tipus d’ordinador.</div>
</li>
<li class="level1"><div class="li"> <acronym title="Megabyte">MB</acronym>: (Mail Box) informació sobre una bústia de correu.</div>
</li>
<li class="level1"><div class="li"> MG: (Mailgroup) informació sobre un grup de correu.</div>
</li>
<li class="level1"><div class="li"> MR: nom nou d’una bústia de correu.</div>
</li>
<li class="level1"><div class="li"> WKS (Well Known Services) llista de serveis del <em>host</em>.</div>
</li>
<li class="level1"><div class="li"> TXT: (Text) text descriptiu.</div>
</li>
<li class="level1"><div class="li"> NULL: (Null) registre buit.</div>
</li>
<li class="level1"><div class="li"> AAAA () corresponent a una adreça de host usant Ipv6.</div>
</li>
</ul>

</div>

<h3><a id="abreviacions" >Abreviacions</a></h3>
<div class="level3">

<p>
L’estàndard <acronym title="Domain Name System">DNS</acronym> permet fer abreviacions en els fitxers de definició de zona per tal de facilitar-ne la sintaxi. Les més importants són:
</p>
<ul>
<li class="level1"><div class="li"> Es pot usar @ com a indicador del nom de domini quan és el mateix que el nom de domini origen (el que s’està definint).</div>
</li>
<li class="level1"><div class="li"> Si no s’indica un nom de domini en el primer camp i es deixa buit, s’entén el mateix nom que el definit en el registre anterior.</div>
</li>
<li class="level1"><div class="li"> Als noms de domini relatius (no acabats en punt) se’ls afegeix el nom de domini origen o nom de la zona que s’està definint.</div>
</li>
</ul>

<p>
Un exemple amb abreviacions: zona inf.ioc.cat:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">@ IN SOA ns1.inf.ioc.cat. Admin.ns1.ioc.cat (1 3h 1h 1w 1h)</div></li><li class="li1"><div class="de1">                       ;utilitzat @ per referir-se al domini inf.ioc.cat</div></li><li class="li1"><div class="de1">IN NS ns1     ;primera columna pren idem valor que l'anterior @</div></li><li class="li1"><div class="de1">IN NS ns2     ;primera columna pren idem valor que l'anterior, @</div></li><li class="li1"><div class="de1">mahatma IN A 192.168.0.2</div></li><li class="li1"><div class="de1">ftp IN CNAME mahatma       ;als noms relatius s'afegeix inf.ioc.cat</div></li></ol></pre>

</div>

<h2><a id="instal_lacio_d_un_servei_dns" >Instal·lació d&#039;un servei DNS</a></h2>
<div class="level2">

<p>
El servei de xarxa <acronym title="Domain Name System">DNS</acronym> està estructurat en forma de servei client/servidor; per tant, caldrà disposar del programari apropiat per fer cada un d’aquests rols. El programari que fa la funció de client usualment ja està integrat en el sistema operatiu (la part que gestiona la xarxa) o en les mateixes aplicacions (per exemple el <em>Firefox</em>). És a dir, per disposar de la part client del servei <acronym title="Domain Name System">DNS</acronym> normalment no cal instal·lar res, tot i que si cal configurar-lo correctament.
</p>

<p>
Així doncs, quan parlem d’instal·lar un servei <acronym title="Domain Name System">DNS</acronym> fem referència al procés d’instal·lació i configuració del programari del servidor. Evidentment també caldrà configurar els clients adequadament per fer ús d’aquest servei.
</p>

<p>
La instal·lació del programari que proporciona el servei <acronym title="Domain Name System">DNS</acronym> es fa de manera molt similar (per no dir idèntica) al d’altres serveis de xarxa com els serveis DHCP, HTTP, <acronym title="File Transfer Protocol">FTP</acronym>, etc. Es tracta d’instal·lar el programari de l’aplicació servidor i fer-ne la configuració apropiada. Senzill oi?
</p>

<p>
Per fer això cal plantejar-se els següents passos:
</p>
<ul>
<li class="level1"><div class="li"> Quin programari proporciona aquest servei? Quines característiques té? Com es pot adquirir?</div>
</li>
<li class="level1"><div class="li"> Obtenir l’aplicació que proporciona el servei <acronym title="Domain Name System">DNS</acronym>.</div>
</li>
<li class="level1"><div class="li"> Observar l’estat de la xarxa actual. Està el servei ja en funcionament? Existeix ja una configuració <acronym title="Domain Name System">DNS</acronym> activa?</div>
</li>
<li class="level1"><div class="li"> Instal·lar l’aplicació servidor.</div>
</li>
<li class="level1"><div class="li"> Comprovar que la instal·lació s’ha efectuat correctament.</div>
</li>
<li class="level1"><div class="li"> Configurar el servei en el servidor i activar els clients perquè la utilitzin.</div>
</li>
<li class="level1"><div class="li"> Comprovar que el servei funciona correctament.</div>
</li>
</ul>

</div>

<h3><a id="aplicacions_servidor_dns" >Aplicacions servidor DNS</a></h3>
<div class="level3">

<p>
Sempre que l’administrador vol posar en funcionament un nou servei de xarxa cal que primerament analitzi quines aplicacions hi ha al mercat que ofereixen aquest servei. És feina seva estudiar les característiques de les diverses aplicacions, com per exemple: avaluar-ne l’eficiència, el cost, el que en diuen els altres… La manera més fàcil de fer això és navegar per Internet, consultar les revistes especialitzades o demanar consell a un dels gurus informàtics coneguts.
</p>

<p>
Usualment, però, l’administrador acaba utilitzant l’aplicació servidor <acronym title="Domain Name System">DNS</acronym> que li proporciona el mateix sistema operatiu. Si utilitzeu el sistema operatiu Windows l’empresa Microsoft disposa d’una aplicació pròpia, però també en podeu trobar d’altres a Internet. Igualment si utilitzeu GNU/Linux, segurament la mateixa distribució ja proporciona un servidor <acronym title="Domain Name System">DNS</acronym> o bé n’existeix algun de clàssic provinent de l’<em>Unix</em>. De totes maneres en podeu obtenir d’altres també a Internet. En la <span class="figref"><a href="#Figura7"><span>figura</span></a></span> es pot veure quin servidor utilitzen els nodes arrels.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Cerca de DNS a Internet</p>
<p>
Usualment l’administrador s’informa a través del seu cercador preferit, per exemple <em>Google</em>, i de webs com la <em>viquipèdia</em>. Proveu a buscar <acronym title="Domain Name System">DNS</acronym> o <acronym title="Domain Name System">DNS</acronym> server al <em>Google</em> i a la <em>wiki</em> (en anglès).
</p>
</div></div><div class="iocfigure"><a name="Figura7"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Llista de servidors arrel <acronym title="Domain Name System">DNS</acronym> i programari que utilitzen

</figcaption><img src="../media/smxm7uf1ud1_im7.png" alt="" /></figure>
<div class="footfigure">Llista extreta de la wikipedia on es poden observar els 13 servidors o nodes arrel del servei DNS, l'entitat que els gestiona, el tipus  de difusió que fan i el programari que utilitzen.</div></div>
</div>

<h3><a id="instal_lar_l_aplicacio_servidor" >Instal·lar l&#039;aplicació servidor</a></h3>
<div class="level3">

<p>
Tot seguit es descriurà el procés per instal·lar el servei <acronym title="Domain Name System">DNS</acronym> en un entorn GNU/Linux. Un cop feta la instal·lació cal observar què s’ha instal·lat, quins programes executables, on són els fitxers de configuració, els de monitoratge, etc.
</p>

<p>
Els usuaris GNU/Linux poden buscar fàcilment per Internet quins paquets del client i del servidor dhcp usant eines com <em>yum</em>, <em>apt-get</em> o <em>wget</em>, a part dels repositoris de programari usuals o del mateix <em>Google</em>.
</p>

<p>
Buscar per Internet paquets del client i del servidor <acronym title="Domain Name System">DNS</acronym>. A <em>Google</em>, a repositoris de programari, etc. Si es disposa de yum o de apt-get o wget:
</p>

<p>
Llista de paquets <em>rpm</em> que contenen el text <em>bind</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# yum list bind </div></li><li class="li1"><div class="de1">Installed Packages </div></li><li class="li1"><div class="de1">bind.i386                                31:9.4.2-3.fc7         installed       </div></li><li class="li1"><div class="de1">Available Packages </div></li><li class="li1"><div class="de1">bind.i386                                31:9.4.2-4.fc7         updates</div></li></ol></pre>

<p>
Llista de paquets que contenen <em>bind*</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# yum list bind* </div></li><li class="li1"><div class="de1">Installed Packages </div></li><li class="li1"><div class="de1">bind.i386                                31:9.4.2-3.fc7         installed       </div></li><li class="li1"><div class="de1">bind-libs.i386                           31:9.4.2-3.fc7         installed       </div></li><li class="li1"><div class="de1">bind-utils.i386                          31:9.4.2-3.fc7         installed       </div></li><li class="li1"><div class="de1">Available Packages </div></li><li class="li1"><div class="de1">bind.i386                                31:9.4.2-4.fc7         updates         </div></li><li class="li1"><div class="de1">bind-chroot.i386                         31:9.4.2-4.fc7         updates         </div></li><li class="li1"><div class="de1">bind-devel.i386                          31:9.4.2-4.fc7         updates         </div></li><li class="li1"><div class="de1">bind-libs.i386                           31:9.4.2-4.fc7         updates         </div></li><li class="li1"><div class="de1">bind-sdb.i386                            31:9.4.2-4.fc7         updates         </div></li><li class="li1"><div class="de1">bind-utils.i386                          31:9.4.2-4.fc7         updates</div></li></ol></pre>

<p>
Instal·lar el paquet <em>bind</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1"># yum install bind</div></li></ol></pre>

<p>
Fer la llista dels paquets <em>bind</em> instal·lats. Si el sistema ja els té instal·lats o volem comprovar-ho podem consultar els paquets instal·lats:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# rpm -qa | grep bind  </div></li><li class="li1"><div class="de1">ypbind-1.19-9.fc7 </div></li><li class="li1"><div class="de1">system-config-bind-4.0.2-6.fc7 </div></li><li class="li1"><div class="de1">rpcbind-0.1.4-8.fc7 </div></li><li class="li1"><div class="de1">bind-libs-9.4.2-3.fc7 </div></li><li class="li1"><div class="de1">bind-9.4.2-3.fc7 </div></li><li class="li1"><div class="de1">bind-utils-9.4.2-3.fc7</div></li></ol></pre>

<p>
Obtenir informació del paquet del servei <em>bind</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# rpm -qi bind  </div></li><li class="li1"><div class="de1">Name        : bind                         Relocations: (not relocatable) </div></li><li class="li1"><div class="de1">Version     : 9.4.2                             Vendor: Fedora Project </div></li><li class="li1"><div class="de1">Release     : 3.fc7                         Build Date: dl 21 gen 2008 11:27:32 CET </div></li><li class="li1"><div class="de1">Install Date: dc 23 gen 2008 19:12:18 CET      Build Host: xenbuilder4.fedora.phx.redhat.com </div></li><li class="li1"><div class="de1">Group       : System Environment/Daemons    Source RPM: bind-9.4.2-3.fc7.src.rpm </div></li><li class="li1"><div class="de1">Size        : 3627903                          License: BSD-like </div></li><li class="li1"><div class="de1">Signature   : DSA/SHA1, dl 21 gen 2008 19:48:26 CET, Key ID b44269d04f2a6fd2 </div></li><li class="li1"><div class="de1">Packager    : Fedora Project </div></li><li class="li1"><div class="de1">URL         : http://www.isc.org/products/BIND/ </div></li><li class="li1"><div class="de1">Summary     : El servidor de noms de domini (DNS) Berkley Internet Name Domain (BIND). </div></li><li class="li1"><div class="de1">Description : </div></li><li class="li1"><div class="de1">El BIND (Berkeley Internet Name Domain) és una implementació de protocol </div></li><li class="li1"><div class="de1">DNS (sistema de noms de domini). El BIND inclou un servidor DNS (named), </div></li><li class="li1"><div class="de1">que converteix els noms d'ordinador en adreces IP, una biblioteca per resoldre els noms </div></li><li class="li1"><div class="de1">(rutines per aplicacions que usen DNS), i eines per </div></li><li class="li1"><div class="de1">a verificar que el servidor DNS funciona degudament.</div></li></ol></pre>

</div>

<h3><a id="observar_els_components_del_paquet" >Observar els components del paquet</a></h3>
<div class="level3">

<p>
Fer la llista dels components del paquet <em>bind</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# rpm -ql bind   </div></li><li class="li1"><div class="de1">/etc/dbus-1/system.d/named.conf </div></li><li class="li1"><div class="de1">/etc/logrotate.d/named </div></li><li class="li1"><div class="de1">/etc/named.conf </div></li><li class="li1"><div class="de1">/etc/rc.d/init.d/named </div></li><li class="li1"><div class="de1">/etc/rndc.conf </div></li><li class="li1"><div class="de1">/etc/rndc.key </div></li><li class="li1"><div class="de1">/etc/sysconfig/named </div></li><li class="li1"><div class="de1">/usr/sbin/dns-keygen </div></li><li class="li1"><div class="de1">/usr/sbin/dnssec-keygen </div></li><li class="li1"><div class="de1">/usr/sbin/dnssec-signzone </div></li><li class="li1"><div class="de1">/usr/sbin/lwresd </div></li><li class="li1"><div class="de1">/usr/sbin/named </div></li><li class="li1"><div class="de1">/usr/sbin/named-bootconf </div></li><li class="li1"><div class="de1">/usr/sbin/named-checkconf </div></li><li class="li1"><div class="de1">/usr/sbin/named-checkzone </div></li><li class="li1"><div class="de1">/usr/sbin/named-compilezone </div></li><li class="li1"><div class="de1">/usr/sbin/namedGetForwarders </div></li><li class="li1"><div class="de1">/usr/sbin/namedSetForwarders </div></li><li class="li1"><div class="de1">/usr/sbin/rndc </div></li><li class="li1"><div class="de1">/usr/sbin/rndc-confgen </div></li><li class="li1"><div class="de1">/usr/share/dbus-1/services/named.service </div></li><li class="li1"><div class="de1">... output suprimit ...</div></li><li class="li1"><div class="de1">/usr/share/doc/bind-9.4.2/sample/var/named/slaves/</div></li><li class="li1"><div class="de1">my.slave.internal.zone.db </div></li><li class="li1"><div class="de1">/usr/share/man/man5/named.conf.5.gz </div></li><li class="li1"><div class="de1">... output suprimit ...</div></li><li class="li1"><div class="de1">/usr/share/man/man8/rndc.8.gz </div></li><li class="li1"><div class="de1">/var/named </div></li><li class="li1"><div class="de1">/var/named/data </div></li><li class="li1"><div class="de1">/var/named/dynamic </div></li><li class="li1"><div class="de1">/var/named/slaves </div></li><li class="li1"><div class="de1">/var/run/named</div></li></ol></pre>

<p>
En funció del directori on s’ubiquen podem intuir si són executables, de configuració o de documentació. També podem mirar de filtrar la sortida en cada cas:
</p>

<p>
Fitxers de configuració:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# rpm -qc bind </div></li><li class="li1"><div class="de1">/etc/dbus-1/system.d/named.conf </div></li><li class="li1"><div class="de1">/etc/logrotate.d/named </div></li><li class="li1"><div class="de1">/etc/named.conf </div></li><li class="li1"><div class="de1">/etc/rc.d/init.d/named </div></li><li class="li1"><div class="de1">/etc/rndc.conf </div></li><li class="li1"><div class="de1">/etc/rndc.key </div></li><li class="li1"><div class="de1">/etc/sysconfig/named </div></li><li class="li1"><div class="de1">/usr/share/dbus-1/services/named.service </div></li><li class="li1"><div class="de1">[root@portatil ~]# rpm -ql  bind  | grep etc </div></li><li class="li1"><div class="de1">/etc/dbus-1/system.d/named.conf </div></li><li class="li1"><div class="de1">/etc/logrotate.d/named </div></li><li class="li1"><div class="de1">/etc/named.conf </div></li><li class="li1"><div class="de1">/etc/rc.d/init.d/named </div></li><li class="li1"><div class="de1">/etc/rndc.conf </div></li><li class="li1"><div class="de1">/etc/rndc.key </div></li><li class="li1"><div class="de1">/etc/sysconfig/named </div></li><li class="li1"><div class="de1">/usr/share/doc/bind-9.4.2/sample/etc </div></li><li class="li1"><div class="de1">/usr/share/doc/bind-9.4.2/sample/etc/named.conf </div></li><li class="li1"><div class="de1">/usr/share/doc/bind-9.4.2/sample/etc/rndc.conf</div></li></ol></pre>

<p>

</p>

<p>
Fitxers de documentació:
</p>
<pre class="code">[root@portatil ~]# rpm -qd bind 
/usr/share/doc/bind-9.4.2/CHANGES 
/usr/share/doc/bind-9.4.2/COPYRIGHT 
/usr/share/doc/bind-9.4.2/README 
/usr/share/doc/bind-9.4.2/README.DBUS 
/usr/share/doc/bind-9.4.2/arm/Bv9ARM-book.xml 
... output suprimit ...
/usr/share/doc/bind-9.4.2/misc/sdb 
/usr/share/doc/bind-9.4.2/sample/etc/named.conf 
/usr/share/doc/bind-9.4.2/sample/etc/rndc.conf 
/usr/share/doc/bind-9.4.2/sample/named.ca 
/usr/share/doc/bind-9.4.2/sample/named.empty 
/usr/share/doc/bind-9.4.2/sample/named.localhost 
/usr/share/doc/bind-9.4.2/sample/named.loopback 
/usr/share/doc/bind-9.4.2/sample/named.rfc1912.zones 
/usr/share/doc/bind-9.4.2/sample/var/named/my.external.zone.db 
/usr/share/doc/bind-9.4.2/sample/var/named/my.internal.zone.db 
/usr/share/doc/bind-9.4.2/sample/var/named/slaves/my.ddns.internal.zone.db 
/usr/share/doc/bind-9.4.2/sample/var/named/slaves/my.slave.internal.zone.db 
/usr/share/man/man5/named.conf.5.gz 
/usr/share/man/man5/rndc.conf.5.gz 
/usr/share/man/man8/dnssec-keygen.8.gz 
/usr/share/man/man8/dnssec-signzone.8.gz 
/usr/share/man/man8/lwresd.8.gz 
/usr/share/man/man8/named-checkconf.8.gz 
/usr/share/man/man8/named-checkzone.8.gz 
/usr/share/man/man8/named-compilezone.8.gz 
/usr/share/man/man8/named.8.gz 
/usr/share/man/man8/rndc-confgen.8.gz 
/usr/share/man/man8/rndc.8.gz</pre>

<p>
Podem mirar de filtrar quins són els executables tenint en compte que usualment estaran en un directori de nom <em>bin</em> o <em>sbin</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# rpm -ql bind   | grep bin/ </div></li><li class="li1"><div class="de1">/usr/sbin/dns-keygen </div></li><li class="li1"><div class="de1">/usr/sbin/dnssec-keygen </div></li><li class="li1"><div class="de1">/usr/sbin/dnssec-signzone </div></li><li class="li1"><div class="de1">/usr/sbin/lwresd </div></li><li class="li1"><div class="de1">/usr/sbin/named </div></li><li class="li1"><div class="de1">/usr/sbin/named-bootconf </div></li><li class="li1"><div class="de1">/usr/sbin/named-checkconf </div></li><li class="li1"><div class="de1">/usr/sbin/named-checkzone </div></li><li class="li1"><div class="de1">/usr/sbin/named-compilezone </div></li><li class="li1"><div class="de1">/usr/sbin/namedGetForwarders </div></li><li class="li1"><div class="de1">/usr/sbin/namedSetForwarders </div></li><li class="li1"><div class="de1">/usr/sbin/rndc </div></li><li class="li1"><div class="de1">/usr/sbin/rndc-confgen</div></li></ol></pre>

<p>

</p>

<p>
En resum:
</p>
<ul>
<li class="level1"><div class="li"> Els fitxers de documentació es troben generalment a: <em>/usr/share/doc</em> i a <em>/usr/share/man</em>.</div>
</li>
<li class="level1"><div class="li"> Els fitxers de configuració es troben a: <em>/etc</em>, <em>/etc/sysconfig</em>.</div>
</li>
<li class="level1"><div class="li"> El dimoni del servei es troba a: <em>/usr/sbin/named</em>.</div>
</li>
<li class="level1"><div class="li"> El fitxer de configuració del dimoni del servei <em>vsftpd</em> es: <em>/etc/named.conf</em>.</div>
</li>
<li class="level1"><div class="li"> El fitxer de govern del servei és: <em>/etc/rc.d/init.d/named</em>.</div>
</li>
<li class="level1"><div class="li"> El fitxer de configuració del registre de <em>logs</em> es troba a <em>/etc/logrotate.d/named</em>.</div>
</li>
</ul>

</div>

<h3><a id="activar_desactivar_el_servei_i_establir_els_nivells_d_arrencada" >Activar/desactivar el servei i establir els nivells d&#039;arrencada</a></h3>
<div class="level3">

<p>
Un cop s’ha instal·lat al sistema un servei de xarxa, cal posar-lo en funcionament. Primer caldrà determinar quin tipus de servei és, si autònom o integrat, dins del superservei de xarxa. Un cop fet això, cal saber si ja està en funcionament o no. De fet cal saber engegar-lo, aturar-lo i reinicialitzarlo. Finalment, cal establir quin estat ha de tenir el servei per defecte cada cop que s’engegui el servidor.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Ubicació de fitxers</p>
<p>
En GNU/Linux els fitxers executables per l’administrador es troben usualment a <em>/sbin</em> i a <em>/usr/sbin</em>. Els executables d’usuari normalment són a <em>/bin</em> i <em>/usr/bin</em>.
</p>
</div></div>
</div>

<h4><a id="el_servei" >El servei</a></h4>
<div class="level4">

<p>
Primerament cal saber si el servidor instal·lat funciona “<em>stand-alone</em>” o dins del superdimoni de xarxa “<em>xinetd</em>” o “<em>initd</em>”. Si existeixen fitxers de configuració dins del directori <em>/etc/xinetd.d/&lt;nom-servei&gt;</em> es tracta d’un servei dins del <em>xinetd</em>. Si existeixen fitxers de configuració dins del directori <em>/etc/rc.d/init.d/&lt;nom-servei&gt;</em> es tracta d’un servei “<em>stand-alone</em>”.
</p>

<p>
Observem ara el contingut del paquet per intentar saber si els fitxers de configuració ens permeten saber de quin tipus de servei es tracta:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# rpm -ql bind   | grep /etc </div></li><li class="li1"><div class="de1">/etc/dbus-1/system.d/named.conf</div></li><li class="li1"><div class="de1">/etc/logrotate.d/named </div></li><li class="li1"><div class="de1">/etc/named.conf </div></li><li class="li1"><div class="de1">/etc/rc.d/init.d/named </div></li><li class="li1"><div class="de1">/etc/rndc.conf </div></li><li class="li1"><div class="de1">/etc/rndc.key </div></li><li class="li1"><div class="de1">/etc/sysconfig/named </div></li><li class="li1"><div class="de1">/usr/share/doc/bind-9.4.2/sample/etc </div></li><li class="li1"><div class="de1">/usr/share/doc/bind-9.4.2/sample/etc/named.conf </div></li><li class="li1"><div class="de1">/usr/share/doc/bind-9.4.2/sample/etc/rndc.conf</div></li></ol></pre>

<p>
Com podem observar es tracta d’un servei <em>stand-alone</em>. També es pot consultar el tipus de servei amb l’ordre chkconfig i observar si surt la llista d’un tipus o de l’altre:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# chkconfig --list | grep named </div></li><li class="li1"><div class="de1">named           0:apagat        1:apagat    2:apagat        </div></li><li class="li1"><div class="de1">3:apagat        4:apagat        5:apagat    6:apagat</div></li></ol></pre>

<p>
Per facilitar buscar els serveis <em>stand-alone</em> podem fer:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# chkconfig --list named </div></li><li class="li1"><div class="de1">named           0:apagat        1:apagat    2:apagat        </div></li><li class="li1"><div class="de1">3:apagat        4:apagat        5:apagat    6:apagat</div></li></ol></pre>

</div>

<h4><a id="estat_del_servei" >Estat del servei</a></h4>
<div class="level4">

<p>
Es pot saber l’estat del servei amb l’opció <em>status</em> de les ordres:
</p>

<p>

</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# service named   status </div></li><li class="li1"><div class="de1">named   està aturat </div></li><li class="li1"><div class="de1">[root@portatil ~]# /etc/rc.d/init.d/named status </div></li><li class="li1"><div class="de1">named   està aturat</div></li></ol></pre>

<p>
Es pot arrencar el servei amb l’opció <em>start</em> de les ordres:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# service named   start </div></li><li class="li1"><div class="de1">S'està iniciant el servei named:                    [ FET  ] </div></li><li class="li1"><div class="de1">[root@portatil ~]# /etc/rc.d/init.d/named start </div></li><li class="li1"><div class="de1">S'està iniciant el servei named:                    [ FET  ]</div></li></ol></pre>

<p>
Es pot aturar el servei amb l’opció <em>stop</em> de les ordres:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# service named   stop </div></li><li class="li1"><div class="de1">S'està aturant el named:                            [ FET  ] </div></li><li class="li1"><div class="de1">[root@portatil ~]# /etc/rc.d/init.d/named stop </div></li><li class="li1"><div class="de1">S'està aturant el servei named:                     [ FET  ]</div></li></ol></pre>

<p>
Es pot iniciar de nou el servei (recarregar) amb l’opció <em>reload</em> o <em>restart</em> de les ordres:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# /etc/rc.d/init.d/named restart </div></li><li class="li1"><div class="de1">S'està aturant el servei named:                   [Incorrecte] </div></li><li class="li1"><div class="de1">S'està iniciant el servei named:                    [ FET  ] </div></li><li class="li1"><div class="de1">[root@portatil ~]# service named  reload </div></li><li class="li1"><div class="de1">S'està aturant el servei named:                     [ FET  ] </div></li><li class="li1"><div class="de1">S'està iniciant el servei named:                    [ FET  ]</div></li></ol></pre>

<p>
Per saber les ordres possibles:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# service named   patapum </div></li><li class="li1"><div class="de1">Forma d'ús: /etc/init.d/dhcpd {start|stop|restart|condrestart|status} </div></li><li class="li1"><div class="de1">[root@portatil ~]# /etc/rc.d/init.d/named pimpam </div></li><li class="li1"><div class="de1">Forma d'ús: /etc/rc.d/init.d/dhcpd {start|stop|restart|condrestart|status}</div></li></ol></pre>

</div>

<h4><a id="establir_els_nivells_per_defecte_del_servei" >Establir els nivells per defecte del servei</a></h4>
<div class="level4">

<p>
Els serveis (els dimonis executables) es poden configurar per arrencar automàticament en determinats nivells d’execució. Les màquines GNU/Linux tenen 7 nivells d’execució com es pot veure del fitxer <em>/etc/inittab</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# head -20 /etc/inittab </div></li><li class="li1"><div class="de1">... output suprimit ...</div></li><li class="li1"><div class="de1"># Default runlevel. The runlevels used by RHS are: </div></li><li class="li1"><div class="de1">#   0 - halt (Do NOT set initdefault to this) </div></li><li class="li1"><div class="de1">#   1 - Single user mode </div></li><li class="li1"><div class="de1">#   2 - Multiuser, without NFS (The same as 3, if you do not have networking) </div></li><li class="li1"><div class="de1">#   3 - Full multiuser mode </div></li><li class="li1"><div class="de1">#   4 - unused </div></li><li class="li1"><div class="de1">#   5 - X11 </div></li><li class="li1"><div class="de1">#   6 - reboot (Do NOT set initdefault to this) </div></li><li class="li1"><div class="de1"># ... output suprimit ...</div></li></ol></pre>

<p>
Per configurar a quins nivells es vol que s’executi un servei s’utilitza l’ordrechkconfig, que permet activar/desactivar el servei pels nivells indicats:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# chkconfig --list dhcpd </div></li><li class="li1"><div class="de1">dhcpd           0:apagat        1:apagat    2:apagat        </div></li><li class="li1"><div class="de1">3:apagat        4:apagat        5:apagat    6:apagat </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">[root@portatil ~]# chkconfig --help </div></li><li class="li1"><div class="de1">chkconfig versió 1.3.34 - Copyright (C) 1997-2000 Red Hat, Inc. </div></li><li class="li1"><div class="de1">Aquest programari es pot distribuir lliurement d'acord amb els termes de la Llicència Pública General GNU. </div></li><li class="li1"><div class="de1">forma d'ús:   chkconfig --list [nom] </div></li><li class="li1"><div class="de1">         chkconfig --add &lt;nom&gt; </div></li><li class="li1"><div class="de1">         chkconfig --del &lt;nom&gt; </div></li><li class="li1"><div class="de1">         chkconfig --override &lt;nom&gt; </div></li><li class="li1"><div class="de1">         chkconfig [--level &lt;nivells&gt;] &lt;nom&gt; &lt;on|off|reset|resetpriorities&gt; </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">[root@portatil ~]# chkconfig --level 345 namedd on </div></li><li class="li1"><div class="de1">[root@portatil ~]# chkconfig --list | grep named   </div></li><li class="li1"><div class="de1">named           0:apagat   1:apagat        2:apagat        </div></li><li class="li1"><div class="de1">3:engegat       4:engegat  5:engegat       6:apagat</div></li></ol></pre>

<p>
Fixeu-vos que definir els nivells d’execució no significa que el servei estigui ara engegat. Significa que quan arranqui el sistema (a partir d’ara) s’engegarà en els nivells corresponents. Podem ara estar al nivell 5 i tenir el servei aturat perquè encara no l’hem engegat. Exemple:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# runlevel </div></li><li class="li1"><div class="de1">N 5 </div></li><li class="li1"><div class="de1">[root@portatil ~]# service named  status </div></li><li class="li1"><div class="de1">named  està aturat </div></li><li class="li1"><div class="de1">[root@portatil ~]# service named  start </div></li><li class="li1"><div class="de1">S'està iniciant el servei named                    [ FET  ]</div></li></ol></pre>

</div>

<h2><a id="servidor_nomes" >Servidor només</a></h2>
<div class="level2">

<p>
La configuració completa d’un servidor <acronym title="Domain Name System">DNS</acronym> no és que sigui difícil, però es “entretinguda”, cal crear cada fitxer de zona amb les entrades pertinents de cada <em>host</em> de la zona. Hi ha organitzacions petites on no els cal configurar el servei <acronym title="Domain Name System">DNS</acronym> completament, en tindrien prou a tenir un servidor <acronym title="Domain Name System">DNS</acronym> local que permetés accelerar les consultes <acronym title="Domain Name System">DNS</acronym> que es fan a l’exterior.
</p>

<p>
Sabem que tota resolució de nom de domini comporta una consulta a un servidor <acronym title="Domain Name System">DNS</acronym>, usualment el del proveïdor de servei (ISP). Es pot posar en marxa un servidor només <em>cache</em> que simplement a una xarxa local per tal de proporcionar més eficiència a les consultes. El servidor només <em>cache</em> no administra cap zona, no té registres de recurs, simplement rep les consultes dels clients, les tramet al servidor <acronym title="Domain Name System">DNS</acronym> extern, rep les seves respostes, les desa al <em>cache</em> i les retorna al client.
</p>

<p>
El benefici d’aquest esquema és que el servidor només cache acumula en memòria (a la <em>cache</em>) les respostes que va obtenint. En les consultes següents, si es demana per als mateixos dominis, ja no li cal passar la consulta a l’exterior sinó simplement respondre de la <em>cache</em>. Evidentment les seves respostes són sempre no autoritàries.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Un servidor <strong>només</strong> cache només emmagatzema les respostes d’altres servidors externs a memòria, però no gestiona cap zona. No és autoritari, simplement augmenta l’eficiència quan rep consultes de les quals ja sap la resposta (les té a la <em>cache</em>).
</p>
</div></div>
<p>
Tot seguit es mostra un exemple de configuració d’un servidor només <em>cache</em>:
</p>
<pre class="code c"><ol><li class="li1"><div class="de1">#Exemple de configuració de servidor només cache:</div></li><li class="li1"><div class="de1">#Extret de la documentació de bind9.</div></li><li class="li1"><div class="de1">//A Caching-only Name Server</div></li><li class="li1"><div class="de1">//The following sample configuration is appropriate for a caching-only name server for use</div></li><li class="li1"><div class="de1">//by clients internal to a corporation. All queries from outside clients are refused using</div></li><li class="li1"><div class="de1">//the allow-query option. Alternatively, the same effect could be achieved using suitable</div></li><li class="li1"><div class="de1">//firewall rules.</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">// Two corporate subnets we wish to allow queries from.</div></li><li class="li1"><div class="de1">acl corpnets { 192.168.4.0/24; 192.168.7.0/24; };</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">options {</div></li><li class="li1"><div class="de1">    directory &quot;/etc/namedb&quot;; // Working directory</div></li><li class="li1"><div class="de1">    allow-query { corpnets; };</div></li><li class="li1"><div class="de1">};</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">// Provide a reverse mapping for the loopback address 127.0.0.1</div></li><li class="li1"><div class="de1">zone &quot;0.0.127.in-addr.arpa&quot; {</div></li><li class="li1"><div class="de1">    type master;</div></li><li class="li1"><div class="de1">    file &quot;localhost.rev&quot;;</div></li><li class="li1"><div class="de1">    notify no;</div></li><li class="li1"><div class="de1">};</div></li></ol></pre>

<p>
En l’exemple anterior es pot observar que no es defineix cap fitxer de zona per ser administrada, excepte el fitxer de resolució inversa del <em>loopback</em>, que cal indicar-lo sempre. Per tant, aquest servidor únicament fa la funció d’atendre peticions <acronym title="Domain Name System">DNS</acronym> com a intermediari i desar-les a la memòria <em>cache</em>. El directori on emmagatzema temporalment la informació és el <em>/etc/namedb</em>.
</p>

<p>
Encara sense entrar a la configuració dels registres de recurs, simplement a través del fitxer de configuració general del servei, es pot configurar un servidor <acronym title="Domain Name System">DNS</acronym> com a secundari. Així actua com a servidor autoritari d’una zona rebent la informació a través de transferències del servidor primari, sense que calgui escriure els fitxers de configuració dels registres de recurs.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Es pot configurar fàcilment un <strong>servidor secundari</strong> autoritari, simplement indicant la zona que administra i de quin servidor(s) primari rebrà la transferència de zona.
</p>
</div></div>
<p>
Un servidor es pot configurar per no fer la funció de <em>cache</em> i treballar únicament com a servidor autoritari. Un servidor pot ser primari per a una zona i secundari per a una altra. L’exemple següent mostra una combinació d’aquests elements:
</p>
<pre class="code c"><ol><li class="li1"><div class="de1">#Exemple de configuració de servidor només autoritatiu:</div></li><li class="li1"><div class="de1">#Extret de la documentació de bind9.</div></li><li class="li1"><div class="de1">//An Authoritative-only Name Server</div></li><li class="li1"><div class="de1">//This sample configuration is for an authoritative-only server that is the master server</div></li><li class="li1"><div class="de1">//for &quot;example.com&quot; and a slave for the subdomain &quot;eng.example.com&quot;.</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">options {</div></li><li class="li1"><div class="de1">    directory &quot;/etc/namedb&quot;; // Working directory</div></li><li class="li1"><div class="de1">    allow-query-cache { none; }; // Do not allow access to cache</div></li><li class="li1"><div class="de1">    allow-query { any; }; // This is the default</div></li><li class="li1"><div class="de1">    recursion no; // Do not provide recursive service</div></li><li class="li1"><div class="de1">};</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">// Provide a reverse mapping for the loopback address 127.0.0.1</div></li><li class="li1"><div class="de1">zone &quot;0.0.127.in-addr.arpa&quot; {</div></li><li class="li1"><div class="de1">    type master;</div></li><li class="li1"><div class="de1">    file &quot;localhost.rev&quot;;</div></li><li class="li1"><div class="de1">    notify no;</div></li><li class="li1"><div class="de1">};</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">// We are the master server for example.com</div></li><li class="li1"><div class="de1">zone &quot;example.com&quot; {</div></li><li class="li1"><div class="de1">    type master;</div></li><li class="li1"><div class="de1">    file &quot;example.com.db&quot;;</div></li><li class="li1"><div class="de1">    // IP addresses of slave servers allowed to transfer example.com</div></li><li class="li1"><div class="de1">    allow-transfer {</div></li><li class="li1"><div class="de1">        192.168.4.14;</div></li><li class="li1"><div class="de1">        192.168.5.53;</div></li><li class="li1"><div class="de1">    };</div></li><li class="li1"><div class="de1">};</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">// We are a slave server for eng.example.com</div></li><li class="li1"><div class="de1">zone &quot;eng.example.com&quot; </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">type slave;</div></li><li class="li1"><div class="de1">    file &quot;eng.example.com.bk&quot;;</div></li><li class="li1"><div class="de1">    // IP address of eng.example.com master server</div></li><li class="li1"><div class="de1">    masters { 192.168.4.12; };</div></li><li class="li1"><div class="de1">};</div></li></ol></pre>

<p>
Si ens hi fixem podem observar que:
</p>
<ul>
<li class="level1"><div class="li"> El servidor es configura com a no <em>cache</em> (no emmagatzema respostes externes).</div>
</li>
<li class="level1"><div class="li"> Permet consultes però no recursivament (només consultes iteratives).</div>
</li>
<li class="level1"><div class="li"> És un servidor autoritari per a la zona <em>example.com</em>.</div>
</li>
<li class="level1"><div class="li"> És un servidor primari per a la zona <em>example.com</em>, com mostra l’opció<em>type master</em>.</div>
</li>
<li class="level1"><div class="li"> El domini <em>example.com</em> disposa a més a més de dos servidors secundaris (també autoritaris) que comparteixen amb aquest servidor la responsabilitat del servei <acronym title="Domain Name System">DNS</acronym>. Aquets dos equips són el <em>192.168.4.14</em> i<em>192.168.5.53</em>, tal com es pot observar de l’opció <em>allow-transfer</em>.</div>
</li>
<li class="level1"><div class="li"> Per tant, el domini <em>example.com</em> disposa de tres servidors de nom, un de primari i dos de secundaris o <em>backup</em>. Tots ells són autoritaris per a la zona. L’opció <em>allow-transfer</em> permet al servidor primari transferir les actualitzacions de la seva base de dades als altres dos servidors secundaris.</div>
</li>
<li class="level1"><div class="li"> La zona <em>eng.example.com</em> està delegada a un altre servidor de noms. Això es pot deduir en l’últim bloc <em>zone</em>, on es pot observar que aquesta zona realment l’administra l’equip <em>192.168.4.12</em>.</div>
</li>
<li class="level1"><div class="li"> Tot i que sembla un contrasentit, un servidor pot ser primari per a una zona i secundari per a altres. Això passa en aquest exemple. El servidor és secundari per a la zona <em>eng.example.com</em>. Es pot observar amb l’opció <em>type slave</em>.</div>
</li>
<li class="level1"><div class="li"> Per tant, per a la zona <em>eng.example.com</em> el servidor fa de <em>backup</em> o de suport. I quin és el servidor que realment conté la base de dades d’aquesta subzona? L’opció <em>masters</em> mostra que aquesta funció la fa l’equip <em>192.168.4.12</em>.</div>
</li>
</ul>

</div>

<h2><a id="creacio_d_una_zona" >Creació d&#039;una zona</a></h2>
<div class="level2">

<p>
El propòsit principal d’un servei <acronym title="Domain Name System">DNS</acronym> és administrar una zona, per exemple una xarxa local amb tots els equips de l’organització on es troba. Per fer això caldrà definir els fitxers de configuració del servei <acronym title="Domain Name System">DNS</acronym> en general (del dimoni) i definir cada una de les zones de què es compongui la xarxa. També caldrà crear els fitxers corresponents a la resolució inversa de cada xarxa i del <em>loopback</em>.
</p>

</div>

<h3><a id="configuracio_dels_fitxers_de_zona" >Configuració dels fitxers de zona</a></h3>
<div class="level3">

<p>
Els fitxers de zona contenen els registres de recurs que formen la base de dades de la zona. Cal configurar el servidor de noms per indicar-li quins són i on són aquests fitxers. Cada administrador anomena els fitxers com li plau o seguint l’estil marcat per l’aplicació servidor <acronym title="Domain Name System">DNS</acronym> que utilitza. Un exemple és anomenar els fitxers de zona amb el format <em>db.nomDomini</em> per al fitxer de resolució directa, i <em>db.ipSubXarxa</em> per a la resolució inversa per a cada xarxa de la zona. El fitxer de la zona corresponent a la resolució inversa del <em>loopback</em> es pot anomenar <em>db.127.0.0</em>, i el fitxer amb la informació dels nodes arrel es pot dir <em>db.cache</em>.
</p>

<p>
Independentment de l’aplicació que s’utilitzi com a servidor de noms, caldrà configurar-la per dir-li on són aquests fitxers, com es diuen, si fan la funció de servidor autoritari per a la zona o no, si fan la funció de primari o secundari i d’altres opcions possibles.
</p>

<p>
L’aplicació actualment més usada és l’aplicació BIND, que es configura mitjançant un fitxer anomenat /etc/named.conf. La manera d’indicar a BIND 9 quin és el directori per defecte on es troben els fitxers de configuració és: 
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Exemple de configuració del servidor de noms</p>
<p>
Si tenim una zona que es compon d’una única xarxa 192.168.20.0/ 24 amb el nom de domini inf.ioc.cat caldran cinc fitxers de zona:
</p>
<ul>
<li class="level1"><div class="li"> El fitxer de resolució directa <em>db.inf.ioc.cat.</em></div>
</li>
<li class="level1"><div class="li"> El fitxer de resolució inversa <em>db.192.168.20.</em></div>
</li>
<li class="level1"><div class="li"> El fitxer de resolució inversa del <em>loopback db.127.0.0.</em></div>
</li>
<li class="level1"><div class="li"> El fitxer amb la informació dels nodes arrel del <acronym title="Domain Name System">DNS</acronym>, <em>db.cache.</em></div>
</li>
</ul>
</div></div><pre class="code">options { directory &quot;/var/named&quot;; }</pre>

<p>
Per cada fitxer de zona caldrà definir una entrada al fitxer de configuració de BIND indicant el nom de la zona, el tipus i el nom del fitxer.
</p>

<p>
La sintaxi seria:
</p>
<pre class="code">zone &quot;nom_zona&quot; in { type master|slave|hint; file &quot;nom_fitxer_zona&quot;;</pre>

<p>
Un exemple de configuració de zona podria ser aquest:
</p>
<pre class="code">zone inf.ioc.cat in { type master; file &quot;db.inf.ioc.cat; }</pre>

<p>
La descripció de cada camp és la següent:
</p>
<ul>
<li class="level1"><div class="li"> <strong>zone nomZona</strong>: Com es pot veure en l’exemple es defineix una zona corresponent al domini <em>inf.ioc.cat</em>.</div>
</li>
<li class="level1"><div class="li"> <strong>type master | slave | hint</strong>: El servidor serà primari (<em>master</em>) i autoritatiu per a aquesta zona. El camp tipus pot prendre els valors <em>master</em>, <em>slave</em> i <em>hint</em> que signifiquen el següent:</div>
<ul>
<li class="level2"><div class="li"> <em>master</em>: El servidor és amb autoritat per a aquesta zona i gestiona els fitxers de zona.</div>
</li>
<li class="level2"><div class="li"> <em>slave</em>: El servidor és autoritari per a la zona però obté les dades de la zona del primari o <em>master</em>.</div>
</li>
<li class="level2"><div class="li"> <em>hint</em>: Indica que es tracta de la informació corresponent als servidors de noms de la zona arrel. Aquesta informació té un tractament especial diferent del de les altres zones.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <strong>file nom_fitxer_zona</strong>: Indica el fitxer amb els registres de recurs de la zona. En l’exemple és el fitxer <em>db.inf.ioc.cat</em>.</div>
</li>
</ul>

<p>
Cal posar especial atenció en la definició dels fitxers de zona per a la resolució inversa, utilitzant per exemple la xarxa 192.168.20.0/24. La zona s’anomena <em>20.168.192.in-addr.arpa</em> i el fitxer de zona <em>db.192.168.20</em>. El nom del fitxer conté l’adreça de xarxa en l’ordre natural, però el domini té els octets invertits perquè forma part del domini <em>in-addr.arpa</em>.
</p>

</div>

<h3><a id="el_fitxer_de_configuracio_dns" >El fitxer de configuració DNS</a></h3>
<div class="level3">

</div>

<h4><a id="configuracio_basica" >Configuració bàsica</a></h4>
<div class="level4">

<p>
Per fer funcionar el servidor <acronym title="Domain Name System">DNS</acronym> cal configurar-lo prèviament. Per poder arrancar li cal saber quin és el domini que administrarà i quins són els noms de màquina que pertanyen al domini (definir els registres de recurs a utilitzar) entre molts altres paràmetres de configuració.
</p>

<p>
El paquet dns conté un fitxer d’exemple de configuració d’una zona al directori <em>/user/share/doc/bind*/sample/etc/named.conf</em>. Aquest fitxer es pot copiar a <em>/etc/named.conf</em> i passarà a ser la configuració bàsica del servidor <acronym title="Domain Name System">DNS</acronym>.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# rpm -ql bind | grep named.conf </div></li><li class="li1"><div class="de1">/etc/dbus-1/system.d/named.conf </div></li><li class="li1"><div class="de1">/etc/named.conf </div></li><li class="li1"><div class="de1">/usr/share/doc/bind-9.4.2/sample/etc/named.conf </div></li><li class="li1"><div class="de1">/usr/share/man/man5/named.conf.5.gz</div></li></ol></pre>

<p>
Podeu fer la llista del contingut fent:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# ll /usr/share/doc/bind-9.4.2/sample/etc/named.conf </div></li><li class="li1"><div class="de1">-rw-r--r-- 1 root root 4273 14 jun  2006 /usr/share/doc/bind-9.4.2/sample/etc/named.conf</div></li></ol></pre>

<p>
Observem-ne el contingut:
</p>
<pre class="code c"><ol><li class="li1"><div class="de1">[root@portatil ~]# cat /usr/share/doc/bind-9.4.2/sample/etc/named.conf </div></li><li class="li1"><div class="de1">// </div></li><li class="li1"><div class="de1">// Sample named.conf BIND DNS server ‚named' configuration file</div></li><li class="li1"><div class="de1">// for the Red Hat BIND distribution. </div></li><li class="li1"><div class="de1">// </div></li><li class="li1"><div class="de1">// See the BIND Administrator's Reference Manual (ARM) for details, in: </div></li><li class="li1"><div class="de1">//   file:///usr/share/doc/bind-*/arm/Bv9ARM.html </div></li><li class="li1"><div class="de1">// Also see the BIND Configuration GUI : /usr/bin/system-config-bind and </div></li><li class="li1"><div class="de1">// its manual. </div></li><li class="li1"><div class="de1">// </div></li><li class="li1"><div class="de1">options </div></li><li class="li1"><div class="de1">{ </div></li><li class="li1"><div class="de1">        /* make named use port 53 for the source of all queries, to allow </div></li><li class="li1"><div class="de1">         * firewalls to block all ports except 53: </div></li><li class="li1"><div class="de1">         */ </div></li><li class="li1"><div class="de1">        query-source    port 53; </div></li><li class="li1"><div class="de1">        query-source-v6 port 53; </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">        // Put files that named is allowed to write in the data/ directory: </div></li><li class="li1"><div class="de1">        directory &quot;/var/named&quot;; // the default </div></li><li class="li1"><div class="de1">        dump-file               &quot;data/cache_dump.db&quot;; </div></li><li class="li1"><div class="de1">        statistics-file         &quot;data/named_stats.txt&quot;; </div></li><li class="li1"><div class="de1">        memstatistics-file      &quot;data/named_mem_stats.txt&quot;; </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">};</div></li><li class="li1"><div class="de1">logging </div></li><li class="li1"><div class="de1">{ </div></li><li class="li1"><div class="de1">/*      If you want to enable debugging, eg. using the ‚rndc trace' command, </div></li><li class="li1"><div class="de1"> *      named will try to write the ‚named.run' file in the $directory (/var/named). </div></li><li class="li1"><div class="de1"> *      By default, SELinux policy does not allow named to modify the /var/named directory, </div></li><li class="li1"><div class="de1"> *      so put the default debug log file in data/ : </div></li><li class="li1"><div class="de1"> */ </div></li><li class="li1"><div class="de1">        channel default_debug { </div></li><li class="li1"><div class="de1">                file &quot;data/named.run&quot;; </div></li><li class="li1"><div class="de1">                severity dynamic; </div></li><li class="li1"><div class="de1">        }; </div></li><li class="li1"><div class="de1">}; </div></li><li class="li1"><div class="de1">// </div></li><li class="li1"><div class="de1">// All BIND 9 zones are in a &quot;view&quot;, which allow different zones to be served </div></li><li class="li1"><div class="de1">// to different types of client addresses, and for options to be set for groups </div></li><li class="li1"><div class="de1">// of zones. </div></li><li class="li1"><div class="de1">// </div></li><li class="li1"><div class="de1">// By default, if named.conf contains no &quot;view&quot; clauses, all zones are in the </div></li><li class="li1"><div class="de1">// &quot;default&quot; view, which matches all clients. </div></li><li class="li1"><div class="de1">// </div></li><li class="li1"><div class="de1">// If named.conf contains any &quot;view&quot; clause, then all zones MUST be in a view; </div></li><li class="li1"><div class="de1">// so it is recommended to start off using views to avoid having to restructure </div></li><li class="li1"><div class="de1">// your configuration files in the future. </div></li><li class="li1"><div class="de1">// </div></li><li class="li1"><div class="de1">view &quot;localhost_resolver&quot; </div></li><li class="li1"><div class="de1">{ </div></li><li class="li1"><div class="de1">/* This view sets up named to be a localhost resolver ( caching only nameserver ). </div></li><li class="li1"><div class="de1"> * If all you want is a caching-only nameserver, then you need only define this view: </div></li><li class="li1"><div class="de1"> */ </div></li><li class="li1"><div class="de1">        match-clients           { localhost; }; </div></li><li class="li1"><div class="de1">        match-destinations      { localhost; }; </div></li><li class="li1"><div class="de1">        recursion yes; </div></li><li class="li1"><div class="de1">        # all views must contain the root hints zone: </div></li><li class="li1"><div class="de1">        include &quot;/etc/named.root.hints&quot;; </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">        /* these are zones that contain definitions for all the localhost </div></li><li class="li1"><div class="de1">         * names and addresses, as recommended in RFC1912 - these names should </div></li><li class="li1"><div class="de1">         * ONLY be served to localhost clients: </div></li><li class="li1"><div class="de1">         */ </div></li><li class="li1"><div class="de1">        include &quot;/etc/named.rfc1912.zones&quot;; </div></li><li class="li1"><div class="de1">}; </div></li><li class="li1"><div class="de1">view &quot;internal&quot; </div></li><li class="li1"><div class="de1">/* This view will contain zones you want to serve only to &quot;internal&quot; clients </div></li><li class="li1"><div class="de1">   that connect via your directly attached LAN interfaces - &quot;localnets&quot; . </div></li><li class="li1"><div class="de1"> */ </div></li><li class="li1"><div class="de1">        match-clients           { localnets; }; </div></li><li class="li1"><div class="de1">        match-destinations      { localnets; }; </div></li><li class="li1"><div class="de1">        recursion yes; </div></li><li class="li1"><div class="de1">        // all views must contain the root hints zone: </div></li><li class="li1"><div class="de1">        include &quot;/etc/named.root.hints&quot;; </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">        // include &quot;named.rfc1912.zones&quot;; </div></li><li class="li1"><div class="de1">        // you should not serve your rfc1912 names to non-localhost clients. </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">        // These are your &quot;authoritative&quot; internal zones, and would probably </div></li><li class="li1"><div class="de1">        // also be included in the &quot;localhost_resolver&quot; view above : </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">        zone &quot;my.internal.zone&quot; { </div></li><li class="li1"><div class="de1">                type master; </div></li><li class="li1"><div class="de1">                file &quot;my.internal.zone.db&quot;; </div></li><li class="li1"><div class="de1">        }; </div></li><li class="li1"><div class="de1">        zone &quot;my.slave.internal.zone&quot; { </div></li><li class="li1"><div class="de1">                type slave; </div></li><li class="li1"><div class="de1">                file &quot;slaves/my.slave.internal.zone.db&quot;; </div></li><li class="li1"><div class="de1">                masters { /* put master nameserver IPs here */ 127.0.0.1; } ; </div></li><li class="li1"><div class="de1">                // put slave zones in the slaves/ directory so named can update them </div></li><li class="li1"><div class="de1">        }; </div></li><li class="li1"><div class="de1">        zone &quot;my.ddns.internal.zone&quot; { </div></li><li class="li1"><div class="de1">                type master; </div></li><li class="li1"><div class="de1">                allow-update { key ddns_key; }; </div></li><li class="li1"><div class="de1">                file &quot;slaves/my.ddns.internal.zone.db&quot;; </div></li><li class="li1"><div class="de1">                // put dynamically updateable zones in the slaves/ directory so named can </div></li><li class="li1"><div class="de1">update them </div></li><li class="li1"><div class="de1">        }; </div></li><li class="li1"><div class="de1">}; </div></li><li class="li1"><div class="de1">key ddns_key </div></li><li class="li1"><div class="de1">{ </div></li><li class="li1"><div class="de1">        algorithm hmac-md5; </div></li><li class="li1"><div class="de1">        secret &quot;use /usr/sbin/dns-keygen to generate TSIG keys&quot;; </div></li><li class="li1"><div class="de1">}; </div></li><li class="li1"><div class="de1">view    &quot;external&quot; </div></li><li class="li1"><div class="de1">{ </div></li><li class="li1"><div class="de1">/* This view will contain zones you want to serve only to &quot;external&quot; clients </div></li><li class="li1"><div class="de1"> * that have addresses that are not on your directly attached LAN interface subnets: </div></li><li class="li1"><div class="de1"> */ </div></li><li class="li1"><div class="de1">        match-clients           { !localnets; !localhost; }; </div></li><li class="li1"><div class="de1">        match-destinations      { !localnets; !localhost; }; </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">        recursion no; </div></li><li class="li1"><div class="de1">        // you'd probably want to deny recursion to external clients, so you don't </div></li><li class="li1"><div class="de1">        // end up providing free DNS service to all takers </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">        // all views must contain the root hints zone: </div></li><li class="li1"><div class="de1">        include &quot;/etc/named.root.hints&quot;; </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">        // These are your &quot;authoritative&quot; external zones, and would probably </div></li><li class="li1"><div class="de1">        // contain entries for just your web and mail servers: </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">        zone &quot;my.external.zone&quot; { </div></li><li class="li1"><div class="de1">                type master; </div></li><li class="li1"><div class="de1">                file &quot;my.external.zone.db&quot;; </div></li><li class="li1"><div class="de1">        }; </div></li><li class="li1"><div class="de1">};</div></li></ol></pre>

<p>
En la configuració per defecte es poden analitzar els diversos elements que es configuren:
</p>
<ul>
<li class="level1"><div class="li"> <strong>options</strong>: En la secció options s’hi defineixen les opcions genèriques del servidor <acronym title="Domain Name System">DNS</acronym>.</div>
</li>
<li class="level1"><div class="li"> <strong>logging</strong>: es defineix com serà el procés d’enregistrament dels logs del servei.</div>
</li>
<li class="level1"><div class="li"> <strong>localhost_resolver</strong>: aquesta secció permet definir el servidor <acronym title="Domain Name System">DNS</acronym> com un servidor només <em>cache</em>. És a dir, no és autoritari de cap domini, no gestiona cap domini, cap zona, no té fitxers de zona, l’única funció que fa és de servidor <acronym title="Domain Name System">DNS</acronym> <em>cache</em>.</div>
</li>
<li class="level1"><div class="li"> <strong>internal</strong>: aquesta secció permet definir les zones i zones delegades que es volen gestionar amb el servidor. Es donarà servei a les xarxes locals internes que es defineixen en aquesta secció.</div>
</li>
<li class="level1"><div class="li"> <strong>external</strong>: defineix el servei a oferir a clients externs a la xarxa local. És per oferir serveis <acronym title="Domain Name System">DNS</acronym> a clients exteriors.</div>
</li>
</ul>

<p>
La <span class="figref"><a href="#Figura8"><span>figura</span></a></span> mostra una eina gràfica que permet la configuració del servei de noms.
</p>
<div class="iocfigure"><a name="Figura8"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Applet gràfic de gestió del servidor bind

</figcaption><img src="../media/smxm7uf1ud1_im8.png" alt="" /></figure>
<div class="footfigure">En sistemes GNU/Linux és usual que els servidors es gestionin editant directament els fitxers de configuració. Es disposa, però,  d'applets gràfics que permeten fer aquesta mateixa tasca des de l'entorn gràfic. Usualment no fan res propi, és a dir, simplement  serveixen per modificar els fitxers de text de configuració a través d'un entorn gràfic més amable.</div></div>
</div>

<h4><a id="exemple_de_configuracio_basica" >Exemple de configuració bàsica</a></h4>
<div class="level4">

<p>
Com heu pogut veure el fitxer d’exemple que proporciona <em>bind</em> és força complex. Una configuració per donar servei a una escola podria ser la següent:
</p>

<p>
Fitxer de configuració del servei named que es troba a <em>/etc/named.conf</em>:
</p>
<pre class="code c"><ol><li class="li1"><div class="de1">// named.conf for inf.escola.org </div></li><li class="li1"><div class="de1">options {             // definició d'opcions globals</div></li><li class="li1"><div class="de1">        directory &quot;/var/named&quot;; </div></li><li class="li1"><div class="de1">        // query-source port 53; </div></li><li class="li1"><div class="de1">   forward only; </div></li><li class="li1"><div class="de1">   forwarders { </div></li><li class="li1"><div class="de1">  100.1.1.201; </div></li><li class="li1"><div class="de1">  100.1.1.202; </div></li><li class="li1"><div class="de1"> }; </div></li><li class="li1"><div class="de1">}; </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">//zone &quot;.&quot; {            // definició dels nodes arrel</div></li><li class="li1"><div class="de1">//        type hint; </div></li><li class="li1"><div class="de1">//        file &quot;root.hints&quot;; </div></li><li class="li1"><div class="de1">//}; </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">//zone &quot;0.0.127.in-addr.arpa&quot; {     // definició del localhost</div></li><li class="li1"><div class="de1">//        type master; </div></li><li class="li1"><div class="de1">//        file &quot;localhost.rev.zone&quot;; </div></li><li class="li1"><div class="de1">//}; </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">zone &quot;inf.escola.org&quot; {        // definició per a la resolució directa </div></li><li class="li1"><div class="de1">        notify no; </div></li><li class="li1"><div class="de1">        type master; </div></li><li class="li1"><div class="de1">        file &quot;inf.escola.org.zone&quot;; </div></li><li class="li1"><div class="de1">}; </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">zone &quot;0.16.172.in-addr.arpa&quot; {     // definició per a la resolució inversa</div></li><li class="li1"><div class="de1">        notify no; </div></li><li class="li1"><div class="de1">        type master; </div></li><li class="li1"><div class="de1">        file &quot;inf.escola.org.rev.zone&quot;; </div></li><li class="li1"><div class="de1">};</div></li></ol></pre>

<p>
El fitxer de zona per a la resolució directa anomenat en l’exemple anterior<em>inf.escola.org.zone</em> conté els registres de recurs que defineixen la zona:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">; Zone file for inf.escola.org </div></li><li class="li1"><div class="de1">$TTL 3D </div></li><li class="li1"><div class="de1">@ INSOA server.inf.escola.org. postmaster.inf.escola.org. ( </div></li><li class="li1"><div class="de1">                                2007101910; Serial </div></li><li class="li1"><div class="de1">                                8H ; Refresh </div></li><li class="li1"><div class="de1">                                2H ; Retry </div></li><li class="li1"><div class="de1">                                4W ; Expire </div></li><li class="li1"><div class="de1">                                1D); Minimum TTL </div></li><li class="li1"><div class="de1"> NS      server</div></li><li class="li1"><div class="de1"> MX      10 mailhost </div></li><li class="li1"><div class="de1"> A  172.16.0.10 </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">; loopback </div></li><li class="li1"><div class="de1">localhostA       127.0.0.1 </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">; Ordinadors del departament</div></li><li class="li1"><div class="de1">; subxarxa 172.16.0.0 mask 255.255.255.192 </div></li><li class="li1"><div class="de1">server     A172.16.0.10 </div></li><li class="li1"><div class="de1">mailhost   A172.16.0.10 </div></li><li class="li1"><div class="de1">www        CNAME   server </div></li><li class="li1"><div class="de1">ftp        CNAME   server </div></li><li class="li1"><div class="de1">ldap       CNAME   server</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">; Servidors, router, i impressora</div></li><li class="li1"><div class="de1">router     A 172.16.0.1 </div></li><li class="li1"><div class="de1">hp-7200c   A 172.16.0.5</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">; Estacions  departament. Adreça IP fixa i automàtica des de DHCP. </div></li><li class="li1"><div class="de1">pcprofe01 A 172.16.0.15 </div></li><li class="li1"><div class="de1">pcprofe02 A 172.16.0.16</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">; Estacions aula-1. Adreca IP fixa i automàtica des de DHCP. </div></li><li class="li1"><div class="de1">; subxarxa   172.16.0.128 mask 255.255.255.192 </div></li><li class="li1"><div class="de1">switch-AA 172.16.0.251 </div></li><li class="li1"><div class="de1">pc01 A 172.16.0.131 </div></li><li class="li1"><div class="de1">pc02 A 172.16.0.132</div></li></ol></pre>

<p>
Per a cada xarxa client que es defineix cal definir el fitxer de resolució inversa de la xarxa en el domini <em>in-addr.arpa</em>. El fitxer de resolució inversa correspon al nom <em>inf.escola.org.rev.zone</em>. Aquí hi ha una entrada PTR per a cada host definit en la resolució directa.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">; Zone file for 0.168.192.in-addr.arpa </div></li><li class="li1"><div class="de1">$TTL 3D </div></li><li class="li1"><div class="de1">@INSOA server.inf.escola.org. postmaster.inf.escola.org. ( </div></li><li class="li1"><div class="de1">    2007101910; Serial </div></li><li class="li1"><div class="de1">    8H      ; Refresh </div></li><li class="li1"><div class="de1">    2H      ; Retry </div></li><li class="li1"><div class="de1">    4W      ; Expire </div></li><li class="li1"><div class="de1">    1D)     ; Minimum TTL </div></li><li class="li1"><div class="de1"> NS  server.inf.escola.org. </div></li><li class="li1"><div class="de1">; departament </div></li><li class="li1"><div class="de1">1   IN PTR router.inf.escola.org. </div></li><li class="li1"><div class="de1">5   IN PTR hp-7200c.inf.escola.org. </div></li><li class="li1"><div class="de1">10  IN PTR server.inf.escola.org. </div></li><li class="li1"><div class="de1">15  IN PTR pcprofe01.inf.escola.org. </div></li><li class="li1"><div class="de1">16  IN PTR pcprofe02.inf.escola.org. </div></li><li class="li1"><div class="de1">131 IN PTR pc01.inf.escola.org. </div></li><li class="li1"><div class="de1">132 IN PTR pc02.inf.escola.org. </div></li><li class="li1"><div class="de1">251 IN PTR switch-A.inf.escola.org.</div></li></ol></pre>

</div>

<h3><a id="el_client_dnsresolver_hosts_i_nsswitch" >El client DNS: resolver, hosts i nsswitch</a></h3>
<div class="level3">

<p>
Un equip client que vol resoldre un nom de <em>host</em> té diferents maneres de fer-ho. Es pot fer localment mitjançant un fitxer de <em>hosts</em> (típicament el /etc/hosts) o distribuïdament usant <acronym title="Domain Name System">DNS</acronym> (el <em>resolver</em>). De fet, es poden aplicar tots dos mètodes conjuntament indicant-ne la precedència en algun fitxer de configuració del sistema (en sistemes Unix, el fitxer /etc/ nsswitch.conf).
</p>

</div>

<h4><a id="resolver" >Resolver</a></h4>
<div class="level4">

<p>
El <em>resolver</em> és la part client del sistema de noms de dominis <acronym title="Domain Name System">DNS</acronym>, que està organitzat en una estructura client-servidor. Cada <em>resolver</em> implementa les seves opcions, però n’hi ha que són suficientment genèriques per descriure-les. En la majoria de sistemes Unix, aquestes opcions es defineixen en el fitxer /etc/resolv.conf.
</p>

<p>
Les següents són les directives del fitxer /etc/resolv.conf:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Domain</strong> (<em>local domain name</em> o nom de domini local) indica el nom de domini del <em>host</em> al qual pertany el <em>resolver</em>, serveix per completar els noms de domini que no són qualificats (FQDN). Per exemple, amb el valor de domain <em>inf.ioc.cat.</em>, si es vol resoldre <em>pc30</em> (un nom de <em>host</em> no qualificat) se li afegirà el nom de domini indicat; per tant, s’intentarà resoldre <em>pc30.inf.ioc.cat.</em> Generalment, la directiva <em>domain</em> és excloent de la directiva <em>search</em>.</div>
</li>
<li class="level1"><div class="li"> <strong>Search</strong> permet modificar el comportament per defecte indicant explícitament la llista de dominis a aplicar. El primer d’aquests és aplicat com el nom del domini local (<em>local domain name</em>) i és per això que la directiva <em>search</em> és excloent de la directiva <em>domain</em>. Si per exemple s’utilitza <em>search inf.ioc.cat inf.ioc.net gencat.cat</em> per resoldre el nom de <em>host</em> <em>pc30</em>, s’aplicarà cada domini seqüencialment<em>pc30.inf.ioc.cat</em>, <em>pc30.inf.ioc.net</em> i <em>pc30.gencat.cat</em>.</div>
</li>
<li class="level1"><div class="li"> <strong>Nameserver</strong> permet especificar el servidor de noms a utilitzar. Se’n poden indicar fins a tres per si no hi ha accés al servidor. El <em>resolver</em> intenta connectar amb el primer servidor i si ho aconsegueix realitza les consultes a aquest servidor. Si el servidor no és accessible intenta el següent, i així també per a l’últim. Fixeu-vos que disposar de tres servidors de noms no significa que si el primer no pot respondre la consulta es repeteix la mateixa consulta al següent. En general, els servidors de noms no restringeixen l’accés de manera que qualsevol <em>host</em> hi pot fer consultes.</div>
</li>
</ul>

<p>
La <span class="figref"><a href="#Figura9"><span>figura</span></a></span> mostra una interfície gràfica que permet configurar els servidors <acronym title="Domain Name System">DNS</acronym>.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Criteri de resolució</p>
<p>
Per defecte, quan cal resoldre un nom de <em>host</em> (i no s’ha especificat la directiva <em>search</em>), el <em>resolver</em> fa el següent: si el nom de <em>host</em> inclou un punt (<em>pc30.inf</em>) mira de resoldre’l tal qual i, si no pot, hi aplica el nom de domini (<em>pc30.inf.inf.ioc.cat.</em>). Si el nom de <em>host</em> no conté cap punt (<em>pc30</em>), primer s’afegeix el domini i es mira de resoldre (<em>pc30.inf.ioc.cat</em>.), i si no es troba es mira de resoldre tal qual (<em>pc30</em>).
</p>
</div></div><div class="iocfigure"><a name="Figura9"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Applet gràfic de configuració del resolver

</figcaption><img src="../media/smxm7uf1ud1_im9.png" alt="" /></figure>
<div class="footfigure">En aquest exemple s'observa que s'han definit dos servidors de noms DNS,un de primari i un de secundari. La directiva search  correspon al valor local.lan. Tal com és tradicional en sistemes GNU/Linux i Unix, aquest applet gràfic simplement modifica el fitxer  de configuració /etc/resolv.conf.</div></div><pre class="code bash"><ol><li class="li1"><div class="de1"># Exemple de fitxer de configuració client /etc/resolv.conf</div></li><li class="li1"><div class="de1">[root@portatil ~]# cat /etc/resolv.conf </div></li><li class="li1"><div class="de1">; generated by /sbin/dhclient-script </div></li><li class="li1"><div class="de1">search ioc.cat</div></li><li class="li1"><div class="de1">nameserver 80.58.61.250 </div></li><li class="li1"><div class="de1">nameserver 80.58.61.254</div></li></ol></pre>

</div>

<h4><a id="nsswitch" >nsswitch</a></h4>
<div class="level4">

<p>
Un <em>host</em> que vol fer la resolució d’un nom pot optar per fer-la localment amb el fitxer <em>hosts</em> o usant <acronym title="Domain Name System">DNS</acronym> amb el <em>resolver</em>. De fet, els pot utilitzar tots dos, simplement ha d’indicar en quin ordre. En els sistemes Unix hi ha el fitxer de configuració /etc/nsswitch.conf, que entre altres coses permet configurar l’ordre de les resolucions de noms.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Servidor de noms d&#039;una altra organització</p>
<p>
Es poden configurar els <em>hosts</em> perquè utilitzin el servidor de noms d’una altra organització (perquè és més ràpid, per estalviar-se feina, etc.), però no és una bona pràctica.
</p>
</div></div>
<p>
Una entrada tipus <strong>hosts: dns files</strong> indica que primer es mira de resoldre el nom per <acronym title="Domain Name System">DNS</acronym> i si no es pot es busca al fitxer de <em>hosts</em> local. Una entrada tipus <strong>hosts: files dns</strong> indica que primerament es buscarà en el fitxer de<em>hosts</em> local i posteriorment el <acronym title="Domain Name System">DNS</acronym>. Aquesta opció acostuma a ser més utilitzada si es permet que un <em>host</em> pugui personalitzar els noms del seu entorn i tinguin precedència sobre els noms del <acronym title="Domain Name System">DNS</acronym>.
</p>

<p>

</p>
<pre class="code bash"><ol><li class="li1"><div class="de1"># Exemple de fitxer de selecció de tipus de resolució:</div></li><li class="li1"><div class="de1">[root@portatil ~]# cat /etc/nsswitch.conf </div></li><li class="li1"><div class="de1"># </div></li><li class="li1"><div class="de1"># /etc/nsswitch.conf </div></li><li class="li1"><div class="de1"># </div></li><li class="li1"><div class="de1"># An example Name Service Switch config file. This file should be </div></li><li class="li1"><div class="de1"># sorted with the most-used services at the beginning. </div></li><li class="li1"><div class="de1"># </div></li><li class="li1"><div class="de1"># The entry ‚[NOTFOUND=return]' means that the search for an </div></li><li class="li1"><div class="de1"># entry should stop if the search in the previous entry turned </div></li><li class="li1"><div class="de1"># up nothing. Note that if the search failed due to some other reason</div></li><li class="li1"><div class="de1"># (like no NIS server responding) then the search continues with the </div></li><li class="li1"><div class="de1"># next entry. </div></li><li class="li1"><div class="de1"># </div></li><li class="li1"><div class="de1"># Legal entries are: </div></li><li class="li1"><div class="de1"># </div></li><li class="li1"><div class="de1">#       nisplus or nis+         Use NIS+ (NIS version 3) </div></li><li class="li1"><div class="de1">#       nis or yp               Use NIS (NIS version 2), also called YP </div></li><li class="li1"><div class="de1">#       dns                     Use DNS (Domain Name Service) </div></li><li class="li1"><div class="de1">#       files                   Use the local files </div></li><li class="li1"><div class="de1">#       db                      Use the local database (.db) files </div></li><li class="li1"><div class="de1">#       compat                  Use NIS on compat mode </div></li><li class="li1"><div class="de1">#       hesiod                  Use Hesiod for user lookups </div></li><li class="li1"><div class="de1">#       [NOTFOUND=return]       Stop searching if not found so far </div></li><li class="li1"><div class="de1"># </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"># To use db, put the &quot;db&quot; in front of &quot;files&quot; for entries you want to be </div></li><li class="li1"><div class="de1"># looked up first in the databases </div></li><li class="li1"><div class="de1"># </div></li><li class="li1"><div class="de1"># Example: </div></li><li class="li1"><div class="de1">#passwd:    db files nisplus nis </div></li><li class="li1"><div class="de1">#shadow:    db files nisplus nis </div></li><li class="li1"><div class="de1">#group:     db files nisplus nis </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">passwd:     files </div></li><li class="li1"><div class="de1">shadow:     files </div></li><li class="li1"><div class="de1">group:      files </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">#hosts:     db files nisplus nis dns </div></li><li class="li1"><div class="de1">hosts:      files dns</div></li></ol></pre>

</div>

<h4><a id="fitxer_de_hosts" >Fitxer de hosts</a></h4>
<div class="level4">

<p>

</p>

<p>
En tot sistema sempre es poden personalitzar els noms dels <em>hosts</em> mitjançant un fitxer local, generalment anomenat <em>hosts</em> (/etc/hosts en sistemes Unix). És un fitxer de text net que conté una entrada per línia del tipus <strong>ip nom_canònic alias1 alias2 … aliasn</strong>. Per a una IP determinada es defineix el seu nom canònic (nom únic identificatiu) i altres noms que actuen com a àlies del nom canònic. Per exemple, 192.168.0.1 server.inf.ioc.cat server machine defineix els àlies <em>server</em> i <em>machine</em> per al <em>host server.ioc.cat</em>.
</p>

<p>
El fitxer de <em>host</em> es pot utilitzar en un entorn de xarxa petit, però no es pot escalar a grans xarxes. Caldria posar dins el fitxer els noms de tots els<em>hosts</em> de la xarxa i copiar el fitxer en cada <em>host</em>. Justament per evitar aquesta dificultat, es va desenvolupar el sistema <acronym title="Domain Name System">DNS</acronym>.
</p>

<p>

</p>
<pre class="code bash"><ol><li class="li1"><div class="de1"># Fitxer d'exemple lmhosts.sam d'un sistema operatiu Windows:</div></li><li class="li1"><div class="de1"># Copyright (c) 1993-1999 Microsoft Corp.</div></li><li class="li1"><div class="de1">#</div></li><li class="li1"><div class="de1"># Este es un archivo LMHOSTS de ejemplo utilizado por TCP/IP de Microsoft </div></li><li class="li1"><div class="de1"># para Windows.</div></li><li class="li1"><div class="de1">#</div></li><li class="li1"><div class="de1"># Este archivo contiene las direcciones de IP asociadas con nombres (NetBIOS)</div></li><li class="li1"><div class="de1"># de equipos. Cada entrada debería encontrarse en una línea individual. La</div></li><li class="li1"><div class="de1"># dirección de IP debería colocarse en la primera columna seguida del nombre de</div></li><li class="li1"><div class="de1"># equipo correspondiente. La dirección de IP y el nombre de equipo</div></li><li class="li1"><div class="de1"># deberían estar separados como mínimo por un espacio o tabulador. El carácter</div></li><li class="li1"><div class="de1"># &quot;#&quot; se usa generalmente para indicar el principio de un comentario (consulte</div></li><li class="li1"><div class="de1"># las excepciones ms adelante).</div></li><li class="li1"><div class="de1">#</div></li><li class="li1"><div class="de1"># Este archivo es compatible con los archivos lmhosts de TCP/IP de Microsoft</div></li><li class="li1"><div class="de1"># LAN Manager 2.x y ofrece las siguientes extensiones:</div></li><li class="li1"><div class="de1">#</div></li><li class="li1"><div class="de1">#      #PRE</div></li><li class="li1"><div class="de1">#      #DOM:&lt;dominio&gt;</div></li><li class="li1"><div class="de1">#      #INCLUDE &lt;nombre_de_archivo&gt;</div></li><li class="li1"><div class="de1">#      #BEGIN_ALTERNATE</div></li><li class="li1"><div class="de1">#      #END_ALTERNATE</div></li><li class="li1"><div class="de1">#      @IOCCONTENT@xnn (permite caracteres no imprimibles)</div></li><li class="li1"><div class="de1">#</div></li><li class="li1"><div class="de1"># Cualquier entrada iniciada con &quot;#PRE&quot; provocar  que la entrada se cargue</div></li><li class="li1"><div class="de1"># en la cach‡. De forma predeterminada, las entradas no son cargadas,</div></li><li class="li1"><div class="de1"># sino que se consultan sólo cuando la resolución dinámica de nombres falla.</div></li><li class="li1"><div class="de1">#</div></li><li class="li1"><div class="de1"># Cualquier entrada iniciada con &quot;#DOM:&lt;dominio&gt;&quot; asociar la entrada</div></li><li class="li1"><div class="de1"># con el dominio especificado en &lt;dominio&gt;. Esto influye en cómo los servicios</div></li><li class="li1"><div class="de1"># Examinador e Inicio de sesión actúa en entornos TCP/IP. Para cargar una entrada</div></li><li class="li1"><div class="de1"># #DOM es necesario agregar #PRE a la línea.</div></li><li class="li1"><div class="de1">#</div></li><li class="li1"><div class="de1"># Especificando &quot;#INCLUDE &lt;nombre_de_archivo&gt;&quot; obligar al software RFC</div></li><li class="li1"><div class="de1"># NetBIOS (NBT) a buscar y tratar el &lt;nombre_de_archivo&gt; como si fuera</div></li><li class="li1"><div class="de1"># local. &lt;nombre_de_archivo&gt; es generalmente un nombre basado en UNC,</div></li><li class="li1"><div class="de1"># permitiendo que un lmhosts central sea mantenido en un servidor. Si el servidor</div></li><li class="li1"><div class="de1"># se encuentra fuera del área de difusión, probablemente será necesario </div></li><li class="li1"><div class="de1"># proporcionar al servidor información sobre direcciones de servidores antes</div></li><li class="li1"><div class="de1"># de #INCLUDE.</div></li><li class="li1"><div class="de1">#</div></li><li class="li1"><div class="de1"># #BEGIN_ y #END_ALTERNATE permiten agrupar múltiples sentencias</div></li><li class="li1"><div class="de1"># #INCLUDE. Cualquier éxito individual se considera éxito del grupo.</div></li><li class="li1"><div class="de1">#</div></li><li class="li1"><div class="de1"># Finalmente, caracteres no imprimibles pueden ser incluidos en este tipo de</div></li><li class="li1"><div class="de1"># archivos, primero se ponen entre comillas los nombre NetBIOS y después</div></li><li class="li1"><div class="de1"># se utiliza la notación @IOCCONTENT@xnn para especificar un valor hexadecimal para un</div></li><li class="li1"><div class="de1"># carácter no imprimible.</div></li><li class="li1"><div class="de1">#</div></li><li class="li1"><div class="de1"># El siguiente ejemplo ilustra todas estas extensiones:</div></li><li class="li1"><div class="de1">#</div></li><li class="li1"><div class="de1"># 102.54.94.97     rhino               #PRE   #DOM:conectividad  #red DC de grupo</div></li><li class="li1"><div class="de1"># 102.54.94.102    &quot;nombreap  @IOCCONTENT@x14&quot;         #servidor ap especial</div></li><li class="li1"><div class="de1"># 102.54.94.123    popular            #PRE   #servidor origen</div></li><li class="li1"><div class="de1"># 102.54.94.117    localsrv           #PRE   #necesario para &quot;#INCLUDE&quot;</div></li><li class="li1"><div class="de1"># #BEGIN_ALTERNATE</div></li><li class="li1"><div class="de1"># #INCLUDE \localsrv\public\lmhosts</div></li><li class="li1"><div class="de1"># #INCLUDE \rhino\public\lmhosts</div></li><li class="li1"><div class="de1"># #END_ALTERNATE</div></li><li class="li1"><div class="de1">#</div></li><li class="li1"><div class="de1"># En el ejemplo anterior, el servidor &quot;nombreap&quot; contiene un carácter</div></li><li class="li1"><div class="de1"># especial en su nombre, el nombre de servidor &quot;popular&quot; es cargado, y</div></li><li class="li1"><div class="de1"># el nombre de servidor &quot;rhino&quot; es especificado, por lo que puede ser </div></li><li class="li1"><div class="de1"># utilizado para un posterior #INCLUDE de archivo lmhosts central si</div></li><li class="li1"><div class="de1"># el sistema &quot;localsrv&quot; no está disponible.</div></li><li class="li1"><div class="de1">#</div></li><li class="li1"><div class="de1"># Tenga en cuenta que en cada búsqueda se analiza el archivo completo, incluyendo los</div></li><li class="li1"><div class="de1"># comentarios, por lo que mantener la mínima cantidad de comentarios mejora el rendimiento.</div></li><li class="li1"><div class="de1"># Sin embargo no es siempre recomendable agregar sólo las entradas de archivo LMHOSTS al final</div></li><li class="li1"><div class="de1"># de este archivo.</div></li></ol></pre>

<p>
La <span class="figref"><a href="#Figura10"><span>figura</span></a></span> mostra una interfície gràfica de gestió de xarxa des d’on configurar noms de <em>host</em> i àlies.
</p>
<div class="iocfigure"><a name="Figura10"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Applet gràfic per configurar noms de host

</figcaption><img src="../media/smxm7uf1ud1_im10.png" alt="" /></figure>
<div class="footfigure">Així per exemple podem observar que el pc01 corresponent a l'adreça IP 192.168.1.32 també es pot anomenar desk1, pere i usuari1.</div></div>
</div>

<h2><a id="realitzacio_de_transferencies_entre_dos_o_mes_servidors" >Realització de transferències entre dos o més servidors</a></h2>
<div class="level2">

<p>
Els dominis d’Internet s’administren en zones, cada una gestionada per dos o més servidors de noms. Segons l’estàndard, cada zona té un servidor primari i almenys un o més servidors secundaris. Ambdós són autoritaris per a la zona que administren. Caldrà, doncs, que aquests servidors disposin d’informació tan coherent com sigui possible, que comparteixin la mateixa informació. Això es realitza mitjançant les transferències de zona.
</p>

<p>

</p>

<p>
Sovint els servidors de noms actuen també com a <em>cache</em>, emmagatzemant en la memòria les respostes d’altres servidors per tal d’incrementar l’eficiència. Quan emeten aquestes respostes actuen de forma no autoritària.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
<strong>Primari/secundari(s)</strong>: una zona és gestionada per un servidor primari i un o més servidors secundaris o de <em>backup</em>.
</p>

<p>
<strong>Autoritari/no autoritari</strong>: els servidors d’una zona (el primari i els secundaris) són autoritat per a aquella zona que administren. Les respostes que emeten basant-se en la informació del <em>cache</em> (i no de la base de dades de zona) són no autoritàries.
</p>

<p>
<strong>Transferència de zona</strong>: la informació de la base de dades de zona ha de ser coherent entre els servidors primari i secundaris. La transferència de zona és el mecanisme que s’estableix per fer que comparteixin la mateixa informació.
</p>
</div></div>
</div>

<h3><a id="autoritari_no_autoritari_i_informacio_de_base_de_dades_de_zona" >Autoritari, no autoritari i informació de base de dades de zona</a></h3>
<div class="level3">

<p>
Cada zona de l’espai dels noms de domini és gestionada per un o més servidors autoritaris per a la zona. Significa que són els servidors que manen, que tenen l’última paraula respecte de la zona. De fet significa que són els servidors que administren la zona. Aquests servidors es configurem com a <strong>autoritaris</strong> de la zona. Les respostes que emeten a consultes referents a la seva zona porten un segell indicant que són autoritàries, que provenen de la font de la informació de la base de dades distribuïda de l’espai de noms de domini.
</p>

<p>
Els servidors de noms guarden en un emmagatzematge <em>cache</em> les respostes que reben d’altres servidors. Aquesta informació també és utilitzada per elaborar respostes a consultes de dominis fora de la zona de la qual són autoritaris. És a dir, quan un servidor rep d’un altre la llista de servidors autoritaris (en una consulta interactiva) per una zona, aquesta llista s’emmagatzema al <em>cache</em>. Quan un servidor rep una resposta a una consulta també es guarda. Quan es rep una resposta negativa, indicant que el domini de la consulta o el tipus de dada sol·licitat no existeix, també es guarda. S’anomena negative <em>caching</em>.
</p>

<p>
Un servidor respon utilitzant la informació de la base de dades de la seva zona, però també respon a altres consultes utilitzant la informació existent en el seu <em>cache</em>. Quan es repeteix una consulta efectuada abans, s’utilitza la resposta del <em>cache</em>. També s’utilitza del <em>cache</em> la llista de servidors autoritaris per una zona més propera al domini que es busca, per tal de no preguntar als servidors arrel. Quan un servidor de noms respon utilitzant la informació del <em>cache</em>, la resposta és no autoritativa. No prové del servidor autoritari de la zona sinó que s’utilitza una informació prèviament obtinguda (i que pot estar desfasada).
</p>

<p>

</p>

<p>
Per exemple, primerament s’ha fet una consulta per al domini <em>adm.ioc.cat</em>, i en el procés de resolució recursiu el servidor ha obtingut la llista de servidors autoritaris per als dominis .cat i <em>ioc.cat.</em> Si ara es demana al mateix servidor pel domini <em>inf.ioc.cat</em> primerament provarà de resoldre aquest domini, però com que és desconegut el següent domini més pròxim és <em>ioc.cat</em> i aquest sí que el coneix, perquè el té emmagatzemat al <em>cache</em> de la resposta anterior. S’utilitzarà la llista de servidors autoritaris del domini <em>ioc.cat</em> per obtenir una resposta o per continuar descendint per l’arbre de l’espai de noms.
</p>

<p>
Emmagatzemar informació de les respostes d’altres servidors en la <em>cache</em> proporciona dos grans avantatges:
</p>
<ol>
<li class="level1"><div class="li"> Incrementa la velocitat de resposta. Ja no cal anar a trobar la resposta a la font de dades de la zona, sinó que s’utilitza la informació d’una resposta anterior.</div>
</li>
<li class="level1"><div class="li"> Evita la sobrecàrrega dels servidors arrel.</div>
</li>
</ol>

<p>
No cal anar per a cada consulta al node arrel un cop es disposa al <em>cache</em> d’informació més propera al domini a cercar. La utilització del <em>cache</em> té, però, un inconvenient que cal mesurar bé, les dades que s’utilitzen no necessàriament són actualitzades ni reflecteixen l’estat actual de la xarxa. <acronym title="Domain Name System">DNS</acronym> es basa en una base de dades jeràrquica i distribuïda on la informació es troba en els fitxers gestionats per cada servidor de zona. Una dada emmagatzemada en el <em>cache</em> pot no reflectir la dada real que ha estat modificada en el servidor autoritari de zona, però que encara no s’ha propagat perquè la dada es manté en el <em>cache</em> fins a caducar el TTL (temps de vida de la dada).
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Són servidors <strong>autoritaris</strong> els que administren una zona (tant el servidor primari com els secundaris). Tenen accés a la informació de la base de dades de zona.
</p>

<p>
Són respostes <strong>no autoritàries</strong> les que provenen de la informació desada en la memòria <em>cache</em>.
</p>
</div></div>
<p>
Fixeu-vos que si la informació del <em>cache</em> es desa indefinidament, els canvis que es fessin en els servidors autoritaris no es propagarien als altres servidors (perquè segurament ja disposarien d’una resposta en el <em>cache</em> anterior). Cal un mecanisme perquè la informació del <em>cache</em> caduqui transcorregut un cert interval de temps.
</p>

<p>
Anomenem <strong>TTL</strong> time to live <strong>(temps de vida)</strong> l’interval de temps que les dades han de perdurar en el <em>cache</em>; un cop transcorregut, les dades s’eliminen. Si fa falta una dada, per obtenir-la caldrà fer una consulta de nou. Si el TTL és un interval de temps petit es facilita la propagació de les actualitzacions (millor consistència de la informació), però es penalitza el rendiment, ja que caldrà fer consultes més sovint (tornar a les fonts de dades). Si el TTL és un interval de temps gran el rendiment millora (més consultes són contestades directament del <em>cache</em> en lloc de consultar la font de dades), però fa que la propagació dels canvis sigui més lenta. Això provoca menys consistència de la base de dades distribuïda de noms i incrementa la possibilitat de proporcionar informació errònia.
</p>

<p>
El temps del TTL l’estableix l’administrador de sistemes. Ha de saber buscar un compromís entre el rendiment (TTL més gran implica menys trànsit de consultes i consultes més ràpides) i la consistència de la informació (TTL més petit significa propagació més fàcil).
</p>

<p>
L’ús de l’emmagatzematge de respostes en memòria <em>cache</em> no és exclusiu del servidor de noms. Sovint el <em>resolver</em> també implementa una petita<em>cache</em> per proporcionar més rendiment i velocitat de resposta a les aplicacions. Fins i tot algunes aplicacions (per exemple el navegador web Firefox) implementen la seva pròpia <em>cache</em> per millorar el rendiment.
</p>

</div>

<h3><a id="servidor_primari_secundari" >Servidor primari/secundari</a></h3>
<div class="level3">

<p>
L’estàndard que defineix el <acronym title="Domain Name System">DNS</acronym> (<em>domain name system</em>) estableix que cal configurar dos o més servidors autoritaris per a cada zona anomenats servidor primari i servidor secundari. El motiu és proporcionar un mecanisme de redundància, robustesa, rendiment i <em>bakcup</em>. Si el servidor de noms falla i és únic possiblement la xarxa caurà, serà inoperativa. Per una banda els usuaris no saben les adreces IP dels <em>hosts</em>, dels serveis, de les seus web, etc. als quals volen accedir. D’altra banda, molts serveis de xarxa requereixen la resolució <acronym title="Domain Name System">DNS</acronym> per funcionar. Per tant, el servidor de noms és un punt crític en tota xarxa. Un segon servidor autoritari proporciona redundància i robustesa en cas que el primari caigui. Proporciona més rendiment perquè les consultes es poden repartir, balancejar, entre els dos o més servidors. I proporciona un mecanisme de <em>backup</em> o salvaguarda amb la repetició de les dades.
</p>

<p>
L’estàndard defineix que calen almenys dos servidors i segur que estem avesats a configurar clients de xarxa omplint els camps del <acronym title="Domain Name System">DNS</acronym> primari i <acronym title="Domain Name System">DNS</acronym> secundari del proveïdor d’Internet a casa. De totes maneres, ningú obliga a seguir els estàndards. En una xarxa petita amb pocs equips i pocs requeriments podem utilitzar un únic servidor <acronym title="Domain Name System">DNS</acronym>. Sabem, però, que si cau no funcionarà la xarxa.
</p>

<p>
El servidor primari és el que manté la base de dades de la zona i el que l’actualitza. El servidor secundari obté una còpia de la base de dades de la zona a través del primari. Existeix un mecanisme d’actualització d’informació de zona entre el servidor primari i el secundari.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
El servidor <strong>primari</strong> manté la base de dades de la zona i l’actualitza. Aquesta informació es copia als servidors <strong>secundaris</strong> utilitzant un procés de <strong>transferència</strong>.
</p>

<p>
Establir com i quan s’ha de fer aquesta transferència és important per proporcionar un bon servei <acronym title="Domain Name System">DNS</acronym>. Cal buscar un <strong>compromís</strong> entre <strong>actualitzar</strong> constantment la informació o disposar d’informació <strong>caducada</strong>.
</p>
</div></div>
<p>
Es poden definir més servidors secundaris per millorar el rendiment del servei de resolució de noms. Si hi ha moltes consultes o es té molta por a una caiguda del sistema es poden configurar més servidors, així les consultes es poden repartir entre tots ells. De totes maneres el més usual és un servidor primari i un de secundari. Recordeu que tant el servidor primari com el secundari són autoritat, tot i que només el primari té els fitxers de zona. El secundari n’obté una còpia.
</p>

<p>
Es pot configurar un servidor de noms de domini perquè actuï fent la funció de només <em>cache</em>. No gestiona cap zona, simplement atén les peticions dels <em>resolver</em> client i les passa a altres servidors de noms. La seva funció és emmagatzemar en <em>cache</em> les respostes que obté abans de passar-les als clients. Això li permetrà que les futures consultes que siguin repetides les pugui contestar directament en lloc de demanar-les a un altre servidor. Evidentment aquest tipus de servidor no emet respostes amb autoritat.
</p>

<p>
El següent exemple mostra la llista dels servidors de noms de <em>Google</em> i de l’<em>IOC</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@localhost ~]# host -t NS google.com</div></li><li class="li1"><div class="de1">google.com name server ns2.google.com.</div></li><li class="li1"><div class="de1">google.com name server ns4.google.com.</div></li><li class="li1"><div class="de1">google.com name server ns3.google.com.</div></li><li class="li1"><div class="de1">google.com name server ns1.google.com.</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">[root@localhost ~]# host -t NS ioc.cat</div></li><li class="li1"><div class="de1">ioc.cat name server dns2.nominalia.com.</div></li><li class="li1"><div class="de1">ioc.cat name server dns1.nominalia.com.</div></li></ol></pre>

</div>

<h3><a id="transferencia_de_zones" >Transferència de zones</a></h3>
<div class="level3">

<p>
El protocol <acronym title="Domain Name System">DNS</acronym> indica que cal utilitzar almenys dos servidors <acronym title="Domain Name System">DNS</acronym> per a una zona, un serà el <em>master</em> o primari i els altres <em>slaves</em> o secundaris. Tots aquests seran autoritat per a la zona. L’administrador fa el manteniment únicament dels fitxers de zona del servidor primari (conté els originals). Els servidors secundaris obtenen els seus fitxers de configuració de zona del primari o d’un altre de secundari. El procés de transferència de la informació de la zona entre primari i secundari és automatitzat i és transparent per a l’administrador.
</p>

<p>

</p>

<p>
Els fitxers de zona no fan cap referència al fet que el nameserver que els utilitza sigui primari o secundari, és en el fitxer de configuració global del servei <acronym title="Domain Name System">DNS</acronym> (el fitxer <em>named.conf</em> per a l’aplicació BIND 9) on cal indicar-ho. De fet, els fitxers de zona es transfereixen del primari als secundaris i han de contenir la mateixa informació.
</p>

<p>
Generalment els servidors secundaris disposen d’una còpia local pròpia del fitxer de <em>root</em> i del de <em>loopback</em>, ja que sempre és el mateix fitxer. Les altres configuracions ens transfereixen des del primari. Per tant, un servidor <acronym title="Domain Name System">DNS</acronym> secundari és primari per al domini <em>root</em> i <em>loopback</em> i secundari per a la resta de la zona.
</p>

<p>
L’administrador del sistema en posar en funcionament un servidor secundari ha de copiar-hi els fitxers corresponents al <em>loopback</em>, a la zona <em>root</em> (<em>db.cache</em>) i el fitxer de configuració global <em>(/etc/named.conf</em> en BIND 9). En el fitxer de configuració global caldrà modificar l’atribut <em>type</em> amb el valor <em>slave</em>; l’atribut <em>file</em> amb un nom tipus <em>bak.db.&lt;nom_zona&gt;</em> i afegir un atribut <em>masters</em> amb la llista de les adreces IP que són autoritaris de la zona. Els canvis caldrà fer-los en totes les definicions de zones excepte per al <em>loopback</em> i per a <em>root hints</em>.
</p>
<pre class="code c"><ol><li class="li1"><div class="de1"># extracte d'un fitxer /etc/named.conf </div></li><li class="li1"><div class="de1">zone &quot;example.com&quot; {     // definició de la zona on és autoritari</div></li><li class="li1"><div class="de1">    type master;</div></li><li class="li1"><div class="de1">    file &quot;example.com.db&quot;;</div></li><li class="li1"><div class="de1">    allow-transfer {     // Ips dels servidors secundaris als quals es permet </div></li><li class="li1"><div class="de1">        192.168.4.14;    // transferir la zona</div></li><li class="li1"><div class="de1">        192.168.5.53; };</div></li><li class="li1"><div class="de1">};</div></li><li class="li1"><div class="de1">zone &quot;.&quot; {          // definició dels nodes arrel</div></li><li class="li1"><div class="de1">        type hint; </div></li><li class="li1"><div class="de1">        file &quot;root.hints&quot;; }; </div></li><li class="li1"><div class="de1">zone &quot;0.0.127.in-addr.arpa&quot; {  // definició del localhost</div></li><li class="li1"><div class="de1">        type master; </div></li><li class="li1"><div class="de1">        file &quot;localhost.rev.zone&quot;; };</div></li></ol></pre>

<p>
En l’exemple anterior es defineixen els fitxers per a la resolució inversa del <em>loopback</em> i el fitxer de resolució dels nodes arrel, que sempre es fa de la mateixa manera. La part interessant és on es defineix el mateix servidor com a <em>màster</em> de la zona <em>example.com</em> i els servidors <em>192.168.4.14</em> i <em>192.168.5.53</em> com a secundaris d’aquesta zona.
</p>

<p>
Es poden posar diverses adreces IP amb servidors autoritzats de la zona en l’atribut <em>masters</em>. Segons sigui el programa/versió que s’utilitzi de servidor <acronym title="Domain Name System">DNS</acronym> s’aplicarà un criteri d’elecció. Els fitxers que es transfereixen del servidor primari al secundari no cal desar-los localment en el servidor secundari (la informació resideix a memòria), però s’aconsella fer-ho utilitzant l’atribut <em>file</em>. D’aquesta manera el servidor secundari pot continuar treballant, encara que el servidor primari no sigui accessible (fins que li caduquin les dades).
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1"># fragment d'un fitxer /etc/named.conf d'un servidor secundari</div></li><li class="li1"><div class="de1">zone &quot;eng.example.com&quot; {</div></li><li class="li1"><div class="de1">    type slave;</div></li><li class="li1"><div class="de1">    file &quot;eng.example.com.bk&quot;;</div></li><li class="li1"><div class="de1">    masters { 192.168.4.12; 192.168.4.13};     // Ips dels servidors primàris</div></li><li class="li1"><div class="de1">};</div></li></ol></pre>

<p>
En l’exemple anterior s’observa que aquest servidor es defineix amb l’atribut <em>slave</em> per a la zona <em>eng.example.com</em>. També s’indiquen quins són els servidors primaris d’aquesta zona, d’on pot rebre la transferència de zona. Usualment el primer és el primari i si n’hi ha més d’un són altres secundaris.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
<strong>L’actualització</strong> de la informació entre el servidor primari i els secundaris és molt important. Establir correctament aquests paràmetres és un art. Un servidor amb informació antiga causa un mal funcionament a la xarxa, un servidor actualitzat constantment consumeix els recursos de la xarxa.
</p>
</div></div>
<p>
Per cada fitxer de zona hi ha una entrada SOA que conté els valors necessaris per governar les transferències. Per exemple en l’entrada:
</p>
<pre class="code">inf.ioc.cat. IN SOA ns1.inf.ioc.cat. admin.ns1.inf.ioc.cat. ( 1h 3h 1h 1w 1h )</pre>

<p>
Els camps entre parèntesis corresponen a:
</p>
<ul>
<li class="level1"><div class="li"> <em>serial (1h)</em>: valor que indica el número de versió de les dades. A cada actualització s’incrementa. Quan el secundari contacta al primari mira aquest valor, si en el màster és superior sol·licita actualitzar la zona.</div>
</li>
<li class="level1"><div class="li"> <em>refresh (3h)</em>: és l’interval de temps cada quan el secundari ha de contactar amb el primari per comprovar si cal actualitzar la zona.</div>
</li>
<li class="level1"><div class="li"> <em>retry (1h)</em>: si no pot contactar amb el primari en fer un <em>refresh</em> ho torna a intentar passat aquest interval de temps.</div>
</li>
<li class="level1"><div class="li"> <em>expire (1w)</em>: si el primari no és accessible aquest és el temps que el secundari pot continuar responent a les consultes de la zona. Un cop transcorregut ha de deixar de fer-ho, perquè es considera que les dades són massa antigues i desfasades.</div>
</li>
<li class="level1"><div class="li"> <em>negative caching ttl (1h)</em>: indica el temps que ha de mantenir a la<em>cache</em> les respostes negatives el secundari (dominis no trobats).</div>
</li>
</ul>

</div>

<h2><a id="comprovacio_de_funcionament_del_servei" >Comprovació de funcionament del servei</a></h2>
<div class="level2">

<p>
En informàtica (a diferència del que passa en l’aviació, per exemple), normalment es comprova si funcionen les coses provant-les. Si el servei <acronym title="Domain Name System">DNS</acronym> emet les respostes adequades, és que funciona. Possiblement la manera mes fàcil de fer-ho és fent ping als noms de domini que es volen comprovar.
</p>

<p>
Existeixen moltes eines per fer consultes <acronym title="Domain Name System">DNS</acronym> simulant el funcionament d’un client i que permeten observar la resposta del servidor. Les més populars són les utilitats nslookup, dig i host. Aquestes ordres permeten obtenir informació dels recursos d’un servidor <acronym title="Domain Name System">DNS</acronym>, resoldre consultes i saber quins són els seus registres de recurs.
</p>

<p>
Altres eines que cal saber utilitzar són la utilitat nmap, que permet analitzar els ports d’un <em>host</em> i <em>sniffers</em> de xarxa que permetin monitorar tot el trànsit <acronym title="Domain Name System">DNS</acronym> que s’està produint. Les utilitats iptraf i wireshark són perfectes per observar el trànsit TCP i UDP que pot generar el protocol <acronym title="Domain Name System">DNS</acronym>.
</p>

</div>

<h3><a id="comprovacio_del_funcionament_basic" >Comprovació del funcionament bàsic</a></h3>
<div class="level3">

<p>
Comprovar que el servidor <acronym title="Domain Name System">DNS</acronym> està en funcionament és un procés ben senzill, n’hi ha prou de comprovar que el servei està engegat. Això no vol dir, en cap cas, que el servei estigui funcionant correctament. Potser el servidor està engegat però no està correctament configurat. De fet, la configuració és la part realment important de l’administració d’un servei i també del servei <acronym title="Domain Name System">DNS</acronym>.
</p>

<p>
A part de comprovar l’estat del servei (amb l’opció <em>status</em>), l’administrador pot assegurar-se que el dimoni del servei està en execució buscant el seu PID (<em>process identifier</em> o indicador de número de procés). Una altra activitat a fer és monitorar el registre d’activitats del servei (els <em>logs</em>). Tot el trànsit <acronym title="Domain Name System">DNS</acronym> és trànsit de xarxa TCP/IP; per tant, també es pot observar l’estat dels ports i analitzar el trànsit que s’hi produeix.
</p>

<p>

</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Comprovació DNS</p>
<p>
L’administrador pot verificar el funcionament del servidor <acronym title="Domain Name System">DNS</acronym> observant:
</p>
<ul>
<li class="level1"><div class="li"> l’estat del servei (<em>on</em>, <em>off</em>)</div>
</li>
<li class="level1"><div class="li"> el PID del servei (ha d’estar <em>running</em>).</div>
</li>
<li class="level1"><div class="li"> el registre de <em>logs</em>.</div>
</li>
<li class="level1"><div class="li"> monitorar el trànsit de xarxa amb una eina tipus wireshark.</div>
</li>
<li class="level1"><div class="li"> l’estat dels ports.</div>
</li>
</ul>
</div></div>
<p>
Tot procés en el sistema té un identificador de procés. El PID dels serveis usualment es desen en el sistema de fitxers (en el directori <em>/var/run</em>) en forma de fitxer que conté un valor numèric (en text) corresponent al PID del procés. Amb el servei en marxa sempre es pot observar el PID del servidor amb:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# ps ax | grep named  </div></li><li class="li1"><div class="de1"> 3612 ?        Ss     0:00 /usr/sbin/named </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">[root@portatil ~]# service named  status </div></li><li class="li1"><div class="de1">named (pid 3612) s'està executant...</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">[root@portatil ~]# ll /var/run/named.pid </div></li><li class="li1"><div class="de1">-rw-r--r-- 1 root root 5 29 jun 14:17 /var/run/named.pid </div></li><li class="li1"><div class="de1">[root@portatil ~]# cat /var/run/named.pid</div></li><li class="li1"><div class="de1">3612</div></li></ol></pre>

<p>
Un cop iniciat el servei es crea un fitxer de bloqueig o <em>lock</em> amb el nom del servei per evitar iniciar-ne una altra instància. Els fitxers de <em>lock</em> usualment es troben a <em>/var/lock</em> i són un simple fitxer de text buit on la seva pròpia existència ja marca que el servei està en marxa. En parar el servei el fitxer s’elimina. Podem observar això fent:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# cat /var/lock/subsys/named </div></li><li class="li1"><div class="de1">[root@portatil ~]# ll /var/lock/subsys/named</div></li><li class="li1"><div class="de1">-rw-r--r-- 1 root root 0  1 jun 18:26 /var/lock/subsys/named</div></li></ol></pre>

<p>
Tots els serveis del sistema normalment es monitoren anotant en fitxers de text un registre de totes les accions que realitzen, són els fitxers coneguts com a fitxers de <em>log</em>. Tant es pot utilitzar un fitxer genèric pel sistema com un fitxer independent per a un servei determinat. El servidor DHCP utilitza el fitxer de monitoratge estàndard <em>/var/log/messages</em>. En aquest fitxer s’enregistra cada cop que el servei s’engega i s’atura.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1"># exemple de missatges en engegar i aturar el servei</div></li><li class="li1"><div class="de1">[root@portatil ~]# cat /var/log/messages | grep named </div></li><li class="li1"><div class="de1">Oct  3 17:40:18 localhost named[5532]: starting BIND 9.5.1-P2 -u named</div></li><li class="li1"><div class="de1">Oct  3 17:40:18 localhost named[5532]: found 2 CPUs, using 2 worker threads</div></li><li class="li1"><div class="de1">Oct  3 17:40:18 localhost named[5532]: using up to 4096 sockets</div></li><li class="li1"><div class="de1">Oct  3 17:40:18 localhost named[5532]: loading configuration from ‚/etc/named.conf'</div></li><li class="li1"><div class="de1">Oct  3 17:40:18 localhost named[5532]: max open files (1024) is smaller than max sockets </div></li><li class="li1"><div class="de1">(4096)</div></li><li class="li1"><div class="de1">Oct  3 17:40:18 localhost named[5532]: using default UDP/IPv4 port range: [1024, 65535]</div></li><li class="li1"><div class="de1">Oct  3 17:40:18 localhost named[5532]: using default UDP/IPv6 port range: [1024, 65535]</div></li><li class="li1"><div class="de1">Oct  3 17:40:18 localhost named[5532]: listening on IPv6 interface lo, ::1#53</div></li><li class="li1"><div class="de1">Oct  3 17:40:18 localhost named[5532]: listening on IPv4 interface lo, 127.0.0.1#53</div></li><li class="li1"><div class="de1">Oct  3 17:40:18 localhost named[5532]: automatic empty zone: 127.IN-ADDR.ARPA</div></li><li class="li1"><div class="de1">... output suprimit ...</div></li><li class="li1"><div class="de1">Oct  3 17:40:18 localhost named[5532]: running</div></li><li class="li1"><div class="de1">Oct  3 17:40:34 localhost named[5532]: received control channel command ‚stop'</div></li><li class="li1"><div class="de1">Oct  3 17:40:34 localhost named[5532]: shutting down: flushing changes</div></li><li class="li1"><div class="de1">Oct  3 17:40:34 localhost named[5532]: stopping command channel on 127.0.0.1#953</div></li><li class="li1"><div class="de1">Oct  3 17:40:34 localhost named[5532]: stopping command channel on ::1#953</div></li><li class="li1"><div class="de1">Oct  3 17:40:34 localhost named[5532]: no longer listening on ::1#53</div></li><li class="li1"><div class="de1">Oct  3 17:40:34 localhost named[5532]: no longer listening on 127.0.0.1#53</div></li><li class="li1"><div class="de1">Oct  3 17:40:34 localhost named[5532]: exiting</div></li></ol></pre>

<p>
Sovint l’administrador vol comprovar que els ports que utilitza el protocol <acronym title="Domain Name System">DNS</acronym> estan oberts. En GNU/Linux fàcilment es pot fer una llista dels serveis associats a cada port mitjançant el fitxer <em>/etc/services</em>. Algunes utilitats com nmap permeten detectar els ports oberts. Per exemple, podem fer:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">#Llista dels ports que inclouen alguna referència DNS:</div></li><li class="li1"><div class="de1">[root@portatil ~]# cat /etc/services  | grep DNS </div></li><li class="li1"><div class="de1">[root@portatil ~]# cat /etc/services | grep dns </div></li><li class="li1"><div class="de1">dnsix           90/tcp                          # DNSIX Securit Attribute Token Map </div></li><li class="li1"><div class="de1">dnsix           90/udp                          # DNSIX Securit Attribute Token Map </div></li><li class="li1"><div class="de1">sdnskmp         558/tcp                         # SDNSKMP </div></li><li class="li1"><div class="de1">sdnskmp         558/udp                         # SDNSKMP </div></li><li class="li1"><div class="de1">dns2go          1227/tcp                        # DNS2Go </div></li><li class="li1"><div class="de1">dns2go          1227/udp                        # DNS2Go </div></li><li class="li1"><div class="de1">menandmice-dns  1337/tcp                        # menandmice DNS</div></li><li class="li1"><div class="de1">menandmice-dns  1337/udp                        # menandmice DNS </div></li><li class="li1"><div class="de1">sunscalar-dns   1870/tcp                        # SunSCALAR DNS Service </div></li><li class="li1"><div class="de1">sunscalar-dns   1870/udp                        # SunSCALAR DNS Service </div></li><li class="li1"><div class="de1">ddns-v3         2164/tcp                        # Dynamic DNS Version 3 </div></li><li class="li1"><div class="de1">ddns-v3         2164/udp                        # Dynamic DNS Version 3 </div></li><li class="li1"><div class="de1">spw-dnspreload  3849/tcp                        # SPACEWAY DNS Preload </div></li><li class="li1"><div class="de1">spw-dnspreload  3849/udp                        # SPACEWAY DNS Prelaod </div></li><li class="li1"><div class="de1">dns-llq         5352/tcp                        # DNS Long-Lived Queries </div></li><li class="li1"><div class="de1">dns-llq         5352/udp                        # DNS Long-Lived Queries </div></li><li class="li1"><div class="de1">mdns            5353/tcp                        # Multicast DNS </div></li><li class="li1"><div class="de1">mdns            5353/udp                        # Multicast DNS</div></li></ol></pre>

<p>
De fet, però, el servei <acronym title="Domain Name System">DNS</acronym> sabem que utilitza el port 53 i no apareix en la llista. Si observem el fitxer <em>/etc/services</em> veurem que s’indica amb el nom <em>domain</em>.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# cat /etc/services | grep  domain </div></li><li class="li1"><div class="de1">domain          53/tcp         # name-domain server </div></li><li class="li1"><div class="de1">domain          53/udp</div></li></ol></pre>

</div>

<h3><a id="eines_de_comprovacio_d_un_servidor_dns" >Eines de comprovació d&#039;un servidor DNS</a></h3>
<div class="level3">

<p>
Hi ha diverses eines per comprovar el funcionament d’un servidor <acronym title="Domain Name System">DNS</acronym>, i les més usuals són <strong>nslookup</strong>, <strong>dig</strong> i <strong>host</strong>. El procés de revisió el podríem basar en els apartats següents:
</p>
<ol>
<li class="level1"><div class="li"> Comprovar que el servei està en funcionament.</div>
</li>
<li class="level1"><div class="li"> Comprovar un nom local del domini. Provar-lo sense qualificar (només el nom.tipus <em>pc01</em>), qualificat amb punt al final (tipus <em>pc01.escola.org.</em>) i sense el punt al final (tipus <em>pc01.escola.org</em>). Exemples:</div>
<ul>
<li class="level2"><div class="li"> nslookup server ns1.inf.ioc.cat</div>
</li>
<li class="level2"><div class="li"> nslookup server.inf.ioc.cat ns1.inf.ioc.cat</div>
</li>
<li class="level2"><div class="li"> nslookup server. ns1.inf.ioc.cat</div>
</li>
<li class="level2"><div class="li"> nslookup server.ins.ioc.cat. ns1.inf.ioc.cat</div>
</li>
<li class="level2"><div class="li"> nslookup server.ins.ioc.cat ns1.inf.ioc.cat</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> Comprovar un nom de domini remot, fora del domini que s’està provant. Per exemple:<pre class="code">nslookup www.uoc.net ns1.inf.ioc.cat</pre>
</div>
</li>
<li class="level1"><div class="li"> Comprovar des d’un servidor remot un nom de domini local a la nostra zona. Cal que la zona estigui integrada en l’altre espai de noms. És a dir, cal una zona pare que hagi delegat en el domini que s’està revisant. Per exemple:</div>
</li>
</ol>

<p>
nslookup mahatma &lt;nom_ns_de un proveidor ISP&gt;. Si es vol, es pot crear un subdomini a la zona i delegar, i el domini pare ha de permetre resoldre noms del domini fill.
</p>

<p>
Tot seguit es presenten diverses eines de consulta <acronym title="Domain Name System">DNS</acronym> molt populars. Les utilitats nslookup, dig i host permeten obtenir informació dels recursos d’un servidor <acronym title="Domain Name System">DNS</acronym>, resoldre consultes i saber quins són els seus registres de recurs.
</p>

<p>
Altres eines que cal saber utilitzar són la utilitat nmap, que permet analitzar els ports d’un <em>host</em>; i sniffers de xarxa tipus iptraf i wireshark, que permeten monitorar el trànsit TCP i UDP.
</p>

</div>

<h4><a id="utilitat_dig" >Utilitat dig</a></h4>
<div class="level4">

<p>
Exemple de consulta dels registres de recurs del servidor <em>ioc.cat</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# dig ioc.cat ANY</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">; &lt;&lt;&gt;&gt; DiG 9.9.5-9-Debian &lt;&lt;&gt;&gt; ioc.cat ANY</div></li><li class="li1"><div class="de1">;; global options: +cmd</div></li><li class="li1"><div class="de1">;; Got answer:</div></li><li class="li1"><div class="de1">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 34042</div></li><li class="li1"><div class="de1">;; flags: qr rd ra; QUERY: 1, ANSWER: 10, AUTHORITY: 2, ADDITIONAL: 5</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; OPT PSEUDOSECTION:</div></li><li class="li1"><div class="de1">; EDNS: version: 0, flags:; udp: 4096</div></li><li class="li1"><div class="de1">;; QUESTION SECTION:</div></li><li class="li1"><div class="de1">;ioc.cat.  		IN	ANY</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; ANSWER SECTION:</div></li><li class="li1"><div class="de1">ioc.cat.		858	IN	SOA	dns1.nominalia.com. root.dns1.nominalia.com. 1431937190 86400 7200 2592000 300</div></li><li class="li1"><div class="de1">ioc.cat.		858	IN	MX	10 aspmx.l.google.com.</div></li><li class="li1"><div class="de1">ioc.cat.		858	IN	MX	30 aspmx2.googlemail.com.</div></li><li class="li1"><div class="de1">ioc.cat.		858	IN	MX	30 aspmx5.googlemail.com.</div></li><li class="li1"><div class="de1">ioc.cat.		858	IN	MX	30 aspmx3.googlemail.com.</div></li><li class="li1"><div class="de1">ioc.cat.		858	IN	MX	20 alt1.aspmx.l.google.com.</div></li><li class="li1"><div class="de1">ioc.cat.		858	IN	MX	20 alt2.aspmx.l.google.com.</div></li><li class="li1"><div class="de1">ioc.cat.		858	IN	MX	30 aspmx4.googlemail.com.</div></li><li class="li1"><div class="de1">ioc.cat.		858	IN	NS	dns2.nominalia.com.</div></li><li class="li1"><div class="de1">ioc.cat.		858	IN	NS	dns1.nominalia.com.</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; AUTHORITY SECTION:</div></li><li class="li1"><div class="de1">ioc.cat.		858	IN	NS	dns2.nominalia.com.</div></li><li class="li1"><div class="de1">ioc.cat.		858	IN	NS	dns1.nominalia.com.</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; ADDITIONAL SECTION:</div></li><li class="li1"><div class="de1">aspmx.l.google.com.	14	IN	A	173.194.67.26</div></li><li class="li1"><div class="de1">aspmx.l.google.com.	14	IN	AAAA	2a00:1450:400c:c00::1a</div></li><li class="li1"><div class="de1">dns1.nominalia.com.	264	IN	A	81.88.57.102</div></li><li class="li1"><div class="de1">dns2.nominalia.com.	349	IN	A	62.193.205.63</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; Query time: 3 msec</div></li><li class="li1"><div class="de1">;; SERVER: 147.83.2.3#53(147.83.2.3)</div></li><li class="li1"><div class="de1">;; WHEN: Thu Jun 04 16:24:11 CEST 2015</div></li><li class="li1"><div class="de1">;; MSG SIZE  rcvd: 408</div></li></ol></pre>

<p>
En el següent exemple es consulten quins són els servidors de noms arrel:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# dig . ANY </div></li><li class="li1"><div class="de1">; &lt;&lt;&gt;&gt; DiG 9.4.2 &lt;&lt;&gt;&gt; . ANY </div></li><li class="li1"><div class="de1">;; global options:  printcmd </div></li><li class="li1"><div class="de1">;; Got answer: </div></li><li class="li1"><div class="de1">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 47921 </div></li><li class="li1"><div class="de1">;; flags: qr rd ra; QUERY: 1, ANSWER: 14, AUTHORITY: 13, ADDITIONAL: 3 </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; QUESTION SECTION: </div></li><li class="li1"><div class="de1">;.                              IN      ANY </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; ANSWER SECTION: </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      H.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      B.ROOT-SERVERS.NET.</div></li><li class="li1"><div class="de1">.                       240358  IN      NS      I.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      K.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      J.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      C.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      G.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      L.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      E.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      M.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      F.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      D.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      A.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       62937   IN      SOA     A.ROOT-SERVERS.NET. NSTLD.VERISIGN-GRS.COM. </div></li><li class="li1"><div class="de1">2007121601 1800 900 604800 86400 </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; AUTHORITY SECTION: </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      L.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      A.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      D.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      J.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      H.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      C.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      I.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      M.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      B.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      G.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      F.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      E.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.                       240358  IN      NS      K.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; ADDITIONAL SECTION: </div></li><li class="li1"><div class="de1">A.ROOT-SERVERS.NET.     601520  IN      A       198.41.0.4 </div></li><li class="li1"><div class="de1">B.ROOT-SERVERS.NET.     581337  IN      A       192.228.79.201 </div></li><li class="li1"><div class="de1">C.ROOT-SERVERS.NET.     581337  IN      A       192.33.4.12 </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; Query time: 0 msec </div></li><li class="li1"><div class="de1">;; SERVER: 192.168.0.10#53(192.168.0.10) </div></li><li class="li1"><div class="de1">;; WHEN: Mon Dec 17 19:02:12 2007 </div></li><li class="li1"><div class="de1">;; MSG SIZE  rcvd: 502</div></li></ol></pre>

<p>
El següent és un exemple de consulta dels servidors autoritaris que existeixen per al domini <em>.com</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]#  dig com. ANY </div></li><li class="li1"><div class="de1">; &lt;&lt;&gt;&gt; DiG 9.4.2 &lt;&lt;&gt;&gt; com. ANY </div></li><li class="li1"><div class="de1">;; global options:  printcmd </div></li><li class="li1"><div class="de1">;; Got answer: </div></li><li class="li1"><div class="de1">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 34936 </div></li><li class="li1"><div class="de1">;; flags: qr rd ra; QUERY: 1, ANSWER: 13, AUTHORITY: 13, ADDITIONAL: 3 </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; QUESTION SECTION: </div></li><li class="li1"><div class="de1">;com.                           IN      ANY </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; ANSWER SECTION: </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      h.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      k.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      b.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      i.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      m.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      l.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      e.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      j.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      f.gtld-servers.net.</div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      a.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      g.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      c.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      d.gtld-servers.net. </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; AUTHORITY SECTION: </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      c.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      j.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      g.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      h.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      k.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      i.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      e.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      l.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      f.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      a.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      b.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      m.gtld-servers.net. </div></li><li class="li1"><div class="de1">com.                    80008   IN      NS      d.gtld-servers.net. </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; ADDITIONAL SECTION: </div></li><li class="li1"><div class="de1">a.gtld-servers.net.     72862   IN      A       192.5.6.30 </div></li><li class="li1"><div class="de1">a.gtld-servers.net.     79678   IN      AAAA    2001:503:a83e::2:30 </div></li><li class="li1"><div class="de1">b.gtld-servers.net.     72862   IN      A       192.33.14.30 </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; Query time: 0 msec </div></li><li class="li1"><div class="de1">;; SERVER: 192.168.0.10#53(192.168.0.10) </div></li><li class="li1"><div class="de1">;; WHEN: Mon Dec 17 19:02:50 2007 </div></li><li class="li1"><div class="de1">;; MSG SIZE  rcvd: 487</div></li></ol></pre>

</div>

<h4><a id="utilitat_nslookup" >Utilitat nslookup</a></h4>
<div class="level4">

<p>
Podem utilitzar la utilitat nslookup per fer consultes <acronym title="Domain Name System">DNS</acronym> de tot tipus. Es pot fins i tot seleccionar quin és el servidor al qual es dirigeixen les consultes.
</p>

<p>
Observeu quins són els nodes arrel:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nslookup: </div></li><li class="li1"><div class="de1">&gt; .   </div></li><li class="li1"><div class="de1">Server:         192.168.0.10 </div></li><li class="li1"><div class="de1">Address:        192.168.0.10#53 </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Non-authoritative answer: </div></li><li class="li1"><div class="de1">.       nameserver = G.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = F.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = L.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = I.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = E.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = K.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = A.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = C.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = M.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = H.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = D.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = J.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = B.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">. </div></li><li class="li1"><div class="de1">        origin = A.ROOT-SERVERS.NET </div></li><li class="li1"><div class="de1">        mail addr = NSTLD.VERISIGN-GRS.COM </div></li><li class="li1"><div class="de1">        serial = 2007121601</div></li><li class="li1"><div class="de1">        refresh = 1800 </div></li><li class="li1"><div class="de1">        retry = 900 </div></li><li class="li1"><div class="de1">        expire = 604800 </div></li><li class="li1"><div class="de1">        minimum = 86400 </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Authoritative answers can be found from: </div></li><li class="li1"><div class="de1">.       nameserver = J.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = F.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = K.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = I.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = C.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = D.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = M.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = G.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = E.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = A.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = B.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = L.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">.       nameserver = H.ROOT-SERVERS.NET. </div></li><li class="li1"><div class="de1">A.ROOT-SERVERS.NET      internet address = 198.41.0.4 </div></li><li class="li1"><div class="de1">B.ROOT-SERVERS.NET      internet address = 192.228.79.201 </div></li><li class="li1"><div class="de1">C.ROOT-SERVERS.NET      internet address = 192.33.4.12</div></li></ol></pre>

<p>
Observeu els noms dels servidors autoritaris per al domini <em>.cat</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nslookup: </div></li><li class="li1"><div class="de1">&gt; cat </div></li><li class="li1"><div class="de1">Server:         192.168.0.10 </div></li><li class="li1"><div class="de1">Address:        192.168.0.10#53 </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Non-authoritative answer: </div></li><li class="li1"><div class="de1">cat </div></li><li class="li1"><div class="de1">        origin = ns.nic.cat </div></li><li class="li1"><div class="de1">        mail addr = dnsmaster.knipp.de </div></li><li class="li1"><div class="de1">        serial = 2007121773 </div></li><li class="li1"><div class="de1">        refresh = 10800 </div></li><li class="li1"><div class="de1">        retry = 10800 </div></li><li class="li1"><div class="de1">        expire = 604800 </div></li><li class="li1"><div class="de1">        minimum = 86400 </div></li><li class="li1"><div class="de1">cat     nameserver = ns1.nic.es. </div></li><li class="li1"><div class="de1">cat     nameserver = merapi.switch.ch. </div></li><li class="li1"><div class="de1">cat     nameserver = ns-ext.nrt1.isc.org. </div></li><li class="li1"><div class="de1">cat     nameserver = ns.nic.cat. </div></li><li class="li1"><div class="de1">cat     nameserver = ns-ext.isc.org. </div></li><li class="li1"><div class="de1">cat     nameserver = ns5.knipp.de. </div></li><li class="li1"><div class="de1">cat     nameserver = dns4.ad. </div></li><li class="li1"><div class="de1">cat     nameserver = cat-dns.denic.de. </div></li><li class="li1"><div class="de1">cat     nameserver = dns-cat.pch.net. </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Authoritative answers can be found from: </div></li><li class="li1"><div class="de1">cat     nameserver = dns4.ad. </div></li><li class="li1"><div class="de1">cat     nameserver = ns1.nic.es. </div></li><li class="li1"><div class="de1">cat     nameserver = ns-ext.nrt1.isc.org. </div></li><li class="li1"><div class="de1">cat     nameserver = ns-ext.isc.org. </div></li><li class="li1"><div class="de1">cat     nameserver = merapi.switch.ch. </div></li><li class="li1"><div class="de1">cat     nameserver = cat-dns.denic.de. </div></li><li class="li1"><div class="de1">cat     nameserver = dns-cat.pch.net. </div></li><li class="li1"><div class="de1">cat     nameserver = ns.nic.cat. </div></li><li class="li1"><div class="de1">cat     nameserver = ns5.knipp.de. </div></li><li class="li1"><div class="de1">ns1.nic.es      internet address = 194.69.254.1 </div></li><li class="li1"><div class="de1">ns5.knipp.de    internet address = 195.253.6.62 </div></li><li class="li1"><div class="de1">dns4.ad internet address = 194.158.64.10 </div></li><li class="li1"><div class="de1">ns-ext.isc.org  internet address = 204.152.184.64</div></li></ol></pre>

<p>
Utilitzant el servidor de noms d’un altre domini, per exemple <em>dns.gencat.net</em>, també podem fer-li consultes:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">nslookup</div></li><li class="li1"><div class="de1">&gt; server 83.247.128.1 </div></li><li class="li1"><div class="de1">Default server: 83.247.128.1 </div></li><li class="li1"><div class="de1">Address: 83.247.128.1#53 </div></li><li class="li1"><div class="de1">&gt; set type=any </div></li><li class="li1"><div class="de1">&gt; mail.yahoo.com </div></li><li class="li1"><div class="de1">Server:         83.247.128.1 </div></li><li class="li1"><div class="de1">Address:        83.247.128.1#53 </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Non-authoritative answer: </div></li><li class="li1"><div class="de1">mail.yahoo.com  canonical name = login.yahoo.com. </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Authoritative answers can be found from: </div></li><li class="li1"><div class="de1">yahoo.com       nameserver = ns2.yahoo.com. </div></li><li class="li1"><div class="de1">yahoo.com       nameserver = ns1.yahoo.com. </div></li><li class="li1"><div class="de1">yahoo.com       nameserver = ns3.yahoo.com. </div></li><li class="li1"><div class="de1">yahoo.com       nameserver = ns4.yahoo.com. </div></li><li class="li1"><div class="de1">yahoo.com       nameserver = ns5.yahoo.com. </div></li><li class="li1"><div class="de1">yahoo.com       nameserver = ns6.yahoo.com. </div></li><li class="li1"><div class="de1">yahoo.com       nameserver = ns8.yahoo.com. </div></li><li class="li1"><div class="de1">ns2.yahoo.com   internet address = 68.142.255.16 </div></li><li class="li1"><div class="de1">ns1.yahoo.com   internet address = 66.218.71.63 </div></li><li class="li1"><div class="de1">ns3.yahoo.com   internet address = 217.12.4.104 </div></li><li class="li1"><div class="de1">ns4.yahoo.com   internet address = 68.142.196.63 </div></li><li class="li1"><div class="de1">ns5.yahoo.com   internet address = 216.109.116.17 </div></li><li class="li1"><div class="de1">ns6.yahoo.com   internet address = 202.43.223.170 </div></li><li class="li1"><div class="de1">ns8.yahoo.com   internet address = 202.165.104.22</div></li></ol></pre>

</div>

<h4><a id="utilitat_host" >Utilitat host</a></h4>
<div class="level4">

<p>
Per saber a qui correspon l’adreça IP utilitzada en l’últim exemple anterior:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# host 83.247.128.1 </div></li><li class="li1"><div class="de1">1.128.247.83.in-addr.arpa domain name pointer dns.gencat.net. </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Per veure la informació del domini de la uoc:</div></li><li class="li1"><div class="de1">[root@portatil ~]# host -a uoc.es </div></li><li class="li1"><div class="de1">Trying &quot;uoc.es&quot; </div></li><li class="li1"><div class="de1">;; -&gt;&gt;HEADER&lt;&lt;- opcode: QUERY, status: NOERROR, id: 51683 </div></li><li class="li1"><div class="de1">;; flags: qr rd ra; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 2 </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; QUESTION SECTION: </div></li><li class="li1"><div class="de1">;uoc.es.                                IN      ANY </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; ANSWER SECTION: </div></li><li class="li1"><div class="de1">uoc.es.                 86400   IN      NS      nepal.uoc.es. </div></li><li class="li1"><div class="de1">uoc.es.                 86400   IN      NS      tibet.uoc.es. </div></li><li class="li1"><div class="de1">uoc.es.                 86400   IN      SOA     tibet.uoc.es. root.tibet.uoc.es. 2008062000 </div></li><li class="li1"><div class="de1">28800 7200 604800 86400 </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">;; ADDITIONAL SECTION: </div></li><li class="li1"><div class="de1">nepal.uoc.es.           86077   IN      A       213.73.40.47 </div></li><li class="li1"><div class="de1">tibet.uoc.es.           86077   IN      A       213.73.40.45 </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Received 137 bytes from 80.58.61.250#53 in 97 ms</div></li></ol></pre>

<p>
Per veure els servidors de correu de <em>Google</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# host -t MX google.com </div></li><li class="li1"><div class="de1">google.com mail is handled by 10 smtp1.google.com. </div></li><li class="li1"><div class="de1">google.com mail is handled by 10 smtp2.google.com. </div></li><li class="li1"><div class="de1">google.com mail is handled by 10 smtp3.google.com. </div></li><li class="li1"><div class="de1">google.com mail is handled by 10 smtp4.google.com.</div></li></ol></pre>

</div>

<h4><a id="utilitat_nmap" >Utilitat nmap</a></h4>
<div class="level4">

<p>
La utilitat nmap fa un escaneig dels ports de l’equip indicat. Molt sovint s’ha considerat una eina atacant, però de fet és una excel·lent eina per a un administrador per observar l’estat dels ports del servidor. Podem generar la llista de l’estat del port on escolta el servidor <acronym title="Domain Name System">DNS</acronym>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@dnsServer ~]# nmap localhost </div></li><li class="li1"><div class="de1">Starting Nmap 4.20 ( http://insecure.org ) at 2008-06-07 14:50 CEST </div></li><li class="li1"><div class="de1">Interesting ports on localhost (127.0.0.1): </div></li><li class="li1"><div class="de1">Not shown: 1692 closed ports </div></li><li class="li1"><div class="de1">PORT     STATE SERVICE </div></li><li class="li1"><div class="de1">22/tcp   open  ssh </div></li><li class="li1"><div class="de1">53/udp   open  dns</div></li><li class="li1"><div class="de1">80/tcp   open  http </div></li><li class="li1"><div class="de1">111/tcp  open  rpcbind </div></li><li class="li1"><div class="de1">443/tcp  open  https </div></li><li class="li1"><div class="de1">8000/tcp open  http-alt </div></li><li class="li1"><div class="de1">Nmap finished: 1 IP address (1 host up) scanned in 0.116 seconds</div></li></ol></pre>

</div>

<h4><a id="utilitat_ping" >Utilitat ping</a></h4>
<div class="level4">

<p>
Podem observar el trànsit UDP d’una consulta <acronym title="Domain Name System">DNS</acronym> amb la utilitat iptraf on es pot veure la connexió del client de sortida usant el port dinàmic 32771 al port 53 del servidor 80.58.61.250. Per una banda activar iptraf i per l’altra fer una consulta que requereixi resolució <acronym title="Domain Name System">DNS</acronym>.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# ping www.google.com </div></li><li class="li1"><div class="de1">PING www.l.google.com (66.102.9.99) 56(84) bytes of data. </div></li><li class="li1"><div class="de1">64 bytes from 66.102.9.99: icmp_seq=1 ttl=244 time=114 ms </div></li><li class="li1"><div class="de1">64 bytes from 66.102.9.99: icmp_seq=2 ttl=244 time=74.7 ms </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">--- www.l.google.com ping statistics --- </div></li><li class="li1"><div class="de1">2 packets transmitted, 2 received, 0% packet loss, time 999ms </div></li><li class="li1"><div class="de1">rtt min/avg/max/mdev = 74.735/94.539/114.343/19.804 ms</div></li></ol></pre>

<p>
En una altra sessió hem fet prèviament:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# iptraf</div></li></ol></pre>

<p>
La <span class="figref"><a href="#Figura11"><span>figura</span></a></span> permet observar el trànsit UDP corresponent a un diàleg <acronym title="Domain Name System">DNS</acronym>.
</p>
<div class="iocfigure"><a name="Figura11"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Imatge d’una captura amb iptraf

</figcaption><img src="../media/smxm7uf1ud1_im11.png" alt="" /></figure>
</div>
</div>

<h3><a id="consultar_la_configuracio_del_clientel_resolver" >Consultar la configuració del client: el resolver</a></h3>
<div class="level3">

<p>
El client d’una consulta <acronym title="Domain Name System">DNS</acronym> utilitza el <em>resolver</em>. Són biblioteques amb les quals està enllaçada l’aplicació client que correspongui. És a dir, no hi ha un programa <em>resolver</em> client, sinó que cada aplicació client o el dimoni de xarxa n’implementa un.
</p>

<p>
El fitxer que conté la configuració del <em>resolver</em> en sistemes GNU/Linux és el <em>/etc/resolv.conf</em>:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# cat /etc/resolv.conf </div></li><li class="li1"><div class="de1">; generated by /sbin/dhclient-script </div></li><li class="li1"><div class="de1">search local.lan </div></li><li class="li1"><div class="de1">nameserver 80.58.61.250 </div></li><li class="li1"><div class="de1">nameserver 80.58.61.254</div></li></ol></pre>

<p>
L’ordre en què s’han de resoldre les consultes client pot ser primer mirant els fitxers de configuració local (usualment el fitxer <em>/etc/hosts</em>) i després consultant un servidor <acronym title="Domain Name System">DNS</acronym> o a l’inrevés. Aquesta configuració es defineix en el fitxer <em>/etc/nsswitch</em>.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# cat /etc/nsswitch.conf </div></li><li class="li1"><div class="de1"># </div></li><li class="li1"><div class="de1"># /etc/nsswitch.conf </div></li><li class="li1"><div class="de1">... output suprimit ... </div></li><li class="li1"><div class="de1"># Example: </div></li><li class="li1"><div class="de1">#passwd:    db files nisplus nis </div></li><li class="li1"><div class="de1">#shadow:    db files nisplus nis </div></li><li class="li1"><div class="de1">#group:     db files nisplus nis </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">passwd:     files </div></li><li class="li1"><div class="de1">shadow:     files </div></li><li class="li1"><div class="de1">group:      files </div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">#hosts:     db files nisplus nis dns </div></li><li class="li1"><div class="de1">hosts:      files dns</div></li></ol></pre>

</div>

<h3><a id="monitorar_el_transit_amb_wireshark" >Monitorar el trànsit amb Wireshark</a></h3>
<div class="level3">

<p>
Activar un <em>snifer</em> de xarxa com per exemple <em>Wireshark</em> per monitorar el trànsit <acronym title="Domain Name System">DNS</acronym>.
</p>

<p>
Podem fer que el client sol·liciti una consulta <acronym title="Domain Name System">DNS</acronym> simplement fent un ping a una nova adreça IP que no estigui al <em>cache</em> local i que calgui resoldre via <acronym title="Domain Name System">DNS</acronym>.
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">[root@portatil ~]# ping  www.google.com </div></li><li class="li1"><div class="de1">PING www.l.google.com (66.102.9.104) 56(84) bytes of data. </div></li><li class="li1"><div class="de1">64 bytes from lm-in-f104.google.com (66.102.9.104): icmp_seq=1 ttl=244 time=118 ms </div></li><li class="li1"><div class="de1">64 bytes from lm-in-f104.google.com (66.102.9.104): icmp_seq=2 ttl=244 time=75.3 ms </div></li><li class="li1"><div class="de1">--- www.l.google.com ping statistics --- </div></li><li class="li1"><div class="de1">2 packets transmitted, 2 received, 0% packet loss, time 999ms </div></li><li class="li1"><div class="de1">rtt min/avg/max/mdev = 75.313/96.914/118.516/21.603 ms</div></li></ol></pre>

<p>
En la captura següent (<span class="figref"><a href="#Figura12"><span>figura</span></a></span>) podeu observar que s’ha fet el <em>ping</em>, el client ha resolt per ARP l’adreça del router local i llavors ha preguntat al servidor <acronym title="Domain Name System">DNS</acronym> (80.58.61.250) per l’adreça de <a href="http://www.google.com" class="urlextern" title="http://www.google.com"  rel="nofollow">www.google.com</a>. El servidor <acronym title="Domain Name System">DNS</acronym> ha contestat indicant que l’adreça IP buscada és <em>66.102.9.104</em>. Fixeu-vos que és una consulta <acronym title="Domain Name System">DNS</acronym> que busca un registre de <em>tipus A</em> (<em>host</em>).
</p>

<p>
Podeu observar també que s’ha fet una consulta de resolució inversa en la qual s’ha comprovat que l’adreça IP <em>66.102.9.104</em> correspon realment al domini <a href="http://www.google.com" class="urlextern" title="http://www.google.com"  rel="nofollow">www.google.com</a>.
</p>
<div class="iocfigure"><a name="Figura12"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Imatge d’una captura de trànsit <acronym title="Domain Name System">DNS</acronym> utilitzant l’aplicació wireshark

</figcaption><img src="../media/smxm7uf1ud1_im12.png" alt="" /></figure>
</div>
<p>
A continuació, podeu observar la llista de text de les quatre trames que contenen informació <acronym title="Domain Name System">DNS</acronym> capturades amb el <em>wireshark</em> (s’han exportat en format text):
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1">No. Time        Source          Destination     Protocol   Info</div></li><li class="li1"><div class="de1">  3 0.000449    192.168.1.34    80.58.61.250    DNS        Standard query A www.google.com</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Frame 3 (74 bytes on wire, 74 bytes captured)</div></li><li class="li1"><div class="de1">Ethernet II, Src: AsustekC_15:80:7e (00:17:31:15:80:7e), Dst: XaviTech_7b:ff:1d </div></li><li class="li1"><div class="de1">(00:01:38:7b:ff:1d)</div></li><li class="li1"><div class="de1">Internet Protocol, Src: 192.168.1.34 (192.168.1.34), Dst: 80.58.61.250 (80.58.61.250)</div></li><li class="li1"><div class="de1">User Datagram Protocol, Src Port: filenet-rmi (32771), Dst Port: domain (53)</div></li><li class="li1"><div class="de1">Domain Name System (query)</div></li><li class="li1"><div class="de1">    [Response In: 4]</div></li><li class="li1"><div class="de1">    Transaction ID: 0x9d09</div></li><li class="li1"><div class="de1">    Flags: 0x0100 (Standard query)</div></li><li class="li1"><div class="de1">    Questions: 1</div></li><li class="li1"><div class="de1">    Answer RRs: 0</div></li><li class="li1"><div class="de1">    Authority RRs: 0</div></li><li class="li1"><div class="de1">    Additional RRs: 0</div></li><li class="li1"><div class="de1">    Queries</div></li><li class="li1"><div class="de1">        www.google.com: type A, class IN</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">No. Time        Source          Destination     Protocol   Info</div></li><li class="li1"><div class="de1">  4 0.074927    80.58.61.250    192.168.1.34    DNS        Standard query response CNAME </div></li><li class="li1"><div class="de1">www.l.google.com A 66.102.9.104 A 66.102.9.147 A 66.102.9.99</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Frame 4 (142 bytes on wire, 142 bytes captured)</div></li><li class="li1"><div class="de1">Ethernet II, Src: XaviTech_7b:ff:1d (00:01:38:7b:ff:1d), Dst: AsustekC_15:80:7e </div></li><li class="li1"><div class="de1">(00:17:31:15:80:7e)</div></li><li class="li1"><div class="de1">Internet Protocol, Src: 80.58.61.250 (80.58.61.250), Dst: 192.168.1.34 (192.168.1.34)</div></li><li class="li1"><div class="de1">User Datagram Protocol, Src Port: domain (53), Dst Port: filenet-rmi (32771)</div></li><li class="li1"><div class="de1">Domain Name System (response)</div></li><li class="li1"><div class="de1">    [Request In: 3]</div></li><li class="li1"><div class="de1">    [Time: 0.074478000 seconds]</div></li><li class="li1"><div class="de1">    Transaction ID: 0x9d09</div></li><li class="li1"><div class="de1">    Flags: 0x8180 (Standard query response, No error)</div></li><li class="li1"><div class="de1">    Questions: 1</div></li><li class="li1"><div class="de1">    Answer RRs: 4</div></li><li class="li1"><div class="de1">    Authority RRs: 0</div></li><li class="li1"><div class="de1">    Additional RRs: 0</div></li><li class="li1"><div class="de1">    Queries</div></li><li class="li1"><div class="de1">        www.google.com: type A, class IN</div></li><li class="li1"><div class="de1">    Answers</div></li><li class="li1"><div class="de1">        www.google.com: type CNAME, class IN, cname www.l.google.com</div></li><li class="li1"><div class="de1">        www.l.google.com: type A, class IN, addr 66.102.9.104</div></li><li class="li1"><div class="de1">        www.l.google.com: type A, class IN, addr 66.102.9.147</div></li><li class="li1"><div class="de1">        www.l.google.com: type A, class IN, addr 66.102.9.99</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">No. Time        Source          Destination     Protocol   Info</div></li><li class="li1"><div class="de1">  7 0.193929    192.168.1.34    80.58.61.250    DNS        Standard query PTR 104.9.102.66.in-</div></li><li class="li1"><div class="de1">addr.arpa</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Frame 7 (85 bytes on wire, 85 bytes captured)</div></li><li class="li1"><div class="de1">Ethernet II, Src: AsustekC_15:80:7e (00:17:31:15:80:7e), Dst: XaviTech_7b:ff:1d </div></li><li class="li1"><div class="de1">(00:01:38:7b:ff:1d)</div></li><li class="li1"><div class="de1">Internet Protocol, Src: 192.168.1.34 (192.168.1.34), Dst: 80.58.61.250 (80.58.61.250)</div></li><li class="li1"><div class="de1">User Datagram Protocol, Src Port: filenet-rmi (32771), Dst Port: domain (53)</div></li><li class="li1"><div class="de1">Domain Name System (query)</div></li><li class="li1"><div class="de1">    [Response In: 8]</div></li><li class="li1"><div class="de1">    Transaction ID: 0x6539</div></li><li class="li1"><div class="de1">    Flags: 0x0100 (Standard query)</div></li><li class="li1"><div class="de1">    Questions: 1</div></li><li class="li1"><div class="de1">    Answer RRs: 0</div></li><li class="li1"><div class="de1">    Authority RRs: 0</div></li><li class="li1"><div class="de1">    Additional RRs: 0</div></li><li class="li1"><div class="de1">    Queries</div></li><li class="li1"><div class="de1">        104.9.102.66.in-addr.arpa: type PTR, class IN</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">No. Time        Source          Destination     Protocol   Info</div></li><li class="li1"><div class="de1">  8 0.229144    80.58.61.250    192.168.1.34    DNS        Standard query response PTR lm-</div></li><li class="li1"><div class="de1">in-f104.google.com</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Frame 8 (120 bytes on wire, 120 bytes captured)</div></li><li class="li1"><div class="de1">Ethernet II, Src: XaviTech_7b:ff:1d (00:01:38:7b:ff:1d), Dst: AsustekC_15:80:7e </div></li><li class="li1"><div class="de1">(00:17:31:15:80:7e)</div></li><li class="li1"><div class="de1">Internet Protocol, Src: 80.58.61.250 (80.58.61.250), Dst: 192.168.1.34 (192.168.1.34)</div></li><li class="li1"><div class="de1">User Datagram Protocol, Src Port: domain (53), Dst Port: filenet-rmi (32771)</div></li><li class="li1"><div class="de1">Domain Name System (response)</div></li><li class="li1"><div class="de1">    [Request In: 7]</div></li><li class="li1"><div class="de1">    [Time: 0.035215000 seconds]</div></li><li class="li1"><div class="de1">    Transaction ID: 0x6539</div></li><li class="li1"><div class="de1">    Flags: 0x8180 (Standard query response, No error)</div></li><li class="li1"><div class="de1">    Questions: 1</div></li><li class="li1"><div class="de1">    Answer RRs: 1</div></li><li class="li1"><div class="de1">    Authority RRs: 0</div></li><li class="li1"><div class="de1">    Additional RRs: 0</div></li><li class="li1"><div class="de1">    Queries</div></li><li class="li1"><div class="de1">        104.9.102.66.in-addr.arpa: type PTR, class IN</div></li><li class="li1"><div class="de1">    Answers</div></li><li class="li1"><div class="de1">        104.9.102.66.in-addr.arpa: type PTR, class IN, lm-in-f104.google.com</div></li></ol></pre>

</div>

<h2><a id="realitzar_documentacio_de_suport_a_l_usuari" >Realitzar documentació de suport a l&#039;usuari</a></h2>
<div class="level2">

<p>
Una de les facetes més ignorades en el camp de la informàtica és la confecció de manuals i documentació de suport. Com a clients molt sovint ens queixem que falta informació o que està mal redactada. Com a administradors de xarxa no trobem mai temps per anotar les coses. Mentre les tenim al cap no creiem necessari fer la documentació, quan no ho tenim al cap, ja ens és impossible fer-ho, i sovint, és just quan es faria falta haver-ho fet! Fem un repàs de la informació necessària que cal documentar, tant per a l’usuari com per a l’administrador.
</p>
<div class="iocreference"><div class="ioccontent">
<p>
Podeu descarregar-vos aquesta captura del diàleg <acronym title="Domain Name System">DNS</acronym> en la secció “Annexos” del web del mòdul.
</p>
</div></div>
<p>
El client ha de saber:
</p>
<ul>
<li class="level1"><div class="li"> Com contactar amb el servidor <acronym title="Domain Name System">DNS</acronym>. Quin programari ha d’utilitzar i com l’ha de configurar per fer ús del servei.</div>
</li>
<li class="level1"><div class="li"> Quina és la informació que s’obtindrà via <acronym title="Domain Name System">DNS</acronym>. Cal saber visualitzar, consultar aquesta informació i saber què significa, per a què serveix.</div>
</li>
</ul>

<p>
Així doncs, la documentació de l’usuari descriurà el procés per activar el client dns, amb captures de pantalla que facilitin aquest procés. La part més important és mostrar un exemple de configuració de xarxa on es detalli el significat de cada element i explicar a l’usuari com fer aquesta consulta. Un exemple d’informació a proporcionar podria ser el següent:
</p>
<pre class="code bash"><ol><li class="li1"><div class="de1"># L'usuari pot consultar la configuració dns l'ordre:</div></li><li class="li1"><div class="de1">C:\&gt;ifconfig /all</div></li><li class="li1"><div class="de1">Configuración IP de Windows</div></li><li class="li1"><div class="de1">        Nombre del host . . . . . . . . . : nombre-29b9943f</div></li><li class="li1"><div class="de1">        Sufijo DNS principal  . . . . . . : </div></li><li class="li1"><div class="de1">        Tipo de nodo. . . . . . . . . . . : híbrido</div></li><li class="li1"><div class="de1">        Enrutamiento habilitado. . . . . .: No</div></li><li class="li1"><div class="de1">        Proxy WINS habilitado. . . . .    : No</div></li><li class="li1"><div class="de1">        Lista de búsqueda de sufijo DNS:    local.lan</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Adaptador Ethernet Conexiones de red inalámbricas          :</div></li><li class="li1"><div class="de1">        Estado de los medios. . . .: medios desconectados</div></li><li class="li1"><div class="de1">        Descripción. . . . . . . . . . .  : Intel(R) PRO/Wireless 3945ABG Net Connection</div></li><li class="li1"><div class="de1">        Dirección física. . . . . . . . . : 00-31-02-44-9F-5A</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1">Adaptador Ethernet Conexión de área local          :</div></li><li class="li1"><div class="de1">        Sufijo de conexión específica DNS : local.lan</div></li><li class="li1"><div class="de1">        Descripción. . . . . . . . . . .  : Realtek RTL8168/8111 PCI-E Gigabit Ether NIC</div></li><li class="li1"><div class="de1">        Dirección física. . . . . . . . . : 00-21-32-80-23-7D</div></li><li class="li1"><div class="de1">        DHCP habilitado. . . . . . . . .  : No</div></li><li class="li1"><div class="de1">        Autoconfiguración habilitada. . . : Sí</div></li><li class="li1"><div class="de1">        Dirección IP. . . . . . . . . . . : 192.168.1.33</div></li><li class="li1"><div class="de1">        Máscara de subred . . . . . . . . : 255.255.255.0</div></li><li class="li1"><div class="de1">        Puerta de enlace predeterminada   : 192.168.1.1</div></li><li class="li1"><div class="de1">        Servidor DHCP . . . . . . . . . . : 192.168.1.1</div></li><li class="li1"><div class="de1">        Servidores DNS . . . . . . . . . .: 80.58.61.250</div></li><li class="li1"><div class="de1">                                            80.58.61.254</div></li><li class="li1"><div class="de1">        Concesión obtenida . . . . . . .  : jueves, 24 de septiembre de 2009 12:09:16</div></li><li class="li1"><div class="de1">        Concesión expira . . . . . . . . .: jueves, 24 de septiembre de 2009 13:09:16</div></li><li class="li1"><div class="de1">&nbsp;</div></li><li class="li1"><div class="de1"># Podem observar els servidors de noms DNS que s'utilitzen.</div></li></ol></pre>

<p>
La documentació de l’usuari pot incloure també referències a la documentació oficial del programari client que s’estigui utilitzant i enllaços web d’aquest programari.
</p>

</div>

	 </article>
     <div class="pnpage">
      <div class="left-corner"></div>
      <div id="prevpage">Anar a la p&agrave;gina anterior:<br /><a href="../../../WebContent/u1/a1/exercicis.html">Exercicis d'autoavaluació</a></div>
      <div id="nextpage">Anar a la p&agrave;gina seg&uuml;ent:<br /><a href="../../../WebContent/u1/a2/activitats.html">Activitats</a></div>
      <div class="right-corner"></div>
     </div>
    </div>
    <footer class="footer">
      <div><small>Aquest document està subjecte a una llicència oberta de Creative Commons, es reserva el dret de reconeixement de l'autoria, d'exigir que no se'n faci cap mena d'ús comercial. Si altereu o transformeu aquesta obra, o en genereu obres derivades, només podeu distribuir l'obra generada amb una llicència idèntica a aquesta.</small></div>
    </footer>
 </div>
 <div id="back_preview" class="hidden"></div>
 <div id="preview" class="hidden">
  <div class="prevcontent"></div>
 </div>
 <div id="help-tooltips">
  <div id="help-toc" class="hidden tooltip"><span>Taula de continguts:</span> Ofereix una vista general de l&#39;estructura del m&ograve;dul, que us facilitar&agrave; la navegaci&oacute; a trav&eacute;s dels seus continguts.<span class="arrow-left"></span></div> 
  <div id="help-settings" class="hidden tooltip"><span>Opcions de format:</span> Permet configurar el format de lectura a partir de les vostres prefer&egrave;ncies, modificant la mida de la lletra, el color del fons, l&#39;amplada de la p&agrave;gina o l&#39;ocultaci&oacute; dels continguts complementaris, entre d&#39;altres.<span class="arrow-left"></span></div>
  <div id="help-printer" class="hidden tooltip"><span>Imprimir:</span>  Envia el contingut seleccionat a la impressora.<span class="arrow-left"></span></div>
  <div id="help-favorites" class="hidden tooltip"><span>Prefereits:</span> Permet desar aquelles parts del contingut a les que us interessi accedir en un moment posterior; us permetr&agrave; anar creant un repositori personalitzat de les seccions que considereu m&eacute;s rellevants. Un cop l&#39;hageu començat a fer servir se us mostrar&agrave; a sota un comptador que us informar&agrave; del nombre de preferits que s&#39;hagin emmagatzemat fins al moment.<span class="arrow-left"></span></div>
  <div id="help-favcounter" class="hidden tooltip"><span>Comptador i llistat de preferits:</span> Indica el nombre de preferits que s&#39;han desat fins el moment; clicant damunt seu accedireu al llistat de preferits, i a trav&eacute;s d&#39;aquest podreu accedir directament als continguts que hageu emmagatzemat.<span class="arrow-left"></span></div>
  <div id="help-help_icon" class="hidden tooltip"><span>Ajuda:</span> Aquesta opci&oacute; activa la informaci&oacute; de les funcionalitats del web tot situant el punter del ratol&iacute; al damunt dels diferents &iacute;tems.<span class="arrow-left"></span></div>
  <div id="help-sidebar-hide" class="hidden tooltip"><span>Mostrar/Ocultar barra lateral:</span>  Deshabilita la barra d&#39;opcions, permetent la seva recuperaci&oacute; quan es desitgi.<span class="arrow-left"></span></div>
  <div id="help-search" class="hidden tooltip"><span>Cerca:</span>  Introdu&iuml;u les paraules clau sobre aquells conceptes que desitgeu localitzar en els continguts del m&ograve;dul. Tamb&eacute; podeu excloure un terme de la cerca tot afegint-hi el signe &#8220;-&#8221; al davant.<span class="arrow-top"></span></div>
  <div id="help-header" class="hidden tooltip"><span>Cap&ccedil;alera:</span>  Indica l&#39;apartat o secci&oacute; que es mostra en pantalla. Tingueu present que les capçaleres de segon, tercer i quart nivell tamb&eacute; es poden desar com a marcadors.<span class="arrow-left"></span></div>
</div> 
</body>
</html>
