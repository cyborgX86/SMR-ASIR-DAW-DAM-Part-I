<!doctype html>

<!--[if lt IE 7 ]> <html class="ie ie6 no-js" lang="ca"> <![endif]-->
<!--[if IE 7 ]>    <html class="ie ie7 no-js" lang="ca"> <![endif]-->
<!--[if IE 8 ]>    <html class="ie ie8 no-js" lang="ca"> <![endif]-->
<!--[if IE 9 ]>    <html class="ie ie9 no-js" lang="ca"> <![endif]-->
<!--[if gt IE 9]><!--><html class="no-js" lang="ca"><!--<![endif]-->
<!-- the "no-js" class is for Modernizr. -->

<head id="www-sitename-com" data-template-set="html5-reset">

	<meta charset="utf-8">
        <meta http-equiv="Content-Type" content="text/html">
        
	<!-- Always force latest IE rendering engine (even in intranet) & Chrome Frame -->
	<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
	
	<title>Xarxes d'àrea local</title>
	
<!-- <meta name="title" content=""> --> 
	<meta name="description" content="">
	<!-- Google will often use this as its description of your page/site. Make it good. -->
	
	<meta name="google-site-verification" content="">
	<!-- Speaking of Google, don't forget to set your site up: http://google.com/webmasters -->
	
	<meta name="author" content="Institut Obert de Catalunya">
	<meta name="Copyright" content="Copyright Institut Obert de Catalunya 2011. All Rights Reserved.">

	<!-- Dublin Core Metadata : http://dublincore.org/ -->
	<meta name="DC.title" content="Xarxes d'àrea local">
	<meta name="DC.subject" content="Informàtica i comunicacions">
	<meta name="DC.creator" content="Institut Obert de Catalunya">
	
	<!--  Mobile Viewport Fix
	j.mp/mobileviewport & davidbcalhoun.com/2010/viewport-metatag 
	device-width : Occupy full width of the screen in its current orientation
	initial-scale = 1.0 retains dimensions instead of zooming out if page height > device height
	maximum-scale = 1.0 retains dimensions instead of zooming in if page width < device width
	-->
	<!-- Uncomment to use � use thoughtfully!
	<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
	-->

	<link rel="shortcut icon" href="../../../img/favicon.ico">
	<!-- This is the traditional favicon.
		 - size: 16x16 or 32x32
		 - transparency is OK
		 - see wikipedia for info on browser support: http://mky.be/favicon/ -->
		 
	<link rel="apple-touch-icon" href="../../../img/apple-touch-icon.png">
	<!-- The is the icon for iOS's Web Clip.
		 - size: 57x57 for older iPhones, 72x72 for iPads, 114x114 for iPhone4's retina display (IMHO, just go ahead and use the biggest one)
		 - To prevent iOS from applying its styles to the icon name it thusly: apple-touch-icon-precomposed.png
		 - Transparency is not recommended (iOS will put a black BG behind the icon) -->
	
	<!-- CSS: screen, mobile & print are all in the same file -->
	<link rel="stylesheet" href="../../../_/css/style.css">

	<!-- CSS: jQuery UI -->
	<link rel="stylesheet" href="../../../_/css/jquery-ui.css">
	
	<!-- all our JS is at the bottom of the page, except for Modernizr. -->
	<script src="../../../_/js/modernizr-1.7.min.js"></script>
	<script src="../../../_/js/Hyphenator.js" type="text/javascript"></script>
	<script type="text/javascript">
	   Hyphenator.config({
		minwordlength : 4
	   });
	   Hyphenator.run();
	</script>
    <script src="../../../_/js/build.js" type="text/javascript"></script>
</head>

<body class="style-newspaper">

<div class="wrapper"><!-- not needed? up to you: http://camendesign.com/code/developpeurs_sans_frontieres -->

	<header id="header">
		<div class="head"><a href="http://ioc.gencat.cat"><img src="../../../img/logo.png" alt="Institut Obert de Catalunya"/></a><a href="http://creativecommons.org/licenses/by-nc-sa/3.0/es/deed.ca"><img src="../../../img/license.png" alt="Llic&egrave;ncia" class="license"/></a></div>
		<div class="headdocument"><a href="../../../index.html">Xarxes d'àrea local</a></div>
        <div id="search" class="search" name="search">
         <form id="frmsearch" action="../../../search.html" method="get">
          <input type="text" name="q"/>
        </form>
        </div>
	</header>
   <div id="upbutton" class="upbutton" style="display:none;"><img src="../../../img/uparrow.png" alt="Pujar a l'inici de p&agrave;gina"/></div>
   <aside id="aside">
    <div id="menu">
      <ul>
       <li name="toc"><div><img src="../../../img/toc.png" alt="&Iacute;ndex"/></div></li>
       <li name="settings"><div><img src="../../../img/settings.png" alt="Configuraci&oacute;"/></div></li>
       <li name="printer"><div><img src="../../../img/printer.png" alt="Imprimir"/></div></li>
       <li name="favorites"><div><img src="../../../img/favorites.png" alt="Favorits"/></div></li>
       <li name="help_icon" class="help_icon"><div><img src="../../../img/help_icon.png" alt="Ajuda"/></div></li>
      </ul>
     </div>
   </aside>
   <div id="sidebar-hide" name="sidebar-hide"><img src="../../../img/arrows.png"/></div>
   <section>
     <div id="toc" class="hidden">
      <div class="menucontent">
        <ul>
        <li id="u4" class="parentnode"><p><a class="unit" href="../../../WebContent/u4/introduccio.html">4. Configuració de dispositius de xarxes</a></p><ul class="expander"><li id="u4introduccio"><a href="../../../WebContent/u4/introduccio.html">Introducció</a></li><li id="u4objectius"><a href="../../../WebContent/u4/objectius.html">Resultats d'aprenentatge</a></li><li id="u4referencies"><a href="../../../WebContent/u4/referencies.html">Referències</a></li><li id="u4resum"><a href="../../../WebContent/u4/resum.html">Resum</a></li><li id="u4a1" class="tocsection"><p id='u4a1continguts'><a class="section" href="../../../WebContent/u4/a1/continguts.html">Configuració de commutadors</a><span class="buttonexp"></span></p><ul><li id="u4a1activitats"><a href="../../../WebContent/u4/a1/activitats.html">Activitats</a></li><li id="u4a1annexos"><a href="../../../WebContent/u4/a1/annexos.html">Annexos</a></li><li id="u4a1exercicis"><a href="../../../WebContent/u4/a1/exercicis.html">Exercicis d'autoavaluació</a></li></ul></li><div data-parent-id='u4a1' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u4/a1/continguts.html#funcionament_dels_commutadors">Funcionament dels commutadors</a></li><li><a href="../../../WebContent/u4/a1/continguts.html#configuracio_basica">Configuració bàsica</a></li><li><a href="../../../WebContent/u4/a1/continguts.html#definicio_i_configuracio_de_vlan">Definició i configuració de VLAN</a></li></ul></div></div><li id="u4a2" class="tocsection"><p id='u4a2continguts'><a class="section" href="../../../WebContent/u4/a2/continguts.html">Configuració d'encaminadors</a><span class="buttonexp"></span></p><ul><li id="u4a2activitats"><a href="../../../WebContent/u4/a2/activitats.html">Activitats</a></li><li id="u4a2exercicis"><a href="../../../WebContent/u4/a2/exercicis.html">Exercicis d'autoavaluació</a></li></ul></li><div data-parent-id='u4a2' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u4/a2/continguts.html#funcionament">Funcionament</a></li><li><a href="../../../WebContent/u4/a2/continguts.html#configuracio_basica">Configuració bàsica</a></li><li><a href="../../../WebContent/u4/a2/continguts.html#manteniment_i_configuracio_de_xarxes_amb_encaminadors">Manteniment i configuració de xarxes amb encaminadors</a></li></ul></div></div><li id="u4a3" class="tocsection"><p id='u4a3continguts'><a class="section" href="../../../WebContent/u4/a3/continguts.html">Xarxes sense fil: conceptes bàsics i configuració</a><span class="buttonexp"></span></p><ul><li id="u4a3activitats"><a href="../../../WebContent/u4/a3/activitats.html">Activitats</a></li><li id="u4a3exercicis"><a href="../../../WebContent/u4/a3/exercicis.html">Exercicis d'autoavaluació</a></li></ul></li><div data-parent-id='u4a3' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u4/a3/continguts.html#les_xarxes_locals_sense_fil">Les xarxes locals sense fil</a></li><li><a href="../../../WebContent/u4/a3/continguts.html#seguretat">Seguretat</a></li><li><a href="../../../WebContent/u4/a3/continguts.html#instal_lacio_i_configuracio_d_un_punt_d_acces_sense_fil">Instal·lació i configuració d'un punt d'accés sense fil</a></li><li><a href="../../../WebContent/u4/a3/continguts.html#resolucio_de_problemes">Resolució de problemes</a></li></ul></div></div><li id="u4a4" class="tocsection"><p id='u4a4continguts'><a class="section" href="../../../WebContent/u4/a4/continguts.html">Documentació dels procediments de configuració</a><span class="buttonexp"></span></p><ul><li id="u4a4activitats"><a href="../../../WebContent/u4/a4/activitats.html">Activitats</a></li></ul></li><div data-parent-id='u4a4' class='tocssection hidden'><div class="toc"><ul><li><a href="../../../WebContent/u4/a4/continguts.html#fases_preliminars_per_la_configuracio_d_una_xarxa">Fases preliminars per la configuració d'una xarxa</a></li><li><a href="../../../WebContent/u4/a4/continguts.html#fases_de_la_configuracio">Fases de la configuració</a></li><li><a href="../../../WebContent/u4/a4/continguts.html#documents_de_la_configuracio_d_una_xarxa">Documents de la configuració d'una xarxa</a></li><li><a href="../../../WebContent/u4/a4/continguts.html#planificacio_estructurada_del_cablatge">Planificació estructurada del cablatge</a></li><li><a href="../../../WebContent/u4/a4/continguts.html#estructura_del_sistema_de_cablatge_horitzontal">Estructura del sistema de cablatge horitzontal</a></li><li><a href="../../../WebContent/u4/a4/continguts.html#subministrament_electric_de_la_xarxa">Subministrament elèctric de la xarxa</a></li><li><a href="../../../WebContent/u4/a4/continguts.html#documentant_la_xarxa">Documentant la xarxa</a></li></ul></div></div></ul></li><li id="" class="indexnode"><p><a href="../../../index.html">Anar a l&#39;&iacute;ndex general</a></p></li>
        </ul>
      </div>
    </div>
   </section>
   <section>
   <div id="settings" class="hidden">
    <div class="menucontent">
     <div class="allsettings">
     <div class="settings">
      <label>Font i Color</label>
		<div class="setting-option">
	        <ul class="fontBackground">
				<li id="style-newspaper" title="Newspaper" class="appearance-style-newspaper"><span>Newspaper</span></li>
                <li id="style-novel" title="Novel" class="appearance-style-novel"><span>Novel</span></li>
                <li id="style-ebook" title="eBook" class="appearance-style-ebook"><span>eBook</span></li>
				<li id="style-inverse" title="Inverse" class="appearance-style-inverse active"><span>Inverse</span></li>
				<li id="style-athelas" title="Athelas" class="appearance-style-athelas"><span>Athelas</span></li>
			</ul>
		</div>
     </div>
	<div class="settings">
      <label>Amplada</label>
		<div class="setting-option">
	        <div id="slider-width"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
		<div class="setting-option">
	        <div id="slider-font"></div>
		</div>
     </div>
     <div class="settings">
      <label>Mida de la font</label>
	  <div class="setting-option">
       <form action="" class="sett-options">
		<ul>
		    <li><input type="checkbox" id="secondary-content" /><label for="secondary-content">Mostra recursos complementaris</label></li>
		    <li><input type="checkbox" id="main-images" /><label for="main-images">Mostra imatges</label></li>
		    <li><input type="checkbox" id="text-alignment" /><label for="text-alignment">Text justificat</label></li>
			<li><input type="checkbox" id="text-hyphen" /><label for="text-hyphen">Partici&oacute; sil·l&agrave;bica</label></li>
		</ul>
       </form>
	  </div>
     </div>
     </div>
    </div>
   </div>
   </section>
 <section>
 <div id="favorites" class="hidden"></div>
 </section>   
 <div id="bridge" class="hidden"></div>
 <div id="help" class="hidden">
  <div class="helptitle">Dreceres del teclat<hr></div>
  <div class="helpsection"><span>General</span>
   <ul>
    <li><span class="shortcut">g</span>: Anar al men&uacute; de navegaci&oacute;</li>
    <li><span class="shortcut">o</span>: Anar a opcions</li>
    <li><span class="shortcut">s</span>: Guardar la p&agrave;gina actual a favorits</li>
    <li><span class="shortcut">p</span>: Imprimir la p&agrave;gina actual</li>
    <li><span class="shortcut">?</span>: Mostrar/Ocultar l&#39;ajuda</li>
   </ul>
  </div>
  <div class="helpsection"><span>Navegaci&oacute;</span>
   <ul>
    <li><span class="shortcut">i</span>: Anar a l&#39;&iacute;ndex general</li>
    <li><span class="shortcut">t</span>: Anar a l&#39;inici de p&agrave;gina</li>
    <li><span class="shortcut">b</span>: Anar al final de p&agrave;gina</li>
    <li><span class="shortcut">j</span>: Anar cap endavant dintre la p&agrave;gina</li>
    <li><span class="shortcut">k</span>: Anar cap enrere dintre la p&agrave;gina</li>
    <li><span class="shortcut">h</span>: Anar a la p&agrave;gina anterior:</li>
    <li><span class="shortcut">l</span>: Anar a la p&agrave;gina seg&uuml;ent:</li>
   </ul>
   </div>
 </div>
 <div id="favcounter" name="favcounter" class="hidden"><span></span></div>
 <div id="navmenu" class="navmenu"><ul class="webnav"><li><a href="../../../index.html" title="Anar a l&#39;&iacute;ndex general">Inici</a></li><li><a href="../introduccio.html">Configuració de dispositius de xarxes</a></li><li>Configuració d'encaminadors</li></ul></div>
	<div id="content" lang="ca" class="hyphenate text">
     <article lang="ca" class="sheet">
        <h1><a id="configuracio_d_encaminadors"> Configuració d'encaminadors </a></h1>
    	
<p>
<div class="iocfigurec">
<ul>
<li>
<img src="../media/ic10m5u4_54.png" class="imgB" title="Imatge que representa un encaminador./6" alt="Imatge que representa un encaminador./6" /></li><li><small>Imatge que representa un encaminador.</small></li>
</ul></div>

</p>

<p>
Un encaminador és un dispositiu que interconnecta diferents xarxes i permet la connexió entre elles i té assignada una adreça IP per cada port connectat a una xarxa. Quan un paquet arriba a un encaminador, aquest comprova l’adreça final del paquet i el transmet per la xarxa més adient segons la destinació. Aquesta tasca és el que li dóna nom, encaminador: dóna un camí o ruta al paquet perquè aquest arribi a la destinació.
</p>

<h2><a id="funcionament" >Funcionament</a></h2>
<div class="level2">

<p>
Un encaminador no és res més que un ordinador dedicat a una única tasca, realitzar l’encaminament de paquets de la millor manera i de la manera més ràpida possible per les diferents interfícies (cada paquet per la interfície més adient). Per realitzar totes aquestes tasques, un encaminador -com un ordinador normal- té una arquitectura interna (vegeu la <span class="figref"><a href="#Figure49"><span>figura</span></a></span>) que cal conèixer.
</p>
<div class="iocfigure"><a name="Figure49"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Arquitectura interna d’un encaminador

</figcaption><img src="../media/ic10m5u4_55.png" alt="" /></figure>
</div>
<p>
Internament, un encaminador consta dels elements següents:
</p>
<div class="iocnote"><div class="ioccontent">
<p>
ROM (<em>read only memory</em>) és una memòria només de lectura que no es pot esborrar ni gravar. Només la pot gravar el fabricant.
</p>
</div></div><ul>
<li class="level1"><div class="li"> <strong>Memòria RAM</strong>: és on emmagatzemen les taules d’encaminament i on hi ha les cues de paquets mentre aquests no han estat enviats per la interfície adequada. A més, com en la memòria RAM de qualsevol ordinador, si hi ha un tall de corrent tot el que hi ha emmagatzemat s’esborra. També s’hi poden trobar els arxius de configuració mentre es treballa amb ells.</div>
</li>
<li class="level1"><div class="li"> <strong>Memòria NVRAM</strong>: aquesta memòria emmagatzema la còpia dels arxius de configuració i inici de l’encaminador. El contingut d’aquesta memòria no s’esborra si hi ha un tall del subministrament elèctric.</div>
</li>
<li class="level1"><div class="li"> <strong>Flaix (<em>flash</em>)</strong>: és la ROM esborrable i reconfigurable que conté la imatge i el microcodi del sistema operatiu. No cal oblidar que un encaminador és un ordinador i com a tal necessita un sistema operatiu per funcionar. Fa les mateixes funcions que faria en un ordinador un “mini disc dur” que només contingués el sistema operatiu utilitzat per arrencar.</div>
</li>
<li class="level1"><div class="li"> <strong>ROM</strong>: conté el diagnòstic d’engegada del sistema i programari del sistema operatiu. Per actualitzar el contingut de la ROM, cal extreure el circuit integrat de l’encaminador i substituir-lo per un de nou.</div>
</li>
<li class="level1"><div class="li"> <strong>Interfícies</strong>: són les connexions de xarxa per on entren i per on s’envien els paquets cap a les diferents xarxes.</div>
</li>
</ul>

<p>
Com s’ha comentat, la funció principal d’un encaminador és interconnectar diferents xarxes per l’encaminament de paquets.
</p>

<p>
Com es pot observar en la <span class="figref"><a href="#Figure50"><span>figura</span></a></span>, l’encaminador 1 connecta la xarxa <code>86.34.100.0</code> amb els encaminadors 2 i 3. Gràcies a aquests encaminadors, un ordinador que està connectat a la xarxa <code>86.34.100.0</code> pot enviar informació a màquines connectades a les xarxes <code>69.12.128.0</code> o <code>25.34.250.0</code>, és a dir, es pot enviar a qualsevol màquina.
</p>

<p>
Perquè un encaminador pugi fer la seva feina eficientment, disposa internament d’una taula amb les xarxes que té connectades directament o indirectament a cada port. S’anomena <em>taula d’encaminament</em>. Aquesta taula es van actualitzant gràcies al protocol ICMP, que envia informació d’encaminador a encaminador per conèixer l’estat de la xarxa i, per tant, saber en tot moment la ruta més adient per enviar els paquets.
</p>

<p>
Així doncs, perquè l’encaminador 1 pugi transmetre informació a una màquina connectada a la xarxa <code>121.23.200.0</code>, ha de tenir a la seva taula d’encaminament que per arribar a aquesta xarxa ha d’enviar el paquet cap a l’encaminador 2, i si vol enviar informació a una màquina connectada a la xarxa <code>69.12.128.0</code>, ha d’enviar la informació cap a l’encaminador 3.
</p>
<div class="iocfigure"><a name="Figure50"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Interconnexió d’encaminadors

</figcaption><img src="../media/ic10m5u4_56.png" alt="" /></figure>
</div>
<p>
Un exemple del contingut de les taules d’encaminament dels tres encaminadors de la <span class="figref"><a href="#Figure50"><span>figura</span></a></span> les podeu veure a la <span class="tabref"><a href="#Table2"><span>taula</span></a></span>, <span class="tabref"><a href="#Table3"><span>taula</span></a></span> i <span class="tabref"><a href="#Table4"><span>taula</span></a></span>, respectivament.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Xarxa = destinació del paquet 
Interfície = port de sortida 
Mètrica = nombre de salts necessaris per arribar a la xarxa.
</p>
</div></div><div class="ioctable ">
<div class="titletable"><a name="Table2"><span>Taula: </span></a>Taula d’encaminament de l’encaminador 1</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Xarxa                                 </th><th class="col1 leftalign"> Interfície      </th><th class="col2"> Mètrica </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> <code>86.34.100.0</code>                       </td><td class="col1"> Ethernet 1 (E1) </td><td class="col2 leftalign"> 0       </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <code>198.20.30.0</code>                       </td><td class="col1 leftalign"> Sèrie 1 (s1)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> <code>69.12.128.0</code>                       </td><td class="col1 leftalign"> Sèrie 1 (s1)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> <code>121.23.200.0</code>                      </td><td class="col1 leftalign"> Sèrie 0 (s0)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> <code>25.34.250.0</code>                       </td><td class="col1 leftalign"> Sèrie 0 (s0)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row6">
		<td class="col0"> Xarxa d’encaminador 1 a encaminador 2 </td><td class="col1 leftalign"> Sèrie 0 (s0)    </td><td class="col2 leftalign"> 0       </td>
	</tr>
	<tr class="row7">
		<td class="col0"> Xarxa d’encaminador 1 a encaminador 3 </td><td class="col1 leftalign"> Sèrie 1 (s1)    </td><td class="col2 leftalign"> 0       </td>
	</tr>
</table></div>
</div>
<p>
El primer camp d’aquesta taula indica la xarxa de destinació a la qual es pot accedir, el segon mostra per quina interfície s’ha d’enviar el paquet per arribar a la xarxa indicada pel primer camp i, finalment, el tercer indica quants salts s’han de fer per arribar a la xarxa de destinació, és a dir, per quants encaminadors s’ha de passar per arribar a la xarxa de destinació.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table3"><span>Taula: </span></a>Taula d’encaminament de l’encaminador 2</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Xarxa                                 </th><th class="col1 leftalign"> Interfície      </th><th class="col2"> Mètrica </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> <code>86.34.100.0</code>                       </td><td class="col1 leftalign"> Sèrie 1 (s1)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <code>198.20.30.0</code>                       </td><td class="col1 leftalign"> Sèrie 0 (s0)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> <code>69.12.128.0</code>                       </td><td class="col1 leftalign"> Sèrie 0 (s0)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> <code>121.23.200.0</code>                      </td><td class="col1"> Ethernet 1 (E1) </td><td class="col2 leftalign"> 0       </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> <code>25.34.250.0</code>                       </td><td class="col1"> Ethernet 2 (E2) </td><td class="col2 leftalign"> 0       </td>
	</tr>
	<tr class="row6">
		<td class="col0"> Xarxa d’encaminador 2 a encaminador 1 </td><td class="col1 leftalign"> Sèrie 1 (s1)    </td><td class="col2 leftalign"> 0       </td>
	</tr>
	<tr class="row7">
		<td class="col0"> Xarxa d’encaminador 2 a encaminador 3 </td><td class="col1 leftalign"> Sèrie 0 (s0)    </td><td class="col2 leftalign"> 0       </td>
	</tr>
</table></div>
</div><div class="ioctable ">
<div class="titletable"><a name="Table4"><span>Taula: </span></a>Taula d’encaminament de l’encaminador 3</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Xarxa                                 </th><th class="col1 leftalign"> Interfície      </th><th class="col2"> Mètrica </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> <code>86.34.100.0</code>                       </td><td class="col1 leftalign"> Sèrie 0 (s0)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <code>198.20.30.0</code>                       </td><td class="col1"> Ethernet 1 (E1) </td><td class="col2 leftalign"> 0       </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> <code>69.12.128.0</code>                       </td><td class="col1"> Ethernet 2 (E2) </td><td class="col2 leftalign"> 0       </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> <code>121.23.200.0</code>                      </td><td class="col1 leftalign"> Sèrie 1 (s1)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> <code>25.34.250.0</code>                       </td><td class="col1 leftalign"> Sèrie 1 (s1)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row6">
		<td class="col0"> Xarxa d’encaminador 3 a encaminador 1 </td><td class="col1 leftalign"> Sèrie 0 (s0)    </td><td class="col2 leftalign"> 0       </td>
	</tr>
	<tr class="row7">
		<td class="col0"> Xarxa d’encaminador 3 a encaminador 2 </td><td class="col1 leftalign"> Sèrie 1 (s1)    </td><td class="col2 leftalign"> 0       </td>
	</tr>
</table></div>
</div>
<p>

</p>

<p>
Com s’ha comentat, aquestes taules es mantenen actualitzades perquè els encaminadors s’intercanvien constantment paquets d’informació de l’estat de les xarxes. Si per qualsevol motiu hi hagués una fallada a la xarxa i, per exemple, es tallés una connexió entre un encaminador i un altre (com es pot veure en la <span class="figref"><a href="#Figure51"><span>figura</span></a></span>), aquestes taules s’haurien de modificar adientment.
</p>

<p>
En la <span class="figref"><a href="#Figure51"><span>figura</span></a></span> es pot observar que la connexió que hi havia entre l’encaminador 1 -per la interfície de sèrie 1 (s1)- i l’encaminador 3 -per la interfície de sèrie 0 (s0)- ha fallat. Això provoca que els paquets que s’envien per aquesta interfície es destrueixin, però també que es generi un paquet ICMP que indica la pèrdua d’aquesta connexió. Les taules s’han de modificar perquè es deixin de perdre paquets. Així doncs, les taules es modifiquen com es mostra en la <span class="tabref"><a href="#Table5"><span>taula</span></a></span>.
</p>
<div class="iocfigure"><a name="Figure51"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Xarxa amb una connexió tallada 

</figcaption><img src="../media/ic10m5u4_57.png" alt="" /></figure>
</div><div class="ioctable ">
<div class="titletable"><a name="Table5"><span>Taula: </span></a>Taula d’encaminament de l’encaminador 1 (sense la connexió a l’encaminador 3)</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Xarxa                                 </th><th class="col1 leftalign"> Interfície      </th><th class="col2"> Mètrica </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> <code>86.34.100.0</code>                       </td><td class="col1"> Ethernet 1 (E1) </td><td class="col2 leftalign"> 0       </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <code>198.20.30.0</code>                       </td><td class="col1 leftalign"> Sèrie 0 (s0)    </td><td class="col2 leftalign"> 2       </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> <code>69.12.128.0</code>                       </td><td class="col1 leftalign"> Sèrie 0 (s0)    </td><td class="col2 leftalign"> 2       </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> <code>121.23.200.0</code>                      </td><td class="col1 leftalign"> Sèrie 0 (s0)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> <code>25.34.250.0</code>                       </td><td class="col1 leftalign"> Sèrie 0 (s0)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row6">
		<td class="col0"> Xarxa d’encaminador 1 a encaminador 2 </td><td class="col1 leftalign"> Sèrie 0 (s0)    </td><td class="col2 leftalign"> 0       </td>
	</tr>
	<tr class="row7">
		<td class="col0"> Xarxa d’encaminador 1 a encaminador 3 </td><td class="col1 leftalign"> *               </td><td class="col2 leftalign"> *       </td>
	</tr>
</table></div>
</div>
<p>
La mètrica de dues xarxes de destinació ha variat, ja que ara no tenen un camí directe. Les sortides que es realitzaven per la interfície sèrie 1 ara es faran per la sèrie 0, però amb una mètrica més alta -és a dir, necessitaran més salts per arribar a la destinació.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table6"><span>Taula: </span></a>Taula d’encaminament de l’encaminador 2</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Xarxa                                 </th><th class="col1 leftalign"> Interfície      </th><th class="col2"> Mètrica </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> <code>86.34.100.0</code>                       </td><td class="col1 leftalign"> Sèrie 1 (s1)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <code>198.20.30.0</code>                       </td><td class="col1 leftalign"> Sèrie 0 (s0)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> <code>69.12.128.0</code>                       </td><td class="col1 leftalign"> Sèrie 0 (s0)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> <code>121.23.200.0</code>                      </td><td class="col1"> Ethernet 1 (E1) </td><td class="col2 leftalign"> 0       </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> <code>25.34.250.0</code>                       </td><td class="col1"> Ethernet 2 (E2) </td><td class="col2 leftalign"> 0       </td>
	</tr>
	<tr class="row6">
		<td class="col0"> Xarxa d’encaminador 2 a encaminador 1 </td><td class="col1 leftalign"> Sèrie 1 (s1)    </td><td class="col2 leftalign"> 0       </td>
	</tr>
	<tr class="row7">
		<td class="col0"> Xarxa d’encaminador 2 a encaminador 3 </td><td class="col1 leftalign"> Sèrie 0 (s0)    </td><td class="col2 leftalign"> 0       </td>
	</tr>
</table></div>
</div>
<p>
Aquesta taula no varia perquè la connexió que ha fallat és la que hi connectava directament els encaminadors 1 i 3.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table7"><span>Taula: </span></a>Taula d’encaminament de l’encaminador 3 (sense la connexió a l’encaminador 1)</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Xarxa                                 </th><th class="col1 leftalign"> Interfície      </th><th class="col2"> Mètrica </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> <code>86.34.100.0</code>                       </td><td class="col1 leftalign"> Sèrie 1 (s1)    </td><td class="col2 leftalign"> 2       </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <code>198.20.30.0</code>                       </td><td class="col1"> Ethernet 1 (E1) </td><td class="col2 leftalign"> 0       </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> <code>69.12.128.0</code>                       </td><td class="col1"> Ethernet 2 (E2) </td><td class="col2 leftalign"> 0       </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> <code>121.23.200.0</code>                      </td><td class="col1 leftalign"> Sèrie 1 (s1)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> <code>25.34.250.0</code>                       </td><td class="col1 leftalign"> Sèrie 1 (s1)    </td><td class="col2 leftalign"> 1       </td>
	</tr>
	<tr class="row6">
		<td class="col0"> Xarxa d’encaminador 3 a encaminador 1 </td><td class="col1 leftalign"> *               </td><td class="col2 leftalign"> *       </td>
	</tr>
	<tr class="row7">
		<td class="col0"> Xarxa d’encaminador 3 a encaminador 2 </td><td class="col1 leftalign"> Sèrie 1 (s1)    </td><td class="col2 leftalign"> 0       </td>
	</tr>
</table></div>
</div>
<p>
En aquest cas, passa el mateix que en l’exemple de l’encaminador 1: els paquets que abans s’enviaven per la interfície sèrie 0 ara s’envien per la interfície sèrie 1 amb una mètrica més alta. Com podeu observar, la xarxa entre l’encaminador 3 i 1 no apareix, ja que és la xarxa que ha fallat i, per tant, no s’hi pot arribar de cap manera.
</p>

<p>
El fet que un encaminador connecti amb diferents xarxes per l’encaminament dels paquets transmesos per les xarxes fa que aquest element hagi de tenir una configuració correcta. Així doncs, per al funcionament correcte dels encaminadors, s’han de configurar correctament.
</p>

</div>

<h2><a id="configuracio_basica" >Configuració bàsica</a></h2>
<div class="level2">

<p>
Perquè un encaminador funcioni correctament, cal configurar-lo: s’ha de connectar a un ordinador, ja que un encaminador no té teclat ni monitor per veure què és el que s’hi fa.
</p>

<p>
L’encaminador i la màquina es connectaran amb un cable de sèrie especial, ja que en una punta hi ha un connector <strong>RJ-45</strong> i a l’altra hi ha un connector <strong>SUB-D DB9</strong> -que és el que es connecta al port <strong>COM</strong>. El connector RJ-45 es connecta a la part del darrere de l’encaminador i el connector <strong>DB9</strong> es connecta al port COM 1 de l’ordinador.
</p>

<p>
Per comunicar-se amb l’encaminador, s’utilitza l’aplicació de l’Hyperterminal (<span class="figref"><a href="#Figure52"><span>figura</span></a></span>) en cas que es faci servir un sistema operatiu Windows. O el gtkterm si el sistema operatiu és Linux.
</p>
<div class="iocfigure"><a name="Figure52"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Hyperterminal

</figcaption><img src="../media/ic10m5u4_58.png" alt="" /></figure>
</div>
<p>
Un cop escollit el nom que es donarà a la connexió, cal indicar per quin connector es farà la connexió; normalment s’utilitza el COM 1 (<span class="figref"><a href="#Figure53"><span>figura</span></a></span>).
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Les versions d’MS-Windows posteriors a XP ja no incorporen l’aplicació Hyperterminal. Podeu utilitzar al seu lloc l’aplicació PuTTY (<a href="http://www.putty.org/" class="urlextern" title="http://www.putty.org/"  rel="nofollow">http://www.putty.org/</a>). Els paràmetres de la connexió seran els mateixos.
</p>
</div></div><div class="iocfigure"><a name="Figure53"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Elecció de la interfície

</figcaption><img src="../media/ic10m5u4_59.png" alt="" /></figure>
</div>
<p>
Un cop s’ha indicat a quin connector està connectat l’encaminador, s’ha de configurar la connexió (<span class="figref"><a href="#Figure54"><span>figura</span></a></span>).
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Elecció de la interfície</p>
<p>
Normalment l’encaminador es connecta al port COM 1 de l’ordinador. Si no s’ha connectat a aquest port, només cal indicar a quin port s’ha fet.
</p>
</div></div><div class="iocfigure"><a name="Figure54"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Configuració de l’Hyperterminal

</figcaption><img src="../media/ic10m5u4_60.png" alt="" /></figure>
</div>
<p>
Aquesta connexió normalment es fa a una velocitat de 9600 bps amb una transmissió de 8 bits de dades sense paritat i 1 bit d’aturada.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">La configuració...</p>
<p>
…que accepten els encaminadors per poder fer la connexió de configuració és la que es mostra en aquesta figura. Si aquesta varia, l’encaminador no serà capaç de conversar amb la màquina connectada.
</p>
</div></div>
<p>
Si el sistema operatiu que s’utilitza és el Linux, l’aplicació necessària per a la comunicació amb l’encaminador es diu <em>gtkterm</em> (<span class="figref"><a href="#Figure55"><span>figura</span></a></span>). Si no es realitza utilitzant aquesta configuració, és molt probable que no es pugui establir la connexió i, per tant, no podreu configurar l’encaminador.
</p>
<div class="iocfigure"><a name="Figure55"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Pantalla gtkterm

</figcaption><img src="../media/ic10m5u4_61.png" alt="" /></figure>
</div>
<p>
Per configurar-la s’ha d’anar a Configuració i seleccionar Port del menú desplegable. Un cop seleccionat, s’obrirà la finestra de configuració com es mostra a la <span class="figref"><a href="#Figure56"><span>figura</span></a></span>.
</p>
<div class="iocfigure"><a name="Figure56"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Configuració de l’aplicació gtkterm

</figcaption><img src="../media/ic10m5u4_62.png" alt="" /></figure>
</div>
<p>
Cal recordar que la interfície COM 0 en Linux és el port /dev/ttyS0. La resta de configuracions són les mateixes que per al programa Hyperterminal de Windows.
</p>

<p>
Un cop feta aquesta configuració, ja es pot establir la connexió amb l’encaminador i configurar tot allò que faci falta. Per a fer les configuracions necessàries, disposareu d’un simulador d’encaminador perquè d’aquesta manera no hàgiu de tocar el vostre, no fos cas que després no us poguéssiu connectar a Internet a causa que hàgiu configurat alguna cosa malament.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Com que utilitzarem un simulador de xarxes per realitzar les configuracions, no serà imprescindible utilitzar el programa HyperTerminal ni cap de similar. No obstant això, és molt recomanable almenys llegir el que s’ha indicat d’aquests programes per saber com funcionen. Són els que caldrà utilitzar a la realitat.
</p>
</div></div>
<p>
Amb el simulador de Cisco la primera pantalla que veureu serà la que es mostra a la <span class="figref"><a href="#Figure201"><span>figura</span></a></span>.
</p>
<div class="iocfigure"><a name="Figure201"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Pantalla inicial del simulador Packet Tracer de Cisco Systems 

</figcaption><img src="../media/ic10m5u4_201.png" alt="" /></figure>
</div>
<p>
Per afegir dispositius a la xarxa que simulem cal fer els següents clics:
</p>
<ol>
<li class="level1"><div class="li"> Al tipus de dispositiu que volem situar (part inferior esquerra de la finestra).</div>
</li>
<li class="level1"><div class="li"> Al dispositiu concret que volem afegir (part inferior esquerra de la finestra).</div>
</li>
<li class="level1"><div class="li"> Al lloc on el volem posar (requadre blanc gran).</div>
</li>
</ol>

<p>
A la figura <span class="figref"><a href="#Figure203"><span>figura</span></a></span> es mostren aquestes zones.
</p>
<div class="iocfigure"><a name="Figure203"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Passos per afegir un dispositiu a la xarxa simulada

</figcaption><img src="../media/ic10m5u4_203.png" alt="" /></figure>
</div>
<p>
Per connectar dispositius de la xarxa que simulem cal fer els següents clics:
</p>
<ol>
<li class="level1"><div class="li"> A la icona <em>raig</em> (part inferior esquerra de la finestra).</div>
</li>
<li class="level1"><div class="li"> Al tipus de cable que utilitzarem (part inferior esquerra de la finestra).</div>
</li>
<li class="level1"><div class="li"> Al primer dispositiu a connectar (dins del requadre blanc gran). Surt un desplegable per triar la interfície associada al cable.</div>
</li>
<li class="level1"><div class="li"> Al segon dispositiu a connectar (exactament igual que al pas anterior).</div>
</li>
</ol>

<p>
A la figura <span class="figref"><a href="#Figure204"><span>figura</span></a></span> es mostra on cal fer aquests clics per unir dos commutadors.
</p>
<div class="iocfigure"><a name="Figure204"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Passos per afegir un dispositiu a la xarxa simulada

</figcaption><img src="../media/ic10m5u4_204.png" alt="" /></figure>
</div>
<p>
Amb aquest simulador, quan feu clic a sobre d’un dispositiu i, a la finestra que apareix, seleccioneu la pestanya CLI, veureu una pantalla com la de la <span class="figref"><a href="#Figure213"><span>figura</span></a></span>, que seria la mateixa que veuríeu si empréssiu les aplicacions Hyperterminal i gtkterm per configurar un commutador físicament.
</p>
<div class="iocfigure"><a name="Figure213"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Pantalla inicial de configuració d’un encaminador

</figcaption><img src="../media/ic10m5u4_213.png" alt="" /></figure>
</div>
<p>
Cal respondre que no a la pregunta que ens fan (“Continue with configuration dialog?”) i, després, picar un enter. Ens apareixerà l’indicador del sistema (Router&gt;) que ens indica que podem introduir ordres.
</p>

<p>
Abans de començar, cal saber un parell de coses. En primer lloc, hi ha diversos modes de treballar amb un encaminador:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Mode d’usuari</strong>: quan treballeu en mode d’usuari tindreu un accés limitat a l’encaminador. Per saber que esteu en mode d’usuari, heu de mirar l’indicador: si l’aspecte és <strong>Router&gt;</strong>, voldrà dir que esteu en mode d’usuari.</div>
</li>
<li class="level1"><div class="li"> <strong>Mode privilegiat</strong>: en aquest mode tindreu un accés més ampli a l’encaminador. Així doncs, des d’aquest mode podreu fer una anàlisi detallada de l’estat de l’encaminador i podreu manipular els arxius de configuració. Per saber que esteu en mode privilegiat, també heu de mirar l’indicador: en aquest cas l’indicador ha de tenir la forma <strong>Router#</strong>, on Router és el nom que s’ha donat a l’encaminador.</div>
</li>
<li class="level1"><div class="li"> <strong>Mode de configuració global</strong>: des d’aquest mode podeu utilitzar ordres de configuració simples. Per saber que esteu en aquest mode, l’aspecte de l’indicador és <strong>Router(config)#</strong>.</div>
</li>
<li class="level1"><div class="li"> <strong>Altres modes de configuració</strong>: aquest mode permet configuracions més detallades. Per saber que esteu en aquest mode, també heu d’observar l’indicador: en aquest cas, tindrà un aspecte similar a <strong>Router(config - mode)#</strong>, on el mode indica quina configuració realitza.</div>
</li>
<li class="level1"><div class="li"> <strong>Router(config - if)#</strong> configuració d’una interfície</div>
</li>
<li class="level1"><div class="li"> <strong>Router(config - subif)#</strong> configuració de subinterfícies lògiques d’una interfície física</div>
</li>
<li class="level1"><div class="li"> <strong>Router(config - line)#</strong> configuració d’una línia de terminal</div>
</li>
<li class="level1"><div class="li"> <strong>Router(config - controller)#</strong> configuració d’una controladora</div>
</li>
<li class="level1"><div class="li"> <strong>Router(config - router)#</strong> configuració de protocols d’encaminament</div>
</li>
</ul>

<p>
Tingueu en compte que treballant amb els diferents modes és quan tindreu més problemes, ja que intentareu configurar alguna cosa des d’un mode equivocat amb les ordres correctes i no trobareu on és l’error.
</p>

<p>
Un cop sabem ja els modes de treball, provarem diferents ordres. Entreu al simulador i en mode d’usuari mireu la informació de la versió del sistema operatiu amb l’ordre <strong>show version</strong> (<span class="figref"><a href="#Figure59"><span>figura</span></a></span>).
</p>
<div class="iocfigure"><a name="Figure59"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Pantalla show version

</figcaption><img src="../media/ic10m5u4_214.png" alt="" /></figure>
</div>
<p>
Hi ha una sèrie d’ordres que es poden utilitzar en mode d’usuari però que no varien la configuració de l’encaminador, ja que un encaminador només es pot configurar en mode de configuració de terminal.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Show version</p>
<p>
Aquesta ordre s’utilitza en mode d’usuari i mostra tota la informació referent al sistema operatiu com la versió, la quantitat, tipus d’interfícies de l’encaminador, etc.
</p>
</div></div>
<p>
A més, per poder comprovar les configuracions cal estar en mode privilegiat, ja que en aquest mode es té un control més gran de tota la informació de l’estat de l’encaminador: es pot comprovar l’estat de totes les interfícies, comprovar la configuració i protocols només d’una interfície, examinar els protocols utilitzats per l’encaminador, etc.
</p>

<p>
Per configurar l’encaminador, cal estar en mode de configuració global. A partir d’aquest mode es pot començar la configuració entre els altres modes per configurar pas a pas l’encaminador. Si es volen configurar les interfícies, cal entrar en mode de configuració d’interfície, etc.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">enable</p>
<p>
Amb l’ordre enable, es passa de mode d’usuari a mode privilegiat, mode des d’on es comprovaran les configuracions de l’encaminador.
</p>
</div></div>
<p>
Per poder fer les comprovacions de l’estat de les interfícies, en primer lloc s’ha de configurar l’encaminador. Per aconseguir configurar-lo cal passar a mode privilegiat executant l’ordre <strong>enable</strong>. Per tornar a mode d’usuari, l’ordre serà <strong>disable</strong> o <strong>exit</strong>. Executeu, doncs, l’ordre <strong>enable</strong> (<span class="figref"><a href="#Figure60"><span>figura</span></a></span>).
</p>
<div class="iocfigure"><a name="Figure60"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Ordre enable

</figcaption><img src="../media/ic10m5u4_215.png" alt="" /></figure>
</div>
<p>
Com podeu comprovar, l’indicador ha canviat de <strong>Router&gt;</strong> a <strong>Router#</strong>. Aquest fet indica que el pas d’un mode a l’altre s’ha realitzat correctament.
</p>

<p>
Abans de començar la nova configuració de l’encaminador, s’ha de comprovar la configuració actual de les connexions mitjançant l’ordre <strong>show running- config</strong>: per exemple, s’ha de veure si ja tenen una configuració, si estan activades o no. Si utilitzeu el simulador d’encaminador, com que encara no s’ha configurat res, ens indicarà que cap interfície no té adreça IP i que estan en l’estat de caigudes (o <em>shutdown</em>), és a dir, que no poden rebre ni enviar.
</p>

<p>
Quan executeu aquesta ordre, us apareixerà el nombre d’interfícies de què disposa aquest encaminador. Comprovareu que té diferents interfícies de sèrie i diverses d’Ethernet: les primeres són les que s’utilitzen per connectar un encaminador amb l’altre, mentre que les segones són les que connecten amb les diferents xarxes d’ordinadors.
</p>

<p>
També us apareixerà altra informació que haureu de tenir en compte com pot ser el nom de l’ordinador -és a dir, el nom de l’encaminador-, així com informació sobre si l’encaminador disposa de contrasenya o no tant per configurar-lo com per tenir-hi accés; a més, també dóna informació de quines són les xarxes a les quals dóna accés.
</p>

<p>
La <span class="figref"><a href="#Figure61"><span>figura</span></a></span> il·lustra la sortida de l’ordre show running-config.
</p>
<div class="iocfigure"><a name="Figure61"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Ordre show running-config

</figcaption><img src="../media/ic10m5u4_216.png" alt="" /></figure>
</div>
<p>
Com podeu comprovar, aquí apareixen totes les interfícies de l’encaminador, però en aquest moment no n’hi ha cap de configurada.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Show running-config</p>
<p>
Aquesta ordre serveix perquè l’encaminador mostri l’estat de la seva configuració, les adreces IP i l’estat de cada interfície, el nom de l’encaminador, si hi ha contrasenya o no, etc.
</p>
</div></div>
<p>
Per aprendre com es configuren els encaminadors, se’n configuraran dos (els encaminadors 1 i 2). Es configuraran les adreces de sèrie, que són les que connecten els dos encaminadors entre ells i les que permeten enviar paquets d’un encaminador a l’altre. La configuració es farà tenint en compte les dades de la taula següent:
</p>

<p>

</p>
<div class="ioctable ">
<div class="titletable"><a name="Table8"><span>Taula: </span></a>Dades de configuració dels encaminadors</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Encaminador  </th><th class="col1 leftalign"> Nom de l’encaminador  </th><th class="col2 leftalign"> Adreça de sèrie  </th><th class="col3 leftalign"> Màscara subxarxa  </th><th class="col4 leftalign"> Contrasenya de configuració  </th><th class="col5 leftalign"> Contrasenya de consola  </th>
	</tr>
	<tr class="row1">
		<td class="col0"> 1 </td><td class="col1"> ABM </td><td class="col2"> Sèrie 2/0 <code>201.100.11.1</code> </td><td class="col3"> <code>255.255.255.0</code> </td><td class="col4"> encaminador </td><td class="col5"> terminal </td>
	</tr>
	<tr class="row2">
		<td class="col0"> 2 </td><td class="col1"> BTA </td><td class="col2"> Sèrie 3/0 <code>201.100.11.2</code> </td><td class="col3"> <code>255.255.255.0</code> </td><td class="col4"> encaminador </td><td class="col5"> terminal </td>
	</tr>
</table></div>
</div>
<p>
Els passos que se seguiran per realitzar aquesta configuració són els següents:
</p>
<ol>
<li class="level1"><div class="li"> Afegir els dos encaminadors i connectar-los a través del port sèrie.</div>
</li>
<li class="level1"><div class="li"> Canviar el nom a l’encaminador.</div>
</li>
<li class="level1"><div class="li"> Configurar la interfície sèrie 0.</div>
</li>
<li class="level1"><div class="li"> Canviar la contrasenya de configuració.</div>
</li>
<li class="level1"><div class="li"> Canviar la contrasenya de consola.</div>
</li>
</ol>

<p>
En primer lloc afegirem dos encaminadors del tipus “Generic” (la penúltima icona de la fila dels encaminadors). El simulador els numera automàticament com a “Router1” i “Router2”. Per fer-ho, podeu seguir els passos explicats anteriorment.
</p>

<p>
Ara cal afegir el cable que els uneix. Per fer-ho, cal fer clic a la zona inferior esquerra, sobre del raig i, a continuació, seleccionar el tipus de cable que es representa per un cable vermell amb un rellotge (a la <span class="figref"><a href="#Figure217"><span>figura</span></a></span> es veu on cal fer aquests clics). Aquest tipus de cable correspon a un cable sèrie.
</p>
<div class="iocfigure"><a name="Figure217"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Selecció del cable sèrie

</figcaption><img src="../media/ic10m5u4_217.png" alt="" /></figure>
</div>
<p>
Un cop seleccionat el cable, cal fer clic a l’encaminador 1, seleccionar la interfície Se2/0. A continuació, cal fer el mateix amb l’encaminador 2. Amb això ja tenim els commutadors en xarxa i podem començar a configurar-los.
</p>

<p>
Per poder configurar l’encaminador cal abans tenir l’encaminador en mode de configuració global. Per arribar a aquest mode, primer cal passar de mode d’usuari a mode privilegiat i, un cop en mode privilegiat, s’ha de passar a mode de configuració global.
</p>

<p>
Per passar de mode d’usuari a mode privilegiat s’utilitza l’ordre <strong>enable</strong>, i per passar de mode privilegiat a mode de configuració global es fa servir l’ordre <strong>configure terminal</strong> (<span class="figref"><a href="#Figure62"><span>figura</span></a></span>).
</p>
<div class="iocfigure"><a name="Figure62"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Ordres per canviar de mode

</figcaption><img src="../media/ic10m5u4_218.png" alt="" /></figure>
</div>
<p>
Podeu comprovar que s’ha passat de mode d’usuari a mode privilegiat, ja que l’indicador ha canviat a Router#, i finalment s’ha canviat a mode de configuració global perquè l’indicador mostra Router(config)#.
</p>

<p>
El primer que s’ha de fer és assegurar-se que l’encaminador té activat el protocol d’encaminament RIP: per a això, simplement s’ha d’entrar al mode de configuració de l’encaminador i sortir-ne. S’entra al mode de configuració de l’encaminador amb l’ordre <strong>router rip</strong> i es torna al mode de configuració global utilitzant l’ordre <strong>exit</strong> (<span class="figref"><a href="#Figure63"><span>figura</span></a></span>).
</p>
<div class="iocfigure"><a name="Figure63"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Ordres per activar el protocol RIP

</figcaption><img src="../media/ic10m5u4_219.png" alt="" /></figure>
</div><div class="iocimportant"><div class="ioccontent">
<p>
Els protocols d’encaminament com RIP fan possible que els encaminadors intercanviïn informació per construir i mantenir les taules d’encaminament.
</p>
</div></div>
<p>
El primer pas que s’ha indicat és el canvi de nom de l’encaminador, que es fa amb l’ordre hostname i el nou nom de l’encaminador (<span class="figref"><a href="#Figure61"><span>figura</span></a></span>).
</p>
<div class="iocfigure"><a name="Figure64"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Ordres per canviar de nom

</figcaption><img src="../media/ic10m5u4_220.png" alt="" /></figure>
</div>
<p>
El segon pas és la configuració de la interfície de sèrie 2/0 (<span class="figref"><a href="#Figure65"><span>figura</span></a></span>). Per fer-ho, s’ha de tornar a canviar a un mode que permeti una configuració més gran. El canvi de mode es farà mitjançant l’ordre <strong>interface serial 2/0</strong>, ja que és justament la interfície de sèrie 2/0 la que es vol configurar. I en aquest punt s’indicarà la IP de la interfície i la màscara que s’utilitzarà (sempre s’ha d’indicar la màscara de subxarxa).
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">hostname</p>
<p>
Amb aquesta ordre es canviarà el nom a l’encaminador. S’ha d’executar des del mode de configuració global.
</p>
</div></div><div class="iocfigure"><a name="Figure65"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Ordres per configurar la interfície de sèrie 2/0

</figcaption><img src="../media/ic10m5u4_221.png" alt="" /></figure>
</div>
<p>
I ara només cal configurar la interfície de sèrie 2/0: se li ha de donar l’adreça IP i la màscara que s’utilitzarà, i a més s’ha d’activar. Si no s’activa la interfície, aquesta no és reconeguda per l’encaminador (<span class="figref"><a href="#Figure66"><span>figura</span></a></span>).
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Interfície de sèrie 2/0</p>
<p>
Ordre per configurar la interfície de sèrie 2/0. En aquest punt s’indica l’adreça IP d’aquest terminal, la màscara de subxarxa i la velocitat de rellotge, i s’activa la interfície.
</p>
</div></div><div class="iocfigure"><a name="Figure66"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Ordre ip address

</figcaption><img src="../media/ic10m5u4_222.png" alt="" /></figure>
</div>
<p>
Un cop configurada l’adreça IP, cal configurar la velocitat de rellotge, ja que una de les màquines és l’encarregada de controlar-lo. Si no es configurés aquesta velocitat, no hi podria haver connexió entre els encaminadors, ja que l’un enviaria a una velocitat i l’altre rebria a una altra, amb la qual cosa es podrien perdre bits (<span class="figref"><a href="#Figure67"><span>figura</span></a></span>).
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">ip address</p>
<p>
Ordre necessària per configurar la interfície: s’ha d’introduir la seva adreça IP i indicar quina màscara de subxarxa s’utilitzarà en la interfície que es configura.
</p>
</div></div>
<p>
Només cal configurar la velocitat quan es connecten les interfícies sèrie (i només a una de les interfícies); a les interfícies Ethernet o FastEthernet no cal fer-ho.
</p>
<div class="iocfigure"><a name="Figure67"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Ordre clock rate

</figcaption><img src="../media/ic10m5u4_223.png" alt="" /></figure>
</div>
<p>
S’ha de tenir en compte que quan es connecten dos encaminadors per la interfície de sèrie, tal com es fa en aquest cas, la connexió es realitza mitjançant un cable anomenat <em>DTE-DCE</em>: un encaminador es configura com a DTE i l’altre, com a DCE. La velocitat de rellotge la controla l’encaminador configurat com a DCE.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Clock rate</p>
<p>
Ordre per configurar la velocitat de rellotge. Aquesta ordre només cal aplicar-la a l’encaminador que fa funcions de DCE, en aquest cas a l’encaminador 1. Aquesta màquina controlarà el rellotge de la comunicació.
</p>
</div></div>
<p>
Un cop s’ha configurat la velocitat de rellotge, cal activar la interfície de sortida per poder realitzar les transmissions mitjançant l’ordre <strong>no shutdown</strong> (<span class="figref"><a href="#Figure68"><span>figura</span></a></span>), ja que <strong>shutdown</strong> significa que la interfície està caiguda, és a dir, que no es pot enviar ni rebre informació per aquesta interfície.
</p>
<div class="iocfigure"><a name="Figure68"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Ordre no shutdown

</figcaption><img src="../media/ic10m5u4_224.png" alt="" /></figure>
</div>
<p>
Un cop configurada la interfície de sèrie, es pot comprovar que s’ha fet correctament. Per a això, cal sortir del mode de configuració de la interfície i del mode de configuració global utilitzant l’ordre <strong>exit</strong>, ja que es comprova l’estat de les interfícies des del mode privilegiat amb l’ordre <strong>show running-config</strong>.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Normalment els ports no configurats estan inactius en l’estat shutdown. Per poder transmetre per la interfície, cal activar-la amb aquesta ordre.
</p>
</div></div>
<p>
L’ús d’aquesta ordre mostra la configuració de totes les interfícies, per això només cal buscar les dades que ens interessen. En aquest cas, la interfície que s’ha configurat és la de sèrie 2/0. Depenent de l’encaminador, hi pot haver diferents interfícies —del tipus sèrie i del tipus Ethernet—; per això el nombre identifica de quina interfície es tracta, ja que n’hi ha diferents del mateix tipus (<span class="figref"><a href="#Figure69"><span>figura</span></a></span>).
</p>
<div class="iocfigure"><a name="Figure69"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Comprovació de la configuració de la interfície de sèrie 0

</figcaption><img src="../media/ic10m5u4_225.png" alt="" /></figure>
</div>
<p>
El pas següent és canviar la contrasenya d’accés al terminal. Per fer aquest canvi, s’ha d’executar des del mode de configuració de consola i, per tant, s’han d’executar les ordres <strong>configure terminal</strong> per entrar al mode de configuració global i <strong>line console 0</strong> per entrar al mode de configuració de consola (<span class="figref"><a href="#Figure70"><span>figura</span></a></span>).
</p>

<p>
Un cop arribats a aquest punt, només cal aplicar l’ordre per canviar la contrasenya, que és <strong>password router</strong> (o qualsevol altra paraula en lloc de <em>router</em>); una vegada s’ha fet això, s’ha d’aplicar l’ordre <strong>login</strong> per activar aquesta contrasenya i fer que l’encaminador la demani.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">line console 0</p>
<p>
Aquesta ordre serveix per poder assignar una contrasenya a la consola i d’aquesta manera evitar l’accés a l’encaminador a persones autoritzades.
</p>
</div></div>
<p>
L’últim pas que queda és el canvi de contrasenya de configuració, és a dir, perquè cada vegada que canvieu de mode d’usuari a mode privilegiat us demani aquesta contrasenya (<span class="figref"><a href="#Figure71"><span>figura</span></a></span>). Des del mode de configuració global s’ha de passar a mode de configuració de terminal vty amb l’ordre <strong>line vty 0 4</strong>; aquí només cal canviar la contrasenya com s’ha fet anteriorment, aplicant l’ordre <strong>password router</strong> (o qualsevol altra paraula en lloc de <em>router</em>) i activant-la amb <strong>login</strong>.
</p>
<div class="iocfigure"><a name="Figure70"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Configuració de la contrasenya de consola

</figcaption><img src="../media/ic10m5u4_226.png" alt="" /></figure>
</div><div class="iocfigure"><a name="Figure71"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Configuració de password vty

</figcaption><img src="../media/ic10m5u4_227.png" alt="" /></figure>
</div>
<p>
En aquest punt, cal indicar a l’encaminador que activi la contrasenya aplicant l’ordre <strong>enable password terminal</strong> (o qualsevol altra paraula en lloc de <em>terminal</em>). Si no es fa aquest pas, l’encaminador no demanarà la contrasenya quan es canviï a mode privilegiat.
</p>

<p>
Utilitzant aquesta ordre es configura una contrasenya per canviar a mode privilegiat i poder fer comprovacions de l’estat de l’encaminador (<span class="figref"><a href="#Figure72"><span>figura</span></a></span>).
</p>
<div class="iocfigure"><a name="Figure72"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Activació de la contrasenya de vty

</figcaption><img src="../media/ic10m5u4_228.png" alt="" /></figure>
</div>
<p>
Un cop s’ha acabat la configuració del primer encaminador, es realitza una comprovació per verificar que demana totes les contrasenyes i que s’han fet correctament les configuracions.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">enable password</p>
<p>
Un cop s’ha configurat la contrasenya, cal activar-la; altrament, no serveix de res haver-la configurat ja que l’encaminador no la demanarà.
</p>

<p>
Cal recordar que s’ha estat treballant a la memòria RAM de l’encaminador i que, per tant, no s’ha guardat cap configuració realitzada. Per això, si s’apaga l’encaminador, s’haurà de començar de nou.
</p>
</div></div>
<p>
Per fer aquest pas sortirem de l’encaminador sense tancar-lo, ja que encara no s’ha guardat la configuració, i es tornarà a entrar per comprovar que demana les contrasenyes. Un cop estigueu en mode privilegiat, executareu l’ordre <strong>exit</strong> per comprovar la configuració de les contrasenyes (<span class="figref"><a href="#Figure73"><span>figura</span></a></span>). És molt important no apagar l’encaminador, ja que no s’han desat els canvis.
</p>
<div class="iocfigure"><a name="Figure73"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Comprovació de les contrasenyes

</figcaption><img src="../media/ic10m5u4_229.png" alt="" /></figure>
</div>
<p>

</p>

<p>
Un cop s’ha comprovat que l’encaminador demana les contrasenyes i que la configuració és la correcta, ja es pot guardar la configuració a la memòria NVRAM per no perdre-la si hi ha un tall de corrent.
</p>

<p>
Aquest pas és molt important i s’ha d’anar en compte amb l’ordre; en cas contrari, es podria esborrar tota la configuració de l’encaminador i s’hauria de tornar a instal·lar-ne el sistema operatiu.
</p>

<p>
L’ordre que s’ha d’executar per guardar la configuració de memòria RAM a la memòria NVRAM  (<span class="figref"><a href="#Figure74"><span>figura</span></a></span>) és <strong>copy running-config startup-config</strong>.
</p>
<div class="iocfigure"><a name="Figure74"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Gravar la configuració a l’NVRAM

</figcaption><img src="../media/ic10m5u4_230.png" alt="" /></figure>
</div>
<p>
Durant tota l’estona s’ha estat treballant sobre la memòria volàtil de l’encaminador; això vol dir que en el moment en què l’encaminador deixés de rebre alimentació, aquesta memòria s’esborraria i es perdria tota la feina feta. La memòria volàtil és la <strong>running-config</strong> memòria d’execució; per no perdre aquesta configuració s’ha de copiar a la memòria NVRAM, que és la que conté les dades d’arrencada <strong>startup-config</strong>.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Un cop s’ha comprovat que la configuració nova és correcta, s’ha d’emmagatzemar a la memòria no volàtil de l’encaminador per no perdre-la si hi ha un tall de corrent; en aquest supòsit, només caldrà tornar-la a carregar.
</p>
</div></div>
<p>
Després de configurar el primer encaminador, cal configurar el segon seguint els mateixos passos. Ara, però, no s’ha d’activar l’ordre <code>clock rate</code>, ja que l’encaminador ABM és l’encarregat de proporcionar el rellotge a la connexió.
</p>

<p>
Un cop configurat el segon encaminador, cal comprovar si hi ha connexió entre les dues màquines amb l’ordre <strong>ping</strong>: n’hi ha prou de fer <strong>ping</strong> IP, on IP és l’adreça IP de la màquina de la qual voleu comprovar que està connectada a la que utilitzeu. Si s’executa l’ordre ping des del segon encaminador que s’ha configurat, es veurà el que es mostra en la <span class="figref"><a href="#Figure75"><span>figura</span></a></span>.
</p>
<div class="iocfigure"><a name="Figure75"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Ordre ping

</figcaption><img src="../media/ic10m5u4_231.png" alt="" /></figure>
</div>
<p>
Com es pot comprovar en la <span class="figref"><a href="#Figure75"><span>figura</span></a></span>, quan s’ha executat l’ordre ping a la màquina amb adreça IP <code>201.100.11.1</code> s’ha rebut un missatge que indica que tots els paquets enviats per comprovar que l’altra màquina hi estava connectada han arribat correctament: han arribat cinc paquets de cinc paquets enviats; si l’altra màquina no hi estigués connectada, la resposta hauria estat zero paquets de cinc.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">ping</p>
<p>
Amb aquesta ordre es comprova a través de la xarxa si hi ha connexió entre les dues màquines i, per tant, si es poden transferir les dades.
</p>
</div></div>
<p>
Tal com s’ha configurat l’encaminador per poder comprovar que la connexió entre les dues màquines és correcta, s’ha d’aplicar un ping a l’adreça IP, cosa que provoca que hagi de recordar les adreces IP de les màquines que estan connectades. Es pot variar la configuració fent un ping al nom de la màquina.
</p>

<p>
Per canviar aquesta configuració, cal entrar al mode de configuració global i introduir quin nom de màquina tenen les diferents adreces IP amb l’ordre <strong>ip host</strong> nom_màquina IP. Només hi pot haver una línia per cada màquina connectada (<span class="figref"><a href="#Figure76"><span>figura</span></a></span>).
</p>

<p>
Aquesta configuració s’ha de repetir a cada encaminador, i així cada encaminador coneixerà les diferents adreces IP que té la resta d’encaminadors; es pot provar fent un ping al nom de la màquina (<span class="figref"><a href="#Figure77"><span>figura</span></a></span>).
</p>

<p>
Una ordre que s’utilitza molt és <em>help</em>, amb la qual es poden comprovar quines ordres hi ha disponibles a cada moment. A més, si mentre configureu no sabeu quina és l’ordre que heu d’indicar o les opcions que té una ordre, amb <em>help</em> es mostraran les opcions disponibles i podreu triar l’opció més adient. L’ordre <em>help</em> s’invoca picant el signe interrogant (<strong>?</strong>). L’interrogant pot escriure’s en qualsevol moment i ens surt automàticament la informació d’ajut.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">ip host nom_màquina IP</p>
<p>
Amb aquesta ordre s’indica a l’encaminador que es pot arribar a la màquina amb un nom determinat des de les adreces IP especificades. Per tant, quan es fa un ping al nom de la màquina, en realitat es fa un ping a cada una de les adreces IP que consten després del nom.
</p>
</div></div><div class="iocfigure"><a name="Figure76"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Sincronització del nom de la màquina amb l’adreça IP

</figcaption><img src="../media/ic10m5u4_232.png" alt="" /></figure>
</div><div class="iocfigure"><a name="Figure77"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Ping al nom de la màquina

</figcaption><img src="../media/ic10m5u4_233.png" alt="" /></figure>
</div>
<p>
En la <span class="figref"><a href="#Figure78"><span>figura</span></a></span> es poden veure totes les ordres que es poden utilitzar des del mode de configuració global. A cada mode de configuració hi ha una llista tan llarga o més de totes les ordres amb què podeu configurar l’encaminador.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Com es pot comprovar, en fer el ping al nom de la màquina l’encaminador ha substituït el nom de la màquina per l’adreça IP que se li ha indicat com a adreça d’aquell nom.
</p>
</div></div><div class="iocfigure"><a name="Figure78"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Ordre help en mode de configuració global

</figcaption><img src="../media/ic10m5u4_234.png" alt="" /></figure>
</div>
<p>
Ja s’han vist les ordres més importants que es poden utilitzar per configurar els dos encaminadors, però no són les úniques. A continuació us exposarem algunes ordres més amb una petita explicació del seu funcionament:
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Amb l’ordre help en mode de configuració global apareix tota la llista de les ordres.
</p>
</div></div><ul>
<li class="level1"><div class="li"> <strong>clear</strong>: serveix per esborrar o reinicialitzar diferents configuracions.</div>
<ul>
<li class="level2"><div class="li"> Exemple 1: clear interface serial 0 esborra la configuració de la interfície de sèrie 0.</div>
</li>
<li class="level2"><div class="li"> Exemple 2: clear ip route * esborra tota la taula de rutes.</div>
</li>
</ul>
</li>
<li class="level1"><div class="li"> <strong>clock set</strong>: permet configurar la data i l’hora del sistema.</div>
</li>
<li class="level1"><div class="li"> <strong>configure terminal</strong>: dóna accés al mode de configuració global. Per sortir d’aquest mode cal aplicar l’ordre exit.</div>
</li>
<li class="level1"><div class="li"> <strong>copy</strong>: serveix per copiar els arxius de configuració.</div>
</li>
<li class="level1"><div class="li"> <strong>debug</strong>: habilita funcions de depuració. Cal anar amb compte amb aquesta ordre, ja que podria bloquejar fàcilment l’encaminador.</div>
</li>
<li class="level1"><div class="li"> <strong>disable</strong>: canvia de mode privilegiat a mode d’usuari.</div>
</li>
<li class="level1"><div class="li"> <strong>ping</strong>: comprova la connectivitat entre diferents aparells, entre encaminador i encaminador, entre encaminador i ordinador, entre ordinador i encaminador, etc.</div>
</li>
<li class="level1"><div class="li"> <strong>reload</strong>: programa per tornar a engegar el sistema.</div>
</li>
<li class="level1"><div class="li"> <strong>send</strong>: envia un missatge a altres usuaris, individualment o col·lectivament.</div>
</li>
<li class="level1"><div class="li"> <strong>show access-lists</strong>: mostra la llista d’accessos cada vegada que un paquet ha arribat correctament. Les llistes d’accés (<acronym title="Access Control List">ACL</acronym>) serveixen per filtrar el trànsit.</div>
</li>
<li class="level1"><div class="li"> <strong>show arp</strong>: mostra la taula arp, o sigui les adreces MAC amb l’adreça IP corresponent. Cada targeta de xarxa —és a dir, cada interfície— tindrà una MAC i una adreça IP.</div>
</li>
<li class="level1"><div class="li"> <strong>show buffers</strong>: mostra estadístiques de la memòria interna.</div>
</li>
<li class="level1"><div class="li"> <strong>show cdp neighbour</strong>: mostra informació dels encaminadors més propers de la marca Cisco, ja que és un protocol Cisco (cdp = <em>Cisco discovery protocol</em>).</div>
</li>
<li class="level1"><div class="li"> <strong>show clock</strong>: mostra la data i l’hora del sistema.</div>
</li>
<li class="level1"><div class="li"> <strong>show configuration</strong>: mostra la configuració amb què l’encaminador inicia, és a dir, la que hi ha emmagatzemada a la memòria NVRAM. Equival a <strong>show startup-configuration</strong>.</div>
</li>
<li class="level1"><div class="li"> <strong>show controlers</strong>: dóna informació dels controladors, la targeta, si el tipus del cable connectat és DTE o DCE, etc.</div>
</li>
<li class="level1"><div class="li"> <strong>show interfaces</strong>: mostra l’estat de les interfícies.</div>
</li>
<li class="level1"><div class="li"> <strong>show ip protocols</strong>: indica els protocols d’encaminament configurats.</div>
</li>
<li class="level1"><div class="li"> <strong>show ip route</strong>: mostra les taules d’encaminament.</div>
</li>
<li class="level1"><div class="li"> <strong>show protocols</strong>: dóna els protocols de xarxa habilitats i un resum de les direccions de xarxa ordenades per interfície.</div>
</li>
<li class="level1"><div class="li"> <strong>show running-config</strong>: recull la configuració que hi ha en execució.</div>
</li>
<li class="level1"><div class="li"> <strong>show startup-conf</strong>: mostra la configuració amb què iniciarà el dispositiu.</div>
</li>
<li class="level1"><div class="li"> <strong>show version</strong>: proporciona informació sobre el model de l’encaminador, la versió de sistema operatiu que utilitza, etc.</div>
</li>
<li class="level1"><div class="li"> <strong>traceroute</strong>: mostra la ruta fins a arribar a la destinació, per quines adreces IP ha de passar el paquet per arribar a la destinació.</div>
</li>
</ul>

<p>
Totes aquestes ordres funcionen amb un encaminador. Si les voleu provar al simulador d’encaminador, és possible que algunes no funcionin perquè probablement no s’ha previst la necessitat d’incloure-les al simulador.
</p>

</div>

<h2><a id="manteniment_i_configuracio_de_xarxes_amb_encaminadors" >Manteniment i configuració de xarxes amb encaminadors</a></h2>
<div class="level2">

<p>
El manteniment correcte dels encaminadors i la planificació de les còpies de seguretat dels nostres dispositius ens permeten optimitzar el trànsit en la nostra xarxa.
</p>

<p>
Hem de tenir en compte que els encaminadors no poden treballar sense un sistema operatiu i arxius de configuració, hem de ser capaços de determinar les seqüències d’inici, càrrega i ubicació dels arxius necessaris; i tanmateix, s’ha de garantir la seguretat i la tolerància a errades del sistema.
</p>

<p>
El manteniment comporta la configuració correcta perquè el sistema operatiu de l’encaminador (IOS) desenvolupi correctament les seves funcions:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">IOS</p>
<p>
L’IOS és l’element fonamental dels encaminadors. S’encarrega de gestionar tots els dispositius físics i gestiona l’encaminament i la commutació. Normalment resideix en la memòria Flash en forma d’un únic arxiu.
</p>
</div></div><ul>
<li class="level1"><div class="li"> Tractament de l’encaminament i la commutació.</div>
</li>
<li class="level1"><div class="li"> Gestió de totes les interfícies.</div>
</li>
<li class="level1"><div class="li"> Accés fiable i segur als diferents dispositius de la xarxa.</div>
</li>
<li class="level1"><div class="li"> Escalabilitat de la xarxa.</div>
</li>
</ul>

<p>
D’altra banda, hem de fer còpies de seguretat, que ens permetran recuperar l’estat del sistema o actualitzar-lo amb una nova versió.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Les <strong>còpies de seguretat</strong> són fonamentals per al manteniment correcte del sistema.
</p>
</div></div>
<p>
La configuració de la xarxa s’ha de fer amb protocols d’encaminament, que ens proporcionen les eines necessàries per connectar diferents encaminadors i proporcionar rutes segures i fiables d’una manera automàtica.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Els <strong>protocols d’encaminament</strong> automatitzen la gestió de la configuració de la xarxa.
</p>
</div></div>
</div>

<h3><a id="imatges_d_ios" >Imatges d&#039;IOS</a></h3>
<div class="level3">

<p>
Els arxius de l’IOS i els de configuració d’inici són els elements fonamentals per al bon funcionament del nostre encaminador, un cop s’han realitzat les fases de POST i d’arrencada (<em>bootstrap</em>) es fa la càrrega de l’IOS. El sistema operatiu pot residir en la memòria Flash, en un servidor TFTP o en la ROM, per determinar on resideix i el tipus d’inici es fa servir el registre de configuració.
</p>

<p>
En la <span class="figref"><a href="#Figure79"><span>figura</span></a></span> s’observa la seqüència de càrrega de l’IOS i dels arxius de configuració i les diferents ubicacions on poden residir.
</p>

<p>
Un cop s’ha carregat l’IOS es fa la càrrega de l’arxiu de configuració, i a continuació s’han de fer les còpies de seguretat en un servidor de transferència de fitxers trivial o TFTP per tenir les primeres còpies dels fitxers d’inici i del sistema operatiu IOS.
</p>
<div class="iocfigure"><a name="Figure79"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Seqüència de càrrega de l’IOS

</figcaption><img src="../media/ic10m5u4_85.png" alt="" /></figure>
</div>
<p>
Els fitxers del sistema operatiu tenen una estructura de noms molt significativa, simplement veient el nom podem interpretar per a quina plataforma s’executa el sistema operatiu, quines característiques té i quin és el format de les dades, des d’on s’executa i si està comprimit. El nom està format per aquestes tres parts separades per guions, per exemple C2500-IS-L. La <span class="tabref"><a href="#Table9"><span>taula</span></a></span> ens mostra les característiques dels noms.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table9"><span>Taula: </span></a>Format dels noms IOS</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Plataforma </th><th class="col1"> Característiques </th><th class="col2"> Format </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> C2500      </td><td class="col1 leftalign"> IS               </td><td class="col2 leftalign"> LZ     </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> C1700      </td><td class="col1 leftalign"> BNS              </td><td class="col2 leftalign"> L      </td>
	</tr>
</table></div>
</div>
<p>
El camp plataforma fa referència al model d’encaminador (C2500 o C1700 en aquest cas). La resta de camps (característiques i format) estan determinats per una composició de sigles. Cadascuna de les diferents sigles té un significat determinat; les de la <span class="tabref"><a href="#Table10"><span>taula</span></a></span> són les més comunes.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Nom de l&#039;arxiu IOS</p>
<p>
El nom de l’arxiu IOS que resideix en la memòria Flash ens proporciona informació referent al tipus de plataforma, les seves característiques i el format de l’arxiu.
</p>
</div></div><div class="ioctable ">
<div class="titletable"><a name="Table10"><span>Taula: </span></a>Valors de les sigles dels noms IOS</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Valor </th><th class="col1 leftalign"> Significat                                  </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> I     </td><td class="col1 leftalign"> Proporciona suport per serveis IP           </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> B     </td><td class="col1 leftalign"> Proporciona suport AppleTalk                </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> N     </td><td class="col1"> Proporciona suport a protocols de xarxa IPX </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> Z     </td><td class="col1 leftalign"> Arxiu comprimit                             </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> L     </td><td class="col1 leftalign"> Arxiu reubicable                            </td>
	</tr>
</table></div>
</div>
<p>
Podeu veure la versió i el nom de l’arxiu IOS mitjançant l’ordre show version. Si observeu la <span class="figref"><a href="#Figure80"><span>figura</span></a></span> podeu veure un exemple d’ús d’aquesta ordre. Podeu veure, a més, que el programa d’arrencada (<em>bootstrap</em>) show version s’executa des de la memòria ROM, la càrrega del sistema s’ha executat des de la memòria Flash. També es pot veure el valor del camp configuration register, que, en aquest cas, té el valor 0x2102. Aquest valor ens indica el tipus d’inici de l’encaminador mitjançant aquest codi hexadecimal.
</p>
<div class="iocfigure"><a name="Figure80"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Exemple d’ús de l’ordre show version

</figcaption><img src="../media/ic10m5u4_235.png" alt="" /></figure>
</div>
</div>

<h4><a id="inici_de_l_encaminadorrommon" >Inici de l&#039;encaminador: ROMMON</a></h4>
<div class="level4">

<p>
A vegades ens pot interessar modificar el procés d’inici de l’encaminador. Per fer-ho tenim dos mètodes: un és modificar el registre de configuració i l’altre, usar les ordres boot system. El registre de configuració es pot modificar des del mode privilegiat o amb el monitor de ROM. A continuació especifiquem com es pot modificar de diferents maneres.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">L&#039;ordre show version...</p>
<p>
…mostra informació referent al sistema operatiu, com és el nom de l’arxiu o informació dels dispositius físics que té l’encaminador.
</p>
</div></div>
<p>
<strong>Modificació de configuració del registre mitjançant ROMMON</strong>: El monitor de ROM o ROMMON és una versió mínima del sistema operatiu amb un conjunt de funcions limitades, està ubicat en la memòria ROM i no es pot modificar o actualitzar, per fer-ho caldria incorporar un altre ROM diferent a la placa base de l’encaminador ctrl+pause. Aquest mode de treball ens permet, bàsicament, fer les funcions següents:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">ROMMON</p>
<p>
El monitor de ROM ens permet restaurar l’IOS, és un sistema operatiu amb un conjunt d’ordres mínim. S’ubica en la memòria ROM, per accedir a aquest mode disposem de la combinació de tecles , que cal pitjar quan està arrencant l’encaminador.
</p>
</div></div><ul>
<li class="level1"><div class="li"> Restaurar la contrasenya.</div>
</li>
<li class="level1"><div class="li"> Modificar el registre de configuració.</div>
</li>
<li class="level1"><div class="li"> Gestionar la seqüència d’inici de l’encaminador.</div>
</li>
<li class="level1"><div class="li"> Restaurar còpies de seguretat de l’IOS amb TFTP.</div>
</li>
<li class="level1"><div class="li"> Restaurar còpies de seguretat de l’IOS amb Xmodem.</div>
</li>
</ul>

<p>
El ROMMON s’executa automàticament quan l’encaminador no troba cap configuració correcta en la memòria Flash. També podem interrompre el procés d’arrencada de l’encaminador per accedir al ROMMON amb la combinació de tecles ctrl+pause.
</p>

<p>
Identifiquem que ens trobem en el monitor de ROM pel símbol de sistema:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Ctrl+pause</p>
<p>
La combinació de tecles ctrl+pause ens permet accedir al ROMMON. Fa una interrupció en la càrrega del sistema operatiu.
</p>
</div></div><pre class="code">ROMMON 1&gt;</pre>

<p>
Si som en el monitor de ROM i volem tornar a reiniciar el sistema disposem de l’ordre reset.
</p>
<pre class="code">ROMMON 2&gt; reset</pre>

<p>
Les opcions de configuració que es poden utilitzar en el ROMMON les podeu veure en la <span class="figref"><a href="#Figure81"><span>figura</span></a></span>, només cal introduir un ?.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
L’ordre reset ens permet sortir del ROMMON i recarregar l’encaminador amb les opcions d’inici que s’hagin configurat.
</p>
</div></div><div class="iocfigure"><a name="Figure81"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Opcions de configuració al ROMMON

</figcaption><img src="../media/ic10m5u4_239.png" alt="" /></figure>
</div>
<p>
Des del ROMMON podem modificar el registre de configuració amb l’ordre confreg valor. El registre és un valor que s’emmagatzema en la NVRAM, confreg té una grandària de 16 bits i es representa en format hexadecimal. La funció confreg principal del registre és indicar l’ordre de càrrega de l’IOS. Aquesta ordre depèn del valor que tinguem emmagatzemat. Per modificar la seqüència només cal variar els darrers quatre bits del registre de configuració. El valor per defecte sempre és 0x2102. La <span class="tabref"><a href="#Table11"><span>taula</span></a></span> mostra els valors més comuns que pot tenir el registre de configuració i què volen indicar.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">ordre confreg</p>
<p>
L’ordre permet modificar la configuració d’inici que resideix al registre de configuració, únicament es pot executar des del monitor de Rom.
</p>
</div></div><div class="ioctable ">
<div class="titletable"><a name="Table11"><span>Taula: </span></a>Valors del registre de configuració d’un encaminador</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Valor                    </th><th class="col1 leftalign"> Funció                                                                                           </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> <strong>0xnnn0</strong>               </td><td class="col1 leftalign"> Inicia l’encaminador amb el monitor de ROM.                                                      </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> <strong>0xnnn1</strong>               </td><td class="col1 leftalign"> Inicia l’encaminador des de la memòria Flash.                                                    </td>
	</tr>
	<tr class="row3">
		<td class="col0"> <strong>0xnnn2 fins a 0xnnnF</strong> </td><td class="col1 leftalign"> Inicia l’encaminador des de la memòria NVRAM.                                                    </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> <strong>0xnn42</strong>               </td><td class="col1"> Inicia l’encaminador sense carregar l’arxiu de configuració. Serveix per recuperar contrasenyes. </td>
	</tr>
</table></div>
</div><div class="iocimportant"><div class="ioccontent">
<p>
Es pot consultar la configuració actual del registre mitjançant l’ordre show version.
</p>
</div></div>
<p>
Des del mode de configuració global, amb l’ordre <em>config-register 0x210X</em> podem modificar la configuració d’inici. A continuació amb l’ordre <em>reload</em> reiniciem l’encaminador per tal que es carregui tal com hem indicat.
</p>

<p>
La <span class="figref"><a href="#Figure82"><span>figura</span></a></span> ens mostra com podem modificar la configuració perquè iniciï amb el monitor de ROM. S’executa l’ordre config-register 0x2100, a continuació guardem la configuració i recarreguem l’encaminador mitjançant l’ordre reload.
</p>
<div class="iocfigure"><a name="Figure82"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Execució de l’ordre configure register

</figcaption><img src="../media/ic10m5u4_240.png" alt="" /></figure>
</div>
<p>
En iniciar l’encaminador es carrega el monitor de ROM, s’identifica perquè apareix el símbol de sistema ROMMON&gt;, per tornar a la configuració anterior utilitzem l’ordre confreg 0x2102 i recarreguem el sistema amb l’ordre reset.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">ordre config-register</p>
<p>
L’ordre config-register permet especificar des de quina ubicació es carrega l’IOS i amb quines condicions. Permet modificar el registre de configuració de 16 bits que conté el valor que defineix el tipus d’inici en format hexadecimal.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">Recuperació de contrasenya</p>
<p>
Una de les funcions fonamentals del monitor de ROM és la possibilitat de poder recuperar contrasenyes o fer una configuració nova.
</p>
</div></div>
<p>
Una altre funció molt important del registre de configuració juntament amb el monitor de ROM és la recuperació de contrasenyes, a continuació fem el procés de recuperació:
</p>

<p>
<strong>1.</strong> Una vegada observem que no tenim la contrasenya del mode privilegiat, recarreguem l’encaminador amb la combinació de tecles <em>control + pause</em> i accedim al ROMMON.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Assistent de configuració del sistema</p>
<p>
Quan arrenquem un encaminador que no té arxiu de configuració (startup-config) ens apareix automàticament una pregunta que ens demana si volem configurar el sistema de manera assistida. Es tracta de l’assistent de configuració. Si no volem configurar l’encaminador fent servir aquesta eina, hem d’indicar que no.
</p>
</div></div>
<p>
<strong>2.</strong> A continuació, només cal introduir l’ordre en el ROMMON:
</p>
<pre class="code">ROMMON 1&gt; confreg 0x2142
ROOMON 2&gt; reset</pre>

<p>
<strong>3.</strong> Amb això l’encaminador s’inicia sense carregar l’arxiu de configuració. Com que no hi és, ens apareix l’assistent de configuració del sistema, el podem cancel·lar i tornar a fer una configuració. Llavors podem consultar una còpia del fitxer <em>startup-config</em> per veure la contrasenya sense xifrar i canviar-la per posar-ne una de nova que coneixem nosaltres.
</p>

<p>
<strong>4.</strong> Les ordres boot-system ens permeten indicar si l’encaminador executa l’IOS des de la memòria Flash o si s’inicia amb ROMMON, si es poden executar des del mode privilegiat o des del monitor de ROM, aquestes ordres no estan configurades per defecte i l’encaminador s’inicia sempre buscant l’IOS en la Flash, després en un servidor TFTP i finalment en la ROM.
</p>

<p>
Si volem canviar la seqüència d’inici hem d’utilitzar l’ordre: 
</p>
<pre class="code">boot system Ubicació_d&#039;inici nom_imatge</pre>

<p>
A continuació podeu veure dos exemples d’ús d’aquesta ordre:
</p>
<pre class="code">Router(config)#boot system flash c2500-is-l</pre>

<p>
Aquest exemple indica al sistema que l’inici de l’encaminador es fa des de la memòria Flash i carrega una imatge de l’IOS anomenada c2500-is-l.
</p>
<pre class="code">Router(config)#boot system rom</pre>

<p>
Aquest exemple indica al sistema que l’inici de l’encaminador es fa des de la memòria ROM amb ROMMON.
</p>

</div>

<h4><a id="tftp" >TFTP</a></h4>
<div class="level4">

<p>
El servei de TFTP ens permet disposar de còpies de seguretat per tal de recuperar una imatge de l’IOS o d’un arxiu de configuració.
</p>

<p>
Un cop l’encaminador s’ha iniciat i hem realitzat les configuracions que necessitem, hem de ser capaços de poder fer còpies de seguretat, per això necessitem un equip de la xarxa que tingui instal·lat el servei de TFTP. Utilitzem, per exemple, el programa Winagents TFTP Service for Windows com a servidor TFTP. La <span class="figref"><a href="#Figure83"><span>figura</span></a></span> ens mostra el procés d’instal·lació del servidor i en quina carpeta resideix.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Servidor TFTP</p>
<p>
Els servidors TFTP són de gran importància per a la gestió de les imatges dels encaminadors. Ens permeten fer còpies de seguretat del sistema operatiu i dels arxius de configuració.
</p>
</div></div><div class="iocnote"><div class="ioccontent">
<p>
A l’entorn virtual <em>Packet Tracer</em> els servidors ja porten incorporat un servidor TFTP; per tant, no n’haurem d’instal·lar cap.
</p>
</div></div><div class="iocfigure"><a name="Figure83"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Instal·lació d’un servidor TFTP

</figcaption><img src="../media/ic10m5u4_89.png" alt="" /></figure>
</div>
<p>
Quan s’ha fet el procés d’instal·lació cal observar la configuració del servidor TFTP, ens mostra per defecte el port 69 per obtenir les connexions del client, els temps de resposta i el directori on s’emmagatzemen les imatges.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Les imatges s’emmagatzemen en el directori arrel que especifiquem en l’opció tftp root directory.
</p>
</div></div>
<p>
En la <span class="figref"><a href="#Figure84"><span>figura</span></a></span> podeu observar les propietats de configuració del servidor TFTP, ens mostra el port que utilitza el servei i el directori on s’emmagatzemen les imatges.
</p>
<div class="iocfigure"><a name="Figure84"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Configuració d’un servidor TFTP

</figcaption><img src="../media/ic10m5u4_90.png" alt="" /></figure>
</div>
<p>
Per accedir des de l’encaminador al servidor TFTP només ens cal conèixer-ne l’adreça IP i fer la còpia de seguretat de l’IOS o de l’arxiu de configuració (segons les necessitats). Per fer aquestes còpies hem de fer el següent:
</p>

<p>
<strong>1. Còpia de l’IOS show flash</strong>. Utilitzem l’ordre show flash per obtenir el nom del fitxer que conté l’IOS, a continuació amb l’ordre copy flash tftp indiquem al sistema show flash que volem fer una còpia de seguretat al servidor TFTP, ens demana quina és l’adreça del servidor i quin és el nom de la imatge de l’IOS d’origen i de destinació (<span class="figref"><a href="#Figure85"><span>figura</span></a></span>).
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">show flash</p>
<p>
Amb l’ordre podem obtenir informació referent a la grandària de la memòria Flash i del seu contingut. Això és molt important per poder fer una còpia de seguretat o restaurar l’IOS.
</p>
</div></div><div class="iocimportant"><div class="ioccontent">
<p>
L’ordre copy flash tftp copia un arxiu de la memòria Flash al servidor TFTP. Si la còpia es fa correctament ens ho ha d’indicar mitjançant el signe ! i ens ha de retornar la quantitat de bytes que s’han copiat.
</p>
</div></div><div class="iocfigure"><a name="Figure85"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Còpia de l’IOS al servidor TFTP

</figcaption><img src="../media/ic10m5u4_241.png" alt="" /></figure>
</div>
<p>
<strong>2. Còpia d’arxiu de configuració</strong>. Primer hem de fer una còpia de la configuració activa del fitxer runningconfig al fitxer d’inici startup-config, i a continuació utilitzem l’ordre copy startup-config tftp per fer la còpia de seguretat en el servidor TFTP. Aquesta ordre ens demana l’adreça del servidor i el nom de l’arxiu de configuració d’origen i de destinació (<span class="figref"><a href="#Figure87"><span>figura</span></a></span>).
</p>
<div class="iocfigure"><a name="Figure87"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Còpia del fitxer startup-config en el servidor TFTP

</figcaption><img src="../media/ic10m5u4_242.png" alt="" /></figure>
</div><div class="iocimportant"><div class="ioccontent">
<p>
Per tal de fer còpies de seguretat de l’encaminador al servidor TFTP és necessari que estiguin en la mateixa xarxa per poder obtenir un rendiment millor.
</p>
</div></div>
<p>
Quan hem fet les còpies de seguretat dels arxius de configuració i de l’arxiu de l’IOS, les tenim disponibles en el servidor de TFTP i les podem recuperar en qualsevol moment que sigui necessari.
</p>

<p>
<strong>3. Restauració de l’IOS</strong>. Per carregar una imatge de l’OIS tenim tres maneres de recuperar-la i restaurar-la. Es pot fer des del mode privilegiat amb l’IOS actiu, mitjançant un servidor TFTP o amb una còpia local amb Xmodem. A continuació detallem cadascuna de les diferents maneres de restaurar-la:
</p>

<p>
<strong>a. Actualització des d’un IOS actiu</strong>. Utilitzem aquesta opció de restauració de l’IOS quan únicament volem actualitzar l’IOS existent. Cal que tinguem una imatge de l’IOS nou al servidor TFTP i que utilitzem l’ordre copy tftp Flash, ens demana l’adreça IP del servidor TFTP i el nom de la imatge.
</p>

<p>
<strong>b. Restauració amb ROMMON via TFTP</strong>. Aquesta opció s’utilitza quan no disposem de cap imatge activa en la memòria Flash, i llavors l’encaminador no ha iniciat cap sistema. Per accedir a ROMMON cal prémer la combinació de tecles ctrl+ pause.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Per connectar-nos des de l’encaminador amb entorn ROMMON a un servidor TFTP hem de configurar prèviament la interfície Ethernet de l’encaminador. Hem de tenir en compte que la instal·lació de ROMMON és mínima i només ens permet configurar la primera interfície Ethernet de l’encaminador.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">L&#039;ordre del ROMMON...</p>
<p>
…permet visualitzar les variables que utilitza el sistema, per connectar amb un servidor TFTP cal configurar-ne cinc. En recarregar l’encaminador les variables que s’han configurat es buiden.
</p>
</div></div>
<p>
Una vegada s’ha accedit al ROMMON s’han de configurar cinc paràmetres per poder connectar l’encaminador a un servidor TFTP. Amb l’ordre set podem veure totes les variables que té el monitor de ROM. Les variable a modificar són les que es presenten en la <span class="tabref"><a href="#Table12"><span>taula</span></a></span>.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table12"><span>Taula: </span></a>Variables Tftpdnld</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0 leftalign"> Variable         </th><th class="col1 leftalign"> Descripció                              </th><th class="col2 leftalign"> Exemple           </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> IP_ADDRESS=      </td><td class="col1 leftalign"> Adreça interfície Ethernet encaminador  </td><td class="col2 leftalign"> <code>192.168.0.241</code>     </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> IP_SUBNET_MASK=  </td><td class="col1"> Màscara interfície Ethernet encaminador </td><td class="col2 leftalign"> <code>255.255.255.0</code>     </td>
	</tr>
	<tr class="row3">
		<td class="col0"> DEFAULT_GATEWAY= </td><td class="col1 leftalign"> Porta d’enllaç per defecte              </td><td class="col2 leftalign"> <code>192.168.0.2</code>       </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> TFTP_SERVER=     </td><td class="col1 leftalign"> Adreça del servidor TFTP                </td><td class="col2 leftalign"> <code>192.168.0.99</code>      </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> TFTP_FILE=       </td><td class="col1 leftalign"> Arxiu imatge IOS resident al TFTP       </td><td class="col2"> <code>c1841-advipservicesk9-mz.124-15.T1.bin-copia</code> </td>
	</tr>
</table></div>
</div>
<p>
Hem de tenir en compte a l’hora de generar les variables que s’han d’escriure en la consola amb majúscules. En recarregar l’encaminador o si s’apaga, les variables perden el valor amb què s’han configurat.
</p>

<p>
La <span class="figref"><a href="#Figure88"><span>figura</span></a></span> mostra com s’han introduït les variables, a continuació s’executa l’ordre set, que ens permetrà veure si els valors s’han configurat correctament, a més de mostrar-nos altres variables del monitor de ROM (o ROMMON).
</p>
<div class="iocfigure"><a name="Figure88"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Introducció de variables TFTP

</figcaption><img src="../media/ic10m5u4_243.png" alt="" /></figure>
</div>
<p>
Quan s’ha confirmat que les variables són correctes a continuació només cal executar l’ordre tftpdnld, aquesta ordre esborra la memòria Flash itftpdnld utilitza el valor de les variables per restaurar la imatge.tftpdnld
</p>

<p>
A la <span class="figref"><a href="#Figure89"><span>figura</span></a></span> veiem el resultat d’executar l’ordre tftpdnld, la recepció de les dades de la imatge es representa amb el símbol !, quan finalitza, ens indica que s’ha rebut la imatge i on s’ubica.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">tftpdnld</p>
<p>
L’ordre s’utilitza des del monitor de ROM per restaurar una còpia de seguretat que està en un servidor TFTP. Llegeix les variables del sistema, configura les interfícies i recupera la imatge.
</p>
</div></div>
<p>

</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Redundància cíclica o CRC</p>
<p>
Redundància cíclica és un càlcul associat a la transferència o a l’emmagatzematge de dades i ens assegura que no hi ha errades. Normalment aquest procés fa una suma de comprovació, en què compara els <em>bytes</em> inicials amb els finals, per detectar l’alteració de les dades en el procés de transferència.
</p>
</div></div>
<p>
Per recarregar l’encaminador i sortir de ROMMON un cop ha finalitzat la còpia de l’IOS només s’ha de prémer la tecla i, l’encaminador s’inicia normalment i només cal restaurar els arxius de configuració.
</p>

<p>
<strong>c. Restauració amb ROMMON via Xmodem</strong>. Aquesta opció s’utilitza quan no disposem de cap imatge activa en la memòria Flash, per accedir a ROMMON cal prémer la combinació de tecles <em>ctrl+pause</em> .
</p>
<div class="iocfigure"><a name="Figure89"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Execució de l’ordre tftpdnld

</figcaption><img src="../media/ic10m5u4_244.png" alt="" /></figure>
</div>
<p>
Si no disposem d’un servidor TFTP o no tenim accés a Internet, aquest mètode ens permet recuperar l’IOS mitjançant la transferència de la imatge des d’un directori del PC que actua com a terminal.
</p>

<p>
Una vegada hem accedit al ROMMON executem l’ordre xmodem -c nom_fitxer_imatge, l’opció -c ens indica que s’ha de fer una comprovació de redundància cíclica en la descàrrega de l’IOS.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
L’ordre del ROMMON permet especificar un arxiu de còpia de seguretat que tenim resident en la màquina local. Habitualment s’utilitza quan no disposem d’un servidor de TFTP.
</p>
</div></div>
<p>
En les <span class="figref"><a href="#Figure90"><span>figura</span></a></span> i <span class="figref"><a href="#Figure91"><span>figura</span></a></span> observem que l’ordre executada és <em>xmodem -c c1841-advipservicesk9-mz.124-15.T1.bin-copia</em>.
</p>
<div class="iocfigure"><a name="Figure90"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Execució de l’ordre xmodem -c c1841-advipservicesk9-mz.124-15.T1.bin-copia

</figcaption><img src="../media/ic10m5u4_245.png" alt="" /></figure>
</div><div class="iocfigure"><a name="Figure91"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Restauració d’un arxiu de configuració, ubicat a la unitat d:, mitjançant xmodem

</figcaption><img src="../media/ic10m5u4_246.png" alt="" /></figure>
</div>
<p>
En executar l’ordre, la consola ens indica que l’encaminador està preparat per rebre l’arxiu de configuració. Llavors cal fer l’enviament de l’arxiu des del PC terminal, per fer-ho accedim al menú de transferir del Hyperterminal, en l’opció enviar podem especificar el nom de l’arxiu. S’ha de seleccionar com a protocol Xmodem.
</p>

<p>
<strong>1. Restauració de l’arxiu de configuració</strong>. Quan no es carrega correctament l’arxiu de configuració o no disposem d’aquest arxiu, i en tenim una còpia en el servidor TFTP, podem recuperar una configuració anterior mitjançant l’ordre copy tftp startup-config,hem d’indicar quina és l’adreça IP del servidor TFTP, aquesta ordre es pot utilitzar des del mode privilegiat o des del ROMMON.
</p>

<p>
Per tal de trobar-nos en la situació de no tenir arxiu de configuració l’esborrarem. En la <span class="figref"><a href="#Figure92"><span>figura</span></a></span> podeu observar com s’esborra el fitxer de configuració d’inici amb l’ordre erase startup-config, a continuació fem copy TFTP startup-config.
</p>
<div class="iocfigure"><a name="Figure92"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Exemple de com s’esborra el fitxer startup-config

</figcaption><img src="../media/ic10m5u4_247.png" alt="" /></figure>
</div>
<p>
La <span class="figref"><a href="#Figure93"><span>figura</span></a></span> ens mostra que una vegada s’ha esborrat el fitxer de configuració i hem recarregat l’encaminador ens apareix el quadre de diàleg de configuració del sistema, no configurem absolutament res ja que restaurem l’arxiu mitjançant TFTP.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">copy TFTP startup-config</p>
<p>
L’ordre restaura un arxiu de configuració ubicat en un servidor TFTP i substitueix l’arxiu startupconfig. Podem executar aquesta ordre des del mode privilegiat o amb el ROMMON.
</p>
</div></div><div class="iocfigure"><a name="Figure93"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Exemple de cancel·lació del quadre de configuració del sistema

</figcaption><img src="../media/ic10m5u4_248.png" alt="" /></figure>
</div>
<p>
La <span class="figref"><a href="#Figure94"><span>figura</span></a></span> mostra la configuració d’una interfície amb una adreça IP de la mateixa xarxa del servidor TFTP, a continuació s’utilitza l’ordre copy TFTP startup-config. Observem que la càrrega de l’arxiu es fa correctament i ens mostra la grandària de l’arxiu descarregat.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Diàleg de configuració de sistema</p>
<p>
El diàleg de configuració de sistema és un assistent que s’executa quan no hi ha cap arxiu d’inici en l’encaminador. Ens permet fer una configuració bàsica sense utilitzar les ordres del sistema.
</p>
</div></div><div class="iocfigure"><a name="Figure94"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Restauració del fitxer startup-config

</figcaption><img src="../media/ic10m5u4_249.png" alt="" /></figure>
</div><div class="iocimportant"><div class="ioccontent">
<p>
Quan s’ha restaurat l’arxiu de configuració startup-config cal recarregar l’encaminador amb l’ordre reload per tal d’iniciar l’encaminador amb aquesta nova configuració.
</p>
</div></div>
</div>

<h3><a id="encaminament_ip" >Encaminament IP</a></h3>
<div class="level3">

<p>
L’encaminament IP és una de les funcions fonamentals que els dispositius encaminadors han de fer. Consisteix fonamentalment a determinar quina és la ruta que ha de seguir un paquet de dades d’un host d’origen fins a un host de destinació basant-se en factors com poden ser els següents:
</p>
<ul>
<li class="level1"><div class="li"> Nombre de salts de l’origen a la destinació</div>
</li>
<li class="level1"><div class="li"> Amplada de banda de la línia</div>
</li>
<li class="level1"><div class="li"> Nombre d’usuaris connectats</div>
</li>
<li class="level1"><div class="li"> Prioritats</div>
</li>
</ul>

<p>
Aquests factors o paràmetres són la base per seleccionar quina és la millor mètrica per arribar a una xarxa determinada. La mètrica normalment és un valor numèric que es genera de diferents maneres depenent dels protocols d’encaminament dinàmic que s’utilitzen. Basant-se en aquest paràmetre s’actualitza la taula d’encaminament.
</p>

<p>

</p>

<p>
L’encaminament es pot fer de dues maneres, amb rutes estàtiques o dinàmiques.
</p>

</div>

<h4><a id="encaminament_ip_per_rutes_estatiques" >Encaminament IP per rutes estàtiques</a></h4>
<div class="level4">

<p>
Les rutes estàtiques són aquelles que l’administrador introdueix en els encaminadors manualment, això comporta que s’hagi de tenir un profund coneixement de la xarxa que estem configurant, a més és un sistema que no varia amb el temps i no s’actualitzen les taules d’encaminament d’una manera automàtica quan hi ha modificacions en la xarxa.
</p>

<p>
Podem definir una ruta estàtica quan volem que els clients accedeixin a una xarxa que no està directament connectada a l’encaminador, també permet definir una ruta concreta, de totes les possibles, a una destinació.
</p>

<p>
Per poder veure la taula d’encaminament d’un encaminador tenim l’ordre <em>show ip route</em>, aquesta ordre ens mostra les interfícies que tenim directament connectades, les podem identificar per la lletra C, que identifica les xarxes que el dispositiu coneix. També mostra com s’han generat la resta de rutes. La <span class="figref"><a href="#Figure95"><span>figura</span></a></span> mostra un exemple d’ús de show ip route.
</p>
<div class="iocfigure"><a name="Figure95"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Ús de l’ordre show ip route

</figcaption><img src="../media/ic10m5u4_250.png" alt="" /></figure>
</div><div class="iocimportant"><div class="ioccontent">
<p>
Amb l’ordre <em>show ip route</em> visualitzem la taula d’encaminament que conté les interfícies directament connectades. Si la interfície no està configurada o està desactivada no s’inclou cap ruta en la taula d’encaminament.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">show ip route</p>
<p>
L’ordre ens mostra la taula d’encaminament, especifica totes les rutes, com s’han generat i si estan directament connectades.
</p>
</div></div>
<p>
Les rutes estàtiques s’introdueixen en el sistema amb l’ordre <em>ip route</em> des del mode de configuració global, l’estructura de l’ordre és:
</p>
<pre class="code">Ip route Identificador_de_xarxa Màscara Porta d&#039;enllaç Distància administrativa</pre>

<p>

</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">ip route</p>
<p>
L’ordre <em>ip route</em> ens permet afegir rutes estàtiques a la nostra taula d’encaminament de manera permanent, sempre s’ha d’especificar la xarxa, la màscara i la porta d’enllaç.
</p>
</div></div>
<p>
Aquesta ordre necessita els diferents paràmetres que es detallen a continuació:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Identificador de xarxa</strong>. Identifica una xarxa que no tenim directament connectada a l’encaminador.</div>
</li>
<li class="level1"><div class="li"> <strong>Màscara</strong>. Hem d’especificar la màscara de la xarxa de destinació.</div>
</li>
<li class="level1"><div class="li"> <strong>Porta d’enllaç o interfície local</strong>. Aquest paràmetre pot tenir dos valors diferents, pot ser l’adreça de l’encaminador següent que dóna accés a la xarxa o la interfície local de l’encaminador per on surt el paquet de dades.</div>
</li>
<li class="level1"><div class="li"> <strong>Distància administrativa</strong>. La distància administrativa és un valor opcional, es pot representar amb un nombre comprès entre 0 i 255. En cas de tenir més d’una ruta per accedir a la mateixa xarxa els paquets de dades utilitzen la que té una distància administrativa més baixa. Aquest valor ens indica la fiabilitat de la ruta, no vol indicar el mateix que la mètrica, recordeu que la mètrica permet únicament generar la ruta en la taula.</div>
</li>
</ul>
<div class="iocimportant"><div class="ioccontent">
<p>
La distància administrativa indica la fiabilitat de la ruta i la seva prioritat. Com més petita millor. Per exemple, les xarxes directament connectades tenen una distància administrativa 0, mentre que les rutes estàtiques tenen com a valor 1, si en una taula hi ha dues rutes que apunten la mateixa destinació se seleccionà la que tingui la distància administrativa més petita.
</p>
</div></div><div class="ioctext"><div class="ioccontent"><p class="ioctitle">Confiabilitat de la ruta</p>
<p>
La confiabilitat de la ruta defineix realment la fiabilitat del protocol d’encaminament que genera la ruta, que proporciona una distància administrativa en aquesta ruta. Com més baix sigui aquest valor més prioritat té la ruta i es considerarà més fiable.
</p>
</div></div>
<p>
Si volem esborrar una ruta estàtica hem d’utilitzar la mateixa ordre però amb la paraula clau “no” al davant, la sintaxi de la sentència és la següent:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">no IP route</p>
<p>
<em>no IP route</em> és una ordre que permet a l’administrador eliminar les entrades de rutes estàtiques que s’han generat. S’ha d’especificar l’identificador de xarxa i la màscara.
</p>
</div></div><pre class="code">No ip route Identificador_de _xarxa Màscara Porta d&#039;enllaç</pre>

<p>
En la <span class="figref"><a href="#Figure96"><span>figura</span></a></span> observem un disseny de xarxa amb dos encaminadors, afegim les rutes estàtiques i determinem quin és el contingut de la taula d’encaminament.
</p>
<div class="iocfigure"><a name="Figure96"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Disseny de xarxa amb dos encaminadors

</figcaption><img src="../media/ic10m5u4_101.png" alt="" /></figure>
</div>
<p>
Les adreces IP que s’utilitzen en la <span class="figref"><a href="#Figure96"><span>figura</span></a></span> és mostren en la <span class="tabref"><a href="#Table13"><span>taula</span></a></span>, cal considerar que les màscares de xarxa són pures.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Màscara de xarxa pura</p>
<p>
Es diu que una màscara de xarxa és pura quan no s’ha fet cap modificació en la màscara associada a l’adreça IP.
</p>
</div></div><div class="ioctable ">
<div class="titletable"><a name="Table13"><span>Taula: </span></a>Adreces IP de les interfícies dels encaminadors</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Dispositiu </th><th class="col1"> Adreça eth0 </th><th class="col2"> Adreça eth1 </th><th class="col3"> Serial </th>
	</tr>
	<tr class="row1">
		<td class="col0"> Encaminador Mad </td><td class="col1"> 172.17.1.1 </td><td class="col2"> No configurat </td><td class="col3"> 192.168.1.1 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> Encaminador Bcn </td><td class="col1"> 10.0.0.1 </td><td class="col2"> 11.0.0.1 </td><td class="col3"> 192.168.1.2 </td>
	</tr>
</table></div>
</div>
<p>
Quan configurem les interfícies amb una adreça IP en els encaminadors es genera automàticament les taules d’encaminament, aquests ja coneixen les xarxes que tenen directament connectades, però no les xarxes remotes. S’han d’afegir manualment com s’especifica en la <span class="tabref"><a href="#Table14"><span>taula</span></a></span>.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table14"><span>Taula: </span></a>Configuració de les xarxes desconegudes pels encaminadors Mad i Bcn</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Encaminador </th><th class="col1"> Xarxa </th><th class="col2"> Afegir ruta estàtica a cada encaminador </th>
	</tr>
	<tr class="row1">
		<td class="col0"> Mad </td><td class="col1"> 10.0.0.0  <br/>
 11.0.0.0 </td><td class="col2"> ip route 10.0.0.0 255.0.0.0 192.168.1.2 <br/>
ip route 11.0.0.0 255.0.0.0 192.168.1.2 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> Bcn </td><td class="col1"> 172.17.0.0 </td><td class="col2"> ip route 172.17.0.0 255.0.0.0 192.168.1.1 </td>
	</tr>
</table></div>
</div>
<p>
Hem introduït les rutes configurant com a porta d’enllaç l’adreça de l’encaminador següent, aquest paràmetre es podria substituir pel nom de la interfície local per on enviem les dades, la <span class="tabref"><a href="#Table15"><span>taula</span></a></span> mostra com podem afegir les mateixes rutes però d’aquesta altra manera.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table15"><span>Taula: </span></a>Configuració de les xarxes desconegudes pels encaminadors Mad i Bcn 2a. forma</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Encaminador </th><th class="col1"> Xarxa </th><th class="col2"> Afegir ruta estàtica a cada encaminador </th>
	</tr>
	<tr class="row1">
		<td class="col0"> Mad </td><td class="col1"> 10.0.0.0  <br/>
 11.0.0.0 </td><td class="col2"> ip route 10.0.0.0 255.0.0.0 S0  <br/>
 ip route 11.0.0.0 255.0.0.0 S0 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> Bcn </td><td class="col1"> 172.17.0.0 </td><td class="col2"> ip route 172.17.0.0 255.0.0.0 S1 </td>
	</tr>
</table></div>
</div>
<p>
Quan s’han afegit les rutes observem la taula d’encaminament i podem identificar les rutes directament connectades amb la lletra C i les estàtiques perquè tenen la lletra clau S. Per comprovar que les rutes funcionen correctament només cal fer un ping des de qualsevol dels encaminadors cap a una de les xarxes remotes. Si volem veure per quins encaminadors passa un paquet hem d’utilitzar l’ordre traceroute.
</p>
<pre class="code">Mad# Ping 11.0.0.1
Mad# traceroute 11.0.0.1</pre>

<p>
Quan l’accés a múltiples xarxes es fa per una mateixa porta d’enllaç podem introduir una ruta estàtica per a cada xarxa o configurar una ruta per defecte per a totes les destinacions amb un camí comú. Quan s’examina la taula d’encaminament si la xarxa de destinació té una ruta estàtica pròpia s’utilitza aquesta ruta, sinó, s’utilitza la ruta per defecte.
</p>

<p>
Per configurar una ruta estàtica utilitzem l’ordre ip route amb l’identificador de xarxa a 0 i la màscara a 0, aquests valors indiquen qualsevol destinació amb qualsevol màscara.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Rutes per defecte</p>
<p>
Les rutes per defecte permeten substituir totes les rutes estàtiques que tenen una mateixa porta d’enllaç, això implica una tasca administrativa inferior que si hem d’especificar cadascuna de les rutes.
</p>
</div></div>
<p>
En la <span class="tabref"><a href="#Table16"><span>taula</span></a></span> podeu observar que en l’encaminador Mad, en lloc de crear una ruta estàtica per a cada xarxa, afegim una única ruta per defecte per a qualsevol trànsit. L’accés a les xarxes 10.0.0.0 i 11.0.0.0 es fa amb aquesta ruta i qualsevol paquet de dades s’envia a l’encaminador 192.168.1.2.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Rutes dinàmiques</p>
<p>
Les rutes es generen automàticament quan es configura un protocol dinàmic en diversos encaminadors. Aquests comparteixen les taules en intervals determinats de temps periòdicament.
</p>
</div></div><div class="ioctable ">
<div class="titletable"><a name="Table16"><span>Taula: </span></a>Configuració de la ruta per defecte als encaminadors Mad i Bcn</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Encaminador </th><th class="col1"> Xarxa </th><th class="col2"> Afegir ruta estàtica a cada encaminador </th>
	</tr>
	<tr class="row1">
		<td class="col0"> Mad </td><td class="col1"> 10.0.0.0  <br/>
 11.0.0.0 </td><td class="col2"> ip route 0.0.0.0 0.0.0.0 192.168.1.2 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> Bcn </td><td class="col1"> 172.17.0.0 </td><td class="col2"> ip route 172.17.0.0 255.255.0.0 S1 </td>
	</tr>
</table></div>
</div>
</div>

<h4><a id="encaminament_ip_per_rutes_dinamiques" >Encaminament IP per rutes dinàmiques</a></h4>
<div class="level4">

<p>
Les rutes dinàmiques es generen automàticament en els encaminadors quan activem els protocols d’encaminament per a les diferents xarxes, a diferència de les rutes estàtiques les taules d’encaminament es configuren automàticament davant de qualsevol canvi en la xarxa, això ens permet una major escalabilitat i fiabilitat per a la gestió i resolució de rutes.
</p>

<p>
S’ha de tenir en compte que es poden presentar problemes de redundància de rutes i es poden generar bucles d’encaminament.
</p>

<p>
Quan tots els encaminadors han generat les seves taules i han actualitzat als dispositius veïns es diu que han convergit.
</p>

</div>

<h3><a id="protocols_d_encaminament" >Protocols d&#039;encaminament</a></h3>
<div class="level3">

<p>
Els protocols d’encaminament es poden classificar en protocols de vector-distància i protocols estat de l’enllaç. És important tenir en compte les característiques principals d’aquests protocols, la seva classificació i com s’han de configurar en l’encaminador.
</p>

</div>

<h4><a id="protocols_vector-distancia" >Protocols vector-distància</a></h4>
<div class="level4">
<div class="iocimportant"><div class="ioccontent">
<p>
Els protocols vector-distància tenen com a característiques principals:
</p>
<ul>
<li class="level1"><div class="li"> Els encaminadors no tenen informació de la topologia completa de la xarxa; només coneixen la distància a cada xarxa i el proper pas per arribar-hi.</div>
</li>
<li class="level1"><div class="li"> Els encaminadors s’envien actualitzacions periòdiques de la seva informació.</div>
</li>
</ul>
</div></div>
<p>
La mètrica per determinar quina és la millor ruta per on enviar un paquet de dades és el nombre de salts que ha de fer un paquet des de l’origen fins a la destinació. Els protocols més comuns del tipus vector-distància són els següents:
</p>
<ul>
<li class="level1"><div class="li"> RIP: protocol d’encaminament d’Internet.</div>
</li>
<li class="level1"><div class="li"> IGRP: protocol d’encaminament de passarel·la interior.</div>
</li>
</ul>

<p>
Les principals característiques d’aquests protocols es mostren en la <span class="tabref"><a href="#Table16"><span>taula</span></a></span>.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table16:"><span>Taula: </span></a>Característiques dels protocols vector-distància</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Protocol </th><th class="col1"> Mètrica </th><th class="col2"> Distància administrativa </th><th class="col3"> Nombre màxim de salts </th><th class="col4"> Període actualització </th>
	</tr>
	<tr class="row1">
		<td class="col0"> RIP </td><td class="col1"> Salts </td><td class="col2"> 120 </td><td class="col3"> 15 </td><td class="col4"> 30 segons </td>
	</tr>
	<tr class="row2">
		<td class="col0"> IGRP </td><td class="col1"> Salts, amplada de banda, retard, càrrega i fiabilitat. </td><td class="col2"> 100 </td><td class="col3"> 255 </td><td class="col4"> 90 segons </td>
	</tr>
</table></div>
</div>
</div>

<h4><a id="configuracio_del_protocol_rip" >Configuració del protocol RIP</a></h4>
<div class="level4">

<p>
El protocol RIP és un protocol d’encaminament de vector-distància que es destina a xarxes petites i mitjanes. La seva característica principal és que no és un protocol propietari, el poden utilitzar tots els fabricants d’encaminadors.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Protocol d&#039;encaminament RIP</p>
<p>
Igual que les granotes salten per desplaçar-se fins a una destinació concreta, el protocol RIP utilitza el nombre de salts com a mètrica per generar les taules d’encaminament i permetre als paquets de dades arribar a la xarxa de destinació. Aquest protocol s’ha de configurar en tots els encaminadors que volem que intercanviïn informació.
</p>
</div></div>
<p>
L’encaminador coneix les rutes que té directament connectades, s’ha de configurar RIP globalment en l’encaminador i afegir les xarxes que coneix en cada interfície. RIP fa les funcions següents:
</p>
<ul>
<li class="level1"><div class="li"> Anuncia totes las xarxes que coneix l’encaminador en els encaminadors de la xarxa directament connectats a les seves interfícies.</div>
</li>
<li class="level1"><div class="li"> Escolta les actualitzacions externes.</div>
</li>
<li class="level1"><div class="li"> Difon les actualitzacions amb informació de l’estat de la xarxa en totes les interfícies.</div>
</li>
</ul>

<p>
L’ordre per configurar el protocol RIP s’executa des del mode de configuració global i és router rip, en executar-la accedim al mode de configuració del protocol, un cop en aquest mode s’han d’especificar les xarxes per les quals treballarà (cada xarxa està assignada a una interfície) amb l’ordre network. A continuació podem veure un exemple d’ús d’aquestes ordres.
</p>
<pre class="code">Router(config)#Router rip
Router(config-router)#network 192.168.1.0</pre>

<p>
Cal que observeu en l’exemple anterior que hem indicat a l’encaminador que el protocol RIP envia i rep actualitzacions per la interfície que té configurada una adreça IP de la xarxa 192.168.1.0.
</p>

<p>
Hi ha una sèrie d’ordres per visualitzar les estadístiques de RIP i els temps d’actualització aquestes estadístiques, són les següents:
</p>
<ul>
<li class="level1"><div class="li"> <strong>show ip protocols</strong>. Mostra totes les variables que utilitza el protocol RIP i identifica cadascuna de les variables de temps que utilitza, aquestes variables són les que es mostren en la <span class="tabref"><a href="#Table17"><span>taula</span></a></span>.</div>
</li>
</ul>
<div class="ioctable ">
<div class="titletable"><a name="Table17"><span>Taula: </span></a>Variables del protocol RIP</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Variable </th><th class="col1"> Valor </th><th class="col2"> Descripció </th>
	</tr>
	<tr class="row1">
		<td class="col0"> UPDATE EVERY </td><td class="col1"> 30 </td><td class="col2"> S’envien actualitzacions cada 30 segons. </td>
	</tr>
	<tr class="row2">
		<td class="col0"> INVALID AFTER </td><td class="col1"> 180 </td><td class="col2"> Es descarta el paquet després de 180 segons. </td>
	</tr>
	<tr class="row3">
		<td class="col0"> SEND </td><td class="col1"> 1 </td><td class="col2"> Versió protocol RIP per enviar actualitzacions. </td>
	</tr>
	<tr class="row4">
		<td class="col0"> RECV </td><td class="col1"> 1,2 </td><td class="col2"> Pot rebre paquets de qualsevol versió RIP. </td>
	</tr>
	<tr class="row5">
		<td class="col0"> Routing for networks </td><td class="col1"> 172.17.0.0 <br/>
192.168.0.0 </td><td class="col2"> Envia actualitzacions d’aquestes xarxes. </td>
	</tr>
	<tr class="row6">
		<td class="col0"> Routing inf sources </td><td class="col1"> 192.168.0.2 </td><td class="col2"> Encaminador que actualitza la nostra taula. </td>
	</tr>
</table></div>
</div><ul>
<li class="level1"><div class="li"> <strong>show ip rip database</strong>. Ens mostra la base de dades del protocol RIP amb tota la informació referent a quines rutes té directament connectades i quin encaminador proporciona les rutes addicionals.</div>
</li>
<li class="level1"><div class="li"> <strong>Debug ip rip</strong>. Proporciona a l’administrador la informació necessària per determinar com està treballant el protocol, és un mode de depuració, es pot desactivar executant undebug ip rip.</div>
</li>
</ul>

<p>
Amb el disseny de la <span class="figref"><a href="#Figure97"><span>figura</span></a></span> fem un exemple de configuració de RIP, on ja s’han configurat totes les interfícies dels encaminadors amb les seves adreces i s’ha activat el protocol RIP en totes les interfícies excepte en la de l’encaminador Mad.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">debug</p>
<p>
L’ordre permet a l’administrador activar el mode de depuració per un protocol en concret. El mode de depuració mostra missatges que indiquen totes les accions que fa el protocol. Per desactivar el mode de depuració s’utilitza l’ordre undebug.
</p>
</div></div><div class="iocfigure"><a name="Figure97"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Disseny d’una xarxa RIP

</figcaption><img src="../media/ic10m5u4_103.png" alt="" /></figure>
</div>
<p>
La <span class="tabref"><a href="#Table18"><span>taula</span></a></span> mostra les adreces IP; cal considerar que les màscares de xarxa són pures.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table18"><span>Taula: </span></a>Adreces dels encaminadors Mad i Bcn</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Dispositiu </th><th class="col1"> Adreça eth0 </th><th class="col2"> Adreça eth1 </th><th class="col3"> Serial </th>
	</tr>
	<tr class="row1">
		<td class="col0"> Encaminador Mad </td><td class="col1"> 172.17.1.1 </td><td class="col2"> No configurat </td><td class="col3"> 192.168.1.1 </td>
	</tr>
	<tr class="row2">
		<td class="col0"> Encaminador Bcn </td><td class="col1"> 10.0.0.1 </td><td class="col2"> 11.0.0.1 </td><td class="col3"> 192.168.1.2 </td>
	</tr>
</table></div>
</div>
<p>
Fem la configuració sencera de l’encaminador Mad amb l’ordre següent:
</p>
<ol>
<li class="level1"><div class="li"> Configurar adreces en totes les interfícies. Cal activar les interfícies dels encaminadors un cop s’han configurat. Utilitzarem l’ordre no shutdown.</div>
</li>
<li class="level1"><div class="li"> Configurar RIP.</div>
</li>
<li class="level1"><div class="li"> Mostrar informació de configuració.</div>
</li>
</ol>

<p>
En la <span class="figref"><a href="#Figure98"><span>figura</span></a></span> podeu observar la taula d’encaminament de l’encaminador Mad mitjançant l’ordre show ip route. Veiem que només coneix les xarxes que té directament connectades.
</p>
<div class="iocfigure"><a name="Figure98"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Configuració d’interfícies i taula d’encaminament

</figcaption><img src="../media/ic10m5u4_236.png" alt="" /></figure>
</div>
<p>
La <span class="figref"><a href="#Figure99"><span>figura</span></a></span> mostra com es fa la configuració de l’encaminador per utilitzar el protocol RIP, només cal tornar a observar la taula d’encaminament i veure que ja s’ha actualitzat amb les noves rutes que genera RIP. El contingut de la taula d’encaminament ens indica amb quin protocol s’ha generat la ruta o si està directament connectada i quin és el salt següent.
</p>
<div class="iocfigure"><a name="Figure99"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Resultat d’executar show ip route

</figcaption><img src="../media/ic10m5u4_237.png" alt="" /></figure>
</div>
<p>
En la <span class="figref"><a href="#Figure100"><span>figura</span></a></span> ja s’ha configurat el protocol d’encaminament, podem observar amb la comanda show IP protocols totes les variables que utilitza el protocol rip i identificar cadascuna de les variables de temps i analitzar-ne els valors.
</p>
<div class="iocfigure"><a name="Figure100"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Resultat d’executar show ip protocol

</figcaption><img src="../media/ic10m5u4_238.png" alt="" /></figure>
</div>
<p>
Podeu veure que les variables de temps de la imatge especifiquen els valors següents:
</p>
<ul>
<li class="level1"><div class="li"> Invalid after 180 seconds: vol dir que es descarta el paquet després de 180 segons d’espera.</div>
</li>
<li class="level1"><div class="li"> Interface Send-Recv: podem veure per a cada interfície la versió del protocol que es fa servir per rebre o enviar actualitzacions. Les dues interfícies d’aquest exemple envien amb la versió 1 del protocol i reben actualitzacions de la versió 1 i/o 2 del protocol.</div>
</li>
</ul>

<p>
La <span class="figref"><a href="#Figure101"><span>figura</span></a></span> ens proporciona informació de la base de dades del protocol RIP amb totes les rutes connectades. Podem comprovar el bon funcionament de la configuració, efectuant un ping en diverses adreces IP de diferents xarxes. Cal executar l’ordre traceroute per determinar els salts que fa un paquet de dades fins a la destinació.
</p>
<div class="iocfigure"><a name="Figure101"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Resultat d’executar show ip rip database

</figcaption><img src="../media/ic10m5u4_251.png" alt="" /></figure>
</div>
<p>
Amb el disseny de xarxa de la <span class="figref"><a href="#Figure102"><span>figura</span></a></span> veurem un exemple de redundància de rutes, un paquet de dades pot optar per utilitzar diferents rutes per arribar a una destinació, els encaminadors han de seleccionar la millor ruta basant-se en la mètrica, només s’incorpora en la taula una de totes les rutes possibles per arribar a la destinació.
</p>
<div class="iocfigure"><a name="Figure102"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Exemple de rutes redundants

</figcaption><img src="../media/ic10m5u4_108.png" alt="" /></figure>
</div>
<p>
Els encaminadors generen la taula d’encaminament publicant i actualitzant les taules periòdicament, els encaminadors coneixen les xarxes directament connectades, com es mostra en la <span class="tabref"><a href="#Table19"><span>taula</span></a></span>.
</p>

<p>
Les taules d’encaminament descarten múltiples rutes per a una mateixa destinació generades amb un protocol, si observem la <span class="tabref"><a href="#Table20"><span>taula</span></a></span> podem deduir com l’encaminador MAD ha seleccionat les rutes en les xarxes basant-se en la mètrica.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table19"><span>Taula: </span></a>Taula de xarxes del disseny de rutes redundants</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Encaminador </th><th class="col1"> Xarxes conegudes </th><th class="col2"> Xarxes desconegudes </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> MAD         </td><td class="col1 leftalign"> 1, 2, 5          </td><td class="col2 leftalign"> 3, 4, 6, 7          </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> BCN         </td><td class="col1 leftalign"> 2, 3, 4, 6       </td><td class="col2 leftalign"> 1, 5, 7             </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> VAL         </td><td class="col1 leftalign"> 5, 7             </td><td class="col2 leftalign"> 1, 2, 3, 4, 6       </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> BILB        </td><td class="col1 leftalign"> 6, 7             </td><td class="col2 leftalign"> 1, 2, 3, 4, 5       </td>
	</tr>
</table></div>
</div><div class="ioctable ">
<div class="titletable"><a name="Table20"><span>Taula: </span></a>Taula de rutes de l’encaminador Mad</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Destinació </th><th class="col1 leftalign"> Possibles rutes destinació          </th><th class="col2"> Mètrica </th><th class="col3"> Ruta definitiva </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> Xarxa 3    </td><td class="col1"> Encaminador Bcn  <br/>
Encaminador Val </td><td class="col2 leftalign"> 1 <br/>
3  </td><td class="col3"> Encaminador Bcn </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> Xarxa 4    </td><td class="col1"> Encaminador Bcn  <br/>
Encaminador Val </td><td class="col2 leftalign"> 1 <br/>
3  </td><td class="col3"> Encaminador Bcn </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> Xarxa 6    </td><td class="col1"> Encaminador Bcn  <br/>
Encaminador Val </td><td class="col2 leftalign"> 1 <br/>
2  </td><td class="col3"> Encaminador Bcn </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> Xarxa 7    </td><td class="col1"> Encaminador Bcn  <br/>
Encaminador Val </td><td class="col2 leftalign"> 2 <br/>
1  </td><td class="col3"> Encaminador Val </td>
	</tr>
</table></div>
</div>
<p>
L’encaminador MAD de la <span class="tabref"><a href="#Table20"><span>taula</span></a></span> pot arribar a la xarxa 3 per dues possibles rutes: per l’encaminador Bcn o per l’encaminador Val, per determinar quina de les rutes és la millor compta el nombre de salts que hauran de fer els paquets de dades i selecciona la ruta amb un valor de mètrica més baix, en aquest cas BCN.
</p>

<p>
Si una de les xarxes o un encaminador no està disponible, els protocols d’encaminament s’encarreguen d’actualitzar les taules dels veïns i seleccionar una altra ruta, encara que tingui una mètrica més elevada.
</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Quan una de les rutes cau, els protocols d’encaminament permeten que les taules d’encaminament s’actualitzin automàticament. Les actualitzacions dinàmiques podrien generar problemes de redundància de rutes. Les xarxes han de convergir; això vol dir que malgrat que hi hagi rutes redundants per arribar a una destinació tots els encaminadors han de tenir taules coherents entre ells.
</p>
</div></div>
<p>
La <span class="figref"><a href="#Figure103"><span>figura</span></a></span> ens mostra el resultat d’executar l’ordre debug ip rip, la qual activa el mode de depuració del protocol ip i ens mostra estadístiques d’ús de forma contínua. Per a desactivar-lo utilitzem l’ordreundebug ip rip.
</p>
<div class="iocfigure"><a name="Figure103"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Resultat d’executar debug ip rip

</figcaption><img src="../media/ic10m5u4_252.png" alt="" /></figure>
</div>
</div>

<h4><a id="configuracio_del_protocol_igrp" >Configuració del protocol IGRP</a></h4>
<div class="level4">

<p>
El protocol IGRP és un protocol d’encaminament de <em>gateway</em> interior propietat de Cisco. Aprofita les característiques de RIP però millora la generació de rutes utilitzant altres mètriques que no són el nombre de salts, són les següents:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Retard</strong>. És una de les mètriques utilitzades, és la suma de retards de l’origen a la destinació.</div>
</li>
<li class="level1"><div class="li"> <strong>Amplada de banda</strong>. És una de les mètriques utilitzades i es calcula tenint com a referència l’amplada de banda més baixa de totes les connexions del trajecte.</div>
</li>
<li class="level1"><div class="li"> <strong>Càrrega</strong>. És un valor comprès entre 1 (ús mínim ) i 255 (saturació de l’enllaç), indica la quantitat de trànsit o saturació en un segment de xarxa durant un període de temps, normalment cinc minuts. Per defecte no està activa i està ajustada a 0.</div>
</li>
<li class="level1"><div class="li"> <strong>Confiabilitat</strong>. És un valor que funciona al revés de la càrrega, està comprès entre 1 (enllaç inutilitzat) i 255 (enllaç lliure d’errors), analitza el trànsit de xarxa d’un període de temps, normalment els cinc minuts anteriors per determinar els errors que han succeït. Per defecte no està activa i està ajustada a 0.</div>
</li>
</ul>

<p>
Els temps d’actualització entre encaminadors és de 90 segons i s’utilitzen paquets de difusió o broadcast.
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Protocol d&#039;encaminament IGRP</p>
<p>
L’IGRP és un protocol d’encaminament de vector-distància. Utilitza com a mètrica paràmetres de l’estat de la línia i el nombre de salts per generar les taules d’encaminament. Aquest protocol s’ha de configurar en tots els encaminadors que volem que intercanviïn informació, a més s’han d’especificar les xarxes per les quals el protocol treballarà i un número de sistema autònom.
</p>
</div></div>
<p>
Per activar IGRP s’utilitzen les mateixes ordres que per a RIP, però hem d’indicar un paràmetre addicional, que és el número de sistema autònom, aquest valor indica el conjunt d’encaminadors que poden intercanviar les seves taules d’actualització. S’anomena domini de processos.
</p>
<pre class="code">Router(config)#router igrp 100
Router(config-router)#network 192.168.1.0</pre>

<p>
Cal que observeu en l’exemple anterior que hem indicat a l’encaminador que el protocol IGRP enviarà i rebrà actualitzacions als encaminadors que utilitzen el valor de sistema autònom 100 per la interfície que té configurada una adreça IP de la xarxa 192.168.1.0.
</p>

</div>

<h4><a id="protocols_estat_de_l_enllac" >Protocols estat de l&#039;enllaç</a></h4>
<div class="level4">

<p>

</p>
<div class="iocimportant"><div class="ioccontent">
<p>
Els protocols d’estat de l’enllaç tenen com a característiques principals:
</p>
<ul>
<li class="level1"><div class="li"> Cada encaminador té informació de tota la topologia de la xarxa.</div>
</li>
<li class="level1"><div class="li"> Els encaminadors només s’han d’enviar actualitzacions quan hi ha un canvi als enllaços.</div>
</li>
</ul>
</div></div>
<p>
Els protocols més comuns de l’estat de l’enllaç són:
</p>
<ul>
<li class="level1"><div class="li"> <strong>EIGRP</strong>: protocol d’encaminament de passarel·la interior millorat. Es considera un protocol híbrid.</div>
</li>
<li class="level1"><div class="li"> <strong>OSPF</strong>: protocol primer el camí més curt.</div>
</li>
</ul>

<p>
La mètrica per a aquest tipus de protocols depèn de diversos factors. En la <span class="tabref"><a href="#Table21"><span>taula</span></a></span> es mostren les principals característiques dels protocols d’estat de l’enllaç.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table21"><span>Taula: </span></a>Característiques dels protocols d’estat de l’enllaç</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Protocol </th><th class="col1"> Distància administrativa </th><th class="col2 leftalign"> Mètrica                                        </th><th class="col3 leftalign"> Taules                           </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> EIGRP    </td><td class="col1 leftalign"> 90                       </td><td class="col2"> Amplada de banda de la línia <br/>
Cost <br/>
Retard </td><td class="col3"> Veïnat, topològica, encaminament </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> OSPF     </td><td class="col1 leftalign"> 110                      </td><td class="col2"> Amplada de banda de la línia <br/>
Cost <br/>
Retard </td><td class="col3"> Veïnat, topològica, encaminament </td>
	</tr>
</table></div>
</div>
</div>

<h4><a id="configuracio_del_protocol_eigrp" >Configuració del protocol EIGRP</a></h4>
<div class="level4">

<p>
El protocol EIGRP és una millora del protocol IGRP; també és propietat de Cisco. Utilitza tres taules d’informació per generar les rutes:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Veïnat</strong>. Conté els encaminadors que utilitzen el protocol EIGRP i estan directament connectats al nostre dispositiu, són aquells que transfereixen la seva taula d’encaminament.</div>
</li>
<li class="level1"><div class="li"> <strong>Topològica</strong>. Mostra les rutes i el seu estat, la mètrica i la distància als encaminadors veïns per a cadascuna de les rutes. Conté informació de tota la topologia de la xarxa.</div>
</li>
<li class="level1"><div class="li"> <strong>Encaminament</strong>. A partir de la taula topològica es genera la taula de rutes.</div>
</li>
</ul>

<p>
Per configurar EIGRP utilitzem les mateixes ordres que amb IGRP, també s’ha d’especificar un valor de sistema autònom:
</p>
<pre class="code">Router(config)#Router eigrp 100
Router(config-router)#network 192.168.1.0</pre>
<div class="iocimportant"><div class="ioccontent">
<p>
El <strong>sistema autònom</strong> ens indica quins encaminadors poden intercanviar les seves taules; aquest valor el defineix l’administrador.
</p>
</div></div>
<p>
Una vegada hem configurat els encaminadors amb el protocols EIGRP aquests comencen a enviar paquets de salutació o Hello als dispositius de la xarxa i es construeix la taula d’encaminadors veïns amb què intercanviarem actualitzacions, a continuació es genera la taula topològica.
</p>
<div class="iocnote"><div class="ioccontent">
<p>
Paquets Hello
</p>

<p>
Per conèixer els veïns del nostre barri i tenir una relació cordial utilitzem les salutacions; de la mateixa manera, els encaminadors utilitzen els paquets Hello. Són paquets de salutació entre encaminadors que utilitzen EIGRP, gràcies als quals el protocol pot construir les taules amb informació dels veïns i la topologia de la xarxa.
</p>
</div></div>
<p>
No s’utilitzen actualitzacions cada 30 o 90 segons com en altres protocols, l’encaminador detecta si un veí és actiu mitjançant un missatge de salutació aproximadament cada 60 segons.
</p>

<p>
Les rutes generades poden tenir diferents estats, es mostren en la <span class="tabref"><a href="#Table22"><span>taula</span></a></span>.
</p>
<div class="ioctable ">
<div class="titletable"><a name="Table22"><span>Taula: </span></a>Estats d’una ruta generada amb OSPF</div>
<div class="table"><table class="inline">
	<tr class="row0">
		<th class="col0"> Estat de la ruta </th><th class="col1 leftalign"> Descripció                                  </th>
	</tr>
	<tr class="row1">
		<td class="col0 leftalign"> P-PASSIVE        </td><td class="col1 leftalign"> Estat normal de la ruta                     </td>
	</tr>
	<tr class="row2">
		<td class="col0 leftalign"> A-ACTIVE         </td><td class="col1 leftalign"> La ruta està efectuant càlculs.             </td>
	</tr>
	<tr class="row3">
		<td class="col0 leftalign"> U-UPDATE         </td><td class="col1 leftalign"> S’estan enviant actualitzacions.            </td>
	</tr>
	<tr class="row4">
		<td class="col0 leftalign"> Q-QUERY          </td><td class="col1"> S’està enviant una consulta a aquesta ruta. </td>
	</tr>
	<tr class="row5">
		<td class="col0 leftalign"> R-REPLY          </td><td class="col1 leftalign"> S’està enviant una rèplica a aquesta ruta.  </td>
	</tr>
	<tr class="row6">
		<td class="col0 leftalign"> r-REPLY STATUS   </td><td class="col1 leftalign"> S’espera una rèplica.                       </td>
	</tr>
</table></div>
</div>
<p>
Per veure el contingut de les taules i la informació dels veïns tenim les ordres següents:
</p>
<ul>
<li class="level1"><div class="li"> <strong>Show ip eigrp neighbors</strong>. Ens mostra quins encaminadors es consideren veïns i per quina interfície estan connectats.</div>
</li>
<li class="level1"><div class="li"> <strong>Show ip eigrp topology</strong>. Ens mostra la taula de topologia amb totes les rutes incorporades i l’estat en què estan, s’utilitza per escollir successors viables i, per tant, es construeix la taula d’encaminament amb aquesta informació. Aquesta ordre té diversos modificadors per filtrar els resultats que es mostren en la consola.</div>
</li>
<li class="level1"><div class="li"> <strong>Show ip Eigrp traffic</strong>. Podem veure les estadístiques de trànsit del protocol EIGRP.show ip eigrp “taula”.</div>
</li>
</ul>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">show ip eigrp &quot;taula&quot;</p>
<p>
Amb l’ordre <code>show ip eigrp “taula”</code> podem visualitzar totes les taules que utilitza el protocol EIGRP, per exemple les de topologia o veïns. També serveix per obtenir estadístiques del trànsit de xarxa.
</p>
</div></div>
<p>
En la <span class="figref"><a href="#Figure104"><span>figura</span></a></span> podeu observar com es configura EIGRP, l’execució de lestaula ordres show ip eigrp neighbors i show IP eigrp topology.
</p>

<p>
La <span class="figref"><a href="#Figure105"><span>figura</span></a></span> mostra les estadístiques Eigrp i la taula de rutes, en què s’utilitzen les ordresShow IP Eigrp trafficishow IP route.
</p>
<div class="iocfigure"><a name="Figure104"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Configuració de l’EIGRP

</figcaption><img src="../media/ic10m5u4_253.png" alt="" /></figure>
</div><div class="iocfigure"><a name="Figure105"></a><figure>
<figcaption><span class="figuretitle">Figura</span>

Resultat d’executar sh ip eigrp traffic

</figcaption><img src="../media/ic10m5u4_254.png" alt="" /></figure>
</div>
</div>

<h4><a id="configuracio_del_protocol_ospf" >Configuració del protocol OSPF</a></h4>
<div class="level4">

<p>
El protocol OSPF és un protocol obert. Amb aquest protocol cada encaminador té un mapa complet de la xarxa i genera la taula d’encaminament basant-se en aquest mapa, escollint les rutes amb una mètrica més petita.
</p>

<p>
Com que OSPF coneix totes les possibles rutes detecta automàticament les rutes redundants i les elimina, utilitza el concepte d’àrea enlloc de sistema autònom, però té una funció semblant, especifica quins encaminadors poden intercanviar les seves taules de rutes i tenen la mateixa base de dades topològica. Hem de considerar el concepte d’àrea com una subdivisió d’un sistema autònom.
</p>

<p>
Les característiques principals d’OSPF són les següents:
</p>
<div class="ioctext"><div class="ioccontent"><p class="ioctitle">Protocol d&#039;encaminament OSPF</p>
<p>
L’OSPF és un protocol d’encaminament d’estat de l’enllaç que utilitza com a mètrica paràmetres de l’estat de la línia. Aquest protocol s’ha de configurar en tots els encaminadors que volem que intercanviïn informació.
</p>
</div></div><ul>
<li class="level1"><div class="li"> <strong>Redueix el consum de xarxa</strong>. No hi ha actualitzacions periòdiques com en els protocols de vector distància, hem de tenir en compte que tots els encaminadors coneixen el mapa de la xarxa.</div>
</li>
<li class="level1"><div class="li"> <strong>Temps curt de convergència</strong>. Com que es disposa de tot el mapa de xarxa quan cau una línia automàticament s’estableix una ruta alternativa.</div>
</li>
<li class="level1"><div class="li"> <strong>Topologia</strong> <strong>sense</strong> <strong>bucles</strong>. No es permeten bucles d’encaminament; es fa una selecció de ruta amb l’algoritme SPF (<em>shortest path first</em> o primer el camí més curt) que determina el camí més curt a totes les destinacions.</div>
</li>
<li class="level1"><div class="li"> <strong>Multiplataforma</strong>. Com que OSPF és un estàndard obert, el pot utilitzar qualsevol fabricant en els seus dispositius.</div>
</li>
</ul>

<p>
El protocol OSPF utilitza les mateixes taules que EIGRP:
</p>
<ul>
<li class="level1"><div class="li"> Taula de veïns</div>
</li>
<li class="level1"><div class="li"> Taula topològica</div>
</li>
<li class="level1"><div class="li"> Taula d’encaminament</div>
</li>
</ul>

<p>
La configuració d’OSPF es fa com la resta de protocols d’encaminament, però s’ha d’especificar el número d’àrea en lloc del número de sistema autònom, aquest valor el defineix l’administrador de la xarxa.
</p>
<pre class="code">Router(config)#Router ospf 1
Router(config-router)#network 192.168.1.0</pre>
<div class="iocimportant"><div class="ioccontent">
<p>
El número d’àrea proporciona informació dels dispositius que poden intercanviar les taules i que tenen una taula topològica comú.
</p>
</div></div>
</div>

	 </article>
     <div class="pnpage">
      <div class="left-corner"></div>
      <div id="prevpage">Anar a la p&agrave;gina anterior:<br /><a href="../../../WebContent/u4/a1/exercicis.html">Exercicis d'autoavaluació</a></div>
      <div id="nextpage">Anar a la p&agrave;gina seg&uuml;ent:<br /><a href="../../../WebContent/u4/a2/activitats.html">Activitats</a></div>
      <div class="right-corner"></div>
     </div>
    </div>
    <footer class="footer">
      <div><small>Aquest document està subjecte a una llicència oberta de Creative Commons, es reserva el dret de reconeixement de l'autoria, d'exigir que no se'n faci cap mena d'ús comercial. Si altereu o transformeu aquesta obra, o en genereu obres derivades, només podeu distribuir l'obra generada amb una llicència idèntica a aquesta.</small></div>
    </footer>
 </div>
 <div id="back_preview" class="hidden"></div>
 <div id="preview" class="hidden">
  <div class="prevcontent"></div>
 </div>
 <div id="help-tooltips">
  <div id="help-toc" class="hidden tooltip"><span>Taula de continguts:</span> Ofereix una vista general de l&#39;estructura del m&ograve;dul, que us facilitar&agrave; la navegaci&oacute; a trav&eacute;s dels seus continguts.<span class="arrow-left"></span></div> 
  <div id="help-settings" class="hidden tooltip"><span>Opcions de format:</span> Permet configurar el format de lectura a partir de les vostres prefer&egrave;ncies, modificant la mida de la lletra, el color del fons, l&#39;amplada de la p&agrave;gina o l&#39;ocultaci&oacute; dels continguts complementaris, entre d&#39;altres.<span class="arrow-left"></span></div>
  <div id="help-printer" class="hidden tooltip"><span>Imprimir:</span>  Envia el contingut seleccionat a la impressora.<span class="arrow-left"></span></div>
  <div id="help-favorites" class="hidden tooltip"><span>Prefereits:</span> Permet desar aquelles parts del contingut a les que us interessi accedir en un moment posterior; us permetr&agrave; anar creant un repositori personalitzat de les seccions que considereu m&eacute;s rellevants. Un cop l&#39;hageu començat a fer servir se us mostrar&agrave; a sota un comptador que us informar&agrave; del nombre de preferits que s&#39;hagin emmagatzemat fins al moment.<span class="arrow-left"></span></div>
  <div id="help-favcounter" class="hidden tooltip"><span>Comptador i llistat de preferits:</span> Indica el nombre de preferits que s&#39;han desat fins el moment; clicant damunt seu accedireu al llistat de preferits, i a trav&eacute;s d&#39;aquest podreu accedir directament als continguts que hageu emmagatzemat.<span class="arrow-left"></span></div>
  <div id="help-help_icon" class="hidden tooltip"><span>Ajuda:</span> Aquesta opci&oacute; activa la informaci&oacute; de les funcionalitats del web tot situant el punter del ratol&iacute; al damunt dels diferents &iacute;tems.<span class="arrow-left"></span></div>
  <div id="help-sidebar-hide" class="hidden tooltip"><span>Mostrar/Ocultar barra lateral:</span>  Deshabilita la barra d&#39;opcions, permetent la seva recuperaci&oacute; quan es desitgi.<span class="arrow-left"></span></div>
  <div id="help-search" class="hidden tooltip"><span>Cerca:</span>  Introdu&iuml;u les paraules clau sobre aquells conceptes que desitgeu localitzar en els continguts del m&ograve;dul. Tamb&eacute; podeu excloure un terme de la cerca tot afegint-hi el signe &#8220;-&#8221; al davant.<span class="arrow-top"></span></div>
  <div id="help-header" class="hidden tooltip"><span>Cap&ccedil;alera:</span>  Indica l&#39;apartat o secci&oacute; que es mostra en pantalla. Tingueu present que les capçaleres de segon, tercer i quart nivell tamb&eacute; es poden desar com a marcadors.<span class="arrow-left"></span></div>
</div> 
</body>
</html>
